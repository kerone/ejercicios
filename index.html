<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academia Pokemon - Aprendizaje Divertido</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            font-size: 16px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">🎮</text></svg>') no-repeat center;
            background-size: 200px;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-card h1 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .login-card input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 18px;
            font-family: inherit;
        }

        .login-card button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }

        .login-card button:hover {
            transform: scale(1.05);
        }

        .main-app {
            display: none;
        }

        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
        }

        .stats {
            display: flex;
            gap: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            min-width: 80px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .nav-tab:hover, .nav-tab.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .content-area {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .week-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .week-card:hover {
            transform: translateY(-5px);
        }

        .day-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .day-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .exercise-list {
            margin-top: 15px;
        }

        .exercise-item {
            background: #f8f9fa;
            padding: 8px;
            margin: 6px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .exercise-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 1000px;
            width: 95%;
            max-height: 95%;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .exercise-content {
            text-align: center;
        }

        .learning-hint {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 16px;
            text-align: left;
        }

        .learning-hint strong {
            color: #1976d2;
        }

        .question {
            font-size: 22px;
            margin-bottom: 20px;
            line-height: 1.6;
            text-align: left;
            background: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
        }

        .reading-text {
            background: #f3e5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 18px;
            line-height: 1.8;
            text-align: left;
            border: 2px solid #9c27b0;
        }

        .reading-text h4 {
            color: #7b1fa2;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .option {
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            font-size: 16px;
            text-align: center;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
            animation: correctPulse 0.6s ease-out;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            animation: incorrectShake 0.6s ease-out;
        }

        /* Estilos para ejercicios interactivos */
        .interactive-exercise {
            margin: 20px 0;
        }

        .drag-drop-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .draggable {
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: move;
            user-select: none;
            transition: all 0.3s;
        }

        .draggable:hover {
            background: #5a6fdb;
            transform: scale(1.05);
        }

        .draggable.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            min-height: 50px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 10px;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .drop-zone.drag-over {
            border-color: #667eea;
            background: #e3f2fd;
        }

        .drop-zone.filled {
            background: #d4edda;
            border-color: #28a745;
        }

        .sequence-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .sequence-item {
            width: 60px;
            height: 60px;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sequence-item:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .sequence-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .feedback {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            display: none;
            font-size: 16px;
            line-height: 1.5;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .next-btn {
            background: #667eea;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            display: none;
            font-family: inherit;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
        }

        .reward-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1001;
            animation: popup 0.5s ease-out;
        }

        @keyframes popup {
            from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .achievement-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #ddd;
        }

        .achievement-card.unlocked {
            border-color: #ffd700;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
        }

        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
        }

        .connection-status.online {
            background: #d4edda;
            color: #155724;
        }

        .connection-status.offline {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .stats {
                width: 100%;
                justify-content: center;
            }

            .nav-tabs {
                justify-content: center;
            }

            .modal-content {
                padding: 20px;
                margin: 10px;
                width: 98%;
            }

            .question {
                font-size: 18px;
            }

            .options {
                grid-template-columns: 1fr;
            }

            .day-grid {
                grid-template-columns: 1fr;
            }

            .draggable {
                font-size: 14px;
                padding: 8px 12px;
            }

            .sequence-container {
                gap: 5px;
            }

            .sequence-item {
                width: 50px;
                height: 50px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Indicador de conexión -->
    <div id="connectionStatus" class="connection-status offline">🔄 Conectando...</div>

    <!-- Pantalla de Login -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1>🎮 Academia Pokemon</h1>
            <p style="margin-bottom: 20px; color: #666;">¡Conviértete en el mejor entrenador de conocimientos!</p>
            <input type="text" id="usernameInput" placeholder="Escribe tu nombre de entrenador" maxlength="20">
            <button onclick="login()">¡Comenzar Aventura! 🚀</button>
        </div>
    </div>

    <!-- Aplicación Principal -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="user-info">
                    <div class="avatar">🏆</div>
                    <div>
                        <h2 id="userName">Entrenador</h2>
                        <p>Nivel <span id="userLevel">1</span></p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPoints">0</div>
                        <div>Puntos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="streak">0</div>
                        <div>Racha</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="accuracy">0%</div>
                        <div>Precisión</div>
                    </div>
                </div>
                <button onclick="logout()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Salir</button>
            </div>

            <!-- Navegación -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('training')">🎯 Entrenamiento</button>
                <button class="nav-tab" onclick="showTab('achievements')">🏆 Logros</button>
                <button class="nav-tab" onclick="showTab('stats')">📊 Estadísticas</button>
                <button class="nav-tab" onclick="showTab('admin')">⚙️ Administrar</button>
            </div>

            <!-- Área de contenido -->
            <div class="content-area">
                <!-- Pestaña de Entrenamiento -->
                <div id="trainingTab" class="tab-content">
                    <h2>🗓️ Plan de Entrenamiento Semanal</h2>
                    <div class="week-grid" id="weekGrid"></div>
                    <div id="dayView" style="display: none;">
                        <button onclick="backToWeeks()" style="margin-bottom: 20px; padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer;">← Volver a Semanas</button>
                        <h3 id="dayTitle"></h3>
                        <div class="day-grid" id="dayGrid"></div>
                    </div>
                </div>

                <!-- Pestaña de Logros -->
                <div id="achievementsTab" class="tab-content" style="display: none;">
                    <h2>🏆 Tus Logros de Entrenador</h2>
                    <div class="achievement-grid" id="achievementGrid"></div>
                </div>

                <!-- Pestaña de Estadísticas -->
                <div id="statsTab" class="tab-content" style="display: none;">
                    <h2>📊 Estadísticas Detalladas</h2>
                    <div id="statsContent"></div>
                </div>

                <!-- Pestaña de Administración -->
                <div id="adminTab" class="tab-content" style="display: none;">
                    <h2>⚙️ Panel de Administración</h2>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4>📊 Estado de Guardado</h4>
                        <p>Los datos se guardan automáticamente en JSONBin.io</p>
                        <p><strong>Usuario actual:</strong> <span id="currentUserAdmin"></span></p>
                        <p><strong>Última sincronización:</strong> <span id="lastSync">-</span></p>
                    </div>
                    <button onclick="testConnection()" style="padding: 15px 30px; background: #17a2b8; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">🔄 Probar Conexión</button>
                    <button onclick="resetProgress()" style="padding: 15px 30px; background: #dc3545; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">🔄 Reiniciar Progreso</button>
                    <button onclick="exportData()" style="padding: 15px 30px; background: #28a745; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">📥 Exportar Datos</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ejercicio -->
    <div id="exerciseModal" class="exercise-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeExercise()">×</button>
            <div class="exercise-content">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <h3 id="exerciseTitle"></h3>
                <div id="learningHint" class="learning-hint" style="display: none;"></div>
                <div id="readingText" class="reading-text" style="display: none;"></div>
                <div id="exerciseQuestion" class="question"></div>
                <div id="interactiveArea" class="interactive-exercise" style="display: none;"></div>
                <div id="exerciseOptions" class="options"></div>
                <div id="exerciseFeedback" class="feedback"></div>
                <button id="nextExerciseBtn" class="next-btn" onclick="nextExercise()">Siguiente</button>
            </div>
        </div>
    </div>

    <!-- Popup de Recompensa -->
    <div id="rewardPopup" class="reward-popup">
        <h2 id="rewardTitle"></h2>
        <div id="rewardIcon" style="font-size: 60px; margin: 20px 0;"></div>
        <p id="rewardMessage"></p>
        <button onclick="closeReward()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">¡Genial!</button>
    </div>

    <script>
        // Configuración de JSONBin
        const JSONBIN_CONFIG = {
            binId: '68ee144343b1c97be96704f9',
            masterKey: '$2a$10$byEkgCiPtr6uA9j.sw5Uiuld00jGPRMT1Rn9TlhHYbPe3CFfaEu6G',
            apiUrl: 'https://api.jsonbin.io/v3'
        };

        // Estado global de la aplicación
        let appState = {
            currentUser: null,
            userData: {},
            currentExerciseSet: [],
            currentExerciseIndex: 0,
            currentSessionStats: { correct: 0, total: 0 },
            connectionStatus: 'offline'
        };

        // Base de datos de ejercicios AMPLIADA
        const exerciseDatabase = {
            week1: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>💡 Suma con llevadas:</strong> Cuando la suma de unidades es mayor que 9, "llevamos" a las decenas. Ejemplo: 47 + 28 = ?',
                        question: '🔥 Charizard tenía 47 puntos de ataque. Después de entrenar intensamente con Ash, ganó 28 puntos más. ¿Cuántos puntos de ataque tiene ahora?',
                        options: ['75 puntos', '65 puntos', '71 puntos', '79 puntos'],
                        correct: 0,
                        explanation: '¡Perfecto! 47 + 28 = 75. Recuerda: 7 + 8 = 15, escribimos 5 y llevamos 1. Luego 4 + 2 + 1 = 7.'
                    },
                    {
                        type: 'reading',
                        theme: 'pokemon',
                        learningHint: '<strong>📚 Comprensión lectora:</strong> Lee despacio y busca detalles específicos. Subraya mentalmente las palabras importantes.',
                        readingText: '<h4>🔵 El Entrenamiento de Pikachu</h4>Pikachu es un Pokémon eléctrico muy especial que vive en los densos bosques verdes cerca de Pueblo Paleta. Cada mañana temprano, a las 7:00, entrena sus habilidades eléctricas junto a Ash. Le encanta comer exactamente 12 bayas dulces rojas para desayunar, que encuentra en los árboles más altos del bosque. Su ataque favorito es el "Rayo" porque puede generar hasta 100.000 voltios de electricidad con sus mejillas amarillas brillantes. Pikachu es extremadamente leal y siempre protege a sus amigos del peligro.',
                        question: '¿Cuántas bayas rojas come Pikachu para desayunar cada mañana?',
                        options: ['10 bayas', '12 bayas', '15 bayas', '8 bayas'],
                        correct: 1,
                        explanation: '¡Excelente! El texto dice claramente que "come exactamente 12 bayas dulces rojas para desayunar". ¡Has leído con mucha atención a los detalles!'
                    },
                    {
                        type: 'english',
                        theme: 'pokemon',
                        learningHint: '<strong>🇬🇧 Colores en inglés:</strong> Los colores son palabras muy importantes. "Yellow" suena como "jelo" en español.',
                        question: '🟡 Las mejillas de Pikachu son amarillas y brillantes. ¿Cómo se dice "amarillo" en inglés?',
                        options: ['Red', 'Blue', 'Yellow', 'Green'],
                        correct: 2,
                        explanation: '¡Genial! "Yellow" significa amarillo en inglés. Pikachu has yellow cheeks! (¡Pikachu tiene mejillas amarillas!)'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>✖️ Multiplicación visual:</strong> 6 × 4 significa 6 grupos de 4 objetos. Imagina 6 filas de 4 Pokémon cada una.',
                        question: '🎯 Ash tiene 6 Pokémon en su equipo. Cada Pokémon puede aprender exactamente 4 movimientos diferentes. ¿Cuántos movimientos conoce todo su equipo?',
                        options: ['24 movimientos', '20 movimientos', '26 movimientos', '22 movimientos'],
                        correct: 0,
                        explanation: '¡Perfecto! 6 × 4 = 24 movimientos. Puedes pensarlo como sumar: 4 + 4 + 4 + 4 + 4 + 4 = 24.'
                    },
                    {
                        type: 'interactive',
                        theme: 'pokemon',
                        subtype: 'sequence',
                        learningHint: '<strong>🔢 Secuencias numéricas:</strong> Observa el patrón. Los números pueden aumentar de 2 en 2, de 5 en 5, etc.',
                        question: '🧩 Ayuda a Ash a ordenar estos números de Pokédex de menor a mayor:',
                        data: [25, 1, 150, 9, 144],
                        correctOrder: [1, 9, 25, 144, 150],
                        explanation: '¡Excelente! Has ordenado correctamente: 1 (Bulbasaur), 9 (Blastoise), 25 (Pikachu), 144 (Articuno), 150 (Mewtwo).'
                    },
                    {
                        type: 'science',
                        theme: 'pokemon',
                        learningHint: '<strong>🔬 Estados de la materia:</strong> Sólido (hielo), líquido (agua), gas (vapor). El calor cambia el estado.',
                        question: '🧊 Cuando unPokémon de tipo hielo usa su ataque, convierte el agua líquida en hielo sólido. ¿Qué tipo de cambio de estado es este?',
                        options: ['Evaporación', 'Solidificación', 'Fusión', 'Condensación'],
                        correct: 1,
                        explanation: '¡Correcto! La solidificación es cuando un líquido (agua) se convierte en sólido (hielo). ¡Como los ataques de hielo de los Pokémon!'
                    },
                    {
                        type: 'geography',
                        theme: 'pokemon',
                        learningHint: '<strong>🗺️ Puntos cardinales:</strong> Norte arriba, Sur abajo, Este derecha, Oeste izquierda. Como una brújula.',
                        question: '🧭 Ash viaja desde Pueblo Paleta hacia Ciudad Plateada. Si va hacia donde sale el sol, ¿en qué dirección se mueve?',
                        options: ['Norte', 'Sur', 'Este', 'Oeste'],
                        correct: 2,
                        explanation: '¡Perfecto! El sol sale por el Este. Si Ash va hacia donde sale el sol, se dirige al Este.'
                    }
                ],
                day2: [
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>➕ Sumas con tres números:</strong> Suma de dos en dos: primero 15 + 23 = 38, luego 38 + 17.',
                        question: '⚔️ Eren contó titanes durante tres días consecutivos. El lunes vio 15 titanes, el martes 23 titanes, y el miércoles 17 titanes. ¿Cuántos titanes observó en total?',
                        options: ['55 titanes', '53 titanes', '57 titanes', '52 titanes'],
                        correct: 0,
                        explanation: '¡Correcto! 15 + 23 + 17 = 55 titanes. Paso a paso: 15 + 23 = 38, luego 38 + 17 = 55.'
                    },
                    {
                        type: 'reading',
                        theme: 'titans',
                        learningHint: '<strong>🧱 Organización espacial:</strong> Imagina las murallas como círculos concéntricos, una dentro de otra.',
                        readingText: '<h4>🏰 El Sistema de Murallas Defensivas</h4>Las tres enormes murallas protegen a la humanidad de los gigantes titanes. La muralla exterior se llama María, tiene 50 metros de altura y es la primera línea de defensa contra los titanes. Dentro de María se encuentra la muralla Rose, de 45 metros de altura, que protege las ciudades intermedias. En el centro de todo está la muralla Sina, la más pequeña con 40 metros de altura, pero la más segura, donde vive la familia real. Entre cada muralla hay aproximadamente 100 kilómetros de distancia.',
                        question: '¿Cuál es la altura de la muralla Rose?',
                        options: ['50 metros', '40 metros', '45 metros', '35 metros'],
                        correct: 2,
                        explanation: '¡Muy bien! El texto dice claramente que "la muralla Rose, de 45 metros de altura". ¡Has encontrado la información específica!'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>🗣️ Palabras cognadas:</strong> "Giant" y "gigante" suenan parecido porque vienen de la misma raíz latina.',
                        question: '🗿 Los titanes son criaturas gigantes y terroríficas. ¿Cómo se dice "gigante" en inglés?',
                        options: ['Small', 'Giant', 'Tiny', 'Little'],
                        correct: 1,
                        explanation: '¡Excelente! "Giant" significa gigante. ¿Notaste que suena similar a "gigante" en español?'
                    },
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>✖️ Multiplicación práctica:</strong> 8 × 6 = 48. Piensa en 8 grupos de 6 soldados formados.',
                        question: '🛡️ El escuadrón se organiza en 8 filas de soldados. En cada fila hay 6 soldados. ¿Cuántos soldados hay en total en la formación?',
                        options: ['48 soldados', '42 soldados', '54 soldados', '46 soldados'],
                        correct: 0,
                        explanation: '¡Perfecto! 8 × 6 = 48 soldados. Es como sumar 6 ocho veces: 6+6+6+6+6+6+6+6 = 48.'
                    },
                    {
                        type: 'interactive',
                        theme: 'titans',
                        subtype: 'drag_drop',
                        learningHint: '<strong>📏 Unidades de medida:</strong> Metro para altura, kilómetro para distancias largas, gramo para peso.',
                        question: '📐 Arrastra cada medida a la unidad correcta:',
                        data: {
                            items: ['Altura de muralla', 'Distancia entre ciudades', 'Peso de una espada'],
                            zones: ['Metros', 'Kilómetros', 'Gramos'],
                            correct: [0, 1, 2]
                        },
                        explanation: '¡Genial! Altura se mide en metros, distancias largas en kilómetros, y peso en gramos.'
                    },
                    {
                        type: 'history',
                        theme: 'titans',
                        learningHint: '<strong>🏛️ Épocas históricas:</strong> Prehistoria (sin escritura), Edad Antigua (pirámides), Edad Media (castillos).',
                        question: '🏰 Las murallas de la serie recuerdan a las fortificaciones medievales. ¿En qué época histórica se construían castillos y murallas defensivas?',
                        options: ['Prehistoria', 'Edad Antigua', 'Edad Media', 'Edad Moderna'],
                        correct: 2,
                        explanation: '¡Correcto! En la Edad Media se construían castillos y murallas para defenderse. ¡Como las murallas contra los titanes!'
                    },
                    {
                        type: 'body',
                        theme: 'titans',
                        learningHint: '<strong>💪 Sistema muscular:</strong> Los músculos nos permiten moverse. Los soldados necesitan músculos fuertes.',
                        question: '💪 Los soldados de las murallas necesitan músculos fuertes para manejar sus equipos. ¿Qué parte del cuerpo humano permite el movimiento?',
                        options: ['Los huesos', 'Los músculos', 'La piel', 'Los nervios'],
                        correct: 1,
                        explanation: '¡Perfecto! Los músculos son los que nos permiten movernos y hacer fuerza, como los soldados entrenados.'
                    }
                ],
                day3: [
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>➕➖ Operaciones combinadas:</strong> Primero suma todos los goles de cada equipo, luego resta para comparar.',
                        question: '⚽ En el partido de ayer, el Real Madrid metió 2 goles en el primer tiempo y 3 en el segundo. El Barcelona metió 1 gol en el primer tiempo y 3 en el segundo. ¿Cuál fue la diferencia de goles?',
                        options: ['1 gol', '2 goles', '0 goles', '3 goles'],
                        correct: 0,
                        explanation: '¡Muy bien! Real Madrid: 2 + 3 = 5 goles. Barcelona: 1 + 3 = 4 goles. Diferencia: 5 - 4 = 1 gol a favor del Real Madrid.'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>🏃‍♂️ Datos biográficos:</strong> Busca información específica sobre la persona: origen, profesión, logros.',
                        readingText: '<h4>⭐ Lionel Messi: Una Leyenda del Fútbol</h4>Lionel Andrés Messi nació el 24 de junio de 1987 en Rosario, Argentina, una ciudad de Sudamérica. Comenzó a jugar fútbol profesional a los 17 años en el FC Barcelona de España. Messi es famoso mundialmente por ser un delantero extraordinariamente hábil con la pelota y por haber ganado 7 premios Balón de Oro, más que cualquier otro jugador en la historia. Mide 1,70 metros de altura y es conocido por su increíble velocidad y técnica de dribleo. En 2022 logró su mayor sueño: ganar la Copa del Mundo con Argentina.',
                        question: '¿En qué año nació Lionel Messi según el texto?',
                        options: ['1986', '1987', '1988', '1985'],
                        correct: 1,
                        explanation: '¡Perfecto! El texto dice claramente que "nació el 24 de junio de 1987". ¡Has leído con mucha precisión!'
                    },
                    {
                        type: 'english',
                        theme: 'football',
                        learningHint: '<strong>⚽ Deportes en inglés:</strong> "Ball" viene de la palabra germánica para pelota. Se usa en muchos deportes.',
                        question: '⚽ En el fútbol, los jugadores patean la pelota con los pies. ¿Cómo se dice "pelota" en inglés?',
                        options: ['Ball', 'Goal', 'Field', 'Player'],
                        correct: 0,
                        explanation: '¡Genial! "Ball" significa pelota. Football = foot (pie) + ball (pelota) = fútbol.'
                    },
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>✖️ Problemas de multiplicación:</strong> 11 jugadores × 2 equipos. Cada equipo tiene el mismo número de jugadores.',
                        question: '👥 En un partido oficial de fútbol juegan 2 equipos completos. Cada equipo tiene 11 jugadores en el campo. ¿Cuántos jugadores están jugando en total?',
                        options: ['22 jugadores', '20 jugadores', '24 jugadores', '18 jugadores'],
                        correct: 0,
                        explanation: '¡Excelente! 11 × 2 = 22 jugadores en total. También puedes sumar: 11 + 11 = 22.'
                    },
                    {
                        type: 'interactive',
                        theme: 'football',
                        subtype: 'sequence',
                        learningHint: '<strong>⏰ Tiempo en el deporte:</strong> Un partido dura 90 minutos: 45 + 45. Se divide en dos tiempos.',
                        question: '⏱️ Ordena las fases de un partido de fútbol:',
                        data: ['Segundo tiempo', 'Calentamiento', 'Primer tiempo', 'Descanso', 'Final del partido'],
                        correctOrder: ['Calentamiento', 'Primer tiempo', 'Descanso', 'Segundo tiempo', 'Final del partido'],
                        explanation: '¡Perfecto! Has ordenado correctamente las fases de un partido de fútbol.'
                    },
                    {
                        type: 'geography',
                        theme: 'football',
                        learningHint: '<strong>🌍 Países y continentes:</strong> Argentina está en Sudamérica, España en Europa.',
                        question: '🌎 Messi nació en Argentina. ¿En qué continente está Argentina?',
                        options: ['Europa', 'Sudamérica', 'África', 'Asia'],
                        correct: 1,
                        explanation: '¡Correcto! Argentina está en Sudamérica, junto con países como Brasil, Chile y Perú.'
                    },
                    {
                        type: 'body',
                        theme: 'football',
                        learningHint: '<strong>🦵 Partes del cuerpo:</strong> Los futbolistas usan principalmente las piernas y los pies para jugar.',
                        question: '🦶 Los futbolistas necesitan tener piernas muy fuertes. ¿Cuál es el hueso más largo del cuerpo humano?',
                        options: ['El húmero (brazo)', 'El fémur (muslo)', 'La tibia (espinilla)', 'El radio (antebrazo)'],
                        correct: 1,
                        explanation: '¡Perfecto! El fémur, que está en el muslo, es el hueso más largo y fuerte del cuerpo humano.'
                    }
                ],
                day4: [
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>➖ Resta con llevadas:</strong> Si necesitas quitar más de lo que tienes en una posición, "pides prestado" a la siguiente.',
                        question: '🔫 Un Tenno empieza su misión con 124 puntos de energía. Usa 67 puntos para sus habilidades especiales. ¿Cuánta energía le queda?',
                        options: ['57 puntos', '63 puntos', '51 puntos', '59 puntos'],
                        correct: 0,
                        explanation: '¡Perfecto! 124 - 67 = 57 puntos. En la resta: 4 - 7 no se puede, pido prestado: 14 - 7 = 7, luego 1 - 6 no se puede, pido prestado: 11 - 6 = 5.'
                    },
                    {
                        type: 'reading',
                        theme: 'warframe',
                        learningHint: '<strong>🚀 Ciencia ficción:</strong> Busca información sobre tecnología futurista y características especiales.',
                        readingText: '<h4>🤖 Los Guerreros Tenno del Futuro</h4>Los Tenno son antiguos guerreros espaciales que despertaron después de siglos durmiendo en criosueño. Utilizan armaduras bio-mecánicas llamadas Warframes que les otorgan poderes sobrenaturales únicos. Existen más de 50 tipos diferentes de Warframes: algunos se especializan en velocidad extrema como Volt, otros en fuerza bruta como Rhino, y algunos en sigilo como Ash. Cada Warframe puede usar hasta 4 habilidades especiales diferentes. Los Tenno protegen el Sistema Solar viajando entre planetas como Marte, Venus, Júpiter y Saturno usando naves espaciales llamadas Orbiter.',
                        question: '¿Cuántos tipos diferentes de Warframes existen según el texto?',
                        options: ['Más de 40', 'Exactamente 50', 'Más de 50', 'Menos de 50'],
                        correct: 2,
                        explanation: '¡Excelente! El texto dice "más de 50 tipos diferentes de Warframes". ¡Has leído con mucha atención!'
                    },
                    {
                        type: 'english',
                        theme: 'warframe',
                        learningHint: '<strong>🌌 Vocabulario espacial:</strong> "Space" se relaciona con astronauta, spaceship (nave espacial).',
                        question: '🌌 Los Tenno son guerreros que luchan en el espacio exterior. ¿Cómo se dice "espacio" en inglés?',
                        options: ['Space', 'Time', 'World', 'Sky'],
                        correct: 0,
                        explanation: '¡Perfecto! "Space" significa espacio. Outer space = espacio exterior, donde luchan los Tenno.'
                    },
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>✖️ Multiplicación de dos cifras:</strong> 15 × 4 = (10 × 4) + (5 × 4) = 40 + 20 = 60.',
                        question: '🪐 Un Tenno debe completar misiones en 15 planetas diferentes. En cada planeta hay 4 misiones obligatorias. ¿Cuántas misiones debe completar en total?',
                        options: ['60 misiones', '55 misiones', '65 misiones', '50 misiones'],
                        correct: 0,
                        explanation: '¡Genial! 15 × 4 = 60 misiones. Puedes calcularlo como (10 × 4) + (5 × 4) = 40 + 20 = 60.'
                    },
                    {
                        type: 'interactive',
                        theme: 'warframe',
                        subtype: 'drag_drop',
                        learningHint: '<strong>🌌 Sistema Solar:</strong> Los planetas tienen orden desde el Sol: Mercurio, Venus, Tierra, Marte...',
                        question: '🌍 Arrastra cada planeta a su posición correcta desde el Sol:',
                        data: {
                            items: ['Marte', 'Venus', 'Tierra'],
                            zones: ['2º planeta', '3º planeta', '4º planeta'],
                            correct: [1, 2, 0]
                        },
                        explanation: '¡Perfecto! Venus (2º), Tierra (3º), Marte (4º). Los Tenno luchan en todos estos mundos.'
                    },
                    {
                        type: 'science',
                        theme: 'warframe',
                        learningHint: '<strong>🌍 El Sistema Solar:</strong> Hay 8 planetas que giran alrededor del Sol. Los más cercanos son rocosos.',
                        question: '🌍 Los Tenno protegen el Sistema Solar. ¿Cuántos planetas principales hay en nuestro Sistema Solar?',
                        options: ['7 planetas', '8 planetas', '9 planetas', '10 planetas'],
                        correct: 1,
                        explanation: '¡Correcto! Hay 8 planetas: Mercurio, Venus, Tierra, Marte, Júpiter, Saturno, Urano y Neptuno.'
                    },
                    {
                        type: 'technology',
                        theme: 'warframe',
                        learningHint: '<strong>💻 Tecnología:</strong> Los robots y la inteligencia artificial son parte de la ciencia moderna.',
                        question: '🤖 Los Warframes son como robots avanzados. ¿Cómo se llama la ciencia que estudia los robots?',
                        options: ['Biología', 'Robótica', 'Geología', 'Astronomía'],
                        correct: 1,
                        explanation: '¡Perfecto! La robótica es la ciencia que estudia y desarrolla robots, como los Warframes futuristas.'
                    }
                ],
                day5: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>➗ División exacta:</strong> Dividir es repartir en partes iguales. 24 ÷ 6 = 4 significa que cada grupo tiene 4.',
                        question: '🔴 Ash tiene 24 Pokéballs nuevas y quiere repartirlas igualmente entre sus 6 amigos entrenadores. ¿Cuántas Pokéballs recibirá cada amigo?',
                        options: ['4 Pokéballs', '5 Pokéballs', '3 Pokéballs', '6 Pokéballs'],
                        correct: 0,
                        explanation: '¡Perfecto! 24 ÷ 6 = 4 Pokéballs cada uno. Puedes comprobarlo: 4 × 6 = 24. ¡Ash es muy generoso!'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>🥅 Reglas deportivas:</strong> Presta atención a las reglas especiales y las excepciones.',
                        readingText: '<h4>⚽ Las Reglas Básicas del Fútbol</h4>En un partido oficial de fútbol, cada equipo tiene exactamente 11 jugadores en el campo simultáneamente. De estos 11 jugadores, hay 10 jugadores de campo que pueden correr libremente por todo el terreno, pero tienen una regla muy importante: solo pueden tocar la pelota con los pies, la cabeza, el pecho y los hombros. Sin embargo, existe un jugador muy especial llamado portero o guardameta. El portero es el único jugador de todo el equipo que puede usar las manos para tocar la pelota, pero esta regla especial solo funciona cuando está dentro de su área de penalti, que es un rectángulo de 16,5 metros marcado frente a su portería.',
                        question: '¿Cuántos jugadores de campo (sin contar el portero) hay en cada equipo?',
                        options: ['9 jugadores', '10 jugadores', '11 jugadores', '12 jugadores'],
                        correct: 1,
                        explanation: '¡Correcto! Son 11 jugadores en total: 10 jugadores de campo + 1 portero = 11 jugadores por equipo.'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>🧱 Construcciones:</strong> "Wall" también se usa en "Great Wall of China" (Gran Muralla China).',
                        question: '🏰 Las murallas protegen a la humanidad de los titanes. ¿Cómo se dice "muralla" o "muro" en inglés?',
                        options: ['Wall', 'Door', 'Window', 'Roof'],
                        correct: 0,
                        explanation: '¡Excelente! "Wall" significa muro o muralla. The Great Wall = La Gran Muralla (de China).'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>🔢 Fracciones básicas:</strong> 1/2 es la mitad, 1/3 es un tercio, 1/4 es un cuarto.',
                        question: '🍎 Pikachu tiene 8 bayas para comer. Si se come la mitad en el desayuno, ¿cuántas bayas se comió?',
                        options: ['4 bayas', '3 bayas', '5 bayas', '2 bayas'],
                        correct: 0,
                        explanation: '¡Perfecto! La mitad de 8 es 4. La mitad (1/2) significa dividir entre 2: 8 ÷ 2 = 4 bayas.'
                    },
                    {
                        type: 'interactive',
                        theme: 'mixed',
                        subtype: 'sequence',
                        learningHint: '<strong>📅 Días de la semana:</strong> Lunes es el primer día laborable, domingo el último día del fin de semana.',
                        question: '📅 Ordena los días de la semana correctamente:',
                        data: ['Miércoles', 'Lunes', 'Viernes', 'Martes', 'Jueves'],
                        correctOrder: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes'],
                        explanation: '¡Genial! Has ordenado perfectamente los días laborables de la semana.'
                    },
                    {
                        type: 'grammar',
                        theme: 'pokemon',
                        learningHint: '<strong>📝 Nombres propios:</strong> Los nombres de personas, lugares y Pokémon se escriben con mayúscula inicial.',
                        question: '✏️ ¿Cuál de estas palabras debe escribirse con mayúscula inicial?',
                        options: ['pelota', 'pikachu', 'amarillo', 'rápido'],
                        correct: 1,
                        explanation: '¡Correcto! "Pikachu" es un nombre propio (de un Pokémon específico) y se debe escribir con mayúscula: Pikachu.'
                    },
                    {
                        type: 'values',
                        theme: 'mixed',
                        learningHint: '<strong>❤️ Valores sociales:</strong> El respeto, la ayuda mutua y la honestidad son valores importantes.',
                        question: '🤝 Ash siempre ayuda a sus amigos cuando tienen problemas. ¿Qué valor positivo demuestra Ash?',
                        options: ['Egoísmo', 'Solidaridad', 'Envidia', 'Pereza'],
                        correct: 1,
                        explanation: '¡Perfecto! Ash demuestra solidaridad al ayudar a sus amigos. La solidaridad es ayudar a otros sin esperar nada a cambio.'
                    }
                ]
            },
            week2: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>✖️ Tablas de multiplicar:</strong> La tabla del 7 es: 7×1=7, 7×2=14, 7×3=21, 7×4=28, 7×5=35.',
                        question: '🔥 Charizard entrena 7 horas cada día durante 5 días seguidos. ¿Cuántas horas entrenó en total?',
                        options: ['35 horas', '32 horas', '40 horas', '28 horas'],
                        correct: 0,
                        explanation: '¡Correcto! 7 × 5 = 35 horas. La tabla del 7: 7×5 = 35. ¡Charizard entrena muchísimo!'
                    },
                    {
                        type: 'reading',
                        theme: 'titans',
                        learningHint: '<strong>📊 Datos numéricos:</strong> Cuando leas textos con números, anótalos mentalmente o subráyalos.',
                        readingText: '<h4>⚔️ La Gran Expedición Exploratoria</h4>El comandante Erwin organizó la expedición más grande de la historia para explorar más allá de la muralla María. La expedición estaba compuesta por 150 soldados de élite montados a caballo, divididos en 3 escuadrones de 50 soldados cada uno. Llevaban provisiones para 12 días de viaje y partieron al amanecer del día 15 de marzo. Durante las primeras 6 horas de viaje, avanzaron 42 kilómetros sin encontrar ningún titán. Sin embargo, al mediodía descubrieron las huellas de un titán gigante de 15 metros de altura que había pasado por allí recientemente.',
                        question: '¿Cuántos kilómetros avanzaron durante las primeras 6 horas?',
                        options: ['40 kilómetros', '45 kilómetros', '42 kilómetros', '38 kilómetros'],
                        correct: 2,
                        explanation: '¡Excelente! El texto dice "avanzaron 42 kilómetros sin encontrar ningún titán". ¡Has prestado atención a los detalles numéricos!'
                    },
                    {
                        type: 'english',
                        theme: 'football',
                        learningHint: '<strong>🏃‍♂️ Verbos de movimiento:</strong> "Run" (correr), "walk" (caminar), "jump" (saltar).',
                        question: '🏃‍♂️ Los futbolistas corren muy rápido por el campo durante 90 minutos. ¿Cómo se dice "correr" en inglés?',
                        options: ['Walk', 'Run', 'Stop', 'Sit'],
                        correct: 1,
                        explanation: '¡Genial! "Run" significa correr. Football players run fast! (¡Los futbolistas corren rápido!)'
                    },
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>🔢 Números grandes:</strong> 1.000 = mil, 10.000 = diez mil, 100.000 = cien mil.',
                        question: '🔫 Un Tenno ha completado misiones y ganado 1.250 puntos de experiencia en la primera semana y 2.375 puntos en la segunda semana. ¿Cuántos puntos tiene en total?',
                        options: ['3.625 puntos', '3.525 puntos', '3.725 puntos', '3.500 puntos'],
                        correct: 0,
                        explanation: '¡Perfecto! 1.250 + 2.375 = 3.625 puntos. Suma las unidades, luego decenas, centenas y miles.'
                    },
                    {
                        type: 'interactive',
                        theme: 'science',
                        subtype: 'drag_drop',
                        learningHint: '<strong>🔬 Estados de la materia:</strong> Sólido (forma fija), líquido (toma forma del recipiente), gas (llena todo el espacio).',
                        question: '🧪 Clasifica estos elementos según su estado:',
                        data: {
                            items: ['Hielo', 'Vapor de agua', 'Agua del grifo'],
                            zones: ['Sólido', 'Líquido', 'Gas'],
                            correct: [0, 2, 1]
                        },
                        explanation: '¡Excelente! Hielo = sólido, agua = líquido, vapor = gas. ¡Son el mismo elemento en diferentes estados!'
                    },
                    {
                        type: 'geography',
                        theme: 'football',
                        learningHint: '<strong>🗺️ Capitales de España:</strong> Madrid es la capital, Barcelona es en Cataluña, Sevilla en Andalucía.',
                        question: '🏛️ El Real Madrid juega en la capital de España. ¿Cuál es la capital de España?',
                        options: ['Barcelona', 'Madrid', 'Sevilla', 'Valencia'],
                        correct: 1,
                        explanation: '¡Correcto! Madrid es la capital de España, donde juega el Real Madrid en el estadio Santiago Bernabéu.'
                    },
                    {
                        type: 'nature',
                        theme: 'pokemon',
                        learningHint: '<strong>🌱 Partes de las plantas:</strong> Raíz (bajo tierra), tallo (soporte), hojas (respiran), flores (reproducción).',
                        question: '🌳 Pikachu busca bayas en los árboles del bosque. ¿Qué parte de la planta produce las frutas y bayas?',
                        options: ['Las raíces', 'El tallo', 'Las hojas', 'Las flores'],
                        correct: 3,
                        explanation: '¡Perfecto! Las flores se transforman en frutos y bayas después de la polinización. ¡Por eso Pikachu encuentra bayas donde antes había flores!'
                    },
                    {
                        type: 'money',
                        theme: 'pokemon',
                        learningHint: '<strong>💰 Euros y céntimos:</strong> 1 euro = 100 céntimos. Para sumar dinero, suma euros con euros y céntimos con céntimos.',
                        question: '💰 Ash compra 3 Pokéballs que cuestan 1,50 euros cada una. ¿Cuánto paga en total?',
                        options: ['4,50 euros', '4,00 euros', '5,00 euros', '3,50 euros'],
                        correct: 0,
                        explanation: '¡Genial! 3 × 1,50 = 4,50 euros. También puedes pensarlo como 1,50 + 1,50 + 1,50 = 4,50 euros.'
                    }
                ]
            }
        };

        // Logros disponibles AMPLIADOS
        const achievements = [
            { id: 'first_exercise', name: 'Primer Paso', description: 'Completa tu primer ejercicio', icon: '🎯', requirement: 1 },
            { id: 'math_master', name: 'Maestro Matemático', description: 'Completa 20 ejercicios de matemáticas', icon: '🧮', requirement: 20 },
            { id: 'reading_hero', name: 'Héroe de la Lectura', description: 'Completa 20 ejercicios de comprensión lectora', icon: '📚', requirement: 20 },
            { id: 'english_expert', name: 'Experto en Inglés', description: 'Completa 15 ejercicios de inglés', icon: '🇬🇧', requirement: 15 },
            { id: 'perfect_day', name: 'Día Perfecto', description: 'Completa todos los ejercicios de un día sin errores', icon: '⭐', requirement: 1 },
            { id: 'streak_week', name: 'Racha Semanal', description: 'Mantén una racha de 7 días', icon: '🔥', requirement: 7 },
            { id: 'multiplication_master', name: 'Maestro de la Multiplicación', description: 'Completa 15 ejercicios de multiplicación correctos', icon: '✖️', requirement: 15 },
            { id: 'reading_champion', name: 'Campeón de Lectura', description: 'Lee 25 textos completos', icon: '👑', requirement: 25 },
            { id: 'interactive_genius', name: 'Genio Interactivo', description: 'Completa 10 ejercicios interactivos', icon: '🧩', requirement: 10 },
            { id: 'science_explorer', name: 'Explorador Científico', description: 'Completa 10 ejercicios de ciencias', icon: '🔬', requirement: 10 },
            { id: 'speed_demon', name: 'Demonio de Velocidad', description: 'Completa un día en menos de 20 minutos', icon: '⚡', requirement: 1 },
            { id: 'hundred_club', name: 'Club de los 100', description: 'Alcanza 100 ejercicios completados', icon: '💯', requirement: 100 }
        ];

        // Funciones de autenticación
        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('¡Por favor escribe tu nombre!');
                return;
            }
            
            appState.currentUser = username;
            await loadUserData();
            showMainApp();
        }

        function logout() {
            if (confirm('¿Estás seguro de que quieres salir?')) {
                appState.currentUser = null;
                appState.userData = {};
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        }

        // Gestión de datos con JSONBin
        async function loadUserData() {
            updateConnectionStatus('connecting');
            try {
                console.log('Cargando datos del usuario:', appState.currentUser);
                
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Respuesta del servidor:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Datos recibidos:', data);
                    
                    const users = data.record?.users || {};
                    appState.userData = users[appState.currentUser] || createNewUser();
                    
                    console.log('Datos del usuario cargados:', appState.userData);
                    updateConnectionStatus('online');
                } else {
                    console.log('Error en respuesta, creando usuario nuevo');
                    appState.userData = createNewUser();
                    updateConnectionStatus('offline');
                }
            } catch (error) {
                console.error('Error cargando datos:', error);
                appState.userData = createNewUser();
                updateConnectionStatus('offline');
            }
            
            updateLastSyncTime();
        }

        async function saveUserData() {
            try {
                console.log('Guardando datos del usuario:', appState.currentUser);
                updateConnectionStatus('saving');
                
                let allData = { users: {} };
                
                try {
                    const getCurrentResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': JSONBIN_CONFIG.masterKey,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (getCurrentResponse.ok) {
                        const currentData = await getCurrentResponse.json();
                        allData = currentData.record || { users: {} };
                    }
                } catch (error) {
                    console.log('No se pudieron obtener datos existentes, creando estructura nueva');
                }
                
                if (!allData.users) {
                    allData.users = {};
                }
                allData.users[appState.currentUser] = {
                    ...appState.userData,
                    lastSaved: new Date().toISOString()
                };
                
                console.log('Datos a guardar:', allData);
                
                const saveResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    },
                    body: JSON.stringify(allData)
                });
                
                if (saveResponse.ok) {
                    console.log('✅ Datos guardados exitosamente en JSONBin');
                    updateConnectionStatus('online');
                    updateLastSyncTime();
                } else {
                    console.error('❌ Error al guardar:', saveResponse.status);
                    updateConnectionStatus('error');
                }
                
            } catch (error) {
                console.error('❌ Error guardando datos:', error);
                updateConnectionStatus('error');
            }
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            appState.connectionStatus = status;
            
            switch (status) {
                case 'online':
                    statusElement.textContent = '✅ Conectado';
                    statusElement.className = 'connection-status online';
                    break;
                case 'offline':
                    statusElement.textContent = '❌ Sin conexión';
                    statusElement.className = 'connection-status offline';
                    break;
                case 'connecting':
                    statusElement.textContent = '🔄 Conectando...';
                    statusElement.className = 'connection-status offline';
                    break;
                case 'saving':
                    statusElement.textContent = '💾 Guardando...';
                    statusElement.className = 'connection-status online';
                    break;
                case 'error':
                    statusElement.textContent = '⚠️ Error de conexión';
                    statusElement.className = 'connection-status offline';
                    break;
            }
        }

        function updateLastSyncTime() {
            const now = new Date().toLocaleString('es-ES');
            const adminElement = document.getElementById('lastSync');
            if (adminElement) {
                adminElement.textContent = now;
            }
        }

        async function testConnection() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                    alert('✅ Conexión exitosa con JSONBin.io');
                } else {
                    updateConnectionStatus('error');
                    alert('❌ Error de conexión: ' + response.status);
                }
            } catch (error) {
                updateConnectionStatus('error');
                alert('❌ Error de red: ' + error.message);
            }
        }

        function createNewUser() {
            return {
                level: 1,
                totalPoints: 0,
                streak: 0,
                totalExercises: 0,
                correctAnswers: 0,
                exercisesByType: { 
                    math: 0, reading: 0, english: 0, interactive: 0, 
                    science: 0, geography: 0, history: 0, body: 0, 
                    technology: 0, grammar: 0, values: 0, nature: 0, money: 0 
                },
                exercisesByTheme: { pokemon: 0, titans: 0, football: 0, warframe: 0, mixed: 0 },
                multiplicationExercises: 0,
                textsRead: 0,
                interactiveExercises: 0,
                perfectDays: 0,
                fastestDay: null,
                completedExercises: {},
                achievements: [],
                sessionStartTime: null,
                created: new Date().toISOString(),
                lastActivity: new Date().toISOString()
            };
        }

        // Interfaz principal
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUserInterface();
            generateWeeks();
            
            const adminUser = document.getElementById('currentUserAdmin');
            if (adminUser) {
                adminUser.textContent = appState.currentUser;
            }
        }

        function updateUserInterface() {
            document.getElementById('userName').textContent = appState.currentUser;
            document.getElementById('userLevel').textContent = appState.userData.level;
            document.getElementById('totalPoints').textContent = appState.userData.totalPoints;
            document.getElementById('streak').textContent = appState.userData.streak;
            
            const accuracy = appState.userData.totalExercises > 0 
                ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100)
                : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // Gestión de pestañas
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'achievements') {
                loadAchievements();
            } else if (tabName === 'stats') {
                loadStats();
            }
        }

        // Generación de semanas
        function generateWeeks() {
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';
            
            const availableWeeks = Object.keys(exerciseDatabase).length;
            
            for (let week = 1; week <= availableWeeks; week++) {
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card';
                weekCard.onclick = () => showWeek(week);
                
                const completedDays = getCompletedDaysInWeek(week);
                const totalDays = 5;
                
                weekCard.innerHTML = `
                    <h3>🗓️ Semana ${week}</h3>
                    <p>Progreso: ${completedDays}/${totalDays} días completados</p>
                    <div style="margin-top: 15px;">
                        <div style="background: rgba(255,255,255,0.3); height: 8px; border-radius: 4px;">
                            <div style="background: white; height: 100%; width: ${(completedDays/totalDays)*100}%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; font-size: 14px;">🎯 ${getTotalExercisesInWeek(week)} ejercicios por día</p>
                `;
                
                weekGrid.appendChild(weekCard);
            }
        }

        function getTotalExercisesInWeek(week) {
            const weekKey = `week${week}`;
            if (exerciseDatabase[weekKey] && exerciseDatabase[weekKey].day1) {
                return exerciseDatabase[weekKey].day1.length;
            }
            return 4;
        }

        function getCompletedDaysInWeek(week) {
            let completed = 0;
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${week}_day${day}`;
                if (appState.userData.completedExercises[dayKey]) {
                    completed++;
                }
            }
            return completed;
        }

        function showWeek(weekNumber) {
            document.getElementById('weekGrid').style.display = 'none';
            document.getElementById('dayView').style.display = 'block';
            
            const dayGrid = document.getElementById('dayGrid');
            dayGrid.innerHTML = '';
            
            const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes'];
            
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${weekNumber}_day${day}`;
                const isCompleted = appState.userData.completedExercises[dayKey];
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                if (isCompleted) {
                    dayCard.style.background = 'linear-gradient(135deg, #d4edda, #c3e6cb)';
                    dayCard.style.borderLeft = '5px solid #28a745';
                }
                
                dayCard.onclick = () => startDay(weekNumber, day);
                
                const exercises = getDayExercises(weekNumber, day);
                const exerciseList = exercises.map(ex => `
                    <div class="exercise-item">
                        <span>${getExerciseIcon(ex.type)} ${getExerciseTitle(ex.type, ex.theme)}</span>
                        <span>${isCompleted ? '✅' : '⏳'}</span>
                    </div>
                `).join('');
                
                const timeEstimate = Math.ceil(exercises.length * 4); // 4 minutos por ejercicio aproximadamente
                
                dayCard.innerHTML = `
                    <h4>${days[day-1]} - Día ${day}</h4>
                    <p style="color: #666; margin-bottom: 15px;">🕐 ~${timeEstimate} minutos | ${exercises.length} ejercicios</p>
                    <div class="exercise-list">
                        ${exerciseList}
                    </div>
                    ${isCompleted ? '<div style="margin-top: 15px; color: #28a745; font-weight: bold;">🎉 ¡Día completado!</div>' : ''}
                `;
                
                dayGrid.appendChild(dayCard);
            }
        }

        function backToWeeks() {
            document.getElementById('weekGrid').style.display = 'grid';
            document.getElementById('dayView').style.display = 'none';
        }

        function getDayExercises(week, day) {
            const weekKey = `week${week}`;
            const dayKey = `day${day}`;
            
            if (exerciseDatabase[weekKey] && exerciseDatabase[weekKey][dayKey]) {
                return exerciseDatabase[weekKey][dayKey];
            }
            
            // Si no hay ejercicios, usar ejercicios base
            return exerciseDatabase.week1.day1.slice(0, 4);
        }

        function getExerciseIcon(type) {
            const icons = {
                math: '🧮',
                reading: '📖',
                english: '🇬🇧',
                interactive: '🧩',
                science: '🔬',
                geography: '🌍',
                history: '🏛️',
                body: '🫀',
                technology: '💻',
                grammar: '✏️',
                values: '❤️',
                nature: '🌱',
                money: '💰'
            };
            return icons[type] || '📝';
        }

        function getExerciseTitle(type, theme) {
            const titles = {
                math: 'Matemáticas',
                reading: 'Comprensión Lectora',
                english: 'Inglés',
                interactive: 'Ejercicio Interactivo',
                science: 'Ciencias Naturales',
                geography: 'Geografía',
                history: 'Historia',
                body: 'Cuerpo Humano',
                technology: 'Tecnología',
                grammar: 'Gramática',
                values: 'Valores',
                nature: 'Naturaleza',
                money: 'Dinero'
            };
            
            const themes = {
                pokemon: 'Pokémon',
                titans: 'Titanes',
                football: 'Fútbol',
                warframe: 'Warframe',
                mixed: 'Variado'
            };
            
            return `${titles[type]} - ${themes[theme] || 'General'}`;
        }

        // Sistema de ejercicios MEJORADO
        function startDay(week, day) {
            const exercises = getDayExercises(week, day);
            appState.currentExerciseSet = exercises;
            appState.currentExerciseIndex = 0;
            appState.currentSessionStats = { 
                correct: 0, 
                total: 0, 
                week, 
                day,
                startTime: new Date().getTime()
            };
            
            showExercise();
        }

        function showExercise() {
            const modal = document.getElementById('exerciseModal');
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            
            document.getElementById('exerciseTitle').textContent = getExerciseTitle(exercise.type, exercise.theme);
            
            // Mostrar pista de aprendizaje
            const hintElement = document.getElementById('learningHint');
            if (exercise.learningHint) {
                hintElement.innerHTML = exercise.learningHint;
                hintElement.style.display = 'block';
            } else {
                hintElement.style.display = 'none';
            }
            
            // Mostrar texto de lectura si existe
            const readingElement = document.getElementById('readingText');
            if (exercise.readingText) {
                readingElement.innerHTML = exercise.readingText;
                readingElement.style.display = 'block';
                appState.userData.textsRead++;
            } else {
                readingElement.style.display = 'none';
            }
            
            document.getElementById('exerciseQuestion').innerHTML = exercise.question;
            
            // Ocultar elementos por defecto
            document.getElementById('exerciseOptions').style.display = 'none';
            document.getElementById('interactiveArea').style.display = 'none';
            document.getElementById('exerciseFeedback').style.display = 'none';
            document.getElementById('nextExerciseBtn').style.display = 'none';
            
            // Mostrar contenido según el tipo de ejercicio
            if (exercise.type === 'interactive') {
                showInteractiveExercise(exercise);
            } else {
                showNormalExercise(exercise);
            }
            
            // Actualizar barra de progreso
            const progress = ((appState.currentExerciseIndex + 1) / appState.currentExerciseSet.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            modal.style.display = 'flex';
        }

        function showNormalExercise(exercise) {
            const optionsContainer = document.getElementById('exerciseOptions');
            optionsContainer.style.display = 'grid';
            optionsContainer.innerHTML = '';
            
            exercise.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
        }

        function showInteractiveExercise(exercise) {
            const interactiveArea = document.getElementById('interactiveArea');
            interactiveArea.style.display = 'block';
            
            if (exercise.subtype === 'sequence') {
                createSequenceExercise(exercise);
            } else if (exercise.subtype === 'drag_drop') {
                createDragDropExercise(exercise);
            }
        }

        function createSequenceExercise(exercise) {
            const interactiveArea = document.getElementById('interactiveArea');
            let selectedOrder = [];
            
            interactiveArea.innerHTML = `
                <div class="sequence-container" id="sequenceItems"></div>
                <div style="margin: 20px 0;">
                    <p><strong>Orden seleccionado:</strong></p>
                    <div id="selectedOrder" style="min-height: 40px; border: 2px dashed #ccc; padding: 10px; border-radius: 8px; margin: 10px 0;"></div>
                </div>
                <button onclick="checkSequence()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">Comprobar Orden</button>
                <button onclick="resetSequence()" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-left: 10px;">Reiniciar</button>
            `;
            
            const container = document.getElementById('sequenceItems');
            const shuffledData = [...exercise.data].sort(() => Math.random() - 0.5);
            
            shuffledData.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sequence-item';
                itemDiv.textContent = item;
                itemDiv.onclick = () => selectSequenceItem(item, itemDiv);
                container.appendChild(itemDiv);
            });
            
            window.currentExercise = exercise;
            window.selectedOrder = selectedOrder;
        }

        function selectSequenceItem(item, element) {
            if (element.classList.contains('selected')) return;
            
            element.classList.add('selected');
            window.selectedOrder.push(item);
            
            const orderDisplay = document.getElementById('selectedOrder');
            orderDisplay.innerHTML = window.selectedOrder.map((item, index) => 
                `<span style="background: #667eea; color: white; padding: 5px 10px; border-radius: 5px; margin: 2px; display: inline-block;">${index + 1}. ${item}</span>`
            ).join('');
        }

        function checkSequence() {
            const exercise = window.currentExercise;
            const isCorrect = JSON.stringify(window.selectedOrder) === JSON.stringify(exercise.correctOrder);
            
            handleInteractiveResult(isCorrect, exercise.explanation);
        }

        function resetSequence() {
            window.selectedOrder = [];
            document.getElementById('selectedOrder').innerHTML = '';
            document.querySelectorAll('.sequence-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        function createDragDropExercise(exercise) {
            const interactiveArea = document.getElementById('interactiveArea');
            
            interactiveArea.innerHTML = `
                <div class="drag-drop-area">
                    <div style="margin-bottom: 20px;">
                        <h4>Arrastra los elementos:</h4>
                        <div id="draggableItems" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 15px 0;"></div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4>A las zonas correctas:</h4>
                        <div id="dropZones" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0;"></div>
                    </div>
                </div>
                <button onclick="checkDragDrop()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-top: 15px;">Comprobar</button>
            `;
            
            const itemsContainer = document.getElementById('draggableItems');
            const zonesContainer = document.getElementById('dropZones');
            
            // Crear elementos arrastrables
            exercise.data.items.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'draggable';
                itemDiv.textContent = item;
                itemDiv.draggable = true;
                itemDiv.dataset.index = index;
                
                itemDiv.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', index);
                    itemDiv.classList.add('dragging');
                });
                
                itemDiv.addEventListener('dragend', () => {
                    itemDiv.classList.remove('dragging');
                });
                
                itemsContainer.appendChild(itemDiv);
            });
            
            // Crear zonas de soltar
            exercise.data.zones.forEach((zone, index) => {
                const zoneDiv = document.createElement('div');
                zoneDiv.className = 'drop-zone';
                zoneDiv.innerHTML = `<strong>${zone}</strong>`;
                zoneDiv.dataset.zoneIndex = index;
                
                zoneDiv.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zoneDiv.classList.add('drag-over');
                });
                
                zoneDiv.addEventListener('dragleave', () => {
                    zoneDiv.classList.remove('drag-over');
                });
                
                zoneDiv.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const itemIndex = e.dataTransfer.getData('text/plain');
                    const itemElement = document.querySelector(`[data-index="${itemIndex}"]`);
                    
                    // Limpiar zona anterior si el elemento ya estaba colocado
                    const currentZone = itemElement.parentElement;
                    if (currentZone.classList.contains('drop-zone')) {
                        currentZone.classList.remove('filled');
                    }
                    
                    // Colocar en nueva zona
                    zoneDiv.appendChild(itemElement);
                    zoneDiv.classList.remove('drag-over');
                    zoneDiv.classList.add('filled');
                });
                
                zonesContainer.appendChild(zoneDiv);
            });
            
            window.currentExercise = exercise;
        }

        function checkDragDrop() {
            const exercise = window.currentExercise;
            const dropZones = document.querySelectorAll('.drop-zone');
            let userAnswers = [];
            let allPlaced = true;
            
            dropZones.forEach((zone, zoneIndex) => {
                const item = zone.querySelector('.draggable');
                if (item) {
                    userAnswers[zoneIndex] = parseInt(item.dataset.index);
                } else {
                    allPlaced = false;
                }
            });
            
            if (!allPlaced) {
                alert('¡Coloca todos los elementos en las zonas antes de comprobar!');
                return;
            }
            
            const isCorrect = JSON.stringify(userAnswers) === JSON.stringify(exercise.data.correct);
            handleInteractiveResult(isCorrect, exercise.explanation);
        }

        function handleInteractiveResult(isCorrect, explanation) {
            const feedback = document.getElementById('exerciseFeedback');
            
            appState.currentSessionStats.total++;
            appState.userData.interactiveExercises++;
            
            if (isCorrect) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = '🎉 ' + explanation;
                appState.currentSessionStats.correct++;
                appState.userData.correctAnswers++;
                appState.userData.totalPoints += 15; // Más puntos por ejercicios interactivos
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '❌ ' + explanation;
            }
            
            feedback.style.display = 'block';
            document.getElementById('nextExerciseBtn').style.display = 'inline-block';
            
            // Actualizar estadísticas
            appState.userData.totalExercises++;
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            appState.userData.exercisesByType[exercise.type]++;
            appState.userData.exercisesByTheme[exercise.theme]++;
            appState.userData.lastActivity = new Date().toISOString();
            
            saveUserData();
        }

        function selectOption(selectedIndex) {
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            const options = document.querySelectorAll('.option');
            const feedback = document.getElementById('exerciseFeedback');
            
            options.forEach(option => option.onclick = null);
            
            appState.currentSessionStats.total++;
            
            if (selectedIndex === exercise.correct) {
                options[selectedIndex].classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = '🎉 ' + exercise.explanation;
                appState.currentSessionStats.correct++;
                
                appState.userData.correctAnswers++;
                appState.userData.totalPoints += 10;
                
                // Puntos extra por multiplicación
                if (exercise.question.includes('×') || exercise.question.includes('multiplicar')) {
                    appState.userData.multiplicationExercises++;
                    appState.userData.totalPoints += 5;
                }
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[exercise.correct].classList.add('correct');
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '❌ ' + exercise.explanation;
            }
            
            appState.userData.totalExercises++;
            appState.userData.exercisesByType[exercise.type]++;
            appState.userData.exercisesByTheme[exercise.theme]++;
            appState.userData.lastActivity = new Date().toISOString();
            
            feedback.style.display = 'block';
            document.getElementById('nextExerciseBtn').style.display = 'inline-block';
            
            saveUserData();
        }

        function nextExercise() {
            appState.currentExerciseIndex++;
            
            if (appState.currentExerciseIndex < appState.currentExerciseSet.length) {
                showExercise();
            } else {
                completeDay();
            }
        }

        function completeDay() {
            const { week, day, correct, total, startTime } = appState.currentSessionStats;
            const dayKey = `week${week}_day${day}`;
            const endTime = new Date().getTime();
            const duration = Math.round((endTime - startTime) / 1000 / 60); // minutos
            
            appState.userData.completedExercises[dayKey] = {
                completed: true,
                score: correct,
                total: total,
                duration: duration,
                date: new Date().toISOString()
            };
            
            // Actualizar racha
            if (correct === total) {
                appState.userData.streak++;
                appState.userData.perfectDays++;
            } else {
                appState.userData.streak = 0;
            }
            
            // Verificar día más rápido
            if (correct === total && (!appState.userData.fastestDay || duration < appState.userData.fastestDay)) {
                appState.userData.fastestDay = duration;
            }
            
            checkAchievements();
            
            const newLevel = Math.floor(appState.userData.totalPoints / 150) + 1;
            if (newLevel > appState.userData.level) {
                appState.userData.level = newLevel;
                showReward('¡Nivel Superior!', '🆙', `¡Has alcanzado el nivel ${newLevel}!`);
            }
            
            closeExercise();
            saveUserData();
            updateUserInterface();
            generateWeeks();
            
            showDayComplete(correct, total, duration);
        }

        function showDayComplete(correct, total, duration) {
            const percentage = Math.round((correct / total) * 100);
            let message = '';
            let icon = '';
            
            if (percentage === 100) {
                message = '¡Perfecto! ¡Eres un verdadero maestro entrenador!';
                icon = '🏆';
                if (duration <= 20) {
                    message += ' ¡Y muy rápido!';
                }
            } else if (percentage >= 80) {
                message = '¡Excelente trabajo! Casi perfecto.';
                icon = '⭐';
            } else if (percentage >= 60) {
                message = '¡Buen trabajo! Sigue practicando.';
                icon = '👍';
            } else {
                message = '¡Sigue intentando! La práctica hace al maestro.';
                icon = '💪';
            }
            
            showReward('¡Día Completado!', icon, `${message}\nPuntuación: ${correct}/${total} (${percentage}%)\nTiempo: ${duration} minutos`);
        }

        function closeExercise() {
            document.getElementById('exerciseModal').style.display = 'none';
        }

        // Sistema de logros AMPLIADO
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!appState.userData.achievements.includes(achievement.id)) {
                    let earned = false;
                    
                    switch (achievement.id) {
                        case 'first_exercise':
                            earned = appState.userData.totalExercises >= 1;
                            break;
                        case 'math_master':
                            earned = appState.userData.exercisesByType.math >= 20;
                            break;
                        case 'reading_hero':
                            earned = appState.userData.exercisesByType.reading >= 20;
                            break;
                        case 'english_expert':
                            earned = appState.userData.exercisesByType.english >= 15;
                            break;
                        case 'perfect_day':
                            earned = appState.currentSessionStats.correct === appState.currentSessionStats.total && appState.currentSessionStats.total > 0;
                            break;
                        case 'streak_week':
                            earned = appState.userData.streak >= 7;
                            break;
                        case 'multiplication_master':
                            earned = appState.userData.multiplicationExercises >= 15;
                            break;
                        case 'reading_champion':
                            earned = appState.userData.textsRead >= 25;
                            break;
                        case 'interactive_genius':
                            earned = appState.userData.interactiveExercises >= 10;
                            break;
                        case 'science_explorer':
                            earned = (appState.userData.exercisesByType.science || 0) >= 10;
                            break;
                        case 'speed_demon':
                            earned = appState.userData.fastestDay && appState.userData.fastestDay <= 20;
                            break;
                        case 'hundred_club':
                            earned = appState.userData.totalExercises >= 100;
                            break;
                    }
                    
                    if (earned) {
                        appState.userData.achievements.push(achievement.id);
                        showReward('¡Nuevo Logro!', achievement.icon, `${achievement.name}\n${achievement.description}`);
                    }
                }
            });
        }

        function loadAchievements() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const isUnlocked = appState.userData.achievements.includes(achievement.id);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : ''}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <h4>${achievement.name}</h4>
                    <p>${achievement.description}</p>
                    <div style="margin-top: 10px; font-size: 12px; color: #666;">
                        ${isUnlocked ? '✅ Desbloqueado' : '🔒 Bloqueado'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Estadísticas detalladas AMPLIADAS
        function loadStats() {
            const content = document.getElementById('statsContent');
            const userData = appState.userData;
            
            const accuracy = userData.totalExercises > 0 
                ? Math.round((userData.correctAnswers / userData.totalExercises) * 100)
                : 0;
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="stat-card" style="padding: 20px;">
                        <h3>📊 Estadísticas Generales</h3>
                        <p><strong>Ejercicios totales:</strong> ${userData.totalExercises}</p>
                        <p><strong>Respuestas correctas:</strong> ${userData.correctAnswers}</p>
                        <p><strong>Precisión:</strong> ${accuracy}%</p>
                        <p><strong>Puntos totales:</strong> ${userData.totalPoints}</p>
                        <p><strong>Racha actual:</strong> ${userData.streak} días</p>
                        <p><strong>Nivel:</strong> ${userData.level}</p>
                        <p><strong>Días perfectos:</strong> ${userData.perfectDays || 0}</p>
                        <p><strong>Día más rápido:</strong> ${userData.fastestDay ? userData.fastestDay + ' minutos' : 'No disponible'}</p>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>📚 Por Materia</h3>
                        <p><strong>🧮 Matemáticas:</strong> ${userData.exercisesByType.math || 0}</p>
                        <p><strong>📖 Comprensión Lectora:</strong> ${userData.exercisesByType.reading || 0}</p>
                        <p><strong>🇬🇧 Inglés:</strong> ${userData.exercisesByType.english || 0}</p>
                        <p><strong>🧩 Interactivos:</strong> ${userData.exercisesByType.interactive || 0}</p>
                        <p><strong>🔬 Ciencias:</strong> ${userData.exercisesByType.science || 0}</p>
                        <p><strong>🌍 Geografía:</strong> ${userData.exercisesByType.geography || 0}</p>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                            <p><strong>✖️ Multiplicaciones:</strong> ${userData.multiplicationExercises || 0}</p>
                            <p><strong>📖 Textos leídos:</strong> ${userData.textsRead || 0}</p>
                        </div>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>🎮 Por Tema Favorito</h3>
                        <p><strong>🔴 Pokémon:</strong> ${userData.exercisesByTheme.pokemon || 0}</p>
                        <p><strong>⚔️ Titanes:</strong> ${userData.exercisesByTheme.titans || 0}</p>
                        <p><strong>⚽ Fútbol:</strong> ${userData.exercisesByTheme.football || 0}</p>
                        <p><strong>🔫 Warframe:</strong> ${userData.exercisesByTheme.warframe || 0}</p>
                        <p><strong>🎯 Variado:</strong> ${userData.exercisesByTheme.mixed || 0}</p>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>🏆 Progreso de Logros</h3>
                        <p><strong>Desbloqueados:</strong> ${userData.achievements.length}/${achievements.length}</p>
                        <div style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 5px;">
                            ${userData.achievements.map(id => {
                                const achievement = achievements.find(a => a.id === id);
                                return achievement ? `<span style="padding: 4px 8px; background: #ffd700; border-radius: 4px; font-size: 12px; color: #333;">${achievement.icon} ${achievement.name}</span>` : '';
                            }).join('')}
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3>📈 Progreso Semanal Detallado</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                        ${Object.keys(exerciseDatabase).map(weekKey => {
                            const weekNum = weekKey.replace('week', '');
                            const completed = getCompletedDaysInWeek(weekNum);
                            const weekData = getWeekStats(weekNum);
                            return `
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; border: 1px solid #ddd;">
                                    <h4>Semana ${weekNum}</h4>
                                    <div style="font-size: 24px; color: #667eea; margin: 10px 0;">${completed}/5</div>
                                    <div style="font-size: 12px; color: #666;">días completados</div>
                                    ${weekData.totalScore > 0 ? `
                                        <div style="margin-top: 10px; font-size: 14px;">
                                            <div>📊 ${weekData.totalScore}/${weekData.totalExercises} ejercicios</div>
                                            <div>🎯 ${Math.round((weekData.totalScore/weekData.totalExercises)*100)}% precisión</div>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px; border-left: 4px solid #2196f3;">
                    <h4>📝 Información de Cuenta</h4>
                    <p><strong>Usuario:</strong> ${appState.currentUser}</p>
                    <p><strong>Cuenta creada:</strong> ${userData.created ? new Date(userData.created).toLocaleDateString('es-ES') : 'Fecha no disponible'}</p>
                    <p><strong>Última actividad:</strong> ${userData.lastActivity ? new Date(userData.lastActivity).toLocaleString('es-ES') : 'No disponible'}</p>
                    <p><strong>Estado de guardado:</strong> ${appState.connectionStatus === 'online' ? '✅ Sincronizado' : '❌ Sin sincronizar'}</p>
                </div>
            `;
        }

        function getWeekStats(weekNum) {
            let totalScore = 0;
            let totalExercises = 0;
            
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${weekNum}_day${day}`;
                const dayData = appState.userData.completedExercises[dayKey];
                if (dayData) {
                    totalScore += dayData.score;
                    totalExercises += dayData.total;
                }
            }
            
            return { totalScore, totalExercises };
        }

        // Sistema de recompensas
        function showReward(title, icon, message) {
            document.getElementById('rewardTitle').textContent = title;
            document.getElementById('rewardIcon').textContent = icon;
            document.getElementById('rewardMessage').textContent = message;
            document.getElementById('rewardPopup').style.display = 'block';
        }

        function closeReward() {
            document.getElementById('rewardPopup').style.display = 'none';
        }

        // Funciones de administración
        function resetProgress() {
            if (confirm('¿Estás seguro de que quieres reiniciar todo el progreso? Esta acción no se puede deshacer.')) {
                appState.userData = createNewUser();
                saveUserData();
                updateUserInterface();
                generateWeeks();
                alert('Progreso reiniciado correctamente.');
            }
        }

        function exportData() {
            const dataToExport = {
                user: appState.currentUser,
                data: appState.userData,
                exportDate: new Date().toISOString(),
                summary: {
                    totalExercises: appState.userData.totalExercises,
                    accuracy: appState.userData.totalExercises > 0 ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100) : 0,
                    level: appState.userData.level,
                    achievements: appState.userData.achievements.length,
                    connectionStatus: appState.connectionStatus,
                    perfectDays: appState.userData.perfectDays || 0,
                    fastestDay: appState.userData.fastestDay || null
                }
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `academia_pokemon_${appState.currentUser}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎮 Academia Pokemon iniciada - Versión ampliada');
            console.log('📡 Configuración JSONBin:', {
                binId: JSONBIN_CONFIG.binId,
                apiUrl: JSONBIN_CONFIG.apiUrl
            });
            
            updateConnectionStatus('offline');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            // Event listener para Enter en el input de login
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
</body>
</html>
