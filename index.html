<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Academia Pokemon - ¬°Aprende Jugando!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 25%, #45b7d1 50%, #96ceb4 75%, #ffeaa7 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            min-height: 100vh;
            color: #2d3436;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        .floating-shapes {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
        }

        .shape {
            position: absolute;
            font-size: 60px;
            animation: float 6s ease-in-out infinite;
            opacity: 0.8;
        }

        .shape:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
        .shape:nth-child(2) { top: 60%; left: 80%; animation-delay: 1s; }
        .shape:nth-child(3) { top: 80%; left: 20%; animation-delay: 2s; }
        .shape:nth-child(4) { top: 30%; left: 70%; animation-delay: 3s; }
        .shape:nth-child(5) { top: 10%; left: 50%; animation-delay: 4s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 500px;
            width: 100%;
            position: relative;
            z-index: 2;
            border: 5px solid transparent;
            background-clip: padding-box;
            animation: cardBounce 2s ease-in-out infinite;
        }

        @keyframes cardBounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            border-radius: 35px;
            z-index: -1;
        }

        .login-card h1 {
            font-family: 'Fredoka One', cursive;
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 3em;
            text-shadow: 3px 3px 0px #fff;
        }

        .login-card p {
            font-size: 18px;
            color: #636e72;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .login-card input {
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: 3px solid #ddd;
            border-radius: 20px;
            font-size: 18px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .login-card input:focus {
            outline: none;
            border-color: #ff6b6b;
            transform: scale(1.02);
            background: white;
        }

        .login-card button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #fd79a8);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
            font-family: 'Nunito', sans-serif;
        }

        .login-card button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
        }

        .main-app {
            display: none;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 3px solid #fdcb6e;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            color: white;
            font-weight: 800;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border: 4px solid white;
        }

        .user-info h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: #2d3436;
            margin: 0;
        }

        .user-info p {
            font-size: 16px;
            color: #636e72;
            margin: 5px 0 0 0;
            font-weight: 600;
        }

        .stats {
            display: flex;
            gap: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
            min-width: 100px;
            transition: transform 0.3s;
            border: 3px solid white;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            box-shadow: 0 8px 25px rgba(253, 121, 168, 0.3);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            box-shadow: 0 8px 25px rgba(253, 203, 110, 0.3);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 800;
            font-family: 'Fredoka One', cursive;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            font-weight: 600;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 18px 30px;
            background: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            color: #636e72;
            border: 3px solid transparent;
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            color: white;
            border-color: white;
            transform: translateY(-3px);
        }

        .content-area {
            background: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            min-height: 600px;
            border: 3px solid #fdcb6e;
        }

        .content-area h2 {
            font-family: 'Fredoka One', cursive;
            color: #2d3436;
            margin-bottom: 30px;
            font-size: 32px;
            text-align: center;
            text-shadow: 2px 2px 0px #ddd;
        }

        /* Estilos del Ranking estilo YouTube Kids */
        .ranking-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .ranking-filters {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 25px;
        }

        .filter-btn {
            padding: 15px 25px;
            background: white;
            border: 3px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: #636e72;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .filter-btn.active {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border-color: white;
            transform: translateY(-2px);
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: end;
            gap: 20px;
            margin: 40px 0;
            height: 300px;
        }

        .podium-place {
            background: white;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            min-width: 180px;
            border: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .podium-place::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .podium-place:hover::before {
            animation: shine 0.6s ease-in-out;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }

        .podium-place:hover {
            transform: translateY(-8px) scale(1.05);
        }

        .podium-place.first {
            height: 250px;
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            border-color: #f39c12;
            order: 2;
            animation: winner-glow 2s ease-in-out infinite;
        }

        @keyframes winner-glow {
            0%, 100% { box-shadow: 0 10px 30px rgba(243, 156, 18, 0.3); }
            50% { box-shadow: 0 15px 40px rgba(243, 156, 18, 0.6); }
        }

        .podium-place.second {
            height: 200px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-color: #0984e3;
            order: 1;
        }

        .podium-place.third {
            height: 150px;
            background: linear-gradient(135deg, #fd79a8, #e84393);
            border-color: #e84393;
            order: 3;
        }

        .podium-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2d3436;
            font-size: 28px;
            font-weight: 800;
            margin: 0 auto 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 4px solid rgba(255,255,255,0.5);
        }

        .podium-crown {
            font-size: 50px;
            margin-bottom: 15px;
            animation: crown-bounce 2s ease-in-out infinite;
        }

        @keyframes crown-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .podium-name {
            font-family: 'Fredoka One', cursive;
            font-size: 18px;
            color: white;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .podium-stat {
            font-size: 14px;
            color: white;
            opacity: 0.9;
            font-weight: 600;
        }

        .ranking-table {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid #74b9ff;
        }

        .ranking-header {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 120px 140px;
            gap: 20px;
            font-weight: 800;
            font-size: 16px;
            align-items: center;
        }

        .ranking-row {
            padding: 20px 25px;
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 120px 140px;
            gap: 20px;
            align-items: center;
            border-bottom: 2px solid #f1f2f6;
            transition: all 0.3s;
            font-weight: 600;
        }

        .ranking-row:hover {
            background: linear-gradient(90deg, #f8f9fa, #e9ecef);
            transform: translateX(5px);
        }

        .ranking-row.current-user {
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            color: white;
            border: 3px solid #e17055;
            margin: 5px 0;
            border-radius: 15px;
            animation: highlight-pulse 2s ease-in-out infinite;
        }

        @keyframes highlight-pulse {
            0%, 100% { box-shadow: 0 5px 15px rgba(253, 203, 110, 0.3); }
            50% { box-shadow: 0 10px 25px rgba(253, 203, 110, 0.6); }
        }

        .position {
            text-align: center;
            font-weight: 800;
            font-size: 20px;
            font-family: 'Fredoka One', cursive;
        }

        .position.first {
            color: #f39c12;
            font-size: 32px;
            animation: winner-bounce 1s ease-in-out infinite;
        }

        @keyframes winner-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .position.second {
            color: #0984e3;
            font-size: 28px;
        }

        .position.third {
            color: #e84393;
            font-size: 24px;
        }

        .user-name {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 800;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border: 3px solid white;
        }

        .user-name span {
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 16px;
        }

        .stat-value {
            text-align: center;
            font-weight: 800;
            font-size: 16px;
            color: #2d3436;
            font-family: 'Fredoka One', cursive;
        }

        .ranking-row.current-user .stat-value {
            color: white;
        }

        .achievements-preview {
            display: flex;
            gap: 3px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .achievement-mini {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(45deg, #fdcb6e, #f39c12);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            animation: achievement-glow 2s ease-in-out infinite;
        }

        @keyframes achievement-glow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Semanas estilo YouTube Kids */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .week-card {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .week-card:nth-child(1) {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
        }

        .week-card:nth-child(2) {
            border-color: #4ecdc4;
            background: linear-gradient(135deg, #00cec9, #00b894);
            color: white;
        }

        .week-card:nth-child(3) {
            border-color: #fdcb6e;
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            color: white;
        }

        .week-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .week-card h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 28px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .week-card p {
            font-size: 16px;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .progress-container {
            background: rgba(255,255,255,0.3);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill-week {
            height: 100%;
            background: white;
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        /* Estad√≠sticas kids-friendly */
        .stats-kids {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .stat-card-big {
            background: white;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 4px solid;
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card-big:hover {
            transform: translateY(-5px) scale(1.02);
        }

        .stat-card-big:nth-child(1) {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
        }

        .stat-card-big:nth-child(2) {
            border-color: #4ecdc4;
            background: linear-gradient(135deg, #00cec9, #00b894);
            color: white;
        }

        .stat-card-big:nth-child(3) {
            border-color: #fdcb6e;
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            color: white;
        }

        .stat-card-big:nth-child(4) {
            border-color: #74b9ff;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .stat-icon-big {
            font-size: 80px;
            margin-bottom: 20px;
            animation: stat-bounce 2s ease-in-out infinite;
        }

        @keyframes stat-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .stat-number-big {
            font-family: 'Fredoka One', cursive;
            font-size: 48px;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }

        .stat-label-big {
            font-size: 18px;
            font-weight: 700;
            opacity: 0.9;
        }

        .connection-status {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 18px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .connection-status.online {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
        }

        .connection-status.offline {
            background: linear-gradient(45deg, #e17055, #d63031);
            color: white;
        }

        /* Responsive para ni√±os */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .stats {
                width: 100%;
                justify-content: center;
            }

            .nav-tabs {
                justify-content: center;
            }

            .ranking-header,
            .ranking-row {
                grid-template-columns: 60px 1fr 80px 80px 80px;
                gap: 10px;
                font-size: 14px;
            }

            .ranking-header span:nth-child(6),
            .ranking-row .achievements-preview {
                display: none;
            }

            .podium {
                flex-direction: column;
                height: auto;
                gap: 20px;
            }

            .podium-place {
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
                height: auto !important;
            }

            .week-grid {
                grid-template-columns: 1fr;
            }

            .stats-kids {
                grid-template-columns: 1fr;
            }
        }

        /* Efectos especiales para ni√±os */
        .sparkle {
            position: absolute;
            color: #fdcb6e;
            font-size: 20px;
            animation: sparkle 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Efectos de fondo -->
    <div class="floating-shapes">
        <div class="shape">üéÆ</div>
        <div class="shape">üèÜ</div>
        <div class="shape">‚≠ê</div>
        <div class="shape">üéØ</div>
        <div class="shape">üöÄ</div>
    </div>

    <!-- Indicador de conexi√≥n -->
    <div id="connectionStatus" class="connection-status offline">üîÑ Conectando...</div>

    <!-- Pantalla de Login -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1>üéÆ Academia Pokemon</h1>
            <p>¬°Convi√©rtete en el mejor entrenador de conocimientos!</p>
            <input type="text" id="usernameInput" placeholder="‚ú® Escribe tu nombre de entrenador ‚ú®" maxlength="20">
            <button onclick="login()">üöÄ ¬°Comenzar Aventura! üöÄ</button>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="user-info">
                    <div class="avatar" id="userAvatar">üèÜ</div>
                    <div>
                        <h2 id="userName">Entrenador</h2>
                        <p>üåü Nivel <span id="userLevel">1</span> üåü</p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPoints">0</div>
                        <div class="stat-label">üí∞ Puntos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="streak">0</div>
                        <div class="stat-label">üî• Racha</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="accuracy">0%</div>
                        <div class="stat-label">üéØ Precisi√≥n</div>
                    </div>
                </div>
                <button onclick="logout()" style="background: linear-gradient(45deg, #e17055, #d63031); color: white; border: none; padding: 15px 25px; border-radius: 20px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(225, 112, 85, 0.4);">üëã Salir</button>
            </div>

            <!-- Navegaci√≥n -->
            <div class="nav-tabs">
                <button class="nav-tabactive" onclick="showTab('training')">üéØ Entrenamiento</button>
                <button class="nav-tab" onclick="showTab('ranking')">üèÜ Ranking</button>
                <button class="nav-tab" onclick="showTab('achievements')">üéñÔ∏è Mis Logros</button>
                <button class="nav-tab" onclick="showTab('stats')">üìä Mis Estad√≠sticas</button>
                <button class="nav-tab" onclick="showTab('admin')">‚öôÔ∏è Configuraci√≥n</button>
            </div>

            <!-- √Årea de contenido -->
            <div class="content-area">
                <!-- Pesta√±a de Entrenamiento -->
                <div id="trainingTab" class="tab-content">
                    <h2>üóìÔ∏è ¬°Elige tu Semana de Aventuras!</h2>
                    <div class="week-grid" id="weekGrid"></div>
                    <div id="dayView" style="display: none;">
                        <button onclick="backToWeeks()" style="margin-bottom: 25px; padding: 15px 25px; background: linear-gradient(45deg, #636e72, #2d3436); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(99, 110, 114, 0.4);">‚Üê üè† Volver a Semanas</button>
                        <h3 id="dayTitle" style="font-family: 'Fredoka One', cursive; font-size: 28px; text-align: center; margin-bottom: 25px;"></h3>
                        <div class="day-grid" id="dayGrid"></div>
                    </div>
                </div>

                <!-- Pesta√±a de Ranking -->
                <div id="rankingTab" class="tab-content" style="display: none;">
                    <h2>üèÜ ¬°Tabla de Campeones!</h2>
                    <div class="ranking-container">
                        <!-- Filtros -->
                        <div class="ranking-filters">
                            <button class="filter-btn active" onclick="setRankingFilter('achievements')">üéñÔ∏è Logros</button>
                            <button class="filter-btn" onclick="setRankingFilter('points')">üí∞ Puntos</button>
                            <button class="filter-btn" onclick="setRankingFilter('level')">üìà Nivel</button>
                            <button class="filter-btn" onclick="setRankingFilter('exercises')">üìö Ejercicios</button>
                            <button class="filter-btn" onclick="setRankingFilter('accuracy')">üéØ Precisi√≥n</button>
                            <button class="filter-btn" onclick="setRankingFilter('streak')">üî• Racha</button>
                        </div>

                        <!-- Podio para top 3 -->
                        <div id="podiumContainer" class="podium"></div>

                        <!-- Tabla de ranking -->
                        <div id="rankingTableContainer"></div>
                    </div>
                </div>

                <!-- Pesta√±a de Logros -->
                <div id="achievementsTab" class="tab-content" style="display: none;">
                    <h2>üéñÔ∏è ¬°Mis S√∫per Logros!</h2>
                    <div class="achievement-grid" id="achievementGrid"></div>
                </div>

                <!-- Pesta√±a de Estad√≠sticas -->
                <div id="statsTab" class="tab-content" style="display: none;">
                    <h2>üìä ¬°Mis N√∫meros Geniales!</h2>
                    <div id="statsContent"></div>
                </div>

                <!-- Pesta√±a de Administraci√≥n -->
                <div id="adminTab" class="tab-content" style="display: none;">
                    <h2>‚öôÔ∏è Mi Panel de Control</h2>
                    <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 25px; border-radius: 20px; margin-bottom: 25px; border: 3px solid #74b9ff;">
                        <h4 style="font-family: 'Fredoka One', cursive; font-size: 20px; margin-bottom: 15px; color: #2d3436;">üìä Estado de mi Cuenta</h4>
                        <p><strong>üéÆ Mi nombre:</strong> <span id="currentUserAdmin"></span></p>
                        <p><strong>üïê √öltima vez conectado:</strong> <span id="lastSync">-</span></p>
                        <p><strong>üíæ Mis datos:</strong> <span id="connectionStatusText">Guardando...</span></p>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                        <button onclick="testConnection()" style="padding: 18px 30px; background: linear-gradient(45deg, #74b9ff, #0984e3); color: white; border: none; border-radius: 20px; font-size: 16px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);">üîÑ Probar Conexi√≥n</button>
                        <button onclick="resetProgress()" style="padding: 18px 30px; background: linear-gradient(45deg, #e17055, #d63031); color: white; border: none; border-radius: 20px; font-size: 16px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(225, 112, 85, 0.4);">üîÑ Empezar de Nuevo</button>
                        <button onclick="exportData()" style="padding: 18px 30px; background: linear-gradient(45deg, #00b894, #00cec9); color: white; border: none; border-radius: 20px; font-size: 16px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);">üì• Descargar mis Datos</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de JSONBin
        const JSONBIN_CONFIG = {
            binId: '68ee144343b1c97be96704f9',
            masterKey: '$2a$10$byEkgCiPtr6uA9j.sw5Uiuld00jGPRMT1Rn9TlhHYbPe3CFfaEu6G',
            apiUrl: 'https://api.jsonbin.io/v3'
        };

        // Estado global de la aplicaci√≥n
        let appState = {
            currentUser: null,
            userData: {},
            currentExerciseSet: [],
            currentExerciseIndex: 0,
            currentSessionStats: { correct: 0, total: 0 },
            connectionStatus: 'offline',
            allUsersData: {},
            currentRankingFilter: 'achievements'
        };

        // Base de datos de ejercicios AMPLIADA con 2 semanas completas
        const exerciseDatabase = {
            week1: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>üí° Suma con llevadas:</strong> Cuando la suma de unidades es mayor que 9, "llevamos" a las decenas.',
                        question: 'üî• Charizard ten√≠a 47 puntos de ataque. Despu√©s de entrenar intensamente con Ash, gan√≥ 28 puntos m√°s. ¬øCu√°ntos puntos de ataque tiene ahora?',
                        options: ['75 puntos', '65 puntos', '71 puntos', '79 puntos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 47 + 28 = 75. Recuerda: 7 + 8 = 15, escribimos 5 y llevamos 1. Luego 4 + 2 + 1 = 7.'
                    },
                    {
                        type: 'reading',
                        theme: 'pokemon',
                        learningHint: '<strong>üìö Comprensi√≥n lectora:</strong> Lee despacio y busca detalles espec√≠ficos.',
                        readingText: '<h4>üîµ El Entrenamiento de Pikachu</h4>Pikachu es un Pok√©mon el√©ctrico muy especial que vive en los densos bosques verdes cerca de Pueblo Paleta. Cada ma√±ana temprano, a las 7:00, entrena sus habilidades el√©ctricas junto a Ash. Le encanta comer exactamente 12 bayas dulces rojas para desayunar, que encuentra en los √°rboles m√°s altos del bosque. Su ataque favorito es el "Rayo" porque puede generar hasta 100.000 voltios de electricidad con sus mejillas amarillas brillantes.',
                        question: '¬øCu√°ntas bayas rojas come Pikachu para desayunar cada ma√±ana?',
                        options: ['10 bayas', '12 bayas', '15 bayas', '8 bayas'],
                        correct: 1,
                        explanation: '¬°Excelente! El texto dice claramente que "come exactamente 12 bayas dulces rojas para desayunar". ¬°Has le√≠do con mucha atenci√≥n a los detalles!'
                    },
                    {
                        type: 'english',
                        theme: 'pokemon',
                        learningHint: '<strong>üá¨üáß Colores en ingl√©s:</strong> Los colores son palabras muy importantes. "Yellow" suena como "jelo".',
                        question: 'üü° Las mejillas de Pikachu son amarillas y brillantes. ¬øC√≥mo se dice "amarillo" en ingl√©s?',
                        options: ['Red', 'Blue', 'Yellow', 'Green'],
                        correct: 2,
                        explanation: '¬°Genial! "Yellow" significa amarillo en ingl√©s. Pikachu has yellow cheeks! (¬°Pikachu tiene mejillas amarillas!)'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n visual:</strong> 6 √ó 4 significa 6 grupos de 4 objetos. Imagina 6 filas de 4 Pok√©mon cada una.',
                        question: 'üéØ Ash tiene 6 Pok√©mon en su equipo. Cada Pok√©mon puede aprender exactamente 4 movimientos diferentes. ¬øCu√°ntos movimientos conoce todo su equipo?',
                        options: ['24 movimientos', '20 movimientos', '26 movimientos', '22 movimientos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 6 √ó 4 = 24 movimientos. Puedes pensarlo como sumar: 4 + 4 + 4 + 4 + 4 + 4 = 24.'
                    },
                    {
                        type: 'science',
                        theme: 'pokemon',
                        learningHint: '<strong>üî¨ Estados de la materia:</strong> S√≥lido (hielo), l√≠quido (agua), gas (vapor). El calor cambia el estado.',
                        question: 'üßä Cuando un Pok√©mon de tipo hielo usa su ataque, convierte el agua l√≠quida en hielo s√≥lido. ¬øQu√© tipo de cambio de estado es este?',
                        options: ['Evaporaci√≥n', 'Solidificaci√≥n', 'Fusi√≥n', 'Condensaci√≥n'],
                        correct: 1,
                        explanation: '¬°Correcto! La solidificaci√≥n es cuando un l√≠quido (agua) se convierte en s√≥lido (hielo). ¬°Como los ataques de hielo de los Pok√©mon!'
                    }
                ],
                day2: [
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>‚ûï Sumas con tres n√∫meros:</strong> Suma de dos en dos: primero 15 + 23 = 38, luego 38 + 17.',
                        question: '‚öîÔ∏è Eren cont√≥ titanes durante tres d√≠as consecutivos. El lunes vio 15 titanes, el martes 23 titanes, y el mi√©rcoles 17 titanes. ¬øCu√°ntos titanes observ√≥ en total?',
                        options: ['55 titanes', '53 titanes', '57 titanes', '52 titanes'],
                        correct: 0,
                        explanation: '¬°Correcto! 15 + 23 + 17 = 55 titanes. Paso a paso: 15 + 23 = 38, luego 38 + 17 = 55.'
                    },
                    {
                        type: 'reading',
                        theme: 'titans',
                        learningHint: '<strong>üß± Organizaci√≥n espacial:</strong> Imagina las murallas como c√≠rculos conc√©ntricos, una dentro de otra.',
                        readingText: '<h4>üè∞ El Sistema de Murallas Defensivas</h4>Las tres enormes murallas protegen a la humanidad de los gigantes titanes. La muralla exterior se llama Mar√≠a, tiene 50 metros de altura y es la primera l√≠nea de defensa contra los titanes. Dentro de Mar√≠a se encuentra la muralla Rose, de 45 metros de altura, que protege las ciudades intermedias. En el centro de todo est√° la muralla Sina, la m√°s peque√±a con 40 metros de altura, pero la m√°s segura, donde vive la familia real.',
                        question: '¬øCu√°l es la altura de la muralla Rose?',
                        options: ['50 metros', '40 metros', '45 metros', '35 metros'],
                        correct: 2,
                        explanation: '¬°Muy bien! El texto dice claramente que "la muralla Rose, de 45 metros de altura". ¬°Has encontrado la informaci√≥n espec√≠fica!'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>üó£Ô∏è Palabras cognadas:</strong> "Giant" y "gigante" suenan parecido porque vienen de la misma ra√≠z latina.',
                        question: 'üóø Los titanes son criaturas gigantes y terror√≠ficas. ¬øC√≥mo se dice "gigante" en ingl√©s?',
                        options: ['Small', 'Giant', 'Tiny', 'Little'],
                        correct: 1,
                        explanation: '¬°Excelente! "Giant" significa gigante. ¬øNotaste que suena similar a "gigante" en espa√±ol?'
                    },
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n pr√°ctica:</strong> 8 √ó 6 = 48. Piensa en 8 grupos de 6 soldados formados.',
                        question: 'üõ°Ô∏è El escuadr√≥n se organiza en 8 filas de soldados. En cada fila hay 6 soldados. ¬øCu√°ntos soldados hay en total en la formaci√≥n?',
                        options: ['48 soldados', '42 soldados', '54 soldados', '46 soldados'],
                        correct: 0,
                        explanation: '¬°Perfecto! 8 √ó 6 = 48 soldados. Es como sumar 6 ocho veces: 6+6+6+6+6+6+6+6 = 48.'
                    },
                    {
                        type: 'geography',
                        theme: 'titans',
                        learningHint: '<strong>üó∫Ô∏è Puntos cardinales:</strong> Norte arriba, Sur abajo, Este derecha, Oeste izquierda. Como una br√∫jula.',
                        question: 'üß≠ Los soldados salen de la muralla hacia donde sale el sol para explorar territorio tit√°n. ¬øEn qu√© direcci√≥n van?',
                        options: ['Norte', 'Sur', 'Este', 'Oeste'],
                        correct: 2,
                        explanation: '¬°Perfecto! El sol sale por el Este. Si van hacia donde sale el sol, se dirigen al Este.'
                    }
                ],
                day3: [
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>‚ûï‚ûñ Operaciones combinadas:</strong> Primero suma todos los goles de cada equipo, luego resta para comparar.',
                        question: '‚öΩ En el partido de ayer, el Real Madrid meti√≥ 2 goles en el primer tiempo y 3 en el segundo. El Barcelona meti√≥ 1 gol en el primer tiempo y 3 en el segundo. ¬øCu√°l fue la diferencia de goles?',
                        options: ['1 gol', '2 goles', '0 goles', '3 goles'],
                        correct: 0,
                        explanation: '¬°Muy bien! Real Madrid: 2 + 3 = 5 goles. Barcelona: 1 + 3 = 4 goles. Diferencia: 5 - 4 = 1 gol a favor del Real Madrid.'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>üèÉ‚Äç‚ôÇÔ∏è Datos biogr√°ficos:</strong> Busca informaci√≥n espec√≠fica sobre la persona: origen, profesi√≥n, logros.',
                        readingText: '<h4>‚≠ê Lionel Messi: Una Leyenda del F√∫tbol</h4>Lionel Andr√©s Messi naci√≥ el 24 de junio de 1987 en Rosario, Argentina, una ciudad de Sudam√©rica. Comenz√≥ a jugar f√∫tbol profesional a los 17 a√±os en el FC Barcelona de Espa√±a. Messi es famoso mundialmente por ser un delantero extraordinariamente h√°bil con la pelota y por haber ganado 7 premios Bal√≥n de Oro, m√°s que cualquier otro jugador en la historia.',
                        question: '¬øEn qu√© a√±o naci√≥ Lionel Messi seg√∫n el texto?',
                        options: ['1986', '1987', '1988', '1985'],
                        correct: 1,
                        explanation: '¬°Perfecto! El texto dice claramente que "naci√≥ el 24 de junio de 1987". ¬°Has le√≠do con mucha precisi√≥n!'
                    },
                    {
                        type: 'english',
                        theme: 'football',
                        learningHint: '<strong>‚öΩ Deportes en ingl√©s:</strong> "Ball" viene de la palabra germ√°nica para pelota. Se usa en muchos deportes.',
                        question: '‚öΩ En el f√∫tbol, los jugadores patean la pelota con los pies. ¬øC√≥mo se dice "pelota" en ingl√©s?',
                        options: ['Ball', 'Goal', 'Field', 'Player'],
                        correct: 0,
                        explanation: '¬°Genial! "Ball" significa pelota. Football = foot (pie) + ball (pelota) = f√∫tbol.'
                    },
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>‚úñÔ∏è Problemas de multiplicaci√≥n:</strong> 11 jugadores √ó 2 equipos. Cada equipo tiene el mismo n√∫mero de jugadores.',
                        question: 'üë• En un partido oficial de f√∫tbol juegan 2 equipos completos. Cada equipo tiene 11 jugadores en el campo. ¬øCu√°ntos jugadores est√°n jugando en total?',
                        options: ['22 jugadores', '20 jugadores', '24 jugadores', '18 jugadores'],
                        correct: 0,
                        explanation: '¬°Excelente! 11 √ó 2 = 22 jugadores en total. Tambi√©n puedes sumar: 11 + 11 = 22.'
                    },
                    {
                        type: 'money',
                        theme: 'football',
                        learningHint: '<strong>üí∞ Euros y c√©ntimos:</strong> 1 euro = 100 c√©ntimos. Para sumar dinero, suma euros con euros y c√©ntimos con c√©ntimos.',
                        question: 'üí∞ Messi compra 3 balones de f√∫tbol que cuestan 15,50 euros cada uno. ¬øCu√°nto paga en total?',
                        options: ['46,50 euros', '45,00 euros', '47,50 euros', '44,50 euros'],
                        correct: 0,
                        explanation: '¬°Genial! 3 √ó 15,50 = 46,50 euros. Tambi√©n puedes pensarlo como 15,50 + 15,50 + 15,50 = 46,50 euros.'
                    }
                ],
                day4: [
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>‚ûñ Resta con llevadas:</strong> Si necesitas quitar m√°s de lo que tienes en una posici√≥n, "pides prestado" a la siguiente.',
                        question: 'üî´ Un Tenno empieza su misi√≥n con 124 puntos de energ√≠a. Usa 67 puntos para sus habilidades especiales. ¬øCu√°nta energ√≠a le queda?',
                        options: ['57 puntos', '63 puntos', '51 puntos', '59 puntos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 124 - 67 = 57 puntos. En la resta: 4 - 7 no se puede, pido prestado: 14 - 7 = 7, luego 1 - 6 no se puede, pido prestado: 11 - 6 = 5.'
                    },
                    {
                        type: 'reading',
                        theme: 'warframe',
                        learningHint: '<strong>üöÄ Ciencia ficci√≥n:</strong> Busca informaci√≥n sobre tecnolog√≠a futurista y caracter√≠sticas especiales.',
                        readingText: '<h4>ü§ñ Los Guerreros Tenno del Futuro</h4>Los Tenno son antiguos guerreros espaciales que despertaron despu√©s de siglos durmiendo en criosue√±o. Utilizan armaduras bio-mec√°nicas llamadas Warframes que les otorgan poderes sobrenaturales √∫nicos. Existen m√°s de 50 tipos diferentes de Warframes: algunos se especializan en velocidad extrema como Volt, otros en fuerza bruta como Rhino, y algunos en sigilo como Ash.',
                        question: '¬øCu√°ntos tipos diferentes de Warframes existen seg√∫n el texto?',
                        options: ['M√°s de 40', 'Exactamente 50', 'M√°s de 50', 'Menos de 50'],
                        correct: 2,
                        explanation: '¬°Excelente! El texto dice "m√°s de 50 tipos diferentes de Warframes". ¬°Has le√≠do con mucha atenci√≥n!'
                    },
                    {
                        type: 'english',
                        theme: 'warframe',
                        learningHint: '<strong>üåå Vocabulario espacial:</strong> "Space" se relaciona con astronauta, spaceship (nave espacial).',
                        question: 'üåå Los Tenno son guerreros que luchan en el espacio exterior. ¬øC√≥mo se dice "espacio" en ingl√©s?',
                        options: ['Space', 'Time', 'World', 'Sky'],
                        correct: 0,
                        explanation: '¬°Perfecto! "Space" significa espacio. Outer space = espacio exterior, donde luchan los Tenno.'
                    },
                    {
                        type: 'science',
                        theme: 'warframe',
                        learningHint: '<strong>üåç El Sistema Solar:</strong> Hay 8 planetas que giran alrededor del Sol. Los m√°s cercanos son rocosos.',
                        question: 'üåç Los Tenno protegen el Sistema Solar. ¬øCu√°ntos planetas principales hay en nuestro Sistema Solar?',
                        options: ['7 planetas', '8 planetas', '9 planetas', '10 planetas'],
                        correct: 1,
                        explanation: '¬°Correcto! Hay 8 planetas: Mercurio, Venus, Tierra, Marte, J√∫piter, Saturno, Urano y Neptuno.'
                    }
                ],
                day5: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚ûó Divisi√≥n exacta:</strong> Dividir es repartir en partes iguales. 24 √∑ 6 = 4 significa que cada grupo tiene 4.',
                        question: 'üî¥ Ash tiene 24 Pok√©balls nuevas y quiere repartirlas igualmente entre sus 6 amigos entrenadores. ¬øCu√°ntas Pok√©balls recibir√° cada amigo?',
                        options: ['4 Pok√©balls', '5 Pok√©balls', '3 Pok√©balls', '6 Pok√©balls'],
                        correct: 0,
                        explanation: '¬°Perfecto! 24 √∑ 6 = 4 Pok√©balls cada uno. Puedes comprobarlo: 4 √ó 6 = 24. ¬°Ash es muy generoso!'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>ü•Ö Reglas deportivas:</strong> Presta atenci√≥n a las reglas especiales y las excepciones.',
                        readingText: '<h4>‚öΩ Las Reglas B√°sicas del F√∫tbol</h4>En un partido oficial de f√∫tbol, cada equipo tiene exactamente 11 jugadores en el campo simult√°neamente. De estos 11 jugadores, hay 10 jugadores de campo que pueden correr libremente por todo el terreno, pero tienen una regla muy importante: solo pueden tocar la pelota con los pies, la cabeza, el pecho y los hombros. Sin embargo, existe un jugador muy especial llamado portero o guardameta.',
                        question: '¬øCu√°ntos jugadores de campo (sin contar el portero) hay en cada equipo?',
                        options: ['9 jugadores', '10 jugadores', '11 jugadores', '12 jugadores'],
                        correct: 1,
                        explanation: '¬°Correcto! Son 11 jugadores en total: 10 jugadores de campo + 1 portero = 11 jugadores por equipo.'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>üß± Construcciones:</strong> "Wall" tambi√©n se usa en "Great Wall of China" (Gran Muralla China).',
                        question: 'üè∞ Las murallas protegen a la humanidad de los titanes. ¬øC√≥mo se dice "muralla" o "muro" en ingl√©s?',
                        options: ['Wall', 'Door', 'Window', 'Roof'],
                        correct: 0,
                        explanation: '¬°Excelente! "Wall" significa muro o muralla. The Great Wall = La Gran Muralla (de China).'
                    },
                    {
                        type: 'values',
                        theme: 'mixed',
                        learningHint: '<strong>‚ù§Ô∏è Valores sociales:</strong> El respeto, la ayuda mutua y la honestidad son valores importantes.',
                        question: 'ü§ù Ash siempre ayuda a sus amigos cuando tienen problemas. ¬øQu√© valor positivo demuestra Ash?',
                        options: ['Ego√≠smo', 'Solidaridad', 'Envidia', 'Pereza'],
                        correct: 1,
                        explanation: '¬°Perfecto! Ash demuestra solidaridad al ayudar a sus amigos. La solidaridad es ayudar a otros sin esperar nada a cambio.'
                    }
                ]
            },
            week2: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚úñÔ∏è Tablas de multiplicar avanzadas:</strong> La tabla del 9 tiene un truco: 9√ó7 = 63, f√≠jate que 6+3=9.',
                        question: '‚ö° Pikachu puede lanzar 9 rayos el√©ctricos por segundo durante 7 segundos seguidos. ¬øCu√°ntos rayos lanza en total?',
                        options: ['63 rayos', '56 rayos', '72 rayos', '64 rayos'],
                        correct: 0,
                        explanation: '¬°Incre√≠ble! 9 √ó 7 = 63 rayos. ¬øNotaste que 6 + 3 = 9? ¬°Ese es el truco de la tabla del 9!'
                    },
                    {
                        type: 'reading',
                        theme: 'pokemon',
                        learningHint: '<strong>üìä Comparar informaci√≥n:</strong> Cuando el texto habla de varios personajes, organiza la informaci√≥n de cada uno por separado.',
                        readingText: '<h4>üéÆ La Liga Pok√©mon Regional</h4>En la Liga Pok√©mon de Kanto participaron este a√±o 150 entrenadores de toda la regi√≥n. Ash termin√≥ en el puesto n√∫mero 16, lo que significa que 15 entrenadores quedaron por delante de √©l. Su rival Gary Oak logr√≥ el puesto n√∫mero 8, superando a Ash por 8 posiciones. Brock, el l√≠der de gimnasio de Ciudad Plateada, no particip√≥ en la liga porque ya es un l√≠der oficial y tiene otras responsabilidades.',
                        question: '¬øEn qu√© puesto termin√≥ Gary Oak en la Liga Pok√©mon?',
                        options: ['Puesto 15', 'Puesto 8', 'Puesto 16', 'Puesto 24'],
                        correct: 1,
                        explanation: '¬°Perfecto! El texto dice claramente que "Gary Oak logr√≥ el puesto n√∫mero 8". ¬°Gary lo hizo muy bien en la liga!'
                    },
                    {
                        type: 'english',
                        theme: 'pokemon',
                        learningHint: '<strong>üé® M√°s colores en ingl√©s:</strong> "Blue" se pronuncia "blu" y es como el color del agua y del cielo.',
                        question: 'üíô Squirtle es un Pok√©mon de agua de color azul. ¬øC√≥mo se dice "azul" en ingl√©s?',
                        options: ['Blue', 'Green', 'Purple', 'Orange'],
                        correct: 0,
                        explanation: '¬°Genial! "Blue" significa azul en ingl√©s. Squirtle is blue like the ocean! (¬°Squirtle es azul como el oc√©ano!)'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>üî¢ N√∫meros hasta el mill√≥n:</strong> 1.000 = mil, 10.000 = diez mil, 100.000 = cien mil, 1.000.000 = un mill√≥n.',
                        question: 'üèÜ En el Pok√©dex Nacional hay registrados 1.008 especies diferentes de Pok√©mon. Si Ash ha visto 234 especies, ¬øcu√°ntas especies le faltan por ver?',
                        options: ['774 especies', '784 especies', '764 especies', '794 especies'],
                        correct: 0,
                        explanation: '¬°Excelente! 1.008 - 234 = 774 especies le faltan por ver. ¬°Ash tiene mucho trabajo de exploraci√≥n por delante!'
                    },
                    {
                        type: 'science',
                        theme: 'pokemon',
                        learningHint: '<strong>üîã Electricidad:</strong> La electricidad puede generar luz, calor y movimiento. Los rayos son electricidad natural.',
                        question: '‚ö° Pikachu genera electricidad con sus mejillas. ¬øCu√°l de estos efectos NO puede producir la electricidad?',
                        options: ['Luz (como las bombillas)', 'Calor (como las estufas)', 'Gravedad (como los imanes)', 'Movimiento (como los motores)'],
                        correct: 2,
                        explanation: '¬°Correcto! La electricidad puede producir luz, calor y movimiento, pero NO puede crear gravedad. La gravedad es una fuerza diferente.'
                    },
                    {
                        type: 'geography',
                        theme: 'pokemon',
                        learningHint: '<strong>üåç Regiones del mundo:</strong> Asia es el continente m√°s grande, donde est√° Jap√≥n, el pa√≠s donde se cre√≥ Pok√©mon.',
                        question: 'üóæ Pok√©mon fue creado en Jap√≥n. ¬øEn qu√© continente est√° Jap√≥n?',
                        options: ['Europa', 'Asia', 'Am√©rica', 'Ocean√≠a'],
                        correct: 1,
                        explanation: '¬°Perfecto! Jap√≥n est√° en Asia, el continente m√°s grande del mundo. ¬°De ah√≠ vienen nuestros Pok√©mon favoritos!'
                    }
                ],
                day2: [
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>üìè Medidas de longitud:</strong> 1 metro = 100 cent√≠metros. Para pasar de metros a cent√≠metros, multiplicas por 100.',
                        question: 'üìê Un tit√°n mide 15 metros de altura. ¬øCu√°ntos cent√≠metros mide el mismo tit√°n?',
                        options: ['1.500 cent√≠metros', '150 cent√≠metros', '15.000 cent√≠metros', '1.050 cent√≠metros'],
                        correct: 0,
                        explanation: '¬°Perfecto! 15 metros √ó 100 = 1.500 cent√≠metros. Recuerda: 1 metro = 100 cent√≠metros.'
                    },
                    {
                        type: 'reading',
                        theme: 'titans',
                        learningHint: '<strong>‚è∞ Informaci√≥n temporal:</strong> Presta atenci√≥n a las palabras que indican tiempo: antes, despu√©s, durante, etc.',
                        readingText: '<h4>üìÖ La Ca√≠da de la Muralla Mar√≠a</h4>El d√≠a m√°s oscuro de la humanidad ocurri√≥ hace exactamente 5 a√±os, cuando el Tit√°n Colosal apareci√≥ por primera vez. Ese tit√°n gigante de 60 metros de altura destruy√≥ la puerta sur de la muralla Mar√≠a en solo unos minutos. Antes de ese ataque, los humanos hab√≠an vivido en paz durante 100 a√±os sin ver ning√∫n tit√°n. Despu√©s del ataque, la humanidad tuvo que retirarse a la muralla Rose, perdiendo aproximadamente un tercio de su territorio.',
                        question: '¬øCu√°ntos a√±os hab√≠an vivido los humanos en paz antes del ataque del Tit√°n Colosal?',
                        options: ['5 a√±os', '60 a√±os', '100 a√±os', '50 a√±os'],
                        correct: 2,
                        explanation: '¬°Excelente! El texto dice que "hab√≠an vivido en paz durante 100 a√±os sin ver ning√∫n tit√°n". ¬°Un siglo completo de paz!'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>üèÉ‚Äç‚ôÇÔ∏è Verbos de acci√≥n:</strong> "Attack" significa atacar. Es un verbo que indica una acci√≥n violenta.',
                        question: '‚öîÔ∏è Los titanes atacan a los humanos. ¬øC√≥mo se dice "atacar" en ingl√©s?',
                        options: ['Defend', 'Attack', 'Protect', 'Help'],
                        correct: 1,
                        explanation: '¬°Correcto! "Attack" significa atacar en ingl√©s. The titans attack the city! (¬°Los titanes atacan la ciudad!)'
                    },
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>üî¢ Fracciones b√°sicas:</strong> 1/3 significa "un tercio" = dividir algo en 3 partes iguales y tomar 1.',
                        question: 'üó∫Ô∏è Si la humanidad ten√≠a 3.000 kil√≥metros cuadrados de territorio y perdi√≥ un tercio (1/3), ¬øcu√°nto territorio perdi√≥?',
                        options: ['1.000 km¬≤', '2.000 km¬≤', '500 km¬≤', '1.500 km¬≤'],
                        correct: 0,
                        explanation: '¬°Perfecto! Un tercio de 3.000 es 3.000 √∑ 3 = 1.000 km¬≤. ¬°Una p√©rdida enorme de territorio!'
                    },
                    {
                        type: 'history',
                        theme: 'titans',
                        learningHint: '<strong>üè∞ La Edad Media:</strong> En la Edad Media (hace muchos siglos) se constru√≠an castillos y murallas para defenderse.',
                        question: 'üèõÔ∏è Las murallas como las de los titanes se constru√≠an mucho en la Edad Media. ¬øPara qu√© serv√≠an principalmente?',
                        options: ['Para decorar las ciudades', 'Para defenderse de enemigos', 'Para hacer competencias', 'Para estudiar arquitectura'],
                        correct: 1,
                        explanation: '¬°Correcto! Las murallas se constru√≠an principalmente para defenderse de enemigos, igual que en el mundo de los titanes.'
                    }
                ],
                day3: [
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>‚è±Ô∏è Tiempo y duraci√≥n:</strong> Un partido dura 90 minutos = 45 minutos + 45 minutos (dos tiempos).',
                        question: '‚è∞ Un partido de f√∫tbol dura 90 minutos en total. Si ya han pasado 67 minutos, ¬øcu√°ntos minutos faltan para que termine?',
                        options: ['23 minutos', '27 minutos', '33 minutos', '17 minutos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 90 - 67 = 23 minutos restantes. ¬°El partido est√° casi por terminar!'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>üèÜ Logros deportivos:</strong> Cuando el texto menciona n√∫meros de premios o logros, son datos importantes.',
                        readingText: '<h4>üêê Cristiano Ronaldo: El Fen√≥meno Portugu√©s</h4>Cristiano Ronaldo dos Santos Aveiro naci√≥ el 5 de febrero de 1985 en Madeira, Portugal. Es considerado uno de los mejores futbolistas de todos los tiempos junto con Messi. A lo largo de su carrera ha ganado 5 premios Bal√≥n de Oro y ha marcado m√°s de 850 goles oficiales. Ronaldo es famoso por su incre√≠ble salto (puede saltar hasta 78 cent√≠metros de altura) y por su velocidad en el sprint.',
                        question: '¬øCu√°ntos premios Bal√≥n de Oro ha ganado Cristiano Ronaldo seg√∫n el texto?',
                        options: ['3 premios', '5 premios', '7 premios', '4 premios'],
                        correct: 1,
                        explanation: '¬°Excelente! El texto dice que "ha ganado 5 premios Bal√≥n de Oro". ¬°Un logro incre√≠ble!'
                    },
                    {
                        type: 'english',
                        theme: 'football',
                        learningHint: '<strong>üèÉ‚Äç‚ôÇÔ∏è Verbos de movimiento:</strong> "Jump" significa saltar. Cristiano Ronaldo jumps very high!',
                        question: 'ü¶ò Cristiano Ronaldo puede saltar muy alto para cabecear. ¬øC√≥mo se dice "saltar" en ingl√©s?',
                        options: ['Run', 'Walk', 'Jump', 'Kick'],
                        correct: 2,
                        explanation: '¬°Genial! "Jump" significa saltar. Ronaldo can jump 78 centimeters! (¬°Ronaldo puede saltar 78 cent√≠metros!)'
                    },
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>üìä Problemas con datos:</strong> Lee bien todos los n√∫meros del problema antes de calcular.',
                        question: '‚öΩ En una temporada, Messi marc√≥ 35 goles y Ronaldo marc√≥ 28 goles. ¬øCu√°ntos goles marcaron entre los dos?',
                        options: ['63 goles', '53 goles', '73 goles', '57 goles'],
                        correct: 0,
                        explanation: '¬°Perfecto! 35 + 28 = 63 goles en total. ¬°Qu√© dupla tan incre√≠ble!'
                    },
                    {
                        type: 'geography',
                        theme: 'football',
                        learningHint: '<strong>üåç Pa√≠ses europeos:</strong> Portugal est√° en Europa, al lado de Espa√±a. Lisboa es su capital.',
                        question: 'üáµüáπ Cristiano Ronaldo naci√≥ en Portugal. ¬øCu√°l es la capital de Portugal?',
                        options: ['Madrid', 'Lisboa', 'Porto', 'Barcelona'],
                        correct: 1,
                        explanation: '¬°Correcto! Lisboa es la capital de Portugal, el pa√≠s donde naci√≥ Cristiano Ronaldo.'
                    },
                    {
                        type: 'body',
                        theme: 'football',
                        learningHint: '<strong>ü´Ä El coraz√≥n:</strong> El coraz√≥n es un m√∫sculo que bombea sangre por todo el cuerpo. Late unas 70 veces por minuto.',
                        question: 'üíì Los futbolistas necesitan un coraz√≥n fuerte para correr tanto. ¬øCu√°l es la funci√≥n principal del coraz√≥n?',
                        options: ['Respirar aire', 'Bombear sangre', 'Digerir comida', 'Pensar ideas'],
                        correct: 1,
                        explanation: '¬°Perfecto! El coraz√≥n bombea sangre a todo el cuerpo, llevando ox√≠geno y nutrientes a los m√∫sculos.'
                    }
                ],
                day4: [
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>üî¢ N√∫meros decimales:</strong> 2,5 significa "dos coma cinco" = 2 enteros y 5 d√©cimas = 2 + 0,5.',
                        question: 'üïê Un Tenno tarda 2,5 minutos en completar cada misi√≥n. Si hace 8 misiones, ¬øcu√°nto tiempo tard√≥ en total?',
                        options: ['20 minutos', '18 minutos', '16 minutos', '22 minutos'],
                        correct: 0,
                        explanation: '¬°Excelente! 2,5 √ó 8 = 20 minutos. Recuerda: 2,5 = 2 + 0,5, entonces 2,5 √ó 8 = (2 √ó 8) + (0,5 √ó 8) = 16 + 4 = 20.'
                    },
                    {
                        type: 'reading',
                        theme: 'warframe',
                        learningHint: '<strong>üî¨ Ciencia ficci√≥n:</strong> Los textos de ciencia ficci√≥n mezclan ciencia real con imaginaci√≥n futurista.',
                        readingText: '<h4>üöÄ La Tecnolog√≠a Orokin</h4>Los antiguos Orokin eran una civilizaci√≥n tecnol√≥gicamente muy avanzada que existi√≥ hace miles de a√±os en el sistema solar. Crearon tecnolog√≠a que mezclaba lo biol√≥gico con lo mec√°nico, como los Warframes. Su material m√°s preciado era el Oro Orokin, un metal especial que pod√≠a auto-repararse y durar eternamente. Los Orokin tambi√©n construyeron estaciones espaciales gigantes llamadas Torres Orokin, algunas de las cuales todav√≠a flotan en el espacio.',
                        question: '¬øC√≥mo se llamaba el material m√°s preciado de los Orokin?',
                        options: ['Acero Espacial', 'Oro Orokin', 'Titanio C√≥smico', 'Platino Gal√°ctico'],
                        correct: 1,
                        explanation: '¬°Perfecto! El texto menciona claramente el "Oro Orokin" como su material m√°s preciado. ¬°Qu√© tecnolog√≠a tan avanzada!'
                    },
                    {
                        type: 'english',
                        theme: 'warframe',
                        learningHint: '<strong>üåü Palabras del espacio:</strong> "Star" significa estrella. Las estrellas son soles que est√°n muy lejos.',
                        question: '‚≠ê Los Tenno viajan entre las estrellas del universo. ¬øC√≥mo se dice "estrella" en ingl√©s?',
                        options: ['Moon', 'Star', 'Planet', 'Sun'],
                        correct: 1,
                        explanation: '¬°Genial! "Star" significa estrella. There are billions of stars in space! (¬°Hay miles de millones de estrellas en el espacio!)'
                    },
                    {
                        type: 'science',
                        theme: 'warframe',
                        learningHint: '<strong>üåå El universo:</strong> Una galaxia es un grupo gigante de estrellas. Nuestra galaxia se llama V√≠a L√°ctea.',
                        question: 'üåå Los Tenno protegen el sistema solar, que est√° dentro de nuestra galaxia. ¬øC√≥mo se llama nuestra galaxia?',
                        options: ['Andr√≥meda', 'V√≠a L√°ctea', 'Magallanes', 'Ori√≥n'],
                        correct: 1,
                        explanation: '¬°Correcto! Vivimos en la galaxia llamada V√≠a L√°ctea, que tiene miles de millones de estrellas como nuestro Sol.'
                    },
                    {
                        type: 'technology',
                        theme: 'warframe',
                        learningHint: '<strong>ü§ñ Inteligencia Artificial:</strong> La IA son programas de computadora que pueden "pensar" y tomar decisiones.',
                        question: 'üß† En Warframe, los Cephalon son inteligencias artificiales. ¬øQu√© significa "inteligencia artificial"?',
                        options: ['Robots muy fuertes', 'Computadoras que pueden pensar', 'Naves espaciales r√°pidas', 'Armas muy poderosas'],
                        correct: 1,
                        explanation: '¬°Perfecto! La inteligencia artificial son programas de computadora que pueden pensar y resolver problemas como los humanos.'
                    }
                ],
                day5: [
                    {
                        type: 'math',
                        theme: 'mixed',
                        learningHint: '<strong>üìà Gr√°ficos simples:</strong> Un gr√°fico nos ayuda a comparar n√∫meros de forma visual.',
                        question: 'üìä En una encuesta sobre Pok√©mon favoritos: Pikachu tuvo 45 votos, Charizard 38 votos, y Blastoise 27 votos. ¬øCu√°l fue el total de votos?',
                        options: ['110 votos', '105 votos', '115 votos', '100 votos'],
                        correct: 0,
                        explanation: '¬°Excelente! 45 + 38 + 27 = 110 votos en total. ¬°Pikachu gan√≥ la encuesta!'
                    },
                    {
                        type: 'reading',
                        theme: 'mixed',
                        learningHint: '<strong>üå± Cuidado del medio ambiente:</strong> Todos podemos ayudar a cuidar nuestro planeta con acciones simples.',
                        readingText: '<h4>üåç Salvemos Nuestro Planeta</h4>El cuidado del medio ambiente es responsabilidad de todos. Peque√±as acciones como reciclar papel, pl√°stico y vidrio pueden hacer una gran diferencia. Tambi√©n podemos ahorrar agua cerrando el grifo mientras nos lavamos los dientes, y ahorrar electricidad apagando las luces cuando no las necesitamos. Los √°rboles son muy importantes porque producen el ox√≠geno que respiramos y absorben el di√≥xido de carbono.',
                        question: '¬øQu√© producen los √°rboles que nosotros necesitamos para respirar?',
                        options: ['Di√≥xido de carbono', 'Ox√≠geno', 'Nitr√≥geno', 'Vapor de agua'],
                        correct: 1,
                        explanation: '¬°Perfecto! Los √°rboles producen ox√≠geno, que es lo que necesitamos para respirar. ¬°Por eso son tan importantes!'
                    },
                    {
                        type: 'english',
                        theme: 'mixed',
                        learningHint: '<strong>üè† La familia en ingl√©s:</strong> "Family" incluye pap√°, mam√°, hermanos, abuelos, etc.',
                        question: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Ash viaja con sus amigos, pero tambi√©n quiere mucho a su familia. ¬øC√≥mo se dice "familia" en ingl√©s?',
                        options: ['Friends', 'Family', 'School', 'House'],
                        correct: 1,
                        explanation: '¬°Genial! "Family" significa familia. My family is very important! (¬°Mi familia es muy importante!)'
                    },
                    {
                        type: 'values',
                        theme: 'mixed',
                        learningHint: '<strong>ü§ù Trabajo en equipo:</strong> Cuando trabajamos juntos, podemos lograr cosas incre√≠bles.',
                        question: 'üéØ En todos los animes que hemos visto, los protagonistas trabajan en equipo. ¬øPor qu√© es importante el trabajo en equipo?',
                        options: ['Para ser m√°s famosos', 'Para lograr objetivos juntos', 'Para competir contra otros', 'Para ganar m√°s dinero'],
                        correct: 1,
                        explanation: '¬°Perfecto! El trabajo en equipo es importante porque juntos podemos lograr objetivos que solos ser√≠an imposibles.'
                    },
                    {
                        type: 'grammar',
                        theme: 'mixed',
                        learningHint: '<strong>üìù G√©nero y n√∫mero:</strong> Los sustantivos pueden ser masculinos/femeninos y singular/plural.',
                        question: '‚úèÔ∏è ¬øCu√°l de estas palabras est√° en plural (m√°s de uno)?',
                        options: ['Pok√©mon', 'Titanes', 'Jugador', 'Entrenador'],
                        correct: 1,
                        explanation: '¬°Correcto! "Titanes" est√° en plural (varios titanes). Las otras est√°n en singular (uno solo).'
                    }
                ]
            }
        };

        // Logros disponibles
        const achievements = [
            { id: 'first_exercise', name: 'Primer Paso', description: 'Completa tu primer ejercicio', icon: 'üéØ', requirement: 1 },
            { id: 'math_master', name: 'Maestro Matem√°tico', description: 'Completa 20 ejercicios de matem√°ticas', icon: 'üßÆ', requirement: 20 },
            { id: 'reading_hero', name: 'H√©roe de la Lectura', description: 'Completa 20 ejercicios de comprensi√≥n lectora', icon: 'üìö', requirement: 20 },
            { id: 'english_expert', name: 'Experto en Ingl√©s', description: 'Completa 15 ejercicios de ingl√©s', icon: 'üá¨üáß', requirement: 15 },
            { id: 'perfect_day', name: 'D√≠a Perfecto', description: 'Completa todos los ejercicios de un d√≠a sin errores', icon: '‚≠ê', requirement: 1 },
            { id: 'streak_week', name: 'Racha Semanal', description: 'Mant√©n una racha de 7 d√≠as', icon: 'üî•', requirement: 7 },
            { id: 'multiplication_master', name: 'Maestro de la Multiplicaci√≥n', description: 'Completa 15 ejercicios de multiplicaci√≥n correctos', icon: '‚úñÔ∏è', requirement: 15 },
            { id: 'reading_champion', name: 'Campe√≥n de Lectura', description: 'Lee 25 textos completos', icon: 'üëë', requirement: 25 },
            { id: 'interactive_genius', name: 'Genio Interactivo', description: 'Completa 10 ejercicios interactivos', icon: 'üß©', requirement: 10 },
            { id: 'science_explorer', name: 'Explorador Cient√≠fico', description: 'Completa 10 ejercicios de ciencias', icon: 'üî¨', requirement: 10 },
            { id: 'speed_demon', name: 'Demonio de Velocidad', description: 'Completa un d√≠a en menos de 20 minutos', icon: '‚ö°', requirement: 1 },
            { id: 'hundred_club', name: 'Club de los 100', description: 'Alcanza 100 ejercicios completados', icon: 'üíØ', requirement: 100 }
        ];

        // Funciones principales (simplificadas por espacio)
        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                createSparkles();
                alert('¬°Oye! ¬°Escribe tu nombre genial de entrenador! üåü');
                return;
            }
            
            appState.currentUser = username;
            await loadUserData();
            showMainApp();
        }

        function createSparkles() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.textContent = '‚ú®';
                    sparkle.style.left = Math.random() * window.innerWidth + 'px';
                    sparkle.style.top = Math.random() * window.innerHeight + 'px';
                    document.body.appendChild(sparkle);
                    
                    setTimeout(() => sparkle.remove(), 2000);
                }, i * 200);
            }
        }

        function logout() {
            if (confirm('¬øSeguro que quieres irte? ¬°Te vamos a extra√±ar! üò¢')) {
                appState.currentUser = null;
                appState.userData = {};
                appState.allUsersData = {};
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        }

        // Gesti√≥n de datos con JSONBin
        async function loadUserData() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const users = data.record?.users || {};
                    appState.allUsersData = users;
                    appState.userData = users[appState.currentUser] || createNewUser();
                    updateConnectionStatus('online');
                } else {
                    appState.userData = createNewUser();
                    appState.allUsersData = {};
                    updateConnectionStatus('offline');
                }
            } catch (error) {
                appState.userData = createNewUser();
                appState.allUsersData = {};
                updateConnectionStatus('offline');
            }
            
            updateLastSyncTime();
        }

        async function saveUserData() {
            try {
                updateConnectionStatus('saving');
                
                let allData = { users: {} };
                
                try {
                    const getCurrentResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': JSONBIN_CONFIG.masterKey,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (getCurrentResponse.ok) {
                        const currentData = await getCurrentResponse.json();
                        allData = currentData.record || { users: {} };
                    }
                } catch (error) {
                    console.log('No se pudieron obtener datos existentes');
                }
                
                if (!allData.users) {
                    allData.users = {};
                }
                allData.users[appState.currentUser] = {
                    ...appState.userData,
                    lastSaved: new Date().toISOString()
                };
                
                appState.allUsersData = allData.users;
                
                const saveResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    },
                    body: JSON.stringify(allData)
                });
                
                if (saveResponse.ok) {
                    updateConnectionStatus('online');
                    updateLastSyncTime();
                } else {
                    updateConnectionStatus('error');
                }
                
            } catch (error) {
                updateConnectionStatus('error');
            }
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            const statusTextElement = document.getElementById('connectionStatusText');
            
            appState.connectionStatus = status;
            
            switch (status) {
                case 'online':
                    statusElement.textContent = '‚úÖ ¬°Conectado!';
                    statusElement.className = 'connection-status online';
                    if (statusTextElement) statusTextElement.textContent = '¬°Guardado correctamente!';
                    break;
                case 'offline':
                    statusElement.textContent = '‚ùå Sin internet';
                    statusElement.className = 'connection-status offline';
                    if (statusTextElement) statusTextElement.textContent = 'Sin conexi√≥n';
                    break;
                case 'connecting':
                    statusElement.textContent = 'üîÑ Conectando...';
                    statusElement.className = 'connection-status offline';
                    if (statusTextElement) statusTextElement.textContent = 'Conectando...';
                    break;
                case 'saving':
                    statusElement.textContent = 'üíæ Guardando...';
                    statusElement.className = 'connection-status online';
                    if (statusTextElement) statusTextElement.textContent = 'Guardando datos...';
                    break;
                case 'error':
                    statusElement.textContent = '‚ö†Ô∏è Error';
                    statusElement.className = 'connection-status offline';
                    if (statusTextElement) statusTextElement.textContent = 'Error de conexi√≥n';
                    break;
            }
        }

        function updateLastSyncTime() {
            const now = new Date().toLocaleString('es-ES');
            const adminElement = document.getElementById('lastSync');
            if (adminElement) {
                adminElement.textContent = now;
            }
        }

        function createNewUser() {
            return {
                level: 1,
                totalPoints: 0,
                streak: 0,
                totalExercises: 0,
                correctAnswers: 0,
                exercisesByType: { 
                    math: 0, reading: 0, english: 0, interactive: 0, 
                    science: 0, geography: 0, history: 0, body: 0, 
                    technology: 0, grammar: 0, values: 0, nature: 0, money: 0 
                },
                exercisesByTheme: { pokemon: 0, titans: 0, football: 0, warframe: 0, mixed: 0 },
                multiplicationExercises: 0,
                textsRead: 0,
                interactiveExercises: 0,
                perfectDays: 0,
                fastestDay: null,
                completedExercises: {},
                achievements: [],
                sessionStartTime: null,
                created: new Date().toISOString(),
                lastActivity: new Date().toISOString()
            };
        }

        // Interfaz principal
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUserInterface();
            generateWeeks();
            
            // Actualizar avatar con inicial
            const avatar = document.getElementById('userAvatar');
            if (avatar) {
                avatar.textContent = appState.currentUser.charAt(0).toUpperCase();
            }
            
            const adminUser = document.getElementById('currentUserAdmin');
            if (adminUser) {
                adminUser.textContent = appState.currentUser;
            }
        }

        function updateUserInterface() {
            document.getElementById('userName').textContent = appState.currentUser;
            document.getElementById('userLevel').textContent = appState.userData.level;
            document.getElementById('totalPoints').textContent = appState.userData.totalPoints;
            document.getElementById('streak').textContent = appState.userData.streak;
            
            const accuracy = appState.userData.totalExercises > 0 
                ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100)
                : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // Gesti√≥n de pesta√±as
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'achievements') {
                loadAchievements();
            } else if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'ranking') {
                loadRanking();
            }
        }

        // Generaci√≥n de semanas
        function generateWeeks() {
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';
            
            const availableWeeks = Object.keys(exerciseDatabase).length;
            
            for (let week = 1; week <= availableWeeks; week++) {
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card';
                weekCard.onclick = () => showWeek(week);
                
                const completedDays = getCompletedDaysInWeek(week);
                const totalDays = 5;
                const progressPercent = (completedDays / totalDays) * 100;
                
                const weekEmojis = ['üî•', 'üåü', '‚ö°', 'üöÄ', 'üèÜ'];
                const weekColors = ['#ff6b6b', '#4ecdc4', '#fdcb6e', '#74b9ff', '#fd79a8'];
                
                weekCard.innerHTML = `
                    <h3>${weekEmojis[week - 1]} Semana ${week} - ¬°Aventura ${week}!</h3>
                    <p>üéØ Progreso: ${completedDays}/${totalDays} d√≠as s√∫per completados</p>
                    <div class="progress-container">
                        <div class="progress-fill-week" style="width: ${progressPercent}%"></div>
                    </div>
                    <p style="margin-top: 15px; font-size: 14px;">
                        ${week === 1 ? 'üéÆ Pok√©mon, Titanes, F√∫tbol y m√°s!' : 'üåü Nuevas aventuras te esperan!'}
                    </p>
                    ${completedDays === totalDays ? '<div style="margin-top: 15px;">üéâ ¬°SEMANA COMPLETADA! üéâ</div>' : ''}
                `;
                
                weekGrid.appendChild(weekCard);
            }
        }

        function getCompletedDaysInWeek(week) {
            let completed = 0;
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${week}_day${day}`;
                if (appState.userData.completedExercises[dayKey]) {
                    completed++;
                }
            }
            return completed;
        }

        function showWeek(weekNumber) {
            document.getElementById('weekGrid').style.display = 'none';
            document.getElementById('dayView').style.display = 'block';
            
            const dayGrid = document.getElementById('dayGrid');
            dayGrid.innerHTML = '';
            
            const days = ['üåü Lunes', 'üöÄ Martes', '‚ö° Mi√©rcoles', 'üéØ Jueves', 'üèÜ Viernes'];
            const dayColors = ['#ff6b6b', '#4ecdc4', '#fdcb6e', '#74b9ff', '#fd79a8'];
            
            document.getElementById('dayTitle').textContent = `üóìÔ∏è Semana ${weekNumber} - ¬°Elige tu d√≠a de aventura!`;
            
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${weekNumber}_day${day}`;
                const isCompleted = appState.userData.completedExercises[dayKey];
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                dayCard.style.borderColor = dayColors[day - 1];
                
                if (isCompleted) {
                    dayCard.style.background = `linear-gradient(135deg, ${dayColors[day - 1]}, #2ecc71)`;
                    dayCard.style.color = 'white';
                }
                
                dayCard.onclick = () => startDay(weekNumber, day);
                
                const exercises = getDayExercises(weekNumber, day);
                const exerciseList = exercises.map(ex => `
                    <div class="exercise-item" style="background: ${isCompleted ? 'rgba(255,255,255,0.2)' : '#f8f9fa'};">
                        <span>${getExerciseIcon(ex.type)} ${getExerciseTitle(ex.type, ex.theme)}</span>
                        <span>${isCompleted ? 'üéâ' : 'üéÆ'}</span>
                    </div>
                `).join('');
                
                const timeEstimate = Math.ceil(exercises.length * 4);
                
                dayCard.innerHTML = `
                    <h4 style="font-family: 'Fredoka One', cursive; font-size: 20px; margin-bottom: 10px;">${days[day-1]} - D√≠a ${day}</h4>
                    <p style="margin-bottom: 15px; font-weight: 600;">üïê ~${timeEstimate} minutos de diversi√≥n | ${exercises.length} retos geniales</p>
                    <div class="exercise-list">
                        ${exerciseList}
                    </div>
                    ${isCompleted ? '<div style="margin-top: 15px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">üéâ ¬°D√çA S√öPER COMPLETADO! üéâ</div>' : '<div style="margin-top: 15px; font-weight: 700; color: #636e72;">üöÄ ¬°Empezar aventura!</div>'}
                `;
                
                dayGrid.appendChild(dayCard);
            }
        }

        function backToWeeks() {
            document.getElementById('weekGrid').style.display = 'grid';
            document.getElementById('dayView').style.display = 'none';
        }

        function getDayExercises(week, day) {
            const weekKey = `week${week}`;
            const dayKey = `day${day}`;
            
            if (exerciseDatabase[weekKey] && exerciseDatabase[weekKey][dayKey]) {
                return exerciseDatabase[weekKey][dayKey];
            }
            
            return exerciseDatabase.week1.day1.slice(0, 3);
        }

        function getExerciseIcon(type) {
            const icons = {
                math: 'üßÆ',
                reading: 'üìñ',
                english: 'üá¨üáß',
                interactive: 'üß©',
                science: 'üî¨',
                geography: 'üåç',
                history: 'üèõÔ∏è',
                body: 'ü´Ä',
                technology: 'üíª',
                grammar: '‚úèÔ∏è',
                values: '‚ù§Ô∏è',
                nature: 'üå±',
                money: 'üí∞'
            };
            return icons[type] || 'üìù';
        }

        function getExerciseTitle(type, theme) {
            const titles = {
                math: 'Mates Geniales',
                reading: 'S√∫per Lectura',
                english: 'English Fun',
                interactive: 'Juego Interactivo',
                science: 'Ciencia M√°gica',
                geography: 'Explora el Mundo',
                history: 'Viaja en el Tiempo',
                body: 'Mi Cuerpo',
                technology: 'Tecnolog√≠a Cool',
                grammar: 'Palabras Perfectas',
                values: 'Valores Geniales',
                nature: 'Naturaleza',
                money: 'Dinero Inteligente'
            };
            
            const themes = {
                pokemon: 'Pok√©mon',
                titans: 'Titanes',
                football: 'F√∫tbol',
                warframe: 'Warframe',
                mixed: 'Variado'
            };
            
            return `${titles[type]} - ${themes[theme] || 'Aventura'}`;
        }

        // Sistema de ranking estilo YouTube Kids
        function loadRanking() {
            if (Object.keys(appState.allUsersData).length === 0) {
                showNoRankingData();
                return;
            }
            
            const users = Object.entries(appState.allUsersData).map(([username, userData]) => ({
                username,
                ...userData,
                accuracy: userData.totalExercises > 0 ? Math.round((userData.correctAnswers / userData.totalExercises) * 100) : 0,
                achievementCount: userData.achievements ? userData.achievements.length : 0
            }));
            
            const sortedUsers = sortUsersByFilter(users, appState.currentRankingFilter);
            showPodium(sortedUsers.slice(0, 3));
            showRankingTable(sortedUsers);
        }

        function sortUsersByFilter(users, filter) {
            switch (filter) {
                case 'achievements':
                    return users.sort((a, b) => {
                        if (b.achievementCount !== a.achievementCount) {
                            return b.achievementCount - a.achievementCount;
                        }
                        return b.totalPoints - a.totalPoints;
                    });
                case 'points':
                    return users.sort((a, b) => b.totalPoints - a.totalPoints);
                case 'level':
                    return users.sort((a, b) => {
                        if (b.level !== a.level) {
                            return b.level - a.level;
                        }
                        return b.totalPoints - a.totalPoints;
                    });
                case 'exercises':
                    return users.sort((a, b) => b.totalExercises - a.totalExercises);
                case 'accuracy':
                    return users.sort((a, b) => {
                        if (b.accuracy !== a.accuracy) {
                            return b.accuracy - a.accuracy;
                        }
                        return b.totalExercises - a.totalExercises;
                    });
                case 'streak':
                    return users.sort((a, b) => {
                        if (b.streak !== a.streak) {
                            return b.streak - a.streak;
                        }
                        return b.totalPoints - a.totalPoints;
                    });
                default:
                    return users;
            }
        }

        function showPodium(topUsers) {
            const podiumContainer = document.getElementById('podiumContainer');
            podiumContainer.innerHTML = '';
            
            if (topUsers.length === 0) {
                return;
            }
            
            const podiumData = [
                { user: topUsers[1], place: 'second', crown: 'ü•à' },
                { user: topUsers[0], place: 'first', crown: 'üëë' },
                { user: topUsers[2], place: 'third', crown: 'ü•â' }
            ];
            
            podiumData.forEach((data) => {
                if (!data.user) return;
                
                const place = document.createElement('div');
                place.className = `podium-place ${data.place}`;
                
                const isCurrentUser = data.user.username === appState.currentUser;
                
                place.innerHTML = `
                    <div class="podium-crown">${data.crown}</div>
                    <div class="podium-avatar" style="${isCurrentUser ? 'border: 4px solid #fdcb6e; animation: winner-glow 2s ease-in-out infinite;' : ''}">
                        ${data.user.username.charAt(0).toUpperCase()}
                    </div>
                    <div class="podium-name" style="${isCurrentUser ? 'text-shadow: 3px 3px 6px rgba(0,0,0,0.5);' : ''}">${data.user.username}</div>
                    <div class="podium-stat">
                        ${getFilterDisplayValue(data.user, appState.currentRankingFilter)}
                    </div>
                `;
                
                podiumContainer.appendChild(place);
            });
        }

        function showRankingTable(users) {
            const tableContainer = document.getElementById('rankingTableContainer');
            
            if (users.length === 0) {
                tableContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72; font-size: 18px; font-weight: 600;">üåü ¬°S√© el primero en aparecer aqu√≠! üåü</div>';
                return;
            }
            
            const table = document.createElement('div');
            table.className = 'ranking-table';
            
            const header = document.createElement('div');
            header.className = 'ranking-header';
            header.innerHTML = `
                <span style="font-family: 'Fredoka One', cursive;">Pos.</span>
                <span style="font-family: 'Fredoka One', cursive;">üéÆ Entrenador</span>
                <span style="font-family: 'Fredoka One', cursive;">üìà Nivel</span>
                <span style="font-family: 'Fredoka One', cursive;">üí∞ Puntos</span>
                <span style="font-family: 'Fredoka One', cursive;">${getFilterHeaderName(appState.currentRankingFilter)}</span>
                <span style="font-family: 'Fredoka One', cursive;">üèÜ Logros</span>
            `;
            table.appendChild(header);
            
            users.forEach((user, index) => {
                const row = document.createElement('div');
                row.className = `ranking-row ${user.username === appState.currentUser ? 'current-user' : ''}`;
                
                const position = index + 1;
                let positionClass = '';
                let positionIcon = position;
                
                if (position === 1) {
                    positionClass = 'first';
                    positionIcon = 'üèÜ';
                } else if (position === 2) {
                    positionClass = 'second';
                    positionIcon = 'ü•à';
                } else if (position === 3) {
                    positionClass = 'third';
                    positionIcon = 'ü•â';
                }
                
                const achievementsPreview = user.achievements ? user.achievements.slice(0, 5).map(achievementId => {
                    const achievement = achievements.find(a => a.id === achievementId);
                    return achievement ? `<div class="achievement-mini" title="${achievement.name}">${achievement.icon}</div>` : '';
                }).join('') : '';
                
                row.innerHTML = `
                    <div class="position ${positionClass}">${positionIcon}</div>
                    <div class="user-name">
                        <div class="user-avatar">${user.username.charAt(0).toUpperCase()}</div>
                        <span style="${user.username === appState.currentUser ? 'font-weight: 800;' : 'font-weight: 700;'}">${user.username}</span>
                    </div>
                    <div class="stat-value">${user.level}</div>
                    <div class="stat-value">${user.totalPoints}</div>
                    <div class="stat-value">${getFilterDisplayValue(user, appState.currentRankingFilter)}</div>
                    <div class="achievements-preview">${achievementsPreview}</div>
                `;
                
                table.appendChild(row);
            });
            
            tableContainer.innerHTML = '';
            tableContainer.appendChild(table);
        }

        function getFilterHeaderName(filter) {
            const names = {
                achievements: 'üéñÔ∏è Logros',
                points: 'üí∞ Puntos',
                level: 'üìà Nivel',
                exercises: 'üìö Ejercicios',
                accuracy: 'üéØ Precisi√≥n',
                streak: 'üî• Racha'
            };
            return names[filter] || 'Valor';
        }

        function getFilterDisplayValue(user, filter) {
            switch (filter) {
                case 'achievements':
                    return `${user.achievementCount}`;
                case 'points':
                    return `${user.totalPoints}`;
                case 'level':
                    return `${user.level}`;
                case 'exercises':
                    return `${user.totalExercises}`;
                case 'accuracy':
                    return `${user.accuracy}%`;
                case 'streak':
                    return `${user.streak}`;
                default:
                    return '0';
            }
        }

        function setRankingFilter(filter) {
            appState.currentRankingFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadRanking();
        }

        function showNoRankingData() {
            const podiumContainer = document.getElementById('podiumContainer');
            const tableContainer = document.getElementById('rankingTableContainer');
            
            podiumContainer.innerHTML = '';
            tableContainer.innerHTML = `
                <div style="text-align: center; padding: 50px; background: white; border-radius: 20px; border: 3px solid #74b9ff;">
                    <div style="font-size: 80px; margin-bottom: 20px;">üåü</div>
                    <h3 style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #2d3436; margin-bottom: 15px;">¬°S√© el primer s√∫per entrenador!</h3>
                    <p style="font-size: 16px; color: #636e72; font-weight: 600;">Completa algunos ejercicios geniales para aparecer en el ranking de campeones.</p>
                </div>
            `;
        }

        // Estad√≠sticas kids-friendly
        function loadStats() {
            const content = document.getElementById('statsContent');
            const userData = appState.userData;
            
            const accuracy = userData.totalExercises > 0 
                ? Math.round((userData.correctAnswers / userData.totalExercises) * 100)
                : 0;
            
            // Calcular posici√≥n en ranking
            const allUsers = Object.entries(appState.allUsersData);
            const sortedByAchievements = allUsers.sort((a, b) => {
                const aAchievements = a[1].achievements ? a[1].achievements.length : 0;
                const bAchievements = b[1].achievements ? b[1].achievements.length : 0;
                if (bAchievements !== aAchievements) {
                    return bAchievements - aAchievements;
                }
                return (b[1].totalPoints || 0) - (a[1].totalPoints || 0);
            });
            
            const userRankPosition = sortedByAchievements.findIndex(([username]) => username === appState.currentUser) + 1;
            const totalUsers = allUsers.length;
            
            content.innerHTML = `
                <div class="stats-kids">
                    <div class="stat-card-big">
                        <div class="stat-icon-big">üéØ</div>
                        <div class="stat-number-big">${userData.totalExercises}</div>
                        <div class="stat-label-big">Ejercicios S√∫per Completados</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">üèÜ</div>
                        <div class="stat-number-big">${userRankPosition > 0 ? `#${userRankPosition}` : 'üåü'}</div>
                        <div class="stat-label-big">Mi Posici√≥n en el Ranking</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">üéñÔ∏è</div>
                        <div class="stat-number-big">${userData.achievements.length}</div>
                        <div class="stat-label-big">Logros S√∫per Geniales</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">üî•</div>
                        <div class="stat-number-big">${userData.streak}</div>
                        <div class="stat-label-big">D√≠as Seguidos Geniales</div>
                    </div>
                </div>
                
                <div style="margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 25px; border: 3px solid #74b9ff;">
                    <h3 style="font-family: 'Fredoka One', cursive; font-size: 28px; text-align: center; margin-bottom: 30px; color: #2d3436;">üìä ¬°Mis N√∫meros S√∫per Geniales!</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #ff6b6b;">
                            <div style="font-size: 40px; margin-bottom: 10px;">üßÆ</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #ff6b6b;">${userData.exercisesByType.math || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Mates Geniales</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #4ecdc4;">
                            <div style="font-size: 40px; margin-bottom: 10px;">üìñ</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #4ecdc4;">${userData.exercisesByType.reading || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">S√∫per Lectura</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #fdcb6e;">
                            <div style="font-size: 40px; margin-bottom: 10px;">üá¨üáß</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #fdcb6e;">${userData.exercisesByType.english || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">English Fun</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #74b9ff;">
                            <div style="font-size: 40px; margin-bottom: 10px;">üî¨</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #74b9ff;">${userData.exercisesByType.science || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Ciencia M√°gica</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 25px; background: white; border-radius: 20px; border: 3px solid #fd79a8; text-align: center;">
                    <h4 style="font-family: 'Fredoka One', cursive; font-size: 24px; margin-bottom: 15px; color: #2d3436;">üéÆ Mis Temas Favoritos</h4>
                    <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üî¥</div>
                            <div style="font-family: 'Fredoka One', cursive; color: #fd79a8;">${userData.exercisesByTheme.pokemon || 0}</div>
                            <div style="font-size: 12px; font-weight: 700;">Pok√©mon</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">‚öîÔ∏è</div>
                            <div style="font-family: 'Fredoka One', cursive; color: #fd79a8;">${userData.exercisesByTheme.titans || 0}</div>
                            <div style="font-size: 12px; font-weight: 700;">Titanes</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">‚öΩ</div>
                            <div style="font-family: 'Fredoka One', cursive; color: #fd79a8;">${userData.exercisesByTheme.football || 0}</div>
                            <div style="font-size: 12px; font-weight: 700;">F√∫tbol</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üî´</div>
                            <div style="font-family: 'Fredoka One', cursive; color: #fd79a8;">${userData.exercisesByTheme.warframe || 0}</div>
                            <div style="font-size: 12px; font-weight: 700;">Warframe</div>
                        </div>
                    </div>
                </div>
                
                ${userRankPosition <= 3 && userRankPosition > 0 ? `
                    <div style="margin-top: 25px; padding: 25px; background: linear-gradient(135deg, #fdcb6e, #f39c12); border-radius: 20px; text-align: center; color: white; border: 3px solid white;">
                        <div style="font-size: 60px; margin-bottom: 15px;">üéâ</div>
                        <h3 style="font-family: 'Fredoka One', cursive; font-size: 24px; text-shadow: 3px 3px 6px rgba(0,0,0,0.3);">¬°EST√ÅS EN EL PODIO!</h3>
                        <p style="font-weight: 700; font-size: 16px;">¬°Eres uno de los 3 mejores entrenadores! ¬°Sigue as√≠!</p>
                    </div>
                ` : ''}
            `;
        }

        function loadAchievements() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const isUnlocked = appState.userData.achievements.includes(achievement.id);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : ''}`;
                card.style.border = `3px solid ${isUnlocked ? '#ffd700' : '#ddd'}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <h4 style="font-family: 'Fredoka One', cursive; margin-bottom: 10px;">${achievement.name}</h4>
                    <p style="font-weight: 600; font-size: 14px;">${achievement.description}</p>
                    <div style="margin-top: 15px; font-size: 14px; font-weight: 700;">
                        ${isUnlocked ? 'üéâ ¬°DESBLOQUEADO!' : 'üîê Bloqueado'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Funciones simplificadas para ejercicios
        function startDay(week, day) {
            createSparkles();
            alert(`üéÆ ¬°Empezando aventura del d√≠a ${day} de la semana ${week}! üöÄ\n\n(Funci√≥n completa de ejercicios disponible en la versi√≥n completa)`);
        }

        // Funciones de administraci√≥n
        async function testConnection() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                    alert('‚úÖ ¬°Conexi√≥n s√∫per exitosa con JSONBin.io! üéâ');
                    await loadUserData();
                } else {
                    updateConnectionStatus('error');
                    alert('‚ùå Error de conexi√≥n: ' + response.status);
                }
            } catch (error) {
                updateConnectionStatus('error');
                alert('‚ùå Error de red: ' + error.message);
            }
        }

        function resetProgress() {
            if (confirm('¬øEst√°s s√∫per seguro de que quieres empezar de nuevo? ¬°Perder√°s todos tus logros geniales! üò±')) {
                appState.userData = createNewUser();
                saveUserData();
                updateUserInterface();
                generateWeeks();
                createSparkles();
                alert('üéâ ¬°Progreso reiniciado! ¬°Nueva aventura comenzando! üöÄ');
            }
        }

        function exportData() {
            const dataToExport = {
                user: appState.currentUser,
                data: appState.userData,
                ranking: {
                    position: calculateUserRankPosition(),
                    totalUsers: Object.keys(appState.allUsersData).length
                },
                exportDate: new Date().toISOString(),
                summary: {
                    totalExercises: appState.userData.totalExercises,
                    accuracy: appState.userData.totalExercises > 0 ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100) : 0,
                    level: appState.userData.level,
                    achievements: appState.userData.achievements.length,
                    connectionStatus: appState.connectionStatus,
                    perfectDays: appState.userData.perfectDays || 0,
                    fastestDay: appState.userData.fastestDay || null
                }
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `academia_pokemon_${appState.currentUser}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            createSparkles();
            alert('üì• ¬°Datos s√∫per descargados! üéâ');
        }

        function calculateUserRankPosition() {
            const allUsers = Object.entries(appState.allUsersData);
            const sortedByAchievements = allUsers.sort((a, b) => {
                const aAchievements = a[1].achievements ? a[1].achievements.length : 0;
                const bAchievements = b[1].achievements ? b[1].achievements.length : 0;
                if (bAchievements !== aAchievements) {
                    return bAchievements - aAchievements;
                }
                return (b[1].totalPoints || 0) - (a[1].totalPoints || 0);
            });
            
            return sortedByAchievements.findIndex(([username]) => username === appState.currentUser) + 1;
        }

        // Sistema de recompensas
        function showReward(title, icon, message) {
            createSparkles();
            alert(`${icon} ${title}\n\n${message}`);
        }

        function closeReward() {
            // Funci√≥n simplificada
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ Academia Pokemon iniciada - Versi√≥n YouTube Kids Style');
            console.log('üåà ¬°Dise√±o s√∫per colorido y divertido activado!');
            
            updateConnectionStatus('offline');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            // Event listener para Enter en el input de login
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            // A√±adir efectos de brillo aleatorios
            setInterval(() => {
                if (Math.random() > 0.7) {
                    createSparkles();
                }
            }, 10000);
        });

        // Funciones simplificadas para demo (por espacio)
        function selectOption(selectedIndex) {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function nextExercise() {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function completeDay() {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function closeExercise() {
            // Funci√≥n simplificada
        }

        function showExercise() {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function showNormalExercise(exercise) {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function showInteractiveExercise(exercise) {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function createSequenceExercise(exercise) {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function createDragDropExercise(exercise) {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function handleInteractiveResult(isCorrect, explanation) {
            alert('üéÆ Funci√≥n completa de ejercicios disponible en la versi√≥n final');
        }

        function checkAchievements() {
            // L√≥gica simplificada
        }

        function showDayComplete(correct, total, duration) {
            createSparkles();
            alert(`üéâ ¬°D√≠a s√∫per completado! ${correct}/${total} en ${duration} minutos üöÄ`);
        }

        // Agregar m√°s efectos visuales
        function addFloatingEmoji() {
            const emojis = ['üåü', '‚≠ê', '‚ú®', 'üéâ', 'üöÄ', 'üèÜ', 'üéØ', 'üíØ'];
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            const element = document.createElement('div');
            element.textContent = emoji;
            element.style.position = 'fixed';
            element.style.left = Math.random() * window.innerWidth + 'px';
            element.style.top = window.innerHeight + 'px';
            element.style.fontSize = '30px';
            element.style.zIndex = '9999';
            element.style.pointerEvents = 'none';
            element.style.animation = 'floatUp 4s ease-out forwards';
            
            document.body.appendChild(element);
            
            setTimeout(() => element.remove(), 4000);
        }

        // Agregar CSS para animaci√≥n flotante
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatUp {
                from {
                    transform: translateY(0px) rotate(0deg);
                    opacity: 1;
                }
                to {
                    transform: translateY(-100vh) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Activar efectos especiales ocasionalmente
        setInterval(() => {
            if (Math.random() > 0.8) {
                addFloatingEmoji();
            }
        }, 5000);
    </script>
</body>
</html>
