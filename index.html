<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 Academia Pokemon - ¡Aprende Jugando!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 25%, #45b7d1 50%, #96ceb4 75%, #ffeaa7 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            min-height: 100vh;
            color: #2d3436;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 500px;
            width: 100%;
            position: relative;
            z-index: 2;
            border: 5px solid transparent;
            background-clip: padding-box;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            border-radius: 35px;
            z-index: -1;
        }

        .login-card h1 {
            font-family: 'Fredoka One', cursive;
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 3em;
            text-shadow: 3px 3px 0px #fff;
        }

        .login-card p {
            font-size: 18px;
            color: #636e72;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .login-card input {
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: 3px solid #ddd;
            border-radius: 20px;
            font-size: 18px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .login-card input:focus {
            outline: none;
            border-color: #ff6b6b;
            transform: scale(1.02);
            background: white;
        }

        .login-card button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #fd79a8);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
            font-family: 'Nunito', sans-serif;
        }

        .login-card button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
        }

        .main-app {
            display: none;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 3px solid #fdcb6e;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            color: white;
            font-weight: 800;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border: 4px solid white;
        }

        .user-info h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: #2d3436;
            margin: 0;
        }

        .user-info p {
            font-size: 16px;
            color: #636e72;
            margin: 5px 0 0 0;
            font-weight: 600;
        }

        .stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
            min-width: 100px;
            transition: transform 0.3s;
            border: 3px solid white;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            box-shadow: 0 8px 25px rgba(253, 121, 168, 0.3);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            box-shadow: 0 8px 25px rgba(253, 203, 110, 0.3);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 800;
            font-family: 'Fredoka One', cursive;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            font-weight: 600;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 18px 30px;
            background: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            color: #636e72;
            border: 3px solid transparent;
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            color: white;
            border-color: white;
            transform: translateY(-3px);
        }

        .content-area {
            background: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            min-height: 600px;
            border: 3px solid #fdcb6e;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .content-area h2 {
            font-family: 'Fredoka One', cursive;
            color: #2d3436;
            margin-bottom: 30px;
            font-size: 32px;
            text-align: center;
            text-shadow: 2px 2px 0px #ddd;
        }

        .ranking-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .ranking-filters {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 25px;
        }

        .filter-btn {
            padding: 15px 25px;
            background: white;
            border: 3px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: #636e72;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .filter-btn.active {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border-color: white;
            transform: translateY(-2px);
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: end;
            gap: 20px;
            margin: 40px 0;
            height: 300px;
        }

        .podium-place {
            background: white;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            min-width: 180px;
            border: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .podium-place:hover {
            transform: translateY(-8px) scale(1.05);
        }

        .podium-place.first {
            height: 250px;
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            border-color: #f39c12;
            order: 2;
        }

        .podium-place.second {
            height: 200px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-color: #0984e3;
            order: 1;
        }

        .podium-place.third {
            height: 150px;
            background: linear-gradient(135deg, #fd79a8, #e84393);
            border-color: #e84393;
            order: 3;
        }

        .podium-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2d3436;
            font-size: 28px;
            font-weight: 800;
            margin: 0 auto 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 4px solid rgba(255,255,255,0.5);
        }

        .podium-crown {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .podium-name {
            font-family: 'Fredoka One', cursive;
            font-size: 18px;
            color: white;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .podium-stat {
            font-size: 14px;
            color: white;
            opacity: 0.9;
            font-weight: 600;
        }

        .ranking-table {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid #74b9ff;
        }

        .ranking-header {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 120px 140px;
            gap: 20px;
            font-weight: 800;
            font-size: 16px;
            align-items: center;
        }

        .ranking-row {
            padding: 20px 25px;
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 120px 140px;
            gap: 20px;
            align-items: center;
            border-bottom: 2px solid #f1f2f6;
            transition: all 0.3s;
            font-weight: 600;
        }

        .ranking-row:hover {
            background: linear-gradient(90deg, #f8f9fa, #e9ecef);
            transform: translateX(5px);
        }

        .ranking-row.current-user {
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            color: white;
            border: 3px solid #e17055;
            margin: 5px 0;
            border-radius: 15px;
        }

        .position {
            text-align: center;
            font-weight: 800;
            font-size: 20px;
            font-family: 'Fredoka One', cursive;
        }

        .position.first {
            color: #f39c12;
            font-size: 32px;
        }

        .position.second {
            color: #0984e3;
            font-size: 28px;
        }

        .position.third {
            color: #e84393;
            font-size: 24px;
        }

        .user-name {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 800;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border: 3px solid white;
        }

        .user-name span {
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 16px;
        }

        .stat-value {
            text-align: center;
            font-weight: 800;
            font-size: 16px;
            color: #2d3436;
            font-family: 'Fredoka One', cursive;
        }

        .ranking-row.current-user .stat-value {
            color: white;
        }

        .achievements-preview {
            display: flex;
            gap: 3px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .achievement-mini {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(45deg, #fdcb6e, #f39c12);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .week-card {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .week-card:nth-child(1) {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
        }

        .week-card:nth-child(2) {
            border-color: #4ecdc4;
            background: linear-gradient(135deg, #00cec9, #00b894);
            color: white;
        }

        .week-card:nth-child(3) {
            border-color: #fdcb6e;
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            color: white;
        }

        .week-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .week-card h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 28px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .week-card p {
            font-size: 16px;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .progress-container {
            background: rgba(255,255,255,0.3);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill-week {
            height: 100%;
            background: white;
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .day-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .day-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 3px solid #74b9ff;
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
        }

        .exercise-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .exercise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
        }

        #exerciseOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .exercise-container {
            background: white;
            padding: 40px;
            border-radius: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .close-exercise {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #636e72;
        }

        .exercise-hint {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 3px solid white;
        }

        .reading-text {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 3px solid #74b9ff;
            line-height: 1.6;
        }

        .exercise-question {
            font-size: 20px;
            font-weight: 700;
            margin: 25px 0;
            color: #2d3436;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .option-btn {
            padding: 20px;
            border: 3px solid #ddd;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 600;
            text-align: left;
        }

        .option-btn:hover {
            border-color: #74b9ff;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .option-btn.selected {
            border-color: #74b9ff;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .exercise-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        .exercise-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
        }

        .exercise-btn.primary {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);
        }

        .exercise-btn.secondary {
            background: #636e72;
            color: white;
            box-shadow: 0 5px 15px rgba(99, 110, 114, 0.4);
        }

        .exercise-btn:hover {
            transform: translateY(-2px);
        }

        .exercise-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .stats-kids {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .stat-card-big {
            background: white;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 4px solid;
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card-big:hover {
            transform: translateY(-5px) scale(1.02);
        }

        .stat-card-big:nth-child(1) {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
        }

        .stat-card-big:nth-child(2) {
            border-color: #4ecdc4;
            background: linear-gradient(135deg, #00cec9, #00b894);
            color: white;
        }

        .stat-card-big:nth-child(3) {
            border-color: #fdcb6e;
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            color: white;
        }

        .stat-card-big:nth-child(4) {
            border-color: #74b9ff;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .stat-icon-big {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .stat-number-big {
            font-family: 'Fredoka One', cursive;
            font-size: 48px;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }

        .stat-label-big {
            font-size: 18px;
            font-weight: 700;
            opacity: 0.9;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .achievement-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            border: 3px solid #ddd;
        }

        .achievement-card.unlocked {
            border-color: #ffd700;
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            color: white;
        }

        .achievement-card:hover {
            transform: translateY(-5px);
        }

        .achievement-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .connection-status {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 18px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .connection-status.online {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
        }

        .connection-status.offline {
            background: linear-gradient(45deg, #e17055, #d63031);
            color: white;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
                padding: 20px;
            }

            .stats {
                width: 100%;
                justify-content: center;
            }

            .nav-tabs {
                justify-content: center;
                gap: 10px;
            }

            .nav-tab {
                padding: 12px 20px;
                font-size: 14px;
            }

            .content-area {
                padding: 20px;
            }

            .ranking-header,
            .ranking-row {
                grid-template-columns: 50px 1fr 60px 60px 60px;
                gap: 10px;
                font-size: 12px;
                padding: 15px;
            }

            .ranking-header span:nth-child(6),
            .ranking-row .achievements-preview {
                display: none;
            }

            .podium {
                flex-direction: column;
                height: auto;
                gap: 20px;
            }

            .podium-place {
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
                height: auto !important;
            }

            .week-grid {
                grid-template-columns: 1fr;
            }

            .day-grid {
                grid-template-columns: 1fr;
            }

            .stats-kids {
                grid-template-columns: 1fr;
            }

            .options-container {
                grid-template-columns: 1fr;
            }

            .exercise-container {
                padding: 20px;
                width: 95%;
            }

            .exercise-controls {
                flex-direction: column;
                align-items: center;
            }

            .user-info {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .avatar {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="connectionStatus" class="connection-status offline">🔄 Conectando...</div>

    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1>🎮 Academia Pokemon</h1>
            <p>¡Conviértete en el mejor entrenador de conocimientos!</p>
            <input type="text" id="usernameInput" placeholder="✨ Escribe tu nombre de entrenador ✨" maxlength="20">
            <button onclick="login()">🚀 ¡Comenzar Aventura! 🚀</button>
        </div>
    </div>

    <div id="mainApp" class="main-app">
        <div class="container">
            <div class="header">
                <div class="user-info">
                    <div class="avatar" id="userAvatar">🏆</div>
                    <div>
                        <h2 id="userName">Entrenador</h2>
                        <p>🌟 Nivel <span id="userLevel">1</span> 🌟</p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPoints">0</div>
                        <div class="stat-label">💰 Puntos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="streak">0</div>
                        <div class="stat-label">🔥 Racha</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="accuracy">0%</div>
                        <div class="stat-label">🎯 Precisión</div>
                    </div>
                </div>
                <button onclick="logout()" style="background: linear-gradient(45deg, #e17055, #d63031); color: white; border: none; padding: 15px 25px; border-radius: 20px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(225, 112, 85, 0.4);">👋 Salir</button>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="training">🎯 Entrenamiento</button>
                <button class="nav-tab" data-tab="ranking">🏆 Ranking</button>
                <button class="nav-tab" data-tab="achievements">🎖️ Mis Logros</button>
                <button class="nav-tab" data-tab="stats">📊 Mis Estadísticas</button>
                <button class="nav-tab" data-tab="admin">⚙️ Configuración</button>
            </div>

            <div class="content-area">
                <div id="trainingTab" class="tab-content active">
                    <h2>🗓️ ¡Elige tu Semana de Aventuras!</h2>
                    <div class="week-grid" id="weekGrid"></div>
                    <div id="dayView" style="display: none;">
                        <button onclick="backToWeeks()" style="margin-bottom: 25px; padding: 15px 25px; background: linear-gradient(45deg, #636e72, #2d3436); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(99, 110, 114, 0.4);">← 🏠 Volver a Semanas</button>
                        <h3 id="dayTitle" style="font-family: 'Fredoka One', cursive; font-size: 28px; text-align: center; margin-bottom: 25px;"></h3>
                        <div class="day-grid" id="dayGrid"></div>
                    </div>
                </div>

                <div id="rankingTab" class="tab-content">
                    <h2>🏆 ¡Tabla de Campeones!</h2>
                    <div class="ranking-container">
                        <div class="ranking-filters">
                            <button class="filter-btn active" onclick="setRankingFilter('achievements')">🎖️ Logros</button>
                            <button class="filter-btn" onclick="setRankingFilter('points')">💰 Puntos</button>
                            <button class="filter-btn" onclick="setRankingFilter('level')">📈 Nivel</button>
                            <button class="filter-btn" onclick="setRankingFilter('exercises')">📚 Ejercicios</button>
                            <button class="filter-btn" onclick="setRankingFilter('accuracy')">🎯 Precisión</button>
                            <button class="filter-btn" onclick="setRankingFilter('streak')">🔥 Racha</button>
                        </div>
                        <div id="podiumContainer" class="podium"></div>
                        <div id="rankingTableContainer"></div>
                    </div>
                </div>

                <div id="achievementsTab" class="tab-content">
                    <h2>🎖️ ¡Mis Súper Logros!</h2>
                    <div class="achievement-grid" id="achievementGrid"></div>
                </div>

                <div id="statsTab" class="tab-content">
                    <h2>📊 ¡Mis Números Geniales!</h2>
                    <div id="statsContent"></div>
                </div>

                <div id="adminTab" class="tab-content">
                    <h2>⚙️ Mi Panel de Control</h2>
                    <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 25px; border-radius: 20px; margin-bottom: 25px; border: 3px solid #74b9ff;">
                        <h4 style="font-family: 'Fredoka One', cursive; font-size: 20px; margin-bottom: 15px; color: #2d3436;">📊 Estado de mi Cuenta</h4>
                        <p><strong>🎮 Mi nombre:</strong> <span id="currentUserAdmin"></span></p>
                        <p><strong>🕐 Última vez conectado:</strong> <span id="lastSync">-</span></p>
                        <p><strong>💾 Mis datos:</strong> <span id="connectionStatusText">Guardando...</span></p>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                        <button onclick="testConnection()" style="padding: 18px 30px; background: linear-gradient(45deg, #74b9ff, #0984e3); color: white; border: none; border-radius: 20px; font-size: 16px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);">🔄 Probar Conexión</button>
                        <button onclick="resetProgress()" style="padding: 18px 30px; background: linear-gradient(45deg, #e17055, #d63031); color: white; border: none; border-radius: 20px; font-size: 16px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(225, 112, 85, 0.4);">🔄 Empezar de Nuevo</button>
                        <button onclick="exportData()" style="padding: 18px 30px; background: linear-gradient(45deg, #00b894, #00cec9); color: white; border: none; border-radius: 20px; font-size: 16px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);">📥 Descargar mis Datos</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="exerciseOverlay">
        <div class="exercise-container">
            <button class="close-exercise" onclick="closeExercise()">✕</button>
            <div id="exerciseContent"></div>
        </div>
    </div>

    <script>
        const JSONBIN_CONFIG = {
            binId: '68ee144343b1c97be96704f9',
            masterKey: '$2a$10$byEkgCiPtr6uA9j.sw5Uiuld00jGPRMT1Rn9TlhHYbPe3CFfaEu6G',
            apiUrl: 'https://api.jsonbin.io/v3'
        };

        let appState = {
            currentUser: null,
            userData: {},
            currentExerciseSet: [],
            currentExerciseIndex: 0,
            currentWeek: 0,
            currentDay: 0,
            currentSessionStats: { correct: 0, total: 0 },
            connectionStatus: 'offline',
            allUsersData: {},
            currentRankingFilter: 'achievements',
            selectedOption: null
        };

        const exerciseDatabase = {
            week1: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>💡 Suma con llevadas:</strong> Cuando la suma de unidades es mayor que 9, "llevamos" a las decenas.',
                        question: '🔥 Charizard tenía 47 puntos de ataque. Después de entrenar intensamente con Ash, ganó 28 puntos más. ¿Cuántos puntos de ataque tiene ahora?',
                        options: ['75 puntos', '65 puntos', '71 puntos', '79 puntos'],
                        correct: 0,
                        explanation: '¡Perfecto! 47 + 28 = 75. Recuerda: 7 + 8 = 15, escribimos 5 y llevamos 1. Luego 4 + 2 + 1 = 7.'
                    },
                    {
                        type: 'reading',
                        theme: 'pokemon',
                        learningHint: '<strong>📚 Comprensión lectora:</strong> Lee despacio y busca detalles específicos.',
                        readingText: '<h4>🔵 El Entrenamiento de Pikachu</h4>Pikachu es un Pokémon eléctrico muy especial que vive en los densos bosques verdes cerca de Pueblo Paleta. Cada mañana temprano, a las 7:00, entrena sus habilidades eléctricas junto a Ash. Le encanta comer exactamente 12 bayas dulces rojas para desayunar, que encuentra en los árboles más altos del bosque. Su ataque favorito es el "Rayo" porque puede generar hasta 100.000 voltios de electricidad con sus mejillas amarillas brillantes.',
                        question: '¿Cuántas bayas rojas come Pikachu para desayunar cada mañana?',
                        options: ['10 bayas', '12 bayas', '15 bayas', '8 bayas'],
                        correct: 1,
                        explanation: '¡Excelente! El texto dice claramente que "come exactamente 12 bayas dulces rojas para desayunar". ¡Has leído con mucha atención a los detalles!'
                    },
                    {
                        type: 'english',
                        theme: 'pokemon',
                        learningHint: '<strong>🇬🇧 Colores en inglés:</strong> Los colores son palabras muy importantes. "Yellow" suena como "jelo".',
                        question: '🟡 Las mejillas de Pikachu son amarillas y brillantes. ¿Cómo se dice "amarillo" en inglés?',
                        options: ['Red', 'Blue', 'Yellow', 'Green'],
                        correct: 2,
                        explanation: '¡Genial! "Yellow" significa amarillo en inglés. Pikachu has yellow cheeks! (¡Pikachu tiene mejillas amarillas!)'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>✖️ Multiplicación visual:</strong> 6 × 4 significa 6 grupos de 4 objetos. Imagina 6 filas de 4 Pokémon cada una.',
                        question: '🎯 Ash tiene 6 Pokémon en su equipo. Cada Pokémon puede aprender exactamente 4 movimientos diferentes. ¿Cuántos movimientos conoce todo su equipo?',
                        options: ['24 movimientos', '20 movimientos', '26 movimientos', '22 movimientos'],
                        correct: 0,
                        explanation: '¡Perfecto! 6 × 4 = 24 movimientos. Puedes pensarlo como sumar: 4 + 4 + 4 + 4 + 4 + 4 = 24.'
                    },
                    {
                        type: 'science',
                        theme: 'pokemon',
                        learningHint: '<strong>🔬 Estados de la materia:</strong> Sólido (hielo), líquido (agua), gas (vapor). El calor cambia el estado.',
                        question: '🧊 Cuando un Pokémon de tipo hielo usa su ataque, convierte el agua líquida en hielo sólido. ¿Qué tipo de cambio de estado es este?',
                        options: ['Evaporación', 'Solidificación', 'Fusión', 'Condensación'],
                        correct: 1,
                        explanation: '¡Correcto! La solidificación es cuando un líquido (agua) se convierte en sólido (hielo). ¡Como los ataques de hielo de los Pokémon!'
                    }
                ],
                day2: [
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>➕ Sumas con tres números:</strong> Suma de dos en dos: primero 15 + 23 = 38, luego 38 + 17.',
                        question: '⚔️ Eren contó titanes durante tres días consecutivos. El lunes vio 15 titanes, el martes 23 titanes, y el miércoles 17 titanes. ¿Cuántos titanes observó en total?',
                        options: ['55 titanes', '53 titanes', '57 titanes', '52 titanes'],
                        correct: 0,
                        explanation: '¡Correcto! 15 + 23 + 17 = 55 titanes. Paso a paso: 15 + 23 = 38, luego 38 + 17 = 55.'
                    }
                ],
                day3: [
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>➕➖ Operaciones combinadas:</strong> Primero suma todos los goles de cada equipo, luego resta para comparar.',
                        question: '⚽ En el partido de ayer, el Real Madrid metió 2 goles en el primer tiempo y 3 en el segundo. El Barcelona metió 1 gol en el primer tiempo y 3 en el segundo. ¿Cuál fue la diferencia de goles?',
                        options: ['1 gol', '2 goles', '0 goles', '3 goles'],
                        correct: 0,
                        explanation: '¡Muy bien! Real Madrid: 2 + 3 = 5 goles. Barcelona: 1 + 3 = 4 goles. Diferencia: 5 - 4 = 1 gol a favor del Real Madrid.'
                    }
                ],
                day4: [
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>➖ Resta con llevadas:</strong> Si necesitas quitar más de lo que tienes en una posición, "pides prestado" a la siguiente.',
                        question: '🔫 Un Tenno empieza su misión con 124 puntos de energía. Usa 67 puntos para sus habilidades especiales. ¿Cuánta energía le queda?',
                        options: ['57 puntos', '63 puntos', '51 puntos', '59 puntos'],
                        correct: 0,
                        explanation: '¡Perfecto! 124 - 67 = 57 puntos. En la resta: 4 - 7 no se puede, pido prestado: 14 - 7 = 7, luego 1 - 6 no se puede, pido prestado: 11 - 6 = 5.'
                    }
                ],
                day5: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>➗ División exacta:</strong> Dividir es repartir en partes iguales. 24 ÷ 6 = 4 significa que cada grupo tiene 4.',
                        question: '🔴 Ash tiene 24 Pokéballs nuevas y quiere repartirlas igualmente entre sus 6 amigos entrenadores. ¿Cuántas Pokéballs recibirá cada amigo?',
                        options: ['4 Pokéballs', '5 Pokéballs', '3 Pokéballs', '6 Pokéballs'],
                        correct: 0,
                        explanation: '¡Perfecto! 24 ÷ 6 = 4 Pokéballs cada uno. Puedes comprobarlo: 4 × 6 = 24. ¡Ash es muy generoso!'
                    }
                ]
            },
            week2: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>✖️ Tablas de multiplicar avanzadas:</strong> La tabla del 9 tiene un truco: 9×7 = 63, fíjate que 6+3=9.',
                        question: '⚡ Pikachu puede lanzar 9 rayos eléctricos por segundo durante 7 segundos seguidos. ¿Cuántos rayos lanza en total?',
                        options: ['63 rayos', '56 rayos', '72 rayos', '64 rayos'],
                        correct: 0,
                        explanation: '¡Increíble! 9 × 7 = 63 rayos. ¿Notaste que 6 + 3 = 9? ¡Ese es el truco de la tabla del 9!'
                    }
                ]
            }
        };

        const achievements = [
            { id: 'first_exercise', name: 'Primer Paso', description: 'Completa tu primer ejercicio', icon: '🎯', requirement: 1 },
            { id: 'math_master', name: 'Maestro Matemático', description: 'Completa 20 ejercicios de matemáticas', icon: '🧮', requirement: 20 },
            { id: 'reading_hero', name: 'Héroe de la Lectura', description: 'Completa 20 ejercicios de comprensión lectora', icon: '📚', requirement: 20 },
            { id: 'english_expert', name: 'Experto en Inglés', description: 'Completa 15 ejercicios de inglés', icon: '🇬🇧', requirement: 15 },
            { id: 'perfect_day', name: 'Día Perfecto', description: 'Completa todos los ejercicios de un día sin errores', icon: '⭐', requirement: 1 },
            { id: 'streak_week', name: 'Racha Semanal', description: 'Mantén una racha de 7 días', icon: '🔥', requirement: 7 },
            { id: 'science_explorer', name: 'Explorador Científico', description: 'Completa 10 ejercicios de ciencias', icon: '🔬', requirement: 10 },
            { id: 'hundred_club', name: 'Club de los 100', description: 'Alcanza 100 ejercicios completados', icon: '💯', requirement: 100 }
        ];

        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('¡Oye! ¡Escribe tu nombre genial de entrenador! 🌟');
                return;
            }
            
            appState.currentUser = username;
            await loadUserData();
            showMainApp();
        }

        function logout() {
            if (confirm('¿Seguro que quieres irte? ¡Te vamos a extrañar! 😢')) {
                appState.currentUser = null;
                appState.userData = {};
                appState.allUsersData = {};
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        }

        async function loadUserData() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const users = data.record?.users || {};
                    appState.allUsersData = users;
                    appState.userData = users[appState.currentUser] || createNewUser();
                    updateConnectionStatus('online');
                } else {
                    appState.userData = createNewUser();
                    appState.allUsersData = {};
                    updateConnectionStatus('offline');
                }
            } catch (error) {
                appState.userData = createNewUser();
                appState.allUsersData = {};
                updateConnectionStatus('offline');
            }
            
            updateLastSyncTime();
        }

        async function saveUserData() {
            try {
                updateConnectionStatus('saving');
                
                let allData = { users: {} };
                
                try {
                    const getCurrentResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': JSONBIN_CONFIG.masterKey,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (getCurrentResponse.ok) {
                        const currentData = await getCurrentResponse.json();
                        allData = currentData.record || { users: {} };
                    }
                } catch (error) {
                    console.log('No se pudieron obtener datos existentes');
                }
                
                if (!allData.users) {
                    allData.users = {};
                }
                allData.users[appState.currentUser] = {
                    ...appState.userData,
                    lastSaved: new Date().toISOString()
                };
                
                appState.allUsersData = allData.users;
                
                const saveResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    },
                    body: JSON.stringify(allData)
                });
                
                if (saveResponse.ok) {
                    updateConnectionStatus('online');
                    updateLastSyncTime();
                } else {
                    updateConnectionStatus('error');
                }
                
            } catch (error) {
                updateConnectionStatus('error');
            }
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            const statusTextElement = document.getElementById('connectionStatusText');
            
            appState.connectionStatus = status;
            
            switch (status) {
                case 'online':
                    statusElement.textContent = '✅ ¡Conectado!';
                    statusElement.className = 'connection-status online';
                    if (statusTextElement) statusTextElement.textContent = '¡Guardado correctamente!';
                    break;
                case 'offline':
                    statusElement.textContent = '❌ Sin internet';
                    statusElement.className = 'connection-status offline';
                    if (statusTextElement) statusTextElement.textContent = 'Sin conexión';
                    break;
                case 'connecting':
                    statusElement.textContent = '🔄 Conectando...';
                    statusElement.className = 'connection-status offline';
                    if (statusTextElement) statusTextElement.textContent = 'Conectando...';
                    break;
                case 'saving':
                    statusElement.textContent = '💾 Guardando...';
                    statusElement.className = 'connection-status online';
                    if (statusTextElement) statusTextElement.textContent = 'Guardando datos...';
                    break;
                case 'error':
                    statusElement.textContent = '⚠️ Error';
                    statusElement.className = 'connection-status offline';
                    if (statusTextElement) statusTextElement.textContent = 'Error de conexión';
                    break;
            }
        }

        function updateLastSyncTime() {
            const now = new Date().toLocaleString('es-ES');
            const adminElement = document.getElementById('lastSync');
            if (adminElement) {
                adminElement.textContent = now;
            }
        }

        function createNewUser() {
            return {
                level: 1,
                totalPoints: 0,
                streak: 0,
                totalExercises: 0,
                correctAnswers: 0,
                exercisesByType: { 
                    math: 0, reading: 0, english: 0, interactive: 0, 
                    science: 0, geography: 0, history: 0, body: 0, 
                    technology: 0, grammar: 0, values: 0, nature: 0, money: 0 
                },
                exercisesByTheme: { pokemon: 0, titans: 0, football: 0, warframe: 0, mixed: 0 },
                completedExercises: {},
                achievements: [],
                created: new Date().toISOString(),
                lastActivity: new Date().toISOString()
            };
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUserInterface();
            generateWeeks();
            
            const avatar = document.getElementById('userAvatar');
            if (avatar) {
                avatar.textContent = appState.currentUser.charAt(0).toUpperCase();
            }
            
            const adminUser = document.getElementById('currentUserAdmin');
            if (adminUser) {
                adminUser.textContent = appState.currentUser;
            }
        }

        function updateUserInterface() {
            document.getElementById('userName').textContent = appState.currentUser;
            document.getElementById('userLevel').textContent = appState.userData.level;
            document.getElementById('totalPoints').textContent = appState.userData.totalPoints;
            document.getElementById('streak').textContent = appState.userData.streak;
            
            const accuracy = appState.userData.totalExercises > 0 
                ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100)
                : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const selectedTab = document.getElementById(tabName + 'Tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            const clickedButton = document.querySelector(`.nav-tab[data-tab="${tabName}"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            if (tabName === 'achievements') {
                loadAchievements();
            } else if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'ranking') {
                loadRanking();
            }
        }

        function generateWeeks() {
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';
            
            const availableWeeks = Object.keys(exerciseDatabase).length;
            
            for (let week = 1; week <= availableWeeks; week++) {
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card';
                weekCard.onclick = () => showWeek(week);
                
                const completedDays = getCompletedDaysInWeek(week);
                const totalDays = Object.keys(exerciseDatabase[`week${week}`]).length;
                const progressPercent = (completedDays / totalDays) * 100;
                
                const weekEmojis = ['🔥', '🌟', '⚡', '🚀', '🏆'];
                
                weekCard.innerHTML = `
                    <h3>${weekEmojis[week - 1]} Semana ${week} - ¡Aventura ${week}!</h3>
                    <p>🎯 Progreso: ${completedDays}/${totalDays} días súper completados</p>
                    <div class="progress-container">
                        <div class="progress-fill-week" style="width: ${progressPercent}%"></div>
                    </div>
                    <p style="margin-top: 15px; font-size: 14px;">
                        ${week === 1 ? '🎮 Pokémon, Titanes, Fútbol y más!' : '🌟 Nuevas aventuras te esperan!'}
                    </p>
                    ${completedDays === totalDays ? '<div style="margin-top: 15px;">🎉 ¡SEMANA COMPLETADA! 🎉</div>' : ''}
                `;
                
                weekGrid.appendChild(weekCard);
            }
        }

        function getCompletedDaysInWeek(week) {
            let completed = 0;
            const weekData = exerciseDatabase[`week${week}`];
            if (weekData) {
                Object.keys(weekData).forEach(day => {
                    const dayKey = `week${week}_${day}`;
                    if (appState.userData.completedExercises[dayKey]) {
                        completed++;
                    }
                });
            }
            return completed;
        }

        function showWeek(weekNumber) {
            document.getElementById('weekGrid').style.display = 'none';
            document.getElementById('dayView').style.display = 'block';
            
            const dayGrid = document.getElementById('dayGrid');
            dayGrid.innerHTML = '';
            
            const days = ['🌟 Lunes', '🚀 Martes', '⚡ Miércoles', '🎯 Jueves', '🏆 Viernes'];
            const dayColors = ['#ff6b6b', '#4ecdc4', '#fdcb6e', '#74b9ff', '#fd79a8'];
            
            document.getElementById('dayTitle').textContent = `🗓️ Semana ${weekNumber} - ¡Elige tu día de aventura!`;
            
            const weekData = exerciseDatabase[`week${weekNumber}`];
            if (!weekData) {
                dayGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72; font-size: 18px; font-weight: 600;">🚧 ¡Pronto habrá más aventuras aquí! 🚧</div>';
                return;
            }
            
            Object.keys(weekData).forEach((dayKey, index) => {
                const dayNumber = parseInt(dayKey.replace('day', ''));
                const fullDayKey = `week${weekNumber}_${dayKey}`;
                const isCompleted = appState.userData.completedExercises[fullDayKey];
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                dayCard.style.borderColor = dayColors[index % dayColors.length];
                
                if (isCompleted) {
                    dayCard.style.background = `linear-gradient(135deg, ${dayColors[index % dayColors.length]}, #2ecc71)`;
                    dayCard.style.color = 'white';
                }
                
                dayCard.onclick = () => startDay(weekNumber, dayNumber);
                
                const exercises = weekData[dayKey];
                const exerciseList = exercises.map(ex => `
                    <div class="exercise-item" style="background: ${isCompleted ? 'rgba(255,255,255,0.2)' : '#f8f9fa'};">
                        <span>${getExerciseIcon(ex.type)} ${getExerciseTitle(ex.type, ex.theme)}</span>
                        <span>${isCompleted ? '🎉' : '🎮'}</span>
                    </div>
                `).join('');
                
                const timeEstimate = Math.ceil(exercises.length * 4);
                
                dayCard.innerHTML = `
                    <h4 style="font-family: 'Fredoka One', cursive; font-size: 20px; margin-bottom: 10px;">${days[index] || `Día ${dayNumber}`}</h4>
                    <p style="margin-bottom: 15px; font-weight: 600;">🕐 ~${timeEstimate} minutos de diversión | ${exercises.length} retos geniales</p>
                    <div class="exercise-list">
                        ${exerciseList}
                    </div>
                    ${isCompleted ? '<div style="margin-top: 15px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">🎉 ¡DÍA SÚPER COMPLETADO! 🎉</div>' : '<div style="margin-top: 15px; font-weight: 700; color: #636e72;">🚀 ¡Empezar aventura!</div>'}
                `;
                
                dayGrid.appendChild(dayCard);
            });
        }

        function backToWeeks() {
            document.getElementById('weekGrid').style.display = 'grid';
            document.getElementById('dayView').style.display = 'none';
        }

        function getExerciseIcon(type) {
            const icons = {
                math: '🧮',
                reading: '📖',
                english: '🇬🇧',
                interactive: '🧩',
                science: '🔬',
                geography: '🌍',
                history: '🏛️',
                body: '🫀',
                technology: '💻',
                grammar: '✏️',
                values: '❤️',
                nature: '🌱',
                money: '💰'
            };
            return icons[type] || '📝';
        }

        function getExerciseTitle(type, theme) {
            const titles = {
                math: 'Mates Geniales',
                reading: 'Súper Lectura',
                english: 'English Fun',
                interactive: 'Juego Interactivo',
                science: 'Ciencia Mágica',
                geography: 'Explora el Mundo',
                history: 'Viaja en el Tiempo',
                body: 'Mi Cuerpo',
                technology: 'Tecnología Cool',
                grammar: 'Palabras Perfectas',
                values: 'Valores Geniales',
                nature: 'Naturaleza',
                money: 'Dinero Inteligente'
            };
            
            const themes = {
                pokemon: 'Pokémon',
                titans: 'Titanes',
                football: 'Fútbol',
                warframe: 'Warframe',
                mixed: 'Variado'
            };
            
            return `${titles[type]} - ${themes[theme] || 'Aventura'}`;
        }

        function startDay(week, day) {
            const weekKey = `week${week}`;
            const dayKey = `day${day}`;
            
            if (!exerciseDatabase[weekKey] || !exerciseDatabase[weekKey][dayKey]) {
                alert('🚧 ¡Ups! Este día aún no está disponible. ¡Pronto habrá más aventuras! 🚧');
                return;
            }
            
            appState.currentWeek = week;
            appState.currentDay = day;
            appState.currentExerciseSet = exerciseDatabase[weekKey][dayKey];
            appState.currentExerciseIndex = 0;
            appState.currentSessionStats = { correct: 0, total: 0 };
            
            showExercise();
        }

        function showExercise() {
            if (appState.currentExerciseIndex >= appState.currentExerciseSet.length) {
                completeDay();
                return;
            }
            
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            const exerciseContainer = document.getElementById('exerciseContent');
            
            exerciseContainer.innerHTML = `
                <div class="exercise-hint">
                    ${exercise.learningHint}
                </div>
                
                ${exercise.readingText ? `<div class="reading-text">${exercise.readingText}</div>` : ''}
                
                <div class="exercise-question">
                    ${exercise.question}
                </div>
                
                <div class="options-container" id="optionsContainer">
                    ${exercise.options.map((option, index) => `
                        <button class="option-btn" onclick="selectOption(${index})">
                            ${option}
                        </button>
                    `).join('')}
                </div>
                
                <div class="exercise-controls">
                    <button class="exercise-btn secondary" onclick="closeExercise()">❌ Cerrar</button>
                    <button class="exercise-btn primary" id="nextBtn" onclick="nextExercise()" disabled>➡️ Siguiente</button>
                </div>
                
                <div style="text-align: center; margin-top: 20px; font-weight: 600; color: #636e72;">
                    Ejercicio ${appState.currentExerciseIndex + 1} de ${appState.currentExerciseSet.length}
                </div>
            `;
            
            document.getElementById('exerciseOverlay').style.display = 'flex';
            appState.selectedOption = null;
        }

        function selectOption(selectedIndex) {
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            document.querySelectorAll('.option-btn')[selectedIndex].classList.add('selected');
            appState.selectedOption = selectedIndex;
            
            document.getElementById('nextBtn').disabled = false;
        }

        function nextExercise() {
            if (appState.selectedOption === null) return;
            
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            const isCorrect = appState.selectedOption === exercise.correct;
            
            appState.currentSessionStats.total++;
            if (isCorrect) {
                appState.currentSessionStats.correct++;
            }
            
            alert(isCorrect ? '🎉 ¡Correcto! ' + exercise.explanation : '❌ Incorrecto. ' + exercise.explanation);
            
            appState.userData.totalExercises++;
            if (isCorrect) {
                appState.userData.correctAnswers++;
                appState.userData.totalPoints += 10;
            }
            
            appState.userData.exercisesByType[exercise.type] = (appState.userData.exercisesByType[exercise.type] || 0) + 1;
            appState.userData.exercisesByTheme[exercise.theme] = (appState.userData.exercisesByTheme[exercise.theme] || 0) + 1;
            
            appState.currentExerciseIndex++;
            
            saveUserData();
            
            showExercise();
        }

        function closeExercise() {
            document.getElementById('exerciseOverlay').style.display = 'none';
        }

        function completeDay() {
            const dayKey = `week${appState.currentWeek}_day${appState.currentDay}`;
            appState.userData.completedExercises[dayKey] = true;
            
            appState.userData.streak++;
            
            if (appState.currentSessionStats.correct === appState.currentSessionStats.total) {
                if (!appState.userData.achievements.includes('perfect_day')) {
                    appState.userData.achievements.push('perfect_day');
                }
            }
            
            const newLevel = Math.floor(appState.userData.totalPoints / 50) + 1;
            if (newLevel > appState.userData.level) {
                appState.userData.level = newLevel;
                alert(`🎉 ¡Subiste al nivel ${newLevel}! ¡Increíble progreso! 🚀`);
            }
            
            saveUserData();
            
            const accuracy = Math.round((appState.currentSessionStats.correct / appState.currentSessionStats.total) * 100);
            
            closeExercise();
            alert(`🎉 ¡DÍA COMPLETADO! 🎉\n\n✅ Respuestas correctas: ${appState.currentSessionStats.correct}/${appState.currentSessionStats.total}\n🎯 Precisión: ${accuracy}%\n💰 Puntos ganados: ${appState.currentSessionStats.correct * 10}\n\n¡Sigue así, campeón!`);
            
            updateUserInterface();
            generateWeeks();
            backToWeeks();
        }

        function loadRanking() {
            if (Object.keys(appState.allUsersData).length === 0) {
                showNoRankingData();
                return;
            }
            
            const users = Object.entries(appState.allUsersData).map(([username, userData]) => ({
                username,
                ...userData,
                accuracy: userData.totalExercises > 0 ? Math.round((userData.correctAnswers / userData.totalExercises) * 100) : 0,
                achievementCount: userData.achievements ? userData.achievements.length : 0
            }));
            
            const sortedUsers = sortUsersByFilter(users, appState.currentRankingFilter);
            showPodium(sortedUsers.slice(0, 3));
            showRankingTable(sortedUsers);
        }

        function sortUsersByFilter(users, filter) {
            switch (filter) {
                case 'achievements':
                    return users.sort((a, b) => {
                        if (b.achievementCount !== a.achievementCount) {
                            return b.achievementCount - a.achievementCount;
                        }
                        return b.totalPoints - a.totalPoints;
                    });
                case 'points':
                    return users.sort((a, b) => b.totalPoints - a.totalPoints);
                case 'level':
                    return users.sort((a, b) => {
                        if (b.level !== a.level) {
                            return b.level - a.level;
                        }
                        return b.totalPoints - a.totalPoints;
                    });
                case 'exercises':
                    return users.sort((a, b) => b.totalExercises - a.totalExercises);
                case 'accuracy':
                    return users.sort((a, b) => {
                        if (b.accuracy !== a.accuracy) {
                            return b.accuracy - a.accuracy;
                        }
                        return b.totalExercises - a.totalExercises;
                    });
                case 'streak':
                    return users.sort((a, b) => {
                        if (b.streak !== a.streak) {
                            return b.streak - a.streak;
                        }
                        return b.totalPoints - a.totalPoints;
                    });
                default:
                    return users;
            }
        }

        function showPodium(topUsers) {
            const podiumContainer = document.getElementById('podiumContainer');
            podiumContainer.innerHTML = '';
            
            if (topUsers.length === 0) {
                return;
            }
            
            const podiumData = [
                { user: topUsers[1], place: 'second', crown: '🥈' },
                { user: topUsers[0], place: 'first', crown: '👑' },
                { user: topUsers[2], place: 'third', crown: '🥉' }
            ];
            
            podiumData.forEach((data) => {
                if (!data.user) return;
                
                const place = document.createElement('div');
                place.className = `podium-place ${data.place}`;
                
                const isCurrentUser = data.user.username === appState.currentUser;
                
                place.innerHTML = `
                    <div class="podium-crown">${data.crown}</div>
                    <div class="podium-avatar" style="${isCurrentUser ? 'border: 4px solid #fdcb6e;' : ''}">
                        ${data.user.username.charAt(0).toUpperCase()}
                    </div>
                    <div class="podium-name" style="${isCurrentUser ? 'text-shadow: 3px 3px 6px rgba(0,0,0,0.5);' : ''}">${data.user.username}</div>
                    <div class="podium-stat">
                        ${getFilterDisplayValue(data.user, appState.currentRankingFilter)}
                    </div>
                `;
                
                podiumContainer.appendChild(place);
            });
        }

        function showRankingTable(users) {
            const tableContainer = document.getElementById('rankingTableContainer');
            
            if (users.length === 0) {
                tableContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72; font-size: 18px; font-weight: 600;">🌟 ¡Sé el primero en aparecer aquí! 🌟</div>';
                return;
            }
            
            const table = document.createElement('div');
            table.className = 'ranking-table';
            
            const header = document.createElement('div');
            header.className = 'ranking-header';
            header.innerHTML = `
                <span style="font-family: 'Fredoka One', cursive;">Pos.</span>
                <span style="font-family: 'Fredoka One', cursive;">🎮 Entrenador</span>
                <span style="font-family: 'Fredoka One', cursive;">📈 Nivel</span>
                <span style="font-family: 'Fredoka One', cursive;">💰 Puntos</span>
                <span style="font-family: 'Fredoka One', cursive;">${getFilterHeaderName(appState.currentRankingFilter)}</span>
                <span style="font-family: 'Fredoka One', cursive;">🏆 Logros</span>
            `;
            table.appendChild(header);
            
            users.forEach((user, index) => {
                const row = document.createElement('div');
                row.className = `ranking-row ${user.username === appState.currentUser ? 'current-user' : ''}`;
                
                const position = index + 1;
                let positionClass = '';
                let positionIcon = position;
                
                if (position === 1) {
                    positionClass = 'first';
                    positionIcon = '🏆';
                } else if (position === 2) {
                    positionClass = 'second';
                    positionIcon = '🥈';
                } else if (position === 3) {
                    positionClass = 'third';
                    positionIcon = '🥉';
                }
                
                const achievementsPreview = user.achievements ? user.achievements.slice(0, 5).map(achievementId => {
                    const achievement = achievements.find(a => a.id === achievementId);
                    return achievement ? `<div class="achievement-mini" title="${achievement.name}">${achievement.icon}</div>` : '';
                }).join('') : '';
                
                row.innerHTML = `
                    <div class="position ${positionClass}">${positionIcon}</div>
                    <div class="user-name">
                        <div class="user-avatar">${user.username.charAt(0).toUpperCase()}</div>
                        <span style="${user.username === appState.currentUser ? 'font-weight: 800;' : 'font-weight: 700;'}">${user.username}</span>
                    </div>
                    <div class="stat-value">${user.level}</div>
                    <div class="stat-value">${user.totalPoints}</div>
                    <div class="stat-value">${getFilterDisplayValue(user, appState.currentRankingFilter)}</div>
                    <div class="achievements-preview">${achievementsPreview}</div>
                `;
                
                table.appendChild(row);
            });
            
            tableContainer.innerHTML = '';
            tableContainer.appendChild(table);
        }

        function getFilterHeaderName(filter) {
            const names = {
                achievements: '🎖️ Logros',
                points: '💰 Puntos',
                level: '📈 Nivel',
                exercises: '📚 Ejercicios',
                accuracy: '🎯 Precisión',
                streak: '🔥 Racha'
            };
            return names[filter] || 'Valor';
        }

        function getFilterDisplayValue(user, filter) {
            switch (filter) {
                case 'achievements':
                    return `${user.achievementCount}`;
                case 'points':
                    return `${user.totalPoints}`;
                case 'level':
                    return `${user.level}`;
                case 'exercises':
                    return `${user.totalExercises}`;
                case 'accuracy':
                    return `${user.accuracy}%`;
                case 'streak':
                    return `${user.streak}`;
                default:
                    return '0';
            }
        }

        function setRankingFilter(filter) {
            appState.currentRankingFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadRanking();
        }

        function showNoRankingData() {
            const podiumContainer = document.getElementById('podiumContainer');
            const tableContainer = document.getElementById('rankingTableContainer');
            
            podiumContainer.innerHTML = '';
            tableContainer.innerHTML = `
                <div style="text-align: center; padding: 50px; background: white; border-radius: 20px; border: 3px solid #74b9ff;">
                    <div style="font-size: 80px; margin-bottom: 20px;">🌟</div>
                    <h3 style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #2d3436; margin-bottom: 15px;">¡Sé el primer súper entrenador!</h3>
                    <p style="font-size: 16px; color: #636e72; font-weight: 600;">Completa algunos ejercicios geniales para aparecer en el ranking de campeones.</p>
                </div>
            `;
        }

        function loadStats() {
            const content = document.getElementById('statsContent');
            const userData = appState.userData;
            
            const accuracy = userData.totalExercises > 0 
                ? Math.round((userData.correctAnswers / userData.totalExercises) * 100)
                : 0;
            
            const allUsers = Object.entries(appState.allUsersData);
            const sortedByAchievements = allUsers.sort((a, b) => {
                const aAchievements = a[1].achievements ? a[1].achievements.length : 0;
                const bAchievements = b[1].achievements ? b[1].achievements.length : 0;
                if (bAchievements !== aAchievements) {
                    return bAchievements - aAchievements;
                }
                return (b[1].totalPoints || 0) - (a[1].totalPoints || 0);
            });
            
            const userRankPosition = sortedByAchievements.findIndex(([username]) => username === appState.currentUser) + 1;
            
            content.innerHTML = `
                <div class="stats-kids">
                    <div class="stat-card-big">
                        <div class="stat-icon-big">🎯</div>
                        <div class="stat-number-big">${userData.totalExercises}</div>
                        <div class="stat-label-big">Ejercicios Súper Completados</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">🏆</div>
                        <div class="stat-number-big">${userRankPosition > 0 ? `#${userRankPosition}` : '🌟'}</div>
                        <div class="stat-label-big">Mi Posición en el Ranking</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">🎖️</div>
                        <div class="stat-number-big">${userData.achievements.length}</div>
                        <div class="stat-label-big">Logros Súper Geniales</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">🔥</div>
                        <div class="stat-number-big">${userData.streak}</div>
                        <div class="stat-label-big">Días Seguidos Geniales</div>
                    </div>
                </div>
                
                <div style="margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 25px; border: 3px solid #74b9ff;">
                    <h3 style="font-family: 'Fredoka One', cursive; font-size: 28px; text-align: center; margin-bottom: 30px; color: #2d3436;">📊 ¡Mis Números Súper Geniales!</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #ff6b6b;">
                            <div style="font-size: 40px; margin-bottom: 10px;">🧮</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #ff6b6b;">${userData.exercisesByType.math || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Mates Geniales</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #4ecdc4;">
                            <div style="font-size: 40px; margin-bottom: 10px;">📖</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #4ecdc4;">${userData.exercisesByType.reading || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Súper Lectura</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #fdcb6e;">
                            <div style="font-size: 40px; margin-bottom: 10px;">🇬🇧</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #fdcb6e;">${userData.exercisesByType.english || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">English Fun</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #74b9ff;">
                            <div style="font-size: 40px; margin-bottom: 10px;">🔬</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #74b9ff;">${userData.exercisesByType.science || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Ciencia Mágica</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadAchievements() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const isUnlocked = appState.userData.achievements.includes(achievement.id);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : ''}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <h4 style="font-family: 'Fredoka One', cursive; margin-bottom: 10px;">${achievement.name}</h4>
                    <p style="font-weight: 600; font-size: 14px;">${achievement.description}</p>
                    <div style="margin-top: 15px; font-size: 14px; font-weight: 700;">
                        ${isUnlocked ? '🎉 ¡DESBLOQUEADO!' : '🔐 Bloqueado'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        async function testConnection() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                    alert('✅ ¡Conexión súper exitosa con JSONBin.io! 🎉');
                    await loadUserData();
                } else {
                    updateConnectionStatus('error');
                    alert('❌ Error de conexión: ' + response.status);
                }
            } catch (error) {
                updateConnectionStatus('error');
                alert('❌ Error de red: ' + error.message);
            }
        }

        function resetProgress() {
            if (confirm('¿Estás súper seguro de que quieres empezar de nuevo? ¡Perderás todos tus logros geniales! 😱')) {
                appState.userData = createNewUser();
                saveUserData();
                updateUserInterface();
                generateWeeks();
                alert('🎉 ¡Progreso reiniciado! ¡Nueva aventura comenzando! 🚀');
            }
        }

        function exportData() {
            const dataToExport = {
                user: appState.currentUser,
                data: appState.userData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `academia_pokemon_${appState.currentUser}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('📥 ¡Datos súper descargados! 🎉');
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎮 Academia Pokemon iniciada');
            
            updateConnectionStatus('offline');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
        });
    </script>
</body>
</html>
