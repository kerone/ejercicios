<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academia Pokemon - Aprendizaje Divertido</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            font-size: 16px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üéÆ</text></svg>') no-repeat center;
            background-size: 200px;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-card h1 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .login-card input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 18px;
            font-family: inherit;
        }

        .login-card button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }

        .login-card button:hover {
            transform: scale(1.05);
        }

        .main-app {
            display: none;
        }

        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
        }

        .stats {
            display: flex;
            gap: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            min-width: 80px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .nav-tab:hover, .nav-tab.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .content-area {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .week-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .week-card:hover {
            transform: translateY(-5px);
        }

        .day-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .day-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .exercise-list {
            margin-top: 15px;
        }

        .exercise-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 900px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .exercise-content {
            text-align: center;
        }

        .learning-hint {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 16px;
            text-align: left;
        }

        .learning-hint strong {
            color: #1976d2;
        }

        .question {
            font-size: 22px;
            margin-bottom: 20px;
            line-height: 1.6;
            text-align: left;
            background: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
        }

        .reading-text {
            background: #f3e5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 18px;
            line-height: 1.8;
            text-align: left;
            border: 2px solid #9c27b0;
        }

        .reading-text h4 {
            color: #7b1fa2;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .option {
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            font-size: 16px;
            text-align: center;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
            animation: correctPulse 0.6s ease-out;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            animation: incorrectShake 0.6s ease-out;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .feedback {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            display: none;
            font-size: 16px;
            line-height: 1.5;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .next-btn {
            background: #667eea;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            display: none;
            font-family: inherit;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
        }

        .reward-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1001;
            animation: popup 0.5s ease-out;
        }

        @keyframes popup {
            from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .achievement-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #ddd;
        }

        .achievement-card.unlocked {
            border-color: #ffd700;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
        }

        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
        }

        .connection-status.online {
            background: #d4edda;
            color: #155724;
        }

        .connection-status.offline {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .stats {
                width: 100%;
                justify-content: center;
            }

            .nav-tabs {
                justify-content: center;
            }

            .modal-content {
                padding: 20px;
                margin: 20px;
            }

            .question {
                font-size: 18px;
            }

            .options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Indicador de conexi√≥n -->
    <div id="connectionStatus" class="connection-status offline">üîÑ Conectando...</div>

    <!-- Pantalla de Login -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1>üéÆ Academia Pokemon</h1>
            <p style="margin-bottom: 20px; color: #666;">¬°Convi√©rtete en el mejor entrenador de conocimientos!</p>
            <input type="text" id="usernameInput" placeholder="Escribe tu nombre de entrenador" maxlength="20">
            <button onclick="login()">¬°Comenzar Aventura! üöÄ</button>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="user-info">
                    <div class="avatar">üèÜ</div>
                    <div>
                        <h2 id="userName">Entrenador</h2>
                        <p>Nivel <span id="userLevel">1</span></p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPoints">0</div>
                        <div>Puntos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="streak">0</div>
                        <div>Racha</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="accuracy">0%</div>
                        <div>Precisi√≥n</div>
                    </div>
                </div>
                <button onclick="logout()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Salir</button>
            </div>

            <!-- Navegaci√≥n -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('training')">üéØ Entrenamiento</button>
                <button class="nav-tab" onclick="showTab('achievements')">üèÜ Logros</button>
                <button class="nav-tab" onclick="showTab('stats')">üìä Estad√≠sticas</button>
                <button class="nav-tab" onclick="showTab('admin')">‚öôÔ∏è Administrar</button>
            </div>

            <!-- √Årea de contenido -->
            <div class="content-area">
                <!-- Pesta√±a de Entrenamiento -->
                <div id="trainingTab" class="tab-content">
                    <h2>üóìÔ∏è Plan de Entrenamiento Semanal</h2>
                    <div class="week-grid" id="weekGrid"></div>
                    <div id="dayView" style="display: none;">
                        <button onclick="backToWeeks()" style="margin-bottom: 20px; padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer;">‚Üê Volver a Semanas</button>
                        <h3 id="dayTitle"></h3>
                        <div class="day-grid" id="dayGrid"></div>
                    </div>
                </div>

                <!-- Pesta√±a de Logros -->
                <div id="achievementsTab" class="tab-content" style="display: none;">
                    <h2>üèÜ Tus Logros de Entrenador</h2>
                    <div class="achievement-grid" id="achievementGrid"></div>
                </div>

                <!-- Pesta√±a de Estad√≠sticas -->
                <div id="statsTab" class="tab-content" style="display: none;">
                    <h2>üìä Estad√≠sticas Detalladas</h2>
                    <div id="statsContent"></div>
                </div>

                <!-- Pesta√±a de Administraci√≥n -->
                <div id="adminTab" class="tab-content" style="display: none;">
                    <h2>‚öôÔ∏è Panel de Administraci√≥n</h2>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4>üìä Estado de Guardado</h4>
                        <p>Los datos se guardan autom√°ticamente en JSONBin.io</p>
                        <p><strong>Usuario actual:</strong> <span id="currentUserAdmin"></span></p>
                        <p><strong>√öltima sincronizaci√≥n:</strong> <span id="lastSync">-</span></p>
                    </div>
                    <button onclick="testConnection()" style="padding: 15px 30px; background: #17a2b8; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">üîÑ Probar Conexi√≥n</button>
                    <button onclick="resetProgress()" style="padding: 15px 30px; background: #dc3545; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">üîÑ Reiniciar Progreso</button>
                    <button onclick="exportData()" style="padding: 15px 30px; background: #28a745; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">üì• Exportar Datos</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ejercicio -->
    <div id="exerciseModal" class="exercise-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeExercise()">√ó</button>
            <div class="exercise-content">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <h3 id="exerciseTitle"></h3>
                <div id="learningHint" class="learning-hint" style="display: none;"></div>
                <div id="readingText" class="reading-text" style="display: none;"></div>
                <div id="exerciseQuestion" class="question"></div>
                <div id="exerciseOptions" class="options"></div>
                <div id="exerciseFeedback" class="feedback"></div>
                <button id="nextExerciseBtn" class="next-btn" onclick="nextExercise()">Siguiente</button>
            </div>
        </div>
    </div>

    <!-- Popup de Recompensa -->
    <div id="rewardPopup" class="reward-popup">
        <h2 id="rewardTitle"></h2>
        <div id="rewardIcon" style="font-size: 60px; margin: 20px 0;"></div>
        <p id="rewardMessage"></p>
        <button onclick="closeReward()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">¬°Genial!</button>
    </div>

    <script>
        // Configuraci√≥n de JSONBin
        const JSONBIN_CONFIG = {
            binId: '68ee144343b1c97be96704f9',
            masterKey: '$2a$10$byEkgCiPtr6uA9j.sw5Uiuld00jGPRMT1Rn9TlhHYbPe3CFfaEu6G',
            apiUrl: 'https://api.jsonbin.io/v3'
        };

        // Estado global de la aplicaci√≥n
        let appState = {
            currentUser: null,
            userData: {},
            currentExerciseSet: [],
            currentExerciseIndex: 0,
            currentSessionStats: { correct: 0, total: 0 },
            connectionStatus: 'offline'
        };

        // Base de datos de ejercicios con contenido m√°s completo
        const exerciseDatabase = {
            week1: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>üí° Pista:</strong> Para sumar n√∫meros, junta las cantidades. Por ejemplo: si tienes 5 Pok√©balls y te dan 3 m√°s, cuentas 5 + 3 = 8 Pok√©balls en total.',
                        question: 'üî• Charizard ten√≠a 45 puntos de ataque. Despu√©s de entrenar con Ash durante una semana, gan√≥ 23 puntos m√°s. ¬øCu√°ntos puntos de ataque tiene Charizard ahora?',
                        options: ['68 puntos', '72 puntos', '65 puntos', '70 puntos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 45 + 23 = 68 puntos. Charizard se ha vuelto m√°s fuerte entrenando. ¬°La suma nos ayuda a saber cu√°nto ha crecido!'
                    },
                    {
                        type: 'reading',
                        theme: 'pokemon',
                        learningHint: '<strong>üìö Pista para leer mejor:</strong> Lee el texto despacio y busca las palabras clave. Si no entiendes algo, lee esa parte otra vez.',
                        readingText: '<h4>üîµ La Historia de Pikachu</h4>Pikachu es un Pok√©mon el√©ctrico muy especial que vive en los bosques verdes cerca del pueblo de Ash. Le encanta comer bayas dulces rojas que encuentra en los √°rboles altos. Su ataque favorito es el "Rayo" porque puede generar electricidad con sus mejillas amarillas. Pikachu es muy leal y siempre protege a sus amigos.',
                        question: 'Seg√∫n el texto que acabas de leer, ¬ød√≥nde vive Pikachu?',
                        options: ['En una ciudad grande', 'En los bosques verdes', 'En el oc√©ano azul', 'En las monta√±as nevadas'],
                        correct: 1,
                        explanation: '¬°Excelente! El texto dice claramente que "Pikachu vive en los bosques verdes cerca del pueblo de Ash". ¬°Has le√≠do con mucha atenci√≥n!'
                    },
                    {
                        type: 'english',
                        theme: 'pokemon',
                        learningHint: '<strong>üá¨üáß Pista de ingl√©s:</strong> "Fire" significa fuego. Piensa en Charizard que lanza fuego, ¬°eso te ayudar√° a recordarlo!',
                        question: 'üî• Charizard es un Pok√©mon de fuego. ¬øC√≥mo se dice "fuego" en ingl√©s?',
                        options: ['Water (agua)', 'Fire (fuego)', 'Earth (tierra)', 'Air (aire)'],
                        correct: 1,
                        explanation: '¬°Genial! "Fire" significa fuego en ingl√©s. Recuerda: Charizard = Fire Type Pok√©mon.'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚úñÔ∏è Pista de multiplicaci√≥n:</strong> Multiplicar es sumar el mismo n√∫mero varias veces. 3 √ó 4 es lo mismo que 3 + 3 + 3 + 3 = 12.',
                        question: 'üéØ Ash captura 3 Pok√©mon cada d√≠a durante 4 d√≠as seguidos. ¬øCu√°ntos Pok√©mon captur√≥ en total?',
                        options: ['12 Pok√©mon', '7 Pok√©mon', '10 Pok√©mon', '15 Pok√©mon'],
                        correct: 0,
                        explanation: '¬°Perfecto! 3 √ó 4 = 12 Pok√©mon. Es como sumar: 3 + 3 + 3 + 3 = 12. ¬°Ash tiene un gran equipo!'
                    }
                ],
                day2: [
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>‚ûï Recordemos sumar:</strong> Cuando tenemos varios n√∫meros para sumar, podemos hacerlo paso a paso: primero sumamos dos, luego sumamos el tercero.',
                        question: '‚öîÔ∏è Eren observ√≥ titanes durante tres d√≠as. El primer d√≠a vio 12 titanes, el segundo d√≠a vio 8 titanes, y el tercer d√≠a vio 15 titanes. ¬øCu√°ntos titanes vio en total durante los tres d√≠as?',
                        options: ['35 titanes', '33 titanes', '37 titanes', '32 titanes'],
                        correct: 0,
                        explanation: '¬°Correcto! Paso a paso: 12 + 8 = 20, luego 20 + 15 = 35 titanes en total. ¬°Eren es muy observador!'
                    },
                    {
                        type: 'reading',
                        theme: 'titans',
                        learningHint: '<strong>üß± Pista:</strong> Cuando leas sobre las murallas, imag√≠natelas como c√≠rculos uno dentro del otro, como las capas de una cebolla.',
                        readingText: '<h4>üè∞ Las Murallas Protectoras</h4>Las tres murallas protegen a la humanidad de los gigantes peligrosos. La muralla m√°s externa se llama Mar√≠a y es la primera l√≠nea de defensa. Dentro de Mar√≠a est√° la muralla Rose, que es la segunda protecci√≥n. Y en el centro est√° la muralla Sina, la m√°s peque√±a pero la m√°s segura. Cada muralla es muy alta y muy gruesa.',
                        question: 'Seg√∫n el texto, ¬øcu√°l es la muralla que est√° m√°s afuera de todas?',
                        options: ['Muralla Rose', 'Muralla Sina', 'Muralla Mar√≠a', 'Todas est√°n igual'],
                        correct: 2,
                        explanation: '¬°Muy bien! El texto dice que "la muralla m√°s externa se llama Mar√≠a". ¬°Has entendido perfectamente la organizaci√≥n de las murallas!'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>üó£Ô∏è Truco:</strong> "Giant" suena parecido a "gigante" en espa√±ol. ¬°Las palabras parecidas nos ayudan a recordar!',
                        question: 'üóø Los titanes son gigantes muy grandes. ¬øC√≥mo se dice "gigante" en ingl√©s?',
                        options: ['Giant', 'Small', 'Fast', 'Strong'],
                        correct: 0,
                        explanation: '¬°Excelente! "Giant" significa gigante. Nota c√≥mo suena parecido a "gigante" en espa√±ol.'
                    },
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n pr√°ctica:</strong> 5 √ó 3 significa 5 grupos de 3 soldados cada uno. Cuenta: 3 + 3 + 3 + 3 + 3.',
                        question: 'üõ°Ô∏è Hay 5 escuadrones de soldados. Cada escuadr√≥n tiene 3 soldados. ¬øCu√°ntos soldados hay en total?',
                        options: ['15 soldados', '8 soldados', '12 soldados', '18 soldados'],
                        correct: 0,
                        explanation: '¬°Perfecto! 5 √ó 3 = 15 soldados. Pi√©nsalo como 5 grupos de 3: 3+3+3+3+3 = 15.'
                    }
                ],
                day3: [
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>‚ûï‚ûñ Suma y resta juntas:</strong> Primero sumamos todos los goles del Real Madrid, luego restamos para comparar.',
                        question: '‚öΩ En el partido de ayer, el Real Madrid meti√≥ 3 goles en el primer tiempo y 2 golesen el segundo tiempo. El Barcelona meti√≥ 4 goles en total. ¬øCu√°ntos goles m√°s meti√≥ el Real Madrid que el Barcelona?',
                        options: ['1 gol m√°s', '2 goles m√°s', '0 goles (empataron)', '3 goles m√°s'],
                        correct: 0,
                        explanation: '¬°Muy bien! Real Madrid: 3 + 2 = 5 goles. Barcelona: 4 goles. Diferencia: 5 - 4 = 1 gol m√°s para el Real Madrid.'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>üèÉ‚Äç‚ôÇÔ∏è Busca la informaci√≥n:</strong> Cuando te pregunten "¬øde qu√© pa√≠s es alguien?", busca en el texto palabras como "argentino", "espa√±ol", etc.',
                        readingText: '<h4>‚≠ê Lionel Messi, El Mejor</h4>Lionel Messi es un futbolista argentino considerado uno de los mejores del mundo. Naci√≥ en Argentina, un pa√≠s de Sudam√©rica, y comenz√≥ a jugar f√∫tbol desde muy peque√±o. Messi es famoso por ser un delantero muy h√°bil con la pelota y por haber ganado muchos premios importantes como el Bal√≥n de Oro. Su t√©cnica con el bal√≥n es incre√≠ble y puede driblar a muchos jugadores.',
                        question: 'üåé Seg√∫n el texto, ¬øde qu√© pa√≠s es Lionel Messi?',
                        options: ['Espa√±a', 'Brasil', 'Argentina', 'Francia'],
                        correct: 2,
                        explanation: '¬°Perfecto! El texto dice claramente que "Messi es un futbolista argentino" y que "naci√≥ en Argentina". ¬°Has le√≠do con mucha atenci√≥n!'
                    },
                    {
                        type: 'english',
                        theme: 'football',
                        learningHint: '<strong>‚öΩ Conexi√≥n:</strong> "Ball" se parece a "bal√≥n". ¬°Las palabras similares nos ayudan a aprender ingl√©s m√°s f√°cil!',
                        question: '‚öΩ Los jugadores de f√∫tbol patean la pelota. ¬øC√≥mo se dice "pelota" en ingl√©s?',
                        options: ['Ball', 'Goal', 'Field', 'Player'],
                        correct: 0,
                        explanation: '¬°Genial! "Ball" significa pelota o bal√≥n. ¬øNotaste que "ball" suena parecido a "bal√≥n"?'
                    },
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n en equipos:</strong> 11 jugadores √ó 2 equipos. Es como contar: 11 + 11.',
                        question: 'üë• En un partido de f√∫tbol juegan 2 equipos. Cada equipo tiene 11 jugadores en el campo. ¬øCu√°ntos jugadores est√°n jugando en total?',
                        options: ['22 jugadores', '20 jugadores', '24 jugadores', '18 jugadores'],
                        correct: 0,
                        explanation: '¬°Excelente! 11 √ó 2 = 22 jugadores. O tambi√©n puedes pensarlo como 11 + 11 = 22.'
                    }
                ],
                day4: [
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>‚ûñ Restar paso a paso:</strong> Cuando restas varias veces, hazlo una operaci√≥n a la vez: 100 - 25 = 75, luego 75 - 30.',
                        question: 'üî´ Un Tenno guerrero espacial tiene 100 puntos de energ√≠a al comenzar su misi√≥n. Usa 25 puntos para su primera habilidad especial, luego usa 30 puntos para su segunda habilidad. ¬øCu√°nta energ√≠a le queda?',
                        options: ['45 puntos', '50 puntos', '40 puntos', '55 puntos'],
                        correct: 0,
                        explanation: '¬°Perfecto! Paso a paso: 100 - 25 = 75, luego 75 - 30 = 45 puntos. ¬°El Tenno debe administrar bien su energ√≠a!'
                    },
                    {
                        type: 'reading',
                        theme: 'warframe',
                        learningHint: '<strong>üöÄ Palabras clave:</strong> Cuando busques una respuesta espec√≠fica, busca en el texto la palabra exacta de la pregunta.',
                        readingText: '<h4>ü§ñ Los Guerreros Tenno</h4>Los Tenno son guerreros espaciales muy avanzados que protegen el sistema solar. Usan armaduras especiales llamadas Warframes que les dan poderes incre√≠bles. Estos Warframes pueden ser de diferentes tipos: algunos son r√°pidos, otros son fuertes, y algunos pueden usar magia. Los Tenno viajan por diferentes planetas luchando contra enemigos peligrosos.',
                        question: 'üõ°Ô∏è Seg√∫n el texto, ¬øc√≥mo se llaman las armaduras especiales que usan los Tenno?',
                        options: ['Robots espaciales', 'Warframes', 'Naves de combate', 'Cascos m√°gicos'],
                        correct: 1,
                        explanation: '¬°Excelente! El texto dice claramente "armaduras especiales llamadas Warframes". ¬°Has encontrado la informaci√≥n exacta!'
                    },
                    {
                        type: 'english',
                        theme: 'warframe',
                        learningHint: '<strong>üåå Imagen mental:</strong> Piensa en las estrellas y planetas cuando escuches "space". ¬°Las im√°genes nos ayudan a recordar!',
                        question: 'üåå Los Tenno luchan en el espacio exterior. ¬øC√≥mo se dice "espacio" en ingl√©s?',
                        options: ['Space', 'Time', 'World', 'Sky'],
                        correct: 0,
                        explanation: '¬°Perfecto! "Space" significa espacio. Piensa en "space" como el lugar donde est√°n las estrellas y planetas.'
                    },
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>‚úñÔ∏è Grupos iguales:</strong> 4 planetas √ó 6 misiones cada uno. Es como tener 4 grupos de 6 misiones.',
                        question: 'ü™ê Un Tenno debe completar misiones en 4 planetas diferentes. En cada planeta hay 6 misiones. ¬øCu√°ntas misiones debe completar en total?',
                        options: ['24 misiones', '10 misiones', '20 misiones', '26 misiones'],
                        correct: 0,
                        explanation: '¬°Genial! 4 √ó 6 = 24 misiones. Pi√©nsalo como 4 grupos de 6: 6+6+6+6 = 24.'
                    }
                ],
                day5: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n √∫til:</strong> 6 Pok√©mon √ó 4 movimientos cada uno. Cada Pok√©mon aprende la misma cantidad de movimientos.',
                        question: 'üéØ Ash tiene un equipo completo de 6 Pok√©mon. Cada Pok√©mon puede aprender exactamente 4 movimientos diferentes. ¬øCu√°ntos movimientos conoce todo el equipo de Ash en total?',
                        options: ['24 movimientos', '20 movimientos', '26 movimientos', '22 movimientos'],
                        correct: 0,
                        explanation: '¬°Genial! 6 √ó 4 = 24 movimientos en total. ¬°El equipo de Ash conoce muchos ataques diferentes!'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>ü•Ö Detalles importantes:</strong> Lee despacio la parte sobre el portero, porque es diferente a los otros jugadores.',
                        readingText: '<h4>‚öΩ Las Reglas del F√∫tbol</h4>En un partido de f√∫tbol, cada equipo tiene exactamente 11 jugadores en el campo al mismo tiempo. Hay 10 jugadores de campo que pueden correr por todo el terreno, pero solo pueden tocar la pelota con los pies y la cabeza. Sin embargo, hay un jugador muy especial: el portero. El portero es el √∫nico jugador que puede usar las manos, pero solo cuando est√° dentro de su √°rea especial.',
                        question: 'üë• Seg√∫n el texto, ¬øcu√°ntos jugadores tiene cada equipo en el campo durante un partido?',
                        options: ['10 jugadores', '12 jugadores', '11 jugadores', '9 jugadores'],
                        correct: 2,
                        explanation: '¬°Correcto! El texto dice "cada equipo tiene exactamente 11 jugadores en el campo". ¬°Has le√≠do con mucha atenci√≥n!'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>üß± Piensa en construcci√≥n:</strong> "Wall" como las murallas que protegen de los titanes. ¬°Las historias nos ayudan a recordar!',
                        question: 'üè∞ Las murallas protegen a la gente de los titanes. ¬øC√≥mo se dice "muro" o "muralla" en ingl√©s?',
                        options: ['Wall', 'Door', 'Window', 'Floor'],
                        correct: 0,
                        explanation: '¬°Excelente! "Wall" significa muro o muralla. Como las murallas que protegen de los titanes.'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚ûó Divisi√≥n sencilla:</strong> Dividir es repartir en partes iguales. 20 √∑ 4 = 5 significa que cada grupo tiene 5.',
                        question: 'üî¥ Ash tiene 20 Pok√©balls y quiere repartirlas igualmente en 4 mochilas. ¬øCu√°ntas Pok√©balls pondr√° en cada mochila?',
                        options: ['5 Pok√©balls', '6 Pok√©balls', '4 Pok√©balls', '8 Pok√©balls'],
                        correct: 0,
                        explanation: '¬°Perfecto! 20 √∑ 4 = 5 Pok√©balls en cada mochila. ¬°Todas las mochilas tendr√°n la misma cantidad!'
                    }
                ]
            },
            week2: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n de dos cifras:</strong> 15 √ó 3 = (10 √ó 3) + (5 √ó 3) = 30 + 15 = 45.',
                        question: 'üî• Charizard entrena 15 minutos cada d√≠a durante 3 d√≠as. ¬øCu√°ntos minutos entren√≥ en total?',
                        options: ['45 minutos', '50 minutos', '40 minutos', '48 minutos'],
                        correct: 0,
                        explanation: '¬°Correcto! 15 √ó 3 = 45 minutos. Charizard entren√≥ mucho para ser m√°s fuerte.'
                    },
                    {
                        type: 'reading',
                        theme: 'titans',
                        learningHint: '<strong>üìä N√∫meros en el texto:</strong> Cuando veas n√∫meros, subr√°yalos mentalmente para no olvidarlos.',
                        readingText: '<h4>‚öîÔ∏è La Exploraci√≥n Peligrosa</h4>El escuadr√≥n de reconocimiento sali√≥ muy temprano para explorar m√°s all√° de la muralla Mar√≠a. El grupo estaba formado por 25 soldados valientes montados a caballo. Durante su misi√≥n de 6 horas, encontraron 3 titanes peque√±os y 1 tit√°n gigante de 15 metros de altura. Afortunadamente, todos los soldados regresaron sanos y salvos a casa.',
                        question: 'üë• ¬øCu√°ntos soldados formaban el escuadr√≥n de reconocimiento?',
                        options: ['20 soldados', '25 soldados', '30 soldados', '15 soldados'],
                        correct: 1,
                        explanation: '¬°Excelente! El texto dice claramente "25 soldados valientes". ¬°Has prestado atenci√≥n a los n√∫meros!'
                    },
                    {
                        type: 'english',
                        theme: 'football',
                        learningHint: '<strong>üèÉ‚Äç‚ôÇÔ∏è Movimiento:</strong> "Run" es cuando corres r√°pido, como los jugadores en el campo.',
                        question: 'üèÉ‚Äç‚ôÇÔ∏è Los futbolistas corren por el campo. ¬øC√≥mo se dice "correr" en ingl√©s?',
                        options: ['Walk', 'Run', 'Jump', 'Stop'],
                        correct: 1,
                        explanation: '¬°Genial! "Run" significa correr. Los futbolistas "run" por el campo durante todo el partido.'
                    },
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>‚úñÔ∏è Doble multiplicaci√≥n:</strong> Primero calcula 8 √ó 3, luego multiplica por 2.',
                        question: 'üî´ Un Tenno completa 8 misiones cada d√≠a durante 3 d√≠as, y lo hace 2 veces por semana. ¬øCu√°ntas misiones completa en total?',
                        options: ['48 misiones', '24 misiones', '32 misiones', '40 misiones'],
                        correct: 0,
                        explanation: '¬°Perfecto! 8 √ó 3 = 24 misiones en 3 d√≠as, luego 24 √ó 2 = 48 misiones en total.'
                    }
                ]
            }
        };

        // Logros disponibles
        const achievements = [
            { id: 'first_exercise', name: 'Primer Paso', description: 'Completa tu primer ejercicio', icon: 'üéØ', requirement: 1 },
            { id: 'math_master', name: 'Maestro Matem√°tico', description: 'Completa 15 ejercicios de matem√°ticas', icon: 'üßÆ', requirement: 15 },
            { id: 'reading_hero', name: 'H√©roe de la Lectura', description: 'Completa 15 ejercicios de comprensi√≥n lectora', icon: 'üìö', requirement: 15 },
            { id: 'english_expert', name: 'Experto en Ingl√©s', description: 'Completa 15 ejercicios de ingl√©s', icon: 'üá¨üáß', requirement: 15 },
            { id: 'perfect_day', name: 'D√≠a Perfecto', description: 'Completa todos los ejercicios de un d√≠a sin errores', icon: '‚≠ê', requirement: 1 },
            { id: 'streak_week', name: 'Racha Semanal', description: 'Mant√©n una racha de 7 d√≠as', icon: 'üî•', requirement: 7 },
            { id: 'multiplication_master', name: 'Maestro de la Multiplicaci√≥n', description: 'Completa 10 ejercicios de multiplicaci√≥n correctos', icon: '‚úñÔ∏è', requirement: 10 },
            { id: 'reading_champion', name: 'Campe√≥n de Lectura', description: 'Lee 20 textos completos', icon: 'üëë', requirement: 20 }
        ];

        // Funciones de autenticaci√≥n
        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('¬°Por favor escribe tu nombre!');
                return;
            }
            
            appState.currentUser = username;
            await loadUserData();
            showMainApp();
        }

        function logout() {
            if (confirm('¬øEst√°s seguro de que quieres salir?')) {
                appState.currentUser = null;
                appState.userData = {};
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        }

        // Gesti√≥n de datos con JSONBin CORREGIDA
        async function loadUserData() {
            updateConnectionStatus('connecting');
            try {
                console.log('Cargando datos del usuario:', appState.currentUser);
                
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Respuesta del servidor:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Datos recibidos:', data);
                    
                    const users = data.record?.users || {};
                    appState.userData = users[appState.currentUser] || createNewUser();
                    
                    console.log('Datos del usuario cargados:', appState.userData);
                    updateConnectionStatus('online');
                } else {
                    console.log('Error en respuesta, creando usuario nuevo');
                    appState.userData = createNewUser();
                    updateConnectionStatus('offline');
                }
            } catch (error) {
                console.error('Error cargando datos:', error);
                appState.userData = createNewUser();
                updateConnectionStatus('offline');
            }
            
            updateLastSyncTime();
        }

        async function saveUserData() {
            try {
                console.log('Guardando datos del usuario:', appState.currentUser);
                updateConnectionStatus('saving');
                
                // Primero obtenemos los datos actuales para no sobrescribir otros usuarios
                let allData = { users: {} };
                
                try {
                    const getCurrentResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': JSONBIN_CONFIG.masterKey,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (getCurrentResponse.ok) {
                        const currentData = await getCurrentResponse.json();
                        allData = currentData.record || { users: {} };
                    }
                } catch (error) {
                    console.log('No se pudieron obtener datos existentes, creando estructura nueva');
                }
                
                // Actualizamos solo los datos del usuario actual
                if (!allData.users) {
                    allData.users = {};
                }
                allData.users[appState.currentUser] = {
                    ...appState.userData,
                    lastSaved: new Date().toISOString()
                };
                
                console.log('Datos a guardar:', allData);
                
                // Guardamos los datos actualizados
                const saveResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    },
                    body: JSON.stringify(allData)
                });
                
                if (saveResponse.ok) {
                    console.log('‚úÖ Datos guardados exitosamente en JSONBin');
                    updateConnectionStatus('online');
                    updateLastSyncTime();
                } else {
                    console.error('‚ùå Error al guardar:', saveResponse.status);
                    updateConnectionStatus('error');
                }
                
            } catch (error) {
                console.error('‚ùå Error guardando datos:', error);
                updateConnectionStatus('error');
            }
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            appState.connectionStatus = status;
            
            switch (status) {
                case 'online':
                    statusElement.textContent = '‚úÖ Conectado';
                    statusElement.className = 'connection-status online';
                    break;
                case 'offline':
                    statusElement.textContent = '‚ùå Sin conexi√≥n';
                    statusElement.className = 'connection-status offline';
                    break;
                case 'connecting':
                    statusElement.textContent = 'üîÑ Conectando...';
                    statusElement.className = 'connection-status offline';
                    break;
                case 'saving':
                    statusElement.textContent = 'üíæ Guardando...';
                    statusElement.className = 'connection-status online';
                    break;
                case 'error':
                    statusElement.textContent = '‚ö†Ô∏è Error de conexi√≥n';
                    statusElement.className = 'connection-status offline';
                    break;
            }
        }

        function updateLastSyncTime() {
            const now = new Date().toLocaleString('es-ES');
            const adminElement = document.getElementById('lastSync');
            if (adminElement) {
                adminElement.textContent = now;
            }
        }

        async function testConnection() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                    alert('‚úÖ Conexi√≥n exitosa con JSONBin.io');
                } else {
                    updateConnectionStatus('error');
                    alert('‚ùå Error de conexi√≥n: ' + response.status);
                }
            } catch (error) {
                updateConnectionStatus('error');
                alert('‚ùå Error de red: ' + error.message);
            }
        }

        function createNewUser() {
            return {
                level: 1,
                totalPoints: 0,
                streak: 0,
                totalExercises: 0,
                correctAnswers: 0,
                exercisesByType: { math: 0, reading: 0, english: 0 },
                exercisesByTheme: { pokemon: 0, titans: 0, football: 0, warframe: 0 },
                multiplicationExercises: 0,
                textsRead: 0,
                completedExercises: {},
                achievements: [],
                created: new Date().toISOString(),
                lastActivity: new Date().toISOString()
            };
        }

        // Interfaz principal
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUserInterface();
            generateWeeks();
            
            // Actualizar panel de administraci√≥n
            const adminUser = document.getElementById('currentUserAdmin');
            if (adminUser) {
                adminUser.textContent = appState.currentUser;
            }
        }

        function updateUserInterface() {
            document.getElementById('userName').textContent = appState.currentUser;
            document.getElementById('userLevel').textContent = appState.userData.level;
            document.getElementById('totalPoints').textContent = appState.userData.totalPoints;
            document.getElementById('streak').textContent = appState.userData.streak;
            
            const accuracy = appState.userData.totalExercises > 0 
                ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100)
                : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // Gesti√≥n de pesta√±as
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'achievements') {
                loadAchievements();
            } else if (tabName === 'stats') {
                loadStats();
            }
        }

        // Generaci√≥n de semanas
        function generateWeeks() {
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';
            
            const availableWeeks = Object.keys(exerciseDatabase).length;
            
            for (let week = 1; week <= availableWeeks; week++) {
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card';
                weekCard.onclick = () => showWeek(week);
                
                const completedDays = getCompletedDaysInWeek(week);
                const totalDays = 5;
                
                weekCard.innerHTML = `
                    <h3>üóìÔ∏è Semana ${week}</h3>
                    <p>Progreso: ${completedDays}/${totalDays} d√≠as completados</p>
                    <div style="margin-top: 15px;">
                        <div style="background: rgba(255,255,255,0.3); height: 8px; border-radius: 4px;">
                            <div style="background: white; height: 100%; width: ${(completedDays/totalDays)*100}%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; font-size: 14px;">üéØ Temas: Pok√©mon, Titanes, F√∫tbol, Warframe</p>
                `;
                
                weekGrid.appendChild(weekCard);
            }
        }

        function getCompletedDaysInWeek(week) {
            let completed = 0;
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${week}_day${day}`;
                if (appState.userData.completedExercises[dayKey]) {
                    completed++;
                }
            }
            return completed;
        }

        function showWeek(weekNumber) {
            document.getElementById('weekGrid').style.display = 'none';
            document.getElementById('dayView').style.display = 'block';
            
            const dayGrid = document.getElementById('dayGrid');
            dayGrid.innerHTML = '';
            
            const days = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'];
            
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${weekNumber}_day${day}`;
                const isCompleted = appState.userData.completedExercises[dayKey];
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                if (isCompleted) {
                    dayCard.style.background = 'linear-gradient(135deg, #d4edda, #c3e6cb)';
                    dayCard.style.borderLeft = '5px solid #28a745';
                }
                
                dayCard.onclick = () => startDay(weekNumber, day);
                
                const exercises = getDayExercises(weekNumber, day);
                const exerciseList = exercises.map(ex => `
                    <div class="exercise-item">
                        <span>${getExerciseIcon(ex.type)} ${getExerciseTitle(ex.type, ex.theme)}</span>
                        <span>${isCompleted ? '‚úÖ' : '‚è≥'}</span>
                    </div>
                `).join('');
                
                dayCard.innerHTML = `
                    <h4>${days[day-1]} - D√≠a ${day}</h4>
                    <p style="color: #666; margin-bottom: 15px;">üïê ~30 minutos de entrenamiento</p>
                    <div class="exercise-list">
                        ${exerciseList}
                    </div>
                    ${isCompleted ? '<div style="margin-top: 15px; color: #28a745; font-weight: bold;">üéâ ¬°D√≠a completado!</div>' : ''}
                `;
                
                dayGrid.appendChild(dayCard);
            }
        }

        function backToWeeks() {
            document.getElementById('weekGrid').style.display = 'grid';
            document.getElementById('dayView').style.display = 'none';
        }

        function getDayExercises(week, day) {
            const weekKey = `week${week}`;
            const dayKey = `day${day}`;
            
            if (exerciseDatabase[weekKey] && exerciseDatabase[weekKey][dayKey]) {
                return exerciseDatabase[weekKey][dayKey];
            }
            
            return generateDayExercises(week, day);
        }

        function generateDayExercises(week, day) {
            // Si no existen ejercicios para esa semana/d√≠a, usar ejercicios base
            const baseExercises = exerciseDatabase.week1.day1;
            return baseExercises;
        }

        function getExerciseIcon(type) {
            const icons = {
                math: 'üßÆ',
                reading: 'üìñ',
                english: 'üá¨üáß'
            };
            return icons[type] || 'üìù';
        }

        function getExerciseTitle(type, theme) {
            const titles = {
                math: 'Matem√°ticas',
                reading: 'Comprensi√≥n Lectora',
                english: 'Ingl√©s'
            };
            
            const themes = {
                pokemon: 'Pok√©mon',
                titans: 'Titanes',
                football: 'F√∫tbol',
                warframe: 'Warframe'
            };
            
            return `${titles[type]} - ${themes[theme]}`;
        }

        // Sistema de ejercicios
        function startDay(week, day) {
            const exercises = getDayExercises(week, day);
            appState.currentExerciseSet = exercises;
            appState.currentExerciseIndex = 0;
            appState.currentSessionStats = { correct: 0, total: 0, week, day };
            
            showExercise();
        }

        function showExercise() {
            const modal = document.getElementById('exerciseModal');
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            
            document.getElementById('exerciseTitle').textContent = getExerciseTitle(exercise.type, exercise.theme);
            
            // Mostrar pista de aprendizaje
            const hintElement = document.getElementById('learningHint');if (exercise.learningHint) {
                hintElement.innerHTML = exercise.learningHint;
                hintElement.style.display = 'block';
            } else {
                hintElement.style.display = 'none';
            }
            
            // Mostrar texto de lectura si existe
            const readingElement = document.getElementById('readingText');
            if (exercise.readingText) {
                readingElement.innerHTML = exercise.readingText;
                readingElement.style.display = 'block';
                appState.userData.textsRead++;
            } else {
                readingElement.style.display = 'none';
            }
            
            document.getElementById('exerciseQuestion').innerHTML = exercise.question;
            
            const optionsContainer = document.getElementById('exerciseOptions');
            optionsContainer.innerHTML = '';
            
            exercise.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            document.getElementById('exerciseFeedback').style.display = 'none';
            document.getElementById('nextExerciseBtn').style.display = 'none';
            
            // Actualizar barra de progreso
            const progress = ((appState.currentExerciseIndex + 1) / appState.currentExerciseSet.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            modal.style.display = 'flex';
        }

        function selectOption(selectedIndex) {
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            const options = document.querySelectorAll('.option');
            const feedback = document.getElementById('exerciseFeedback');
            
            options.forEach(option => option.onclick = null);
            
            appState.currentSessionStats.total++;
            
            if (selectedIndex === exercise.correct) {
                options[selectedIndex].classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = 'üéâ ' + exercise.explanation;
                appState.currentSessionStats.correct++;
                
                appState.userData.correctAnswers++;
                appState.userData.totalPoints += 10;
                
                // Puntos extra por multiplicaci√≥n
                if (exercise.question.includes('√ó') || exercise.question.includes('multiplicar')) {
                    appState.userData.multiplicationExercises++;
                    appState.userData.totalPoints += 5;
                }
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[exercise.correct].classList.add('correct');
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '‚ùå ' + exercise.explanation;
            }
            
            appState.userData.totalExercises++;
            appState.userData.exercisesByType[exercise.type]++;
            appState.userData.exercisesByTheme[exercise.theme]++;
            appState.userData.lastActivity = new Date().toISOString();
            
            feedback.style.display = 'block';
            document.getElementById('nextExerciseBtn').style.display = 'inline-block';
            
            // Guardar progreso inmediatamente
            saveUserData();
        }

        function nextExercise() {
            appState.currentExerciseIndex++;
            
            if (appState.currentExerciseIndex < appState.currentExerciseSet.length) {
                showExercise();
            } else {
                completeDay();
            }
        }

        function completeDay() {
            const { week, day, correct, total } = appState.currentSessionStats;
            const dayKey = `week${week}_day${day}`;
            
            appState.userData.completedExercises[dayKey] = {
                completed: true,
                score: correct,
                total: total,
                date: new Date().toISOString()
            };
            
            if (correct === total) {
                appState.userData.streak++;
            } else {
                appState.userData.streak = 0;
            }
            
            checkAchievements();
            
            const newLevel = Math.floor(appState.userData.totalPoints / 100) + 1;
            if (newLevel > appState.userData.level) {
                appState.userData.level = newLevel;
                showReward('¬°Nivel Superior!', 'üÜô', `¬°Has alcanzado el nivel ${newLevel}!`);
            }
            
            closeExercise();
            saveUserData();
            updateUserInterface();
            generateWeeks();
            
            showDayComplete(correct, total);
        }

        function showDayComplete(correct, total) {
            const percentage = Math.round((correct / total) * 100);
            let message = '';
            let icon = '';
            
            if (percentage === 100) {
                message = '¬°Perfecto! ¬°Eres un verdadero maestro entrenador!';
                icon = 'üèÜ';
            } else if (percentage >= 80) {
                message = '¬°Excelente trabajo! Casi perfecto.';
                icon = '‚≠ê';
            } else if (percentage >= 60) {
                message = '¬°Buen trabajo! Sigue practicando.';
                icon = 'üëç';
            } else {
                message = '¬°Sigue intentando! La pr√°ctica hace al maestro.';
                icon = 'üí™';
            }
            
            showReward('¬°D√≠a Completado!', icon, `${message}\nPuntuaci√≥n: ${correct}/${total} (${percentage}%)`);
        }

        function closeExercise() {
            document.getElementById('exerciseModal').style.display = 'none';
        }

        // Sistema de logros
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!appState.userData.achievements.includes(achievement.id)) {
                    let earned = false;
                    
                    switch (achievement.id) {
                        case 'first_exercise':
                            earned = appState.userData.totalExercises >= 1;
                            break;
                        case 'math_master':
                            earned = appState.userData.exercisesByType.math >= 15;
                            break;
                        case 'reading_hero':
                            earned = appState.userData.exercisesByType.reading >= 15;
                            break;
                        case 'english_expert':
                            earned = appState.userData.exercisesByType.english >= 15;
                            break;
                        case 'perfect_day':
                            earned = appState.currentSessionStats.correct === appState.currentSessionStats.total && appState.currentSessionStats.total > 0;
                            break;
                        case 'streak_week':
                            earned = appState.userData.streak >= 7;
                            break;
                        case 'multiplication_master':
                            earned = appState.userData.multiplicationExercises >= 10;
                            break;
                        case 'reading_champion':
                            earned = appState.userData.textsRead >= 20;
                            break;
                    }
                    
                    if (earned) {
                        appState.userData.achievements.push(achievement.id);
                        showReward('¬°Nuevo Logro!', achievement.icon, `${achievement.name}\n${achievement.description}`);
                    }
                }
            });
        }

        function loadAchievements() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const isUnlocked = appState.userData.achievements.includes(achievement.id);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : ''}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <h4>${achievement.name}</h4>
                    <p>${achievement.description}</p>
                    <div style="margin-top: 10px; font-size: 12px; color: #666;">
                        ${isUnlocked ? '‚úÖ Desbloqueado' : 'üîí Bloqueado'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Estad√≠sticas detalladas
        function loadStats() {
            const content = document.getElementById('statsContent');
            const userData = appState.userData;
            
            const accuracy = userData.totalExercises > 0 
                ? Math.round((userData.correctAnswers / userData.totalExercises) * 100)
                : 0;
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                    <div class="stat-card" style="padding: 20px;">
                        <h3>üìä Estad√≠sticas Generales</h3>
                        <p><strong>Ejercicios totales:</strong> ${userData.totalExercises}</p>
                        <p><strong>Respuestas correctas:</strong> ${userData.correctAnswers}</p>
                        <p><strong>Precisi√≥n:</strong> ${accuracy}%</p>
                        <p><strong>Puntos totales:</strong> ${userData.totalPoints}</p>
                        <p><strong>Racha actual:</strong> ${userData.streak} d√≠as</p>
                        <p><strong>Nivel:</strong> ${userData.level}</p>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>üìö Por Materia</h3>
                        <p><strong>üßÆ Matem√°ticas:</strong> ${userData.exercisesByType.math || 0}</p>
                        <p><strong>üìñ Comprensi√≥n Lectora:</strong> ${userData.exercisesByType.reading || 0}</p>
                        <p><strong>üá¨üáß Ingl√©s:</strong> ${userData.exercisesByType.english || 0}</p>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                            <p><strong>‚úñÔ∏è Multiplicaciones:</strong> ${userData.multiplicationExercises || 0}</p>
                            <p><strong>üìñ Textos le√≠dos:</strong> ${userData.textsRead || 0}</p>
                        </div>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>üéÆ Por Tema Favorito</h3>
                        <p><strong>üî¥ Pok√©mon:</strong> ${userData.exercisesByTheme.pokemon || 0}</p>
                        <p><strong>‚öîÔ∏è Titanes:</strong> ${userData.exercisesByTheme.titans || 0}</p>
                        <p><strong>‚öΩ F√∫tbol:</strong> ${userData.exercisesByTheme.football || 0}</p>
                        <p><strong>üî´ Warframe:</strong> ${userData.exercisesByTheme.warframe || 0}</p>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>üèÜ Progreso de Logros</h3>
                        <p><strong>Desbloqueados:</strong> ${userData.achievements.length}/${achievements.length}</p>
                        <div style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 5px;">
                            ${userData.achievements.map(id => {
                                const achievement = achievements.find(a => a.id === id);
                                return achievement ? `<span style="padding: 4px 8px; background: #ffd700; border-radius: 4px; font-size: 12px; color: #333;">${achievement.icon} ${achievement.name}</span>` : '';
                            }).join('')}
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3>üìà Progreso Semanal</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        ${Object.keys(exerciseDatabase).map(weekKey => {
                            const weekNum = weekKey.replace('week', '');
                            const completed = getCompletedDaysInWeek(weekNum);
                            return `
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                    <h4>Semana ${weekNum}</h4>
                                    <div style="font-size: 24px; color: #667eea; margin: 10px 0;">${completed}/5</div>
                                    <div style="font-size: 12px; color: #666;">d√≠as completados</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px; border-left: 4px solid #2196f3;">
                    <h4>üìù Informaci√≥n de Cuenta</h4>
                    <p><strong>Usuario:</strong> ${appState.currentUser}</p>
                    <p><strong>Cuenta creada:</strong> ${userData.created ? new Date(userData.created).toLocaleDateString('es-ES') : 'Fecha no disponible'}</p>
                    <p><strong>√öltima actividad:</strong> ${userData.lastActivity ? new Date(userData.lastActivity).toLocaleString('es-ES') : 'No disponible'}</p>
                    <p><strong>Estado de guardado:</strong> ${appState.connectionStatus === 'online' ? '‚úÖ Sincronizado' : '‚ùå Sin sincronizar'}</p>
                </div>
            `;
        }

        // Sistema de recompensas
        function showReward(title, icon, message) {
            document.getElementById('rewardTitle').textContent = title;
            document.getElementById('rewardIcon').textContent = icon;
            document.getElementById('rewardMessage').textContent = message;
            document.getElementById('rewardPopup').style.display = 'block';
        }

        function closeReward() {
            document.getElementById('rewardPopup').style.display = 'none';
        }

        // Funciones de administraci√≥n
        function resetProgress() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar todo el progreso? Esta acci√≥n no se puede deshacer.')) {
                appState.userData = createNewUser();
                saveUserData();
                updateUserInterface();
                generateWeeks();
                alert('Progreso reiniciado correctamente.');
            }
        }

        function exportData() {
            const dataToExport = {
                user: appState.currentUser,
                data: appState.userData,
                exportDate: new Date().toISOString(),
                summary: {
                    totalExercises: appState.userData.totalExercises,
                    accuracy: appState.userData.totalExercises > 0 ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100) : 0,
                    level: appState.userData.level,
                    achievements: appState.userData.achievements.length,
                    connectionStatus: appState.connectionStatus
                }
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `academia_pokemon_${appState.currentUser}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ Academia Pokemon iniciada');
            console.log('üì° Configuraci√≥n JSONBin:', {
                binId: JSONBIN_CONFIG.binId,
                apiUrl: JSONBIN_CONFIG.apiUrl
            });
            
            updateConnectionStatus('offline');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            // Event listener para Enter en el input de login
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
</body>
</html>
