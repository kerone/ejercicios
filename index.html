<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 Academia Pokemon - ¡Aprende Jugando!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 25%, #45b7d1 50%, #96ceb4 75%, #ffeaa7 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            min-height: 100vh;
            color: #2d3436;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 500px;
            width: 100%;
            position: relative;
            z-index: 2;
            border: 5px solid transparent;
            background-clip: padding-box;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            border-radius: 35px;
            z-index: -1;
        }

        .login-card h1 {
            font-family: 'Fredoka One', cursive;
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 3em;
            text-shadow: 3px 3px 0px #fff;
        }

        .login-card p {
            font-size: 18px;
            color: #636e72;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .login-card input {
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: 3px solid #ddd;
            border-radius: 20px;
            font-size: 18px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .login-card input:focus {
            outline: none;
            border-color: #ff6b6b;
            transform: scale(1.02);
            background: white;
        }

        .login-card button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #fd79a8);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
            font-family: 'Nunito', sans-serif;
        }

        .login-card button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
        }

        .main-app {
            display: none;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 3px solid #fdcb6e;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            color: white;
            font-weight: 800;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border: 4px solid white;
        }

        .user-info h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: #2d3436;
            margin: 0;
        }

        .user-info p {
            font-size: 16px;
            color: #636e72;
            margin: 5px 0 0 0;
            font-weight: 600;
        }

        .stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
            min-width: 100px;
            transition: transform 0.3s;
            border: 3px solid white;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #55efc4, #00b894);
            box-shadow: 0 8px 25px rgba(85, 239, 196, 0.3);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            box-shadow: 0 8px 25px rgba(253, 203, 110, 0.3);
        }

        .stat-card h3 {
            font-size: 28px;
            font-weight: 800;
            margin: 5px 0;
            font-family: 'Fredoka One', cursive;
        }

        .stat-card p {
            font-size: 14px;
            opacity: 0.95;
            font-weight: 700;
        }

        .tab-navigation {
            background: white;
            padding: 15px;
            border-radius: 25px;
            margin-bottom: 25px;
            display: flex;
            gap: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 3px solid #4ecdc4;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 15px 30px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 3px solid #dfe6e9;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 800;
            font-size: 16px;
            color: #2d3436;
            font-family: 'Nunito', sans-serif;
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #ff6b6b, #fd79a8);
            color: white;
            border-color: #d63031;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .calendar-wrapper {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            border: 4px solid #74b9ff;
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .calendar-header h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .day-header {
            font-family: 'Fredoka One', cursive;
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border-radius: 15px;
            font-size: 16px;
            border: 3px solid white;
        }

        .day-cell {
            aspect-ratio: 1;
            border: 4px solid #dfe6e9;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .day-cell:hover:not(.disabled):not(.empty) {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .day-cell.empty {
            opacity: 0.3;
            cursor: default;
            background: #f8f9fa;
        }

        .day-cell.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f9fa;
        }

        .day-cell.recoverable {
            background: linear-gradient(135deg, #fab1a0, #ff7675);
            border-color: #d63031;
            cursor: pointer;
            animation: pulseRecoverable 2s infinite;
        }

        @keyframes pulseRecoverable {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 118, 117, 0.4); }
            50% { box-shadow: 0 0 25px rgba(255, 118, 117, 0.7); }
        }

        .day-cell.recoverable:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(255, 118, 117, 0.8);
        }

        .day-cell.completed {
            background: linear-gradient(135deg, #55efc4, #00b894);
            border-color: #00b894;
            animation: pulseGlow 2s infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 184, 148, 0.5); }
            50% { box-shadow: 0 0 40px rgba(0, 184, 148, 0.8); }
        }

        .day-cell.current {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            border-color: #d63031;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .day-number {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            font-weight: 800;
            color: #2d3436;
        }

        .day-cell.completed .day-number,
        .day-cell.current .day-number,
        .day-cell.recoverable .day-number {
            color: white;
        }

        .day-status {
            font-size: 30px;
            margin-top: 5px;
        }

        .exercise-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .exercise-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 5px solid #4ecdc4;
            position: relative;
            margin: 20px auto;
            max-height: 90vh;
            overflow-y: auto;
        }

        .exercise-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .exercise-header h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #2d3436;
            margin-bottom: 15px;
        }

        .subject-badge {
            display: inline-block;
            padding: 12px 25px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 18px;
            margin: 5px;
            border: 3px solid white;
        }

        .subject-badge.math {
            background: linear-gradient(135deg, #ff6b6b, #fd79a8);
            color: white;
        }

        .subject-badge.reading {
            background: linear-gradient(135deg, #4ecdc4, #45b7d1);
            color: white;
        }

        .subject-badge.science {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .subject-badge.social {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
        }

        .instruction-box {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid #636e72;
        }

        .instruction-box h4 {
            font-family: 'Fredoka One', cursive;
            font-size: 22px;
            color: #2d3436;
            margin-bottom: 15px;
        }

        .instruction-box p {
            font-size: 18px;
            font-weight: 700;
            color: #2d3436;
            line-height: 1.6;
        }

        .reading-passage {
            background: linear-gradient(135deg, #fff9e6, #ffeaa7);
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid #fdcb6e;
            font-size: 18px;
            line-height: 2;
            font-weight: 600;
            color: #2d3436;
            max-height: 400px;
            overflow-y: auto;
        }

        .reading-passage h4 {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            margin-bottom: 20px;
            color: #e17055;
            text-align: center;
        }

        .reading-passage p {
            margin-bottom: 15px;
        }

        .question-container {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 30px;
            border-radius: 25px;
            margin: 25px 0;
            border: 4px solid #dfe6e9;
        }

        .question-text {
            font-size: 22px;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .options-container {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .option-btn {
            padding: 20px;
            background: white;
            border: 4px solid #dfe6e9;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
            font-weight: 700;
            text-align: left;
            color: #2d3436;
            font-family: 'Nunito', sans-serif;
        }

        .option-btn:hover {
            transform: translateX(10px);
            border-color: #74b9ff;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border-color: #0984e3;
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            border-color: #00b894;
        }

        .option-btn.incorrect {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border-color: #d63031;
        }

        .hint-box {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 20px;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid #e17055;
            display: none;
        }

        .hint-box.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hint-text {
            font-size: 18px;
            font-weight: 700;
            color: #2d3436;
        }

        .feedback-box {
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            font-size: 18px;
            font-weight: 700;
            border: 4px solid;
            display: none;
            line-height: 1.6;
        }

        .feedback-box.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .feedback-box.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            border-color: #00b894;
        }

        .feedback-box.incorrect {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border-color: #d63031;
        }

        .explanation-box {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid #2196f3;
            display: none;
            font-size: 17px;
            line-height: 1.7;
            font-weight: 600;
            color: #1565c0;
        }

        .explanation-box.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .explanation-box h4 {
            font-family: 'Fredoka One', cursive;
            font-size: 22px;
            margin-bottom: 15px;
            color: #0d47a1;
        }

        .exercise-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .exercise-btn {
            flex: 1;
            min-width: 150px;
            padding: 18px;
            border: none;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
        }

        .exercise-btn.primary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.4);
        }

        .exercise-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(116, 185, 255, 0.6);
        }

        .exercise-btn.secondary {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            color: #2d3436;
        }

        .exercise-btn.secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .exercise-btn.success {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            box-shadow: 0 8px 25px rgba(0, 184, 148, 0.4);
        }

        .exercise-btn.success:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 184, 148, 0.6);
        }

        .exercise-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .progress-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #dfe6e9;
            border: 3px solid #b2bec3;
            transition: all 0.3s;
        }

        .progress-dot.completed {
            background: linear-gradient(135deg, #55efc4, #00b894);
            border-color: #00b894;
        }

        .progress-dot.current {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            border-color: #e17055;
            transform: scale(1.3);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 800;
            box-shadow: 0 8px 20px rgba(214, 48, 49, 0.4);
        }

        .close-modal:hover {
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 12px 30px rgba(214, 48, 49, 0.6);
        }

        .achievement-unlock {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 50px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 2000;
            text-align: center;
            border: 5px solid #fdcb6e;
            display: none;
            animation: achievementPop 0.5s ease;
        }

        @keyframes achievementPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .achievement-unlock.visible {
            display: block;
        }

        .achievement-icon-big {
            font-size: 100px;
            margin-bottom: 20px;
        }

        .achievement-unlock h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #2d3436;
            margin-bottom: 15px;
        }

        .achievement-unlock p {
            font-size: 20px;
            font-weight: 700;
            color: #636e72;
        }

        .stats-kids {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .stat-card-big {
            background: linear-gradient(135deg, #f8f9fa, white);
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 4px solid #74b9ff;
            transition: all 0.3s;
        }

        .stat-card-big:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }

        .stat-icon-big {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .stat-number-big {
            font-family: 'Fredoka One', cursive;
            font-size: 48px;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .stat-label-big {
            font-size: 18px;
            font-weight: 700;
            color: #636e72;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .achievement-card {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 4px solid #636e72;
            transition: all 0.3s;
            opacity: 0.5;
        }

        .achievement-card.unlocked {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-color: #e17055;
            opacity: 1;
            animation: achievementGlow 2s infinite;
        }

        @keyframes achievementGlow {
            0%, 100% { box-shadow: 0 10px 30px rgba(253, 203, 110, 0.4); }
            50% { box-shadow: 0 10px 40px rgba(253, 203, 110, 0.8); }
        }

        .achievement-card:hover {
            transform: scale(1.05);
        }

        .achievement-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .ranking-container {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            border: 4px solid #fdcb6e;
        }

        .ranking-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .ranking-header h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #2d3436;
        }

        .ranking-filters {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            border: 3px solid #636e72;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 800;
            font-size: 16px;
            color: #2d3436;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
        }

        .filter-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            border-color: #e17055;
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin: 40px 0;
            min-height: 300px;
        }

        .podium-place {
            text-align: center;
            padding: 30px 20px;
            border-radius: 20px;
            border: 4px solid;
            min-width: 200px;
            transition: all 0.3s;
        }

        .podium-place:hover {
            transform: translateY(-10px);
        }

        .podium-place.first {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            border-color: #d63031;
            order: 2;
            height: 300px;
        }

        .podium-place.second {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            border-color: #636e72;
            order: 1;
            height: 240px;
        }

        .podium-place.third {
            background: linear-gradient(135deg, #fab1a0, #e17055);
            border-color: #d63031;
            order: 3;
            height: 200px;
        }

        .podium-rank {
            font-family: 'Fredoka One', cursive;
            font-size: 48px;
            color: white;
            margin-bottom: 10px;
        }

        .podium-name {
            font-size: 20px;
            font-weight: 800;
            color: white;
            margin-bottom: 10px;
        }

        .podium-score {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: white;
        }

        .ranking-table {
            margin-top: 30px;
        }

        .ranking-row {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, white);
            border-radius: 20px;
            margin-bottom: 15px;
            border: 3px solid #dfe6e9;
            transition: all 0.3s;
        }

        .ranking-row:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .ranking-row.current-user {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-color: #0984e3;
        }

        .ranking-row.current-user * {
            color: white !important;
        }

        .ranking-position {
            font-family: 'Fredoka One', cursive;
            font-size: 28px;
            color: #2d3436;
            min-width: 60px;
            text-align: center;
        }

        .ranking-user {
            flex: 1;
            font-size: 20px;
            font-weight: 800;
            color: #2d3436;
            margin-left: 20px;
        }

        .ranking-stats {
            display: flex;
            gap: 30px;
            font-weight: 700;
            color: #636e72;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1500;
            font-weight: 800;
            border: 3px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .connection-status.online {
            border-color: #00b894;
            color: #00b894;
        }

        .connection-status.offline {
            border-color: #636e72;
            color: #636e72;
        }

        .connection-status.connecting {
            border-color: #fdcb6e;
            color: #e17055;
        }

        .connection-status.error {
            border-color: #d63031;
            color: #d63031;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .settings-container {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            border: 4px solid #74b9ff;
        }

        .settings-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 3px solid #dfe6e9;
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: #2d3436;
            margin-bottom: 20px;
        }

        .settings-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            border: 3px solid #636e72;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 800;
            font-size: 16px;
            color: #2d3436;
            margin: 10px 0;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
        }

        .settings-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .settings-btn.danger {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border-color: #d63031;
        }

        .settings-btn.success {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            border-color: #00b894;
        }

        .timer-display {
            font-family: 'Fredoka One', cursive;
            font-size: 28px;
            color: #2d3436;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 20px;
            border: 4px solid #e17055;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
            }

            .user-info {
                flex-direction: column;
                text-align: center;
                width: 100%;
            }

            .avatar {
                width: 60px;
                height: 60px;
                font-size: 28px;
            }

            .stats {
                width: 100%;
                justify-content: space-around;
            }

            .stat-card {
                min-width: 80px;
                padding: 12px;
            }

            .stat-card h3 {
                font-size: 20px;
            }

            .stat-card p {
                font-size: 12px;
            }

            .tab-navigation {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .tab-navigation::-webkit-scrollbar {
                display: none;
            }

            .nav-tab {
                min-width: 120px;
                padding: 12px 15px;
                font-size: 14px;
                white-space: nowrap;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 6px;
            }

            .day-cell {
                min-height: 60px;
                padding: 5px;
            }

            .day-number {
                font-size: 14px;
            }

            .day-status {
                font-size: 18px;
            }

            .exercise-content {
                padding: 15px;
            }

            .exercise-modal {
                padding: 15px;
            }

            .option-btn {
                padding: 12px;
                font-size: 15px;
            }

            .podium {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .podium-place {
                width: 100%;
                max-width: 300px;
                height: auto !important;
            }

            .podium-place.first {
                order: 1;
            }

            .podium-place.second {
                order: 2;
            }

            .podium-place.third {
                order: 3;
            }

            .ranking-table {
                font-size: 14px;
            }

            .ranking-row td {
                padding: 10px 5px;
                font-size: 13px;
            }

            .achievement-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .calendar-header h2 {
                font-size: 24px;
            }

            .login-card {
                padding: 30px 20px;
                margin: 10px;
            }

            .login-card h1 {
                font-size: 2em;
            }
        }

        /* Media query específica para pantallas grandes (S24 Ultra y similares) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .calendar-grid {
                gap: 10px;
            }

            .day-cell {
                min-height: 80px;
            }

            .nav-tab {
                padding: 15px 20px;
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        <div class="status-dot"></div>
        <span id="statusText">Desconectado</span>
    </div>

    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h1>🎮 Academia Pokemon</h1>
            <p>¡Bienvenido, Súper Entrenador! 🚀</p>
            <input type="text" id="usernameInput" placeholder="Escribe tu nombre de entrenador">
            <button onclick="login()">¡Comenzar Aventura! 🌟</button>
        </div>
    </div>

    <div class="main-app" id="mainApp">
        <div class="container">
            <div class="header">
                <div class="user-info">
                    <div class="avatar" id="userAvatar">🎮</div>
                    <div>
                        <h2 id="userName">Súper Entrenador</h2>
                        <p id="userLevel">Nivel 1 - Novato Genial</p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <h3 id="totalPoints">0</h3>
                        <p>⭐ Puntos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="streak">0</h3>
                        <p>🔥 Racha</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="achievements">0</h3>
                        <p>🏆 Logros</p>
                    </div>
                </div>
            </div>

            <div class="tab-navigation">
                <div class="nav-tab active" data-tab="calendar" onclick="showTab('calendar')">📅 Calendario</div>
                <div class="nav-tab" data-tab="stats" onclick="showTab('stats')">📊 Estadísticas</div>
                <div class="nav-tab" data-tab="achievements" onclick="showTab('achievements')">🏆 Logros</div>
                <div class="nav-tab" data-tab="ranking" onclick="showTab('ranking')">🥇 Ranking</div>
                <div class="nav-tab" data-tab="settings" onclick="showTab('settings')">⚙️ Ajustes</div>
            </div>

            <div id="calendarTab" class="tab-content active">
                <div class="calendar-wrapper">
                    <div class="calendar-header">
                        <h2>🗓️ Tu Calendario de Aventuras</h2>
                        <p style="font-size: 18px; font-weight: 600; color: #636e72;">¡30 minutos geniales cada día! 🌟</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 20px; border-radius: 20px; margin-bottom: 25px; border: 3px solid #2196f3;">
                        <h4 style="font-family: 'Fredoka One', cursive; font-size: 18px; color: #0d47a1; margin-bottom: 15px; text-align: center;">📋 Leyenda del Calendario</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-weight: 700; font-size: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">🎯</span>
                                <span style="color: #1565c0;">Hoy - ¡A jugar!</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">📝</span>
                                <span style="color: #1565c0;">Recuperar día perdido</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">✅</span>
                                <span style="color: #1565c0;">¡Completado!</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">🔒</span>
                                <span style="color: #1565c0;">Bloqueado (futuro)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="weeksContainer"></div>
                </div>
            </div>

            <div id="statsTab" class="tab-content">
                <div class="settings-container">
                    <div class="calendar-header">
                        <h2>📊 Mis Estadísticas Súper Geniales</h2>
                    </div>
                    <div id="statsContent"></div>
                </div>
            </div>

            <div id="achievementsTab" class="tab-content">
                <div class="settings-container">
                    <div class="calendar-header">
                        <h2>🏆 Mis Logros Increíbles</h2>
                    </div>
                    <div id="achievementGrid" class="achievement-grid"></div>
                </div>
            </div>

            <div id="rankingTab" class="tab-content">
                <div class="ranking-container">
                    <div class="ranking-header">
                        <h2>🥇 Ranking de Súper Campeones</h2>
                    </div>
                    <div class="ranking-filters">
                        <button class="filter-btn active" onclick="setRankingFilter('all')">🌟 Todos</button>
                        <button class="filter-btn" onclick="setRankingFilter('week')">📅 Esta Semana</button>
                        <button class="filter-btn" onclick="setRankingFilter('month')">📆 Este Mes</button>
                    </div>
                    <div id="podiumContainer" class="podium"></div>
                    <div id="rankingTableContainer" class="ranking-table"></div>
                </div>
            </div>

            <div id="settingsTab" class="tab-content">
                <div class="settings-container">
                    <div class="calendar-header">
                        <h2>⚙️ Configuración</h2>
                    </div>
                    
                    <div class="settings-section">
                        <h3>🔌 Conexión</h3>
                        <button class="settings-btn success" onclick="testConnection()">🔄 Probar Conexión</button>
                    </div>
                    
                    <div class="settings-section">
                        <h3>💾 Datos</h3>
                        <button class="settings-btn" onclick="exportData()">📥 Exportar Mis Datos</button>
                        <button class="settings-btn danger" onclick="resetProgress()">🔄 Reiniciar Progreso</button>
                    </div>
                    
                    <div class="settings-section">
                        <h3>⚠️ Zona Peligrosa</h3>
                        <button class="settings-btn danger" onclick="deleteUser()">🗑️ Eliminar Usuario Completo</button>
                        <p style="font-size: 14px; color: #d63031; font-weight: 600; margin-top: 10px;">⚠️ Esta acción borrará PERMANENTEMENTE tu usuario y todos tus datos del servidor.</p>
                    </div>
                    
                    <div class="settings-section">
                        <h3>ℹ️ Información</h3>
                        <p style="font-weight: 600; color: #636e72; margin: 10px 0;">Versión: 4.0 Final - ¡Con Textos Largos! 🚀</p>
                        <p style="font-weight: 600; color: #636e72; margin: 10px 0;">Usuario actual: <span id="currentUserDisplay"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="exercise-modal" id="exerciseModal">
        <div class="exercise-content">
            <button class="close-modal" onclick="closeExerciseModal()">✕</button>
            <div class="exercise-header">
                <h3 id="exerciseTitle">Ejercicios Súper Geniales</h3>
                <div id="subjectBadges"></div>
                <div class="timer-display" id="timerDisplay">⏱️ Tiempo: 30:00</div>
            </div>
            
            <div class="progress-indicator" id="progressIndicator"></div>
            
            <div id="exerciseContainer"></div>
            
            <div class="hint-box" id="hintBox">
                <div style="font-size: 24px; margin-bottom: 10px;">💡 Pista Genial</div>
                <div class="hint-text" id="hintText"></div>
            </div>
            
            <div class="feedback-box" id="feedbackBox">
                <div id="feedbackText"></div>
            </div>

            <div class="explanation-box" id="explanationBox">
                <h4>📚 ¿Por qué es así?</h4>
                <div id="explanationText"></div>
            </div>
            
            <div class="exercise-buttons">
                <button class="exercise-btn secondary" id="hintBtn" onclick="showHint()">💡 Pista</button>
                <button class="exercise-btn primary" id="checkBtn" onclick="checkAnswer()">✓ Comprobar</button>
                <button class="exercise-btn success" id="nextBtn" onclick="nextExercise()" style="display: none;">➜ Siguiente</button>
            </div>
        </div>
    </div>

    <div class="achievement-unlock" id="achievementUnlock">
        <div class="achievement-icon-big" id="unlockedIcon">🏆</div>
        <h3 id="unlockedName">¡Súper Logro!</h3>
        <p id="unlockedDescription">¡Has desbloqueado algo genial!</p>
        <button class="exercise-btn success" onclick="closeAchievementUnlock()" style="margin-top: 30px; width: 100%;">¡Genial! 🎉</button>
    </div>

    <script>
        const JSONBIN_CONFIG = {
            binId: '68ee144343b1c97be96704f9',
            masterKey: '$2a$10$byEkgCiPtr6uA9j.sw5Uiuld00jGPRMT1Rn9TlhHYbPe3CFfaEu6G',
            apiUrl: 'https://api.jsonbin.io/v3'
        };

        let appState = {
            currentUser: null,
            userData: null,
            allUsersData: {},
            currentDay: null,
            currentExerciseIndex: 0,
            currentExercises: [],
            selectedAnswer: null,
            currentRankingFilter: 'all',
            sessionStartTime: null,
            timerInterval: null,
            timeRemaining: 1800
        };

        // BANCO DE EJERCICIOS CON TEXTOS LARGOS DE COMPRENSIÓN LECTORA
        const exerciseBank = {
            math: [
                {
                    instruction: "🎮 Pikachu necesita tu ayuda con las matemáticas. Lee con atención y calcula:",
                    question: "Pikachu ha derrotado a 234 Pokemon en batallas. Charizard ha derrotado el doble que Pikachu. ¿Cuántos Pokemon ha derrotado Charizard?",
                    options: ["468 Pokemon", "334 Pokemon", "464 Pokemon", "234 Pokemon"],
                    correct: 0,
                    hint: "El doble significa multiplicar por 2. Puedes sumar 234 + 234 para encontrar la respuesta.",
                    explanation: "Cuando decimos 'el doble', significa multiplicar por 2. Entonces: 234 × 2 = 468. También puedes pensarlo como sumar el número dos veces: 234 + 234 = 468. ¡Charizard es súper fuerte! 🔥"
                },
                {
                    instruction: "⚽ ¡Problema de fútbol! Vamos a resolver este ejercicio sobre el Real Madrid:",
                    question: "En el Bernabéu caben 81.044 personas. Si ya hay 56.789 espectadores viendo el partido, ¿cuántas personas más pueden entrar?",
                    options: ["24.255 personas", "25.255 personas", "24.155 personas", "23.255 personas"],
                    correct: 0,
                    hint: "Tienes que restar: lo que cabe menos lo que ya hay. Empieza por las unidades y no olvides pedir prestado cuando sea necesario.",
                    explanation: "Para saber cuántas personas más pueden entrar, restamos: 81.044 - 56.789 = 24.255. Es como si el estadio fuera una caja que puede guardar 81.044 caramelos, y ya tiene 56.789, entonces caben 24.255 más. ⚽✨"
                },
                {
                    instruction: "🎮 Eren necesita calcular recursos para proteger la muralla. ¡Ayúdalo!",
                    question: "Los Titanes atacan en grupos de 8. Si Eren cuenta 96 Titanes acercándose, ¿cuántos grupos son?",
                    options: ["12 grupos", "11 grupos", "13 grupos", "10 grupos"],
                    correct: 0,
                    hint: "Divide el total de Titanes entre el tamaño de cada grupo. Puedes usar la tabla del 8.",
                    explanation: "Para saber cuántos grupos hay, dividimos: 96 ÷ 8 = 12 grupos. La división nos ayuda a repartir cosas en partes iguales. ¡Es como separar 96 soldados en escuadrones de 8! ⚔️"
                },
                {
                    instruction: "⚽ ¡Problema con las medallas del Barcelona!",
                    question: "El Barça tiene 3 cajas de medallas. Cada caja contiene 25 medallas. ¿Cuántas medallas tienen en total?",
                    options: ["75 medallas", "70 medallas", "80 medallas", "65 medallas"],
                    correct: 0,
                    hint: "Multiplica el número de cajas por las medallas en cada caja. 25 × 3 = ?",
                    explanation: "Multiplicamos: 3 cajas × 25 medallas = 75 medallas. La multiplicación es una suma rápida: 25 + 25 + 25 = 75. ¡El Barça tiene muchas victorias! 🏆"
                },
                {
                    instruction: "🎮 ¡Ash está contando sus Pokeballs! Vamos a ayudarlo:",
                    question: "Ash tiene 1/4 de sus Pokeballs llenas con Pokemon de tipo Agua. Si tiene 20 Pokeballs, ¿cuántas tienen Pokemon de Agua?",
                    options: ["5 Pokeballs", "10 Pokeballs", "4 Pokeballs", "8 Pokeballs"],
                    correct: 0,
                    hint: "1/4 significa dividir en 4 partes iguales y tomar 1. Divide 20 ÷ 4.",
                    explanation: "Una fracción 1/4 significa dividir algo en 4 partes iguales. Si tenemos 20 Pokeballs y las dividimos en 4 grupos: 20 ÷ 4 = 5. Cada grupo tiene 5 Pokeballs. ¡Splash! 💧"
                },
                {
                    instruction: "⚽ Cristiano Ronaldo está entrenando. ¡Necesita tu ayuda para contar!",
                    question: "Cristiano ha marcado 567 goles en su carrera. Luego marca 345 goles más en las siguientes temporadas. ¿Cuántos goles lleva en total?",
                    options: ["912 goles", "902 goles", "812 goles", "922 goles"],
                    correct: 0,
                    hint: "Suma los goles: 567 + 345. Recuerda ir sumando de derecha a izquierda: unidades, decenas, centenas.",
                    explanation: "Sumamos: 567 + 345 = 912 goles. Primero sumamos las unidades (7+5=12, ponemos 2 y llevamos 1), luego las decenas (6+4+1=11, ponemos 1 y llevamos 1), finalmente las centenas (5+3+1=9). ¡Cristiano es una leyenda! ⚽👑"
                }
            ],
            reading: [
                {
                    instruction: "📖 Lee este texto COMPLETO sobre la aventura de Pikachu. Tómate tu tiempo, luego responde las preguntas:",
                    passageTitle: "La Gran Aventura de Pikachu en el Bosque Misterioso",
                    passage: "Era un día soleado en Ciudad Paleta cuando Pikachu decidió explorar el Bosque Verde. Ash, su entrenador, le había dado permiso para ir, pero le advirtió: 'Ten cuidado, Pikachu. En el bosque viven Pokemon salvajes muy poderosos.'\n\nPikachu caminó por el sendero principal durante una hora hasta que escuchó un ruido extraño detrás de unos arbustos. Sus mejillas eléctricas comenzaron a brillar, listo para defenderse. De repente, apareció un pequeño Caterpie asustado. 'Pi-pika?' preguntó Pikachu amablemente.\n\nEl Caterpie explicó que se había perdido buscando hojas de mora para comer. Pikachu, siendo muy bondadoso, decidió ayudarlo. Juntos caminaron durante dos horas hasta encontrar un árbol enorme lleno de deliciosas hojas verdes.\n\nMientras Caterpie comía feliz, Pikachu escuchó un grito lejano. ¡Era Ash! Estaba buscándolo porque ya era hora de volver a casa. Pikachu se despidió de su nuevo amigo con un 'Pika-chu!' alegre y corrió hacia la voz de Ash.\n\nCuando llegó, Ash lo abrazó fuerte. 'Me preocupé mucho, Pikachu. Pero veo que has hecho un buen amigo.' Pikachu asintió orgulloso. Esa noche, mientras descansaba en su Pokeball, Pikachu soñó con más aventuras en el bosque.",
                    question: "¿Cuánto tiempo caminó Pikachu en total durante su aventura? (cuenta el tiempo del inicio y el tiempo que ayudó a Caterpie)",
                    options: ["3 horas en total", "1 hora en total", "2 horas en total", "4 horas en total"],
                    correct: 0,
                    hint: "Lee de nuevo el texto. Pikachu caminó 1 hora al principio, y luego 2 horas más ayudando a Caterpie. ¿Cuánto es 1 + 2?",
                    explanation: "Pikachu caminó 1 hora al principio por el sendero principal, y luego caminó 2 horas más ayudando a Caterpie a encontrar el árbol. En total: 1 + 2 = 3 horas. ¡Pikachu es muy generoso con su tiempo! ⚡🕐"
                },
                {
                    instruction: "📖 Lee este texto LARGO sobre el Real Madrid. Presta mucha atención a todos los detalles:",
                    passageTitle: "El Real Madrid: Historia de un Gigante del Fútbol",
                    passage: "El Real Madrid fue fundado en el año 1902, hace más de 120 años. Al principio se llamaba simplemente 'Madrid Football Club', pero en 1920 el Rey Alfonso XIII le dio el título de 'Real', que significa 'del Rey'. Desde ese momento, el escudo del equipo lleva una corona dorada en la parte superior.\n\nEl estadio del Real Madrid se llama Santiago Bernabéu, en honor a un presidente del club muy importante que lo construyó en 1947. Tiene capacidad para más de 81.000 espectadores y es uno de los estadios más famosos del mundo. Cuando hay un partido importante, se llena completamente y los aficionados cantan durante los 90 minutos que dura el partido.\n\nLos colores del Real Madrid son el blanco y el dorado. Por eso los llaman 'Los Blancos' o 'Los Merengues'. El equipo ha ganado 14 Champions League, que es el torneo más importante de Europa. Ningún otro equipo ha ganado tantas.\n\nAlgunos de los jugadores más famosos que han jugado en el Real Madrid son: Alfredo Di Stéfano en los años 50, quien marcó 308 goles; Cristiano Ronaldo entre 2009 y 2018, quien marcó increíbles 450 goles; y actualmente juegan estrellas como Vinícius Jr. y Jude Bellingham.\n\nEl Real Madrid tiene una rivalidad histórica con el FC Barcelona. Cuando juegan entre ellos, al partido se le llama 'El Clásico' y es visto por más de 500 millones de personas en todo el mundo. ¡Es el partido más visto del planeta!",
                    question: "Según el texto, ¿cuántos goles marcó Cristiano Ronaldo en el Real Madrid?",
                    options: ["450 goles", "308 goles", "500 goles", "81 goles"],
                    correct: 0,
                    hint: "Busca en el cuarto párrafo donde habla de Cristiano Ronaldo. Lee con cuidado el número exacto que menciona.",
                    explanation: "El texto dice claramente: 'Cristiano Ronaldo entre 2009 y 2018, quien marcó increíbles 450 goles'. Los 308 goles fueron de Di Stéfano. Es importante leer con atención para no confundir los números. ⚽👑"
                },
                {
                    instruction: "📖 Lee esta HISTORIA LARGA sobre Ataque a los Titanes. Lee todo con mucha atención:",
                    passageTitle: "El Día que Cambió Todo: La Caída del Muro María",
                    passage: "Eren Yeager tenía 10 años cuando vivía tranquilamente en el distrito de Shiganshina, protegido por tres enormes murallas: María (la exterior), Rose (la del medio) y Sina (la interior). Estas murallas de 50 metros de altura habían protegido a la humanidad de los Titanes durante 100 años.\n\nEren vivía con su padre Grisha, quien era médico, su madre Carla, y su hermana adoptiva Mikasa. Aunque la vida era segura, Eren soñaba con salir de las murallas y explorar el mundo exterior. Su mejor amigo Armin compartía ese sueño y le mostraba libros secretos sobre el océano y las montañas que existían más allá.\n\nUn día terrible, apareció el Titán Colosal, un titán de 60 metros de altura que era más alto que las propias murallas. Con una patada, destruyó la puerta del Muro María. Los titanes entraron a la ciudad y comenzó una masacre horrible. Eren vio con sus propios ojos cómo un titán atacaba a su madre. No pudo hacer nada para salvarla.\n\nEsa tragedia cambió a Eren para siempre. Juró vengarse de todos los Titanes y unirse al Cuerpo de Exploración, el grupo de soldados más valientes que salían de las murallas para luchar. Mikasa y Armin decidieron acompañarlo en su misión.\n\nDespués de tres años de entrenamiento duro, Eren, Mikasa y Armin se graduaron. Eren quedó en el puesto número 5 de su promoción, Mikasa fue la número 1 por ser increíblemente fuerte, y Armin, aunque no era muy fuerte físicamente, era el más inteligente de todos.\n\nJuntos comenzaron su nueva vida como soldados, listos para enfrentarse a los Titanes y descubrir los secretos que el mundo escondía detrás de las murallas.",
                    question: "¿En qué puesto quedó Eren en su graduación del entrenamiento militar?",
                    options: ["Puesto número 5", "Puesto número 1", "Puesto número 10", "Puesto número 3"],
                    correct: 0,
                    hint: "Busca en el quinto párrafo (el penúltimo) donde habla sobre la graduación. Menciona el puesto de Eren, Mikasa y Armin.",
                    explanation: "El texto dice: 'Eren quedó en el puesto número 5 de su promoción, Mikasa fue la número 1 por ser increíblemente fuerte, y Armin, aunque no era muy fuerte físicamente, era el más inteligente de todos.' ¡Mikasa fue la mejor! ⚔️"
                },
                {
                    instruction: "📝 Gramática Pokemon. Vamos a identificar el VERBO:",
                    question: "En la frase: 'Los Pokemon luchan valientemente en el gimnasio' - ¿Cuál es el VERBO?",
                    options: ["luchan", "Pokemon", "gimnasio", "valientemente"],
                    correct: 0,
                    hint: "El verbo es la palabra que indica la ACCIÓN que realizan los Pokemon. ¿Qué están haciendo?",
                    explanation: "El verbo es 'luchan' porque indica la acción que realizan los Pokemon. Los verbos expresan acciones (correr, saltar, luchar), estados (ser, estar) o procesos (crecer, aprender). ¡Son súper importantes! 💪"
                },
                {
                    instruction: "📝 ¡Ortografía futbolera! elige la palabra correcta:",
                    question: "¿Cómo se escribe correctamente?",
                    options: ["Messi jugó un partido increíble", "Mesi jugo un partido increible", "Messi jugo un partido increíble", "Mesi jugó un partido increible"],
                    correct: 0,
                    hint: "Recuerda: los nombres propios van con mayúscula, 'jugó' lleva tilde porque es pasado, e 'increíble' también lleva tilde.",
                    explanation: "La forma correcta es 'Messi jugó un partido increíble'. Los nombres propios van con mayúscula. 'Jugó' lleva tilde porque es tiempo pasado. 'Increíble' es una palabra esdrújula (acento en la antepenúltima sílaba) y todas llevan tilde. ⚽✍️"
                },
                {
                    instruction: "📖 Comprensión de sinónimos con Titanes:",
                    question: "En la frase 'Los Titanes son ENORMES y aterradores', ¿qué palabra es sinónimo de ENORMES?",
                    options: ["Gigantes", "Pequeños", "Rápidos", "Feos"],
                    correct: 0,
                    hint: "Un sinónimo es una palabra que significa lo mismo o casi lo mismo. Piensa qué otra palabra significa 'muy grande'.",
                    explanation: "Gigantes es sinónimo de enormes porque ambas palabras significan 'muy grande'. Los sinónimos nos ayudan a no repetir palabras y hacer nuestros textos más ricos. Otros sinónimos: inmensos, colosales. 🏔️"
                }
            ],
            science: [
                {
                    instruction: "🔬 ¡Ciencia Pokemon! Vamos a aprender sobre seres vivos:",
                    question: "Pikachu, Squirtle y Charizard son seres vivos. ¿Qué necesitan TODOS los seres vivos para sobrevivir?",
                    options: ["Agua, alimento y aire", "Solo Pokeballs", "Solo batallas", "Solo entrenadores"],
                    correct: 0,
                    hint: "Piensa en lo que necesitas TÚ para vivir. Los Pokemon, como todos los seres vivos, necesitan lo mismo.",
                    explanation: "TODOS los seres vivos necesitan agua, alimento y aire para sobrevivir. Los Pokemon, los humanos, las plantas y los animales comparten estas necesidades básicas. Sin estas tres cosas, ningún ser vivo puede existir. ¡Es la regla de oro de la vida! 💧🍎💨"
                },
                {
                    instruction: "⚽ Ciencia en el fútbol. ¿Qué pasa cuando pateamos el balón?",
                    question: "Cuando Messi patea un balón de fútbol, este sale volando. ¿Qué tipo de energía usa Messi?",
                    options: ["Energía de movimiento (cinética)", "Energía eléctrica", "Energía solar", "Energía mágica"],
                    correct: 0,
                    hint: "Piensa en cómo se mueve tu pierna cuando pateas. Ese movimiento es energía.",
                    explanation: "Messi usa energía cinética, que es la energía del movimiento. Cuando mueve su pierna y patea, transfiere esa energía al balón, haciéndolo volar. ¡La física está en todos lados, hasta en el fútbol! ⚽💨"
                },
                {
                    instruction: "🌍 Los Titanes y la naturaleza. Aprendamos sobre el cuerpo:",
                    question: "Los Titanes tienen cuerpos enormes pero no tienen órganos como nosotros. ¿Qué órgano bombea la sangre en el cuerpo humano?",
                    options: ["El corazón", "Los pulmones", "El estómago", "El cerebro"],
                    correct: 0,
                    hint: "Este órgano está en el pecho y late constantemente. Lo sientes cuando corres.",
                    explanation: "El corazón es el órgano que bombea la sangre a todo el cuerpo. Late aproximadamente 100.000 veces al día, enviando sangre con oxígeno y nutrientes a todas las células. ¡Es como una súper bomba que nunca descansa! ❤️"
                },
                {
                    instruction: "🔬 El agua Pokemon. ¡Experimento con estados de la materia!",
                    question: "Squirtle lanza agua líquida. Si hace mucho frío, ¿en qué se convierte el agua?",
                    options: ["En hielo (sólido)", "En vapor (gas)", "Sigue líquida", "Desaparece"],
                    correct: 0,
                    hint: "Piensa en lo que pasa cuando metes agua en el congelador.",
                    explanation: "Cuando el agua líquida se enfría mucho (a 0°C o menos), se convierte en hielo, que es agua en estado sólido. Este cambio se llama 'solidificación' o 'congelación'. Los tres estados del agua son: hielo (sólido), agua (líquido) y vapor (gas). ❄️💧☁️"
                },
                {
                    instruction: "🌍 Sistema Solar futbolero. ¡Vamos a aprender sobre planetas!",
                    question: "Si pudiéramos jugar fútbol en todos los planetas, ¿cuál está más cerca del Sol y sería el más caliente?",
                    options: ["Mercurio", "Venus", "Tierra", "Marte"],
                    correct: 0,
                    hint: "El planeta más cercano al Sol empieza con M. Piensa en el orden: Mercurio, Venus, Tierra, Marte...",
                    explanation: "Mercurio es el planeta más cercano al Sol. Aunque Venus es más caliente (por su atmósfera), Mercurio está en primer lugar en distancia. El orden de los planetas es: Mercurio, Venus, Tierra, Marte, Júpiter, Saturno, Urano y Neptuno. ¡Un truco para recordar: Mi Vieja Tía María Jamás Supo Una Noticia! ☀️🪐"
                },
                {
                    instruction: "🔬 Las plantas y los Titanes. ¡Aprendamos botánica!",
                    question: "Fuera de las murallas crecen árboles enormes. ¿Qué partes tiene un árbol?",
                    options: ["Raíz, tallo (tronco), hojas y puede tener flores o frutos", "Solo tronco y hojas", "Solo raíz", "Solo hojas y frutos"],
                    correct: 0,
                    hint: "Piensa en un árbol completo: lo que está bajo tierra, lo que sube, lo que tiene arriba...",
                    explanation: "Las plantas tienen varias partes importantes: La RAÍZ (bajo tierra, absorbe agua), el TALLO o TRONCO (sostiene la planta), las HOJAS (hacen fotosíntesis para crear alimento), y pueden tener FLORES (para reproducirse) y FRUTOS (con semillas). ¡Cada parte tiene su función especial! 🌳🌸"
                }
            ],
            social: [
                {
                    instruction: "🌍 Geografía Pokemon. ¿Dónde viven los Pokemon?",
                    question: "La región de Kanto en Pokemon está inspirada en Japón. ¿En qué continente está Japón?",
                    options: ["Asia", "Europa", "América", "África"],
                    correct: 0,
                    hint: "Japón es un país de islas en el Este del mundo, cerca de China y Corea.",
                    explanation: "Japón está en Asia, el continente más grande del mundo. Asia tiene países como China, India, Corea, Tailandia y muchos más. Japón es un archipiélago (conjunto de islas) en el océano Pacífico. ¡Por eso hay tantos Pokemon de tipo Agua! 🗾🌏"
                },
                {
                    instruction: "⚽ Geografía futbolera. ¡Capitales de España!",
                    question: "El Real Madrid juega en Madrid. ¿Madrid es la capital de...?",
                    options: ["España", "Cataluña", "Andalucía", "Madrid no es capital"],
                    correct: 0,
                    hint: "Madrid es la capital de TODO el país de España.",
                    explanation: "Madrid es la capital de España, el país completo. Una capital es la ciudad más importante de un país o región, donde normalmente está el gobierno. España tiene 17 comunidades autónomas, y Madrid es tanto una comunidad como la capital del país. 🇪🇸👑"
                },
                {
                    instruction: "🌍 Historia de los Titanes. ¡Aprendamos sobre murallas y defensa!",
                    question: "En la Edad Media también construían murallas como en Ataque a los Titanes. ¿Para qué servían?",
                    options: ["Para proteger ciudades de ataques enemigos", "Para decorar", "Para jugar", "Para guardar comida"],
                    correct: 0,
                    hint: "Piensa por qué construirían muros enormes alrededor de las ciudades. ¿De qué se querían proteger?",
                    explanation: "Las murallas servían para PROTEGER las ciudades de enemigos. En la Edad Media (hace cientos de años), las ciudades construían murallas de piedra para defenderse de invasores. Los castillos también tenían murallas. ¡Igual que en Ataque a los Titanes, pero contra otros humanos en lugar de Titanes! 🏰⚔️"
                },
                {
                    instruction: "🗺️ Los puntos cardinales en el mundo Pokemon:",
                    question: "Si Ash está mirando hacia donde sale el sol (Este), y gira a su derecha, ¿hacia dónde mira ahora?",
                    options: ["Sur", "Norte", "Oeste", "Este"],
                    correct: 0,
                    hint: "Cuando miras al Este, el Norte está a tu izquierda y el Sur a tu derecha.",
                    explanation: "Si miras al Este y giras a la derecha, miras al SUR. Los puntos cardinales son: Norte (arriba), Sur (abajo), Este (derecha, donde sale el sol) y Oeste (izquierda, donde se pone el sol). Truco para recordar: Nunca Señores Olviden Este. 🧭☀️"
                },
                {
                    instruction: "⚽ Convivencia y respeto en el deporte:",
                    question: "En un partido de fútbol, tu equipo pierde 0-5. ¿Qué es lo correcto hacer?",
                    options: ["Felicitar al otro equipo y aprender de los errores", "Enfadarse y no hablar con nadie", "Decir que hicieron trampa", "Dejar de jugar al fútbol"],
                    correct: 0,
                    hint: "Piensa en cómo te gustaría que te trataran si tú ganaras. El respeto es importante.",
                    explanation: "Lo correcto es felicitar al otro equipo y aprender de los errores. Esto se llama DEPORTIVIDAD. Ganar y perder son parte de los juegos y de la vida. Lo importante es esforzarse, mejorar y respetar a los demás. ¡Los grandes campeones también pierden a veces! 🤝⚽"
                },
                {
                    instruction: "🌍 Servicios de la comunidad con Pokemon:",
                    question: "Si Pikachu se enferma, Ash lo lleva al Centro Pokemon. En nuestra ciudad, ¿a dónde vamos cuando estamos enfermos?",
                    options: ["Al hospital o centro de salud", "Al ayuntamiento", "A la escuela", "Al parque"],
                    correct: 0,
                    hint: "Piensa en el lugar donde trabajan médicos y enfermeras para curar a las personas.",
                    explanation: "Vamos al HOSPITAL o CENTRO DE SALUD cuando estamos enfermos. Es un servicio público muy importante. Allí trabajan médicos, enfermeras y otros profesionales para cuidar nuestra salud. ¡Es como el Centro Pokemon pero para humanos! 🏥👨‍⚕️"
                }
            ]
        };

        const achievements = [
            { id: 'first_day', name: '¡Primer Día Genial!', description: 'Completa tu primer día de ejercicios', icon: '🌟' },
            { id: 'week_warrior', name: 'Guerrero de la Semana', description: 'Completa una semana completa', icon: '⚔️' },
            { id: 'perfect_score', name: 'Perfección Total', description: 'Consigue 100% en todos los ejercicios de un día', icon: '💯' },
            { id: 'streak_5', name: 'Racha de Fuego', description: 'Mantén una racha de 5 días', icon: '🔥' },
            { id: 'streak_10', name: 'Imparable', description: 'Mantén una racha de 10 días', icon: '⚡' },
            { id: 'math_master', name: 'Maestro de Mates', description: 'Completa 20 ejercicios de matemáticas', icon: '🧮' },
            { id: 'reading_pro', name: 'Súper Lector', description: 'Completa 20 ejercicios de lectura', icon: '📚' },
            { id: 'science_genius', name: 'Genio Científico', description: 'Completa 20 ejercicios de ciencias', icon: '🔬' },
            { id: 'social_expert', name: 'Experto Social', description: 'Completa 20 ejercicios de sociales', icon: '🌍' },
            { id: 'century_club', name: 'Club del Centenar', description: 'Completa 100 ejercicios en total', icon: '💪' },
            { id: 'speed_demon', name: 'Rayo Veloz', description: 'Completa un día en menos de 20 minutos', icon: '⚡' }
        ];

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            statusElement.className = 'connection-status ' + status;
            
            const statusMessages = {
                'online': '✅ Conectado',
                'offline': '⚠️ Desconectado',
                'connecting': '🔄 Conectando...',
                'error': '❌ Error'
            };
            
            statusText.textContent = statusMessages[status] || 'Desconocido';
        }

        function createNewUser() {
            return {
                totalPoints: 0,
                streak: 0,
                lastActiveDate: null,
                achievements: [],
                completedDays: [],
                totalExercises: 0,
                correctAnswers: 0,
                exercisesByType: {
                    math: 0,
                    reading: 0,
                    science: 0,
                    social: 0
                },
                dailyProgress: {}
            };
        }

        function ensureUserDataStructure(userData) {
            if (!userData) return createNewUser();
            
            // Asegurar que existan todas las propiedades
            if (!userData.exercisesByType) {
                userData.exercisesByType = {
                    math: 0,
                    reading: 0,
                    science: 0,
                    social: 0
                };
            }
            if (!userData.achievements) userData.achievements = [];
            if (!userData.completedDays) userData.completedDays = [];
            if (typeof userData.totalPoints !== 'number') userData.totalPoints = 0;
            if (typeof userData.streak !== 'number') userData.streak = 0;
            if (typeof userData.totalExercises !== 'number') userData.totalExercises = 0;
            if (typeof userData.correctAnswers !== 'number') userData.correctAnswers = 0;
            
            return userData;
        }

        // ==================== FUNCIONES DE NORMALIZACIÓN ====================
        
        /**
         * Normaliza la estructura de datos de un usuario al formato estándar
         * Maneja tanto el formato antiguo como el nuevo
         */
        function normalizeUserData(userData, username) {
            console.log(`🔧 Normalizando datos para usuario: ${username}`);
            
            // Si ya tiene la estructura correcta, solo asegurar campos
            const normalized = ensureUserDataStructure(userData);
            
            // Convertir completedDays (string array) a array si es necesario
            if (normalized.completedDays && typeof normalized.completedDays === 'object' && !Array.isArray(normalized.completedDays)) {
                // Si completedDays es un objeto en lugar de array, convertirlo
                normalized.completedDays = Object.values(normalized.completedDays).filter(v => typeof v === 'string');
            }
            
            // Asegurar que completedDays sea un array
            if (!Array.isArray(normalized.completedDays)) {
                normalized.completedDays = [];
            }
            
            console.log('✅ Datos normalizados para', username);
            return normalized;
        }

        /**
         * Limpia y normaliza toda la estructura de datos
         * MANTIENE usuarios en la raíz como en el archivo original
         * Mueve usuarios que estén dentro de un objeto 'users' a la raíz
         */
        function cleanAndNormalizeAllData(data) {
            console.log('🧹 Iniciando limpieza y normalización de datos...');
            
            const cleaned = {};
            
            // Campos del sistema que no son usuarios
            const systemFields = ['currentWeek', 'currentDay', 'currentExercise', 'stars', 
                                 'correctAnswers', 'daysCompleted', 'completedDays', 'startTime',
                                 'currentColor', 'totalFailures', 'currentExerciseFailures',
                                 'failuresByExercise', 'exerciseAttempts', 'users'];
            
            // Primero, si hay un objeto 'users', mover sus usuarios a la raíz
            if (data.users && typeof data.users === 'object') {
                console.log('⚠️ Detectado objeto "users" - moviendo usuarios a la raíz');
                Object.keys(data.users).forEach(username => {
                    console.log(`🔄 Moviendo usuario de users.${username} a raíz`);
                    cleaned[username] = normalizeUserData(data.users[username], username);
                });
            }
            
            // Procesar todos los campos en la raíz
            Object.keys(data).forEach(key => {
                const value = data[key];
                
                // Si es un campo del sistema, ignorarlo (no lo necesitamos en la nueva estructura)
                if (systemFields.includes(key)) {
                    return;
                }
                
                // Si parece datos de usuario (tiene campos como totalPoints, streak, etc.)
                if (value && typeof value === 'object' && 
                    (value.totalPoints !== undefined || value.streak !== undefined || 
                     value.achievements !== undefined || value.totalExercises !== undefined ||
                     value.completedDays !== undefined)) {
                    
                    console.log(`👤 Usuario encontrado en raíz: ${key}`);
                    // Si ya lo procesamos desde 'users', no sobrescribir
                    if (!cleaned[key]) {
                        cleaned[key] = normalizeUserData(value, key);
                    }
                }
            });
            
            console.log('✅ Limpieza completada. Usuarios encontrados:', Object.keys(cleaned));
            return cleaned;
        }
        
        // ==================== FIN FUNCIONES DE NORMALIZACIÓN ====================

        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            
            if (!username) {
                alert('¡Por favor escribe tu nombre de entrenador súper genial! 😊');
                return;
            }
            
            appState.currentUser = username;
            document.getElementById('currentUserDisplay').textContent = username;
            
            updateConnectionStatus('connecting');
            await loadUserData();
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            updateUserInterface();
            generateWeeks();
            
            // Cargar las pestañas iniciales
            loadStats();
            loadAchievements();
            loadRanking();
        }

        async function loadUserData() {
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('📦 Datos recibidos del servidor:', data.record);
                    
                    // ====== APLICAR LIMPIEZA Y NORMALIZACIÓN ======
                    appState.allUsersData = cleanAndNormalizeAllData(data.record || {});
                    console.log('✨ Datos normalizados:', appState.allUsersData);
                    
                    if (!appState.allUsersData[appState.currentUser]) {
                        appState.allUsersData[appState.currentUser] = createNewUser();
                    }
                    
                    appState.userData = normalizeUserData(appState.allUsersData[appState.currentUser], appState.currentUser);
                    
                    // Guardar la versión limpia de vuelta al servidor
                    await saveUserData();
                    
                    updateConnectionStatus('online');
                    checkStreak();
                } else {
                    throw new Error('Error al cargar datos');
                }
            } catch (error) {
                console.error('Error:', error);
                updateConnectionStatus('error');
                
                appState.allUsersData[appState.currentUser] = createNewUser();
                appState.userData = ensureUserDataStructure(appState.allUsersData[appState.currentUser]);
            }
        }

        async function saveUserData() {
            try {
                appState.allUsersData[appState.currentUser] = appState.userData;
                
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    },
                    body: JSON.stringify(appState.allUsersData)
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                } else {
                    throw new Error('Error al guardar');
                }
            } catch (error) {
                console.error('Error al guardar:', error);
                updateConnectionStatus('error');
            }
        }

        function checkStreak() {
            const today = new Date().toDateString();
            const lastActive = appState.userData.lastActiveDate;
            
            if (!lastActive) {
                appState.userData.streak = 0;
                return;
            }
            
            const lastDate = new Date(lastActive);
            const diffTime = new Date(today) - lastDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 1) {
                appState.userData.streak = 0;
            }
        }

        function updateUserInterface() {
            const userData = appState.userData || createNewUser();
            
            document.getElementById('userName').textContent = appState.currentUser || 'Entrenador';
            document.getElementById('userAvatar').textContent = appState.currentUser ? appState.currentUser[0].toUpperCase() : '🎮';
            document.getElementById('totalPoints').textContent = userData.totalPoints || 0;
            document.getElementById('streak').textContent = userData.streak || 0;
            document.getElementById('achievements').textContent = (userData.achievements && userData.achievements.length) || 0;
            
            const level = Math.floor(userData.totalPoints / 100) + 1;
            const levelNames = {
                1: 'Novato Genial',
                2: 'Aprendiz Súper',
                3: 'Estudiante Pro',
                4: 'Experto Total',
                5: 'Maestro Pokemon',
                10: '¡CAMPEÓN LEGENDARIO!'
            };
            const levelName = levelNames[Math.min(level, 10)] || `Nivel ${level}`;
            document.getElementById('userLevel').textContent = `Nivel ${level} - ${levelName}`;
        }

        function generateWeeks() {
            const container = document.getElementById('weeksContainer');
            container.innerHTML = '';
            
            const today = new Date();
            const weeks = 1;
            
            for (let week = 0; week < weeks; week++) {
                const weekDiv = document.createElement('div');
                weekDiv.style.marginBottom = '40px';
                
                const weekHeader = document.createElement('h3');
                weekHeader.style.fontFamily = "'Fredoka One', cursive";
                weekHeader.style.fontSize = '24px';
                weekHeader.style.marginBottom = '20px';
                weekHeader.style.color = '#2d3436';
                weekHeader.textContent = `🌟 Semana ${week + 1}`;
                weekDiv.appendChild(weekHeader);
                
                const grid = document.createElement('div');
                grid.className = 'calendar-grid';
                
                const dayNames = ['L', 'M', 'X', 'J', 'V', 'S', 'D'];
                dayNames.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'day-header';
                    header.textContent = day;
                    grid.appendChild(header);
                });
                
                const startDate = new Date(today);
                startDate.setDate(today.getDate() - today.getDay() + 1 + (week * 7));
                
                const firstDayOfWeek = startDate.getDay() === 0 ? 6 : startDate.getDay() - 1;
                
                for (let i = 0; i < firstDayOfWeek; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'day-cell empty';
                    grid.appendChild(emptyCell);
                }
                
                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + day);
                    
                    const dayCell = document.createElement('div');
                    dayCell.className = 'day-cell';
                    
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'day-number';
                    dayNumber.textContent = currentDate.getDate();
                    dayCell.appendChild(dayNumber);
                    
                    const dateKey = currentDate.toDateString();
                    const isCompleted = appState.userData.completedDays.includes(dateKey);
                    const isToday = dateKey === today.toDateString();
                    const isPast = currentDate < today && !isToday;
                    const isFuture = currentDate > today;
                    
                    const statusIcon = document.createElement('div');
                    statusIcon.className = 'day-status';
                    
                    if (isCompleted) {
                        dayCell.classList.add('completed');
                        statusIcon.textContent = '✅';
                    } else if (isToday) {
                        dayCell.classList.add('current');
                        statusIcon.textContent = '🎯';
                    } else if (isFuture) {
                        dayCell.classList.add('disabled');
                        statusIcon.textContent = '🔒';
                    } else if (isPast) {
                        // Los días pasados NO completados están disponibles para recuperar
                        dayCell.classList.add('recoverable');
                        statusIcon.textContent = '📝';
                    }
                    
                    dayCell.appendChild(statusIcon);
                    
                    // Permitir click en día actual O días pasados no completados
                    if ((isToday || isPast) && !isCompleted) {
                        dayCell.onclick = () => startDayExercises(dateKey);
                        dayCell.style.cursor = 'pointer';
                    }
                    
                    grid.appendChild(dayCell);
                }
                
                weekDiv.appendChild(grid);
                container.appendChild(weekDiv);
            }
        }

        function generateDailyExercises() {
            const exercises = [];
            const subjects = ['math', 'reading', 'science', 'social'];
            
            // Crear un "seed" único para el día actual basado en la fecha
            const dateKey = appState.currentDay || new Date().toDateString();
            const seed = hashString(dateKey);
            
            subjects.forEach(subject => {
                const subjectExercises = exerciseBank[subject];
                const count = subject === 'math' || subject === 'reading' ? 3 : 2;
                
                // Usar el seed para obtener una selección determinística
                const shuffled = [...subjectExercises].sort((a, b) => {
                    const hashA = hashString(JSON.stringify(a) + seed);
                    const hashB = hashString(JSON.stringify(b) + seed);
                    return hashA - hashB;
                });
                
                for (let i = 0; i < count && i < shuffled.length; i++) {
                    exercises.push({
                        ...shuffled[i],
                        subject: subject
                    });
                }
            });
            
            // Mezclar los ejercicios de forma determinística
            return exercises.sort((a, b) => {
                const hashA = hashString(JSON.stringify(a) + seed);
                const hashB = hashString(JSON.stringify(b) + seed);
                return hashA - hashB;
            });
        }

        // Función para crear un hash simple y determinístico de una cadena
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convertir a entero de 32 bits
            }
            return Math.abs(hash);
        }

        function startDayExercises(dateKey) {
            appState.currentDay = dateKey;
            appState.currentExerciseIndex = 0;
            appState.currentExercises = generateDailyExercises();
            appState.sessionStartTime = Date.now();
            appState.timeRemaining = 1800;
            
            document.getElementById('exerciseModal').style.display = 'flex';
            updateProgressIndicator();
            startTimer();
            loadExercise();
        }

        function startTimer() {
            if (appState.timerInterval) {
                clearInterval(appState.timerInterval);
            }
            
            appState.timerInterval = setInterval(() => {
                appState.timeRemaining--;
                
                const minutes = Math.floor(appState.timeRemaining / 60);
                const seconds = appState.timeRemaining % 60;
                document.getElementById('timerDisplay').textContent = 
                    `⏱️ Tiempo: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (appState.timeRemaining <= 0) {
                    clearInterval(appState.timerInterval);
                    alert('⏰ ¡Se acabó el tiempo! Pero no te preocupes, ¡puedes seguir mañana! 💪');
                    closeExerciseModal();
                }
            }, 1000);
        }

        function updateProgressIndicator() {
            const container = document.getElementById('progressIndicator');
            container.innerHTML = '';
            
            appState.currentExercises.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (index < appState.currentExerciseIndex) {
                    dot.classList.add('completed');
                } else if (index === appState.currentExerciseIndex) {
                    dot.classList.add('current');
                }
                container.appendChild(dot);
            });
        }

        function loadExercise() {
            const exercise = appState.currentExercises[appState.currentExerciseIndex];
            const container = document.getElementById('exerciseContainer');
            
            document.getElementById('exerciseTitle').textContent = 
                `Ejercicio ${appState.currentExerciseIndex + 1} de ${appState.currentExercises.length}`;
            
            const badges = document.getElementById('subjectBadges');
            badges.innerHTML = `<span class="subject-badge ${exercise.subject}">${getSubjectName(exercise.subject)}</span>`;
            
            document.getElementById('hintBox').classList.remove('visible');
            document.getElementById('feedbackBox').classList.remove('visible');
            document.getElementById('explanationBox').classList.remove('visible');
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('hintBtn').style.display = 'inline-block';
            appState.selectedAnswer = null;
            
            container.innerHTML = '';
            
            // Instrucción
            if (exercise.instruction) {
                const instructionDiv = document.createElement('div');
                instructionDiv.className = 'instruction-box';
                instructionDiv.innerHTML = `
                    <h4>📋 Instrucciones</h4>
                    <p>${exercise.instruction}</p>
                `;
                container.appendChild(instructionDiv);
            }
            
            // Texto de lectura LARGO si existe
            if (exercise.passage) {
                const passageDiv = document.createElement('div');
                passageDiv.className = 'reading-passage';
                
                if (exercise.passageTitle) {
                    passageDiv.innerHTML = `<h4>${exercise.passageTitle}</h4>`;
                }
                
                const paragraphs = exercise.passage.split('\n\n');
                paragraphs.forEach(para => {
                    const p = document.createElement('p');
                    p.textContent = para;
                    passageDiv.appendChild(p);
                });
                
                container.appendChild(passageDiv);
            }
            
            // Pregunta
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-container';
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = exercise.question;
            questionDiv.appendChild(questionText);
            
            // Opciones
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';
            
            exercise.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => selectOption(index);
                optionsContainer.appendChild(btn);
            });
            
            questionDiv.appendChild(optionsContainer);
            container.appendChild(questionDiv);
        }

        function getSubjectName(subject) {
            const names = {
                'math': '🧮 Matemáticas',
                'reading': '📖 Lengua',
                'science': '🔬 Ciencias Naturales',
                'social': '🌍 Ciencias Sociales'
            };
            return names[subject] || subject;
        }

        function selectOption(index) {
            document.querySelectorAll('.option-btn').forEach((btn, i) => {
                btn.classList.remove('selected');
                if (i === index) {
                    btn.classList.add('selected');
                }
            });
            appState.selectedAnswer = index;
        }

        function showHint() {
            const exercise = appState.currentExercises[appState.currentExerciseIndex];
            document.getElementById('hintText').textContent = exercise.hint;
            document.getElementById('hintBox').classList.add('visible');
        }

        function checkAnswer() {
            const exercise = appState.currentExercises[appState.currentExerciseIndex];
            
            if (appState.selectedAnswer === null) {
                alert('¡Por favor selecciona una respuesta primero! 😊');
                return;
            }
            
            const isCorrect = appState.selectedAnswer === exercise.correct;
            
            document.querySelectorAll('.option-btn').forEach((btn, index) => {
                btn.style.pointerEvents = 'none';
                if (index === exercise.correct) {
                    btn.classList.add('correct');
                } else if (index === appState.selectedAnswer && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });
            
            appState.userData.totalExercises++;
            appState.userData.exercisesByType[exercise.subject]++;
            
            if (isCorrect) {
                appState.userData.correctAnswers++;
                appState.userData.totalPoints += 10;
                showFeedback(true, exercise);
            } else {
                showFeedback(false, exercise);
            }
            
            showExplanation(exercise);
            
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
            document.getElementById('hintBtn').style.display = 'none';
            
            updateUserInterface();
        }

        function showFeedback(isCorrect, exercise) {
            const feedbackBox = document.getElementById('feedbackBox');
            const feedbackText = document.getElementById('feedbackText');
            
            feedbackBox.className = 'feedback-box visible';
            
            if (isCorrect) {
                feedbackBox.classList.add('correct');
                const messages = [
                    '🎉 ¡Súper correcto! ¡Eres genial!',
                    '⭐ ¡Perfecto! ¡Lo has clavado!',
                    '🌟 ¡Increíble! ¡Sigue así!',
                    '💪 ¡Excelente trabajo, campeón!',
                    '🏆 ¡Bravo! ¡Eres un crack!'
                ];
                feedbackText.textContent = messages[Math.floor(Math.random() * messages.length)];
            } else {
                feedbackBox.classList.add('incorrect');
                const correctAnswerText = exercise.options[exercise.correct];
                
                feedbackText.innerHTML = `
                    ❌ ¡Ups! No es correcto esta vez.<br>
                    <span style="font-size: 16px; margin-top: 10px; display: block;">
                        La respuesta correcta es: <strong>${correctAnswerText}</strong><br>
                        ¡No te preocupes, sigue intentándolo! 💪
                    </span>
                `;
            }
        }

        function showExplanation(exercise) {
            const explanationBox = document.getElementById('explanationBox');
            const explanationText = document.getElementById('explanationText');
            
            if (exercise.explanation) {
                explanationText.textContent = exercise.explanation;
                explanationBox.classList.add('visible');
            }
        }

        function nextExercise() {
            appState.currentExerciseIndex++;
            
            if (appState.currentExerciseIndex >= appState.currentExercises.length) {
                completeDayExercises();
            } else {
                updateProgressIndicator();
                loadExercise();
            }
        }

        function completeDayExercises() {
            clearInterval(appState.timerInterval);
            
            const dateKey = appState.currentDay;
            if (!appState.userData.completedDays.includes(dateKey)) {
                appState.userData.completedDays.push(dateKey);
            }
            
            const today = new Date().toDateString();
            if (!appState.userData.lastActiveDate || new Date(appState.userData.lastActiveDate).toDateString() !== today) {
                appState.userData.streak++;
                appState.userData.lastActiveDate = today;
            }
            
            const timeTaken = (Date.now() - appState.sessionStartTime) / 1000;
            
            checkAchievements(timeTaken);
            saveUserData();
            
            alert(`🎉 ¡Súper bien hecho! ¡Has completado el día!\n\n⭐ Puntos ganados: ${appState.userData.totalPoints}\n🔥 Racha actual: ${appState.userData.streak} días`);
            
            closeExerciseModal();
            generateWeeks();
            updateUserInterface();
        }

        function checkAchievements(timeTaken) {
            const toCheck = [];
            
            if (appState.userData.completedDays.length === 1) {
                toCheck.push('first_day');
            }
            if (appState.userData.completedDays.length === 7) {
                toCheck.push('week_warrior');
            }
            if (appState.userData.streak === 5) {
                toCheck.push('streak_5');
            }
            if (appState.userData.streak === 10) {
                toCheck.push('streak_10');
            }
            if (appState.userData.exercisesByType.math >= 20) {
                toCheck.push('math_master');
            }
            if (appState.userData.exercisesByType.reading >= 20) {
                toCheck.push('reading_pro');
            }
            if (appState.userData.exercisesByType.science >= 20) {
                toCheck.push('science_genius');
            }
            if (appState.userData.exercisesByType.social >= 20) {
                toCheck.push('social_expert');
            }
            if (appState.userData.totalExercises >= 100) {
                toCheck.push('century_club');
            }
            if (timeTaken < 1200) {
                toCheck.push('speed_demon');
            }
            
            const accuracy = (appState.userData.correctAnswers / appState.userData.totalExercises) * 100;
            if (accuracy === 100 && appState.userData.totalExercises >= 10) {
                toCheck.push('perfect_score');
            }
            
            toCheck.forEach(achievementId => {
                if (!appState.userData.achievements.includes(achievementId)) {
                    unlockAchievement(achievementId);
                }
            });
        }

        function unlockAchievement(achievementId) {
            appState.userData.achievements.push(achievementId);
            const achievement = achievements.find(a => a.id === achievementId);
            
            if (achievement) {
                document.getElementById('unlockedIcon').textContent = achievement.icon;
                document.getElementById('unlockedName').textContent = achievement.name;
                document.getElementById('unlockedDescription').textContent = achievement.description;
                document.getElementById('achievementUnlock').classList.add('visible');
                
                setTimeout(() => {
                    document.getElementById('achievementUnlock').classList.remove('visible');
                }, 5000);
            }
        }

        function closeAchievementUnlock() {
            document.getElementById('achievementUnlock').classList.remove('visible');
        }

        function closeExerciseModal() {
            clearInterval(appState.timerInterval);
            document.getElementById('exerciseModal').style.display = 'none';
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'achievements') {
                loadAchievements();
            } else if (tabName === 'ranking') {
                loadRanking();
            }
        }

        function loadRanking() {
            const allUsers = Object.entries(appState.allUsersData);
            
            console.log('📊 Ranking - Total usuarios:', allUsers.length);
            console.log('📊 Usuarios:', allUsers);
            
            if (allUsers.length === 0) {
                showNoRankingData();
                return;
            }
            
            let filteredUsers = allUsers;
            let showingFiltered = false;
            
            if (appState.currentRankingFilter === 'week') {
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                const weekFiltered = allUsers.filter(([_, data]) => {
                    return data.completedDays && data.completedDays.some(day => new Date(day) >= weekAgo);
                });
                // Si hay resultados con el filtro, usarlos; si no, mostrar todos
                if (weekFiltered.length > 0) {
                    filteredUsers = weekFiltered;
                    showingFiltered = true;
                }
            } else if (appState.currentRankingFilter === 'month') {
                const monthAgo = new Date();
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                const monthFiltered = allUsers.filter(([_, data]) => {
                    return data.completedDays && data.completedDays.some(day => new Date(day) >= monthAgo);
                });
                // Si hay resultados con el filtro, usarlos; si no, mostrar todos
                if (monthFiltered.length > 0) {
                    filteredUsers = monthFiltered;
                    showingFiltered = true;
                }
            }
            
            console.log('📊 Usuarios filtrados:', filteredUsers.length);
            
            const sortedUsers = filteredUsers.sort((a, b) => {
                const aAchievements = a[1].achievements ? a[1].achievements.length : 0;
                const bAchievements = b[1].achievements ? b[1].achievements.length : 0;
                if (bAchievements !== aAchievements) {
                    return bAchievements - aAchievements;
                }
                return (b[1].totalPoints || 0) - (a[1].totalPoints || 0);
            });
            
            const podiumContainer = document.getElementById('podiumContainer');
            const tableContainer = document.getElementById('rankingTableContainer');
            podiumContainer.innerHTML = '';
            tableContainer.innerHTML = '';
            
            // Mostrar mensaje si estamos filtrando sin resultados del filtro
            if (!showingFiltered && appState.currentRankingFilter !== 'all') {
                const notice = document.createElement('div');
                notice.style.cssText = 'text-align: center; padding: 15px; background: #ffeaa7; border-radius: 15px; margin-bottom: 20px; border: 3px solid #fdcb6e;';
                notice.innerHTML = '<p style="font-weight: 700; color: #2d3436; margin: 0;">ℹ️ No hay actividad en este periodo. Mostrando todos los usuarios.</p>';
                podiumContainer.parentElement.insertBefore(notice, podiumContainer);
            }
            
            // PODIO - Mostrar top 3 (o menos si hay menos usuarios)
            const top3 = sortedUsers.slice(0, 3);
            if (top3.length > 0) {
                const podium = document.createElement('div');
                podium.className = 'podium';
                
                const positions = ['second', 'first', 'third'];
                const medals = ['🥈', '🥇', '🥉'];
                
                // Si solo hay 1 o 2 usuarios, ajustar orden
                if (top3.length === 1) {
                    const [username, data] = top3[0];
                    const place = document.createElement('div');
                    place.className = 'podium-place first';
                    place.innerHTML = `
                        <div class="podium-rank">🥇</div>
                        <div class="podium-name">${username}</div>
                        <div class="podium-score">⭐ ${data.totalPoints || 0}</div>
                        <div class="podium-score">🏆 ${data.achievements ? data.achievements.length : 0}</div>
                    `;
                    podium.appendChild(place);
                } else if (top3.length === 2) {
                    [0, 1].forEach((index) => {
                        const [username, data] = top3[index];
                        const place = document.createElement('div');
                        place.className = `podium-place ${index === 0 ? 'first' : 'second'}`;
                        place.innerHTML = `
                            <div class="podium-rank">${medals[index]}</div>
                            <div class="podium-name">${username}</div>
                            <div class="podium-score">⭐ ${data.totalPoints || 0}</div>
                            <div class="podium-score">🏆 ${data.achievements ? data.achievements.length : 0}</div>
                        `;
                        podium.appendChild(place);
                    });
                } else {
                    // 3 o más usuarios - orden normal: 2do, 1ro, 3ro
                    [1, 0, 2].forEach((index, displayIndex) => {
                        if (top3[index]) {
                            const [username, data] = top3[index];
                            const place = document.createElement('div');
                            place.className = `podium-place ${positions[displayIndex]}`;
                            place.innerHTML = `
                                <div class="podium-rank">${medals[index]}</div>
                                <div class="podium-name">${username}</div>
                                <div class="podium-score">⭐ ${data.totalPoints || 0}</div>
                                <div class="podium-score">🏆 ${data.achievements ? data.achievements.length : 0}</div>
                            `;
                            podium.appendChild(place);
                        }
                    });
                }
                
                podiumContainer.appendChild(podium);
            }
            
            // TABLA - Mostrar el resto (posición 4 en adelante)
            const remainingUsers = sortedUsers.slice(3);
            if (remainingUsers.length > 0) {
                remainingUsers.forEach(([username, data], index) => {
                    const row = document.createElement('div');
                    row.className = 'ranking-row';
                    if (username === appState.currentUser) {
                        row.classList.add('current-user');
                    }
                    
                    row.innerHTML = `
                        <div class="ranking-position">#${index + 4}</div>
                        <div class="ranking-user">${username}</div>
                        <div class="ranking-stats">
                            <span>⭐ ${data.totalPoints || 0}</span>
                            <span>🏆 ${data.achievements ? data.achievements.length : 0}</span>
                            <span>🔥 ${data.streak || 0}</span>
                        </div>
                    `;
                    
                    tableContainer.appendChild(row);
                });
            } else if (sortedUsers.length <= 3) {
                // Si hay 3 o menos usuarios, mostrar un mensaje amigable
                tableContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 20px; border: 3px solid #74b9ff; margin-top: 20px;">
                        <div style="font-size: 60px; margin-bottom: 15px;">🎯</div>
                        <h4 style="font-family: 'Fredoka One', cursive; font-size: 20px; color: #2d3436; margin-bottom: 10px;">¡Top ${sortedUsers.length} de entrenadores!</h4>
                        <p style="font-size: 16px; color: #636e72; font-weight: 600;">¡Invita a más amigos para competir! 🚀</p>
                    </div>
                `;
            }
            
            console.log('📊 Ranking cargado - Podio:', top3.length, 'Tabla:', remainingUsers.length);
        }

        function setRankingFilter(filter) {
            appState.currentRankingFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadRanking();
        }

        function showNoRankingData() {
            const podiumContainer = document.getElementById('podiumContainer');
            const tableContainer = document.getElementById('rankingTableContainer');
            
            podiumContainer.innerHTML = '';
            tableContainer.innerHTML = `
                <div style="text-align: center; padding: 50px; background: white; border-radius: 20px; border: 3px solid #74b9ff;">
                    <div style="font-size: 80px; margin-bottom: 20px;">🌟</div>
                    <h3 style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #2d3436; margin-bottom: 15px;">¡Sé el primer súper entrenador!</h3>
                    <p style="font-size: 16px; color: #636e72; font-weight: 600;">Completa algunos ejercicios geniales para aparecer en el ranking de campeones.</p>
                </div>
            `;
        }

        function loadStats() {
            const content = document.getElementById('statsContent');
            const userData = appState.userData || createNewUser();
            
            console.log('📊 LoadStats - userData:', userData);
            console.log('📊 LoadStats - content element:', content);
            
            if (!content) {
                console.error('❌ No se encontró el elemento statsContent');
                return;
            }
            
            const accuracy = userData.totalExercises > 0 
                ? Math.round((userData.correctAnswers / userData.totalExercises) * 100)
                : 0;
            
            const allUsers = Object.entries(appState.allUsersData);
            const sortedByAchievements = allUsers.sort((a, b) => {
                const aAchievements = a[1].achievements ? a[1].achievements.length : 0;
                const bAchievements = b[1].achievements ? b[1].achievements.length : 0;
                if (bAchievements !== aAchievements) {
                    return bAchievements - aAchievements;
                }
                return (b[1].totalPoints || 0) - (a[1].totalPoints || 0);
            });
            
            const userRankPosition = sortedByAchievements.findIndex(([username]) => username === appState.currentUser) + 1;
            
            content.innerHTML = `
                <div class="stats-kids">
                    <div class="stat-card-big">
                        <div class="stat-icon-big">🎯</div>
                        <div class="stat-number-big">${userData.totalExercises}</div>
                        <div class="stat-label-big">Ejercicios Súper Completados</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">🏆</div>
                        <div class="stat-number-big">${userRankPosition > 0 ? `#${userRankPosition}` : '🌟'}</div>
                        <div class="stat-label-big">Mi Posición en el Ranking</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">🎖️</div>
                        <div class="stat-number-big">${userData.achievements.length}</div>
                        <div class="stat-label-big">Logros Súper Geniales</div>
                    </div>
                    
                    <div class="stat-card-big">
                        <div class="stat-icon-big">🔥</div>
                        <div class="stat-number-big">${userData.streak}</div>
                        <div class="stat-label-big">Días Seguidos Geniales</div>
                    </div>
                </div>
                
                <div style="margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 25px; border: 3px solid #74b9ff;">
                    <h3 style="font-family: 'Fredoka One', cursive; font-size: 28px; text-align: center; margin-bottom: 30px; color: #2d3436;">📊 ¡Mis Números Súper Geniales!</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #ff6b6b;">
                            <div style="font-size: 40px; margin-bottom: 10px;">🧮</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #ff6b6b;">${userData.exercisesByType.math || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Mates Geniales</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #4ecdc4;">
                            <div style="font-size: 40px; margin-bottom: 10px;">📖</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #4ecdc4;">${userData.exercisesByType.reading || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Súper Lectura</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #74b9ff;">
                            <div style="font-size: 40px; margin-bottom: 10px;">🔬</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #74b9ff;">${userData.exercisesByType.science || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Ciencias Naturales</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #a29bfe;">
                            <div style="font-size: 40px; margin-bottom: 10px;">🌍</div>
                            <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #a29bfe;">${userData.exercisesByType.social || 0}</div>
                            <div style="font-weight: 700; color: #636e72;">Ciencias Sociales</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadAchievements() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            const userData = appState.userData || createNewUser();
            
            achievements.forEach(achievement => {
                const isUnlocked = userData.achievements && userData.achievements.includes(achievement.id);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : ''}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <h4 style="font-family: 'Fredoka One', cursive; margin-bottom: 10px;">${achievement.name}</h4>
                    <p style="font-weight: 600; font-size: 14px;">${achievement.description}</p>
                    <div style="margin-top: 15px; font-size: 14px; font-weight: 700;">
                        ${isUnlocked ? '🎉 ¡DESBLOQUEADO!' : '🔐 Bloqueado'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        async function testConnection() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                    alert('✅ ¡Conexión súper exitosa con JSONBin.io! 🎉');
                    await loadUserData();
                } else {
                    updateConnectionStatus('error');
                    alert('❌ Error de conexión: ' + response.status);
                }
            } catch (error) {
                updateConnectionStatus('error');
                alert('❌ Error de red: ' + error.message);
            }
        }

        function resetProgress() {
            if (confirm('¿Estás súper seguro de que quieres empezar de nuevo? ¡Perderás todos tus logros geniales! 😱')) {
                appState.userData = createNewUser();
                saveUserData();
                updateUserInterface();
                generateWeeks();
                alert('🎉 ¡Progreso reiniciado! ¡Nueva aventura comenzando! 🚀');
            }
        }

        function exportData() {
            const dataToExport = {
                user: appState.currentUser,
                data: appState.userData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `academia_pokemon_${appState.currentUser}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('📥 ¡Datos súper descargados! 🎉');
        }

        async function deleteUser() {
            const confirmMessage = `⚠️ ATENCIÓN ⚠️\n\n¿Estás COMPLETAMENTE seguro de que quieres ELIMINAR tu usuario "${appState.currentUser}"?\n\nEsta acción:\n- Borrará PERMANENTEMENTE todos tus datos del servidor\n- NO se puede deshacer\n- Perderás TODOS tus puntos, logros y progreso\n\nEscribe "${appState.currentUser}" para confirmar:`;
            
            const confirmation = prompt(confirmMessage);
            
            if (confirmation === appState.currentUser) {
                try {
                    updateConnectionStatus('connecting');
                    
                    // Eliminar el usuario de allUsersData
                    delete appState.allUsersData[appState.currentUser];
                    
                    // Guardar en el servidor
                    const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': JSONBIN_CONFIG.masterKey
                        },
                        body: JSON.stringify(appState.allUsersData)
                    });
                    
                    if (response.ok) {
                        updateConnectionStatus('online');
                        alert('✅ Usuario eliminado correctamente del servidor.\n\n¡Hasta pronto! 👋');
                        
                        // Limpiar estado y volver al login
                        appState.currentUser = null;
                        appState.userData = null;
                        
                        document.getElementById('mainApp').style.display = 'none';
                        document.getElementById('loginScreen').style.display = 'flex';
                        document.getElementById('usernameInput').value = '';
                    } else {
                        throw new Error('Error al eliminar del servidor');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    updateConnectionStatus('error');
                    alert('❌ Error al eliminar el usuario del servidor.\n\nPor favor, inténtalo de nuevo.');
                }
            } else if (confirmation !== null) {
                alert('❌ Confirmación incorrecta. No se ha eliminado el usuario.');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎮 Academia Pokemon iniciada - Versión 4.0 FINAL');
            
            updateConnectionStatus('offline');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
        });
    </script>
</body>
</html>
