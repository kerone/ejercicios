<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academia Pokemon - Aprendizaje Divertido</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            font-size: 16px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üéÆ</text></svg>') no-repeat center;
            background-size: 200px;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-card h1 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .login-card input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 18px;
            font-family: inherit;
        }

        .login-card button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }

        .login-card button:hover {
            transform: scale(1.05);
        }

        .main-app {
            display: none;
        }

        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
        }

        .stats {
            display: flex;
            gap: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            min-width: 80px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .nav-tab:hover, .nav-tab.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .content-area {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .week-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .week-card:hover {
            transform: translateY(-5px);
        }

        .day-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .day-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .exercise-list {
            margin-top: 15px;
        }

        .exercise-item {
            background: #f8f9fa;
            padding: 8px;
            margin: 6px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .exercise-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 1000px;
            width: 95%;
            max-height: 95%;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .exercise-content {
            text-align: center;
        }

        .learning-hint {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 16px;
            text-align: left;
        }

        .learning-hint strong {
            color: #1976d2;
        }

        .question {
            font-size: 22px;
            margin-bottom: 20px;
            line-height: 1.6;
            text-align: left;
            background: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
        }

        .reading-text {
            background: #f3e5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 18px;
            line-height: 1.8;
            text-align: left;
            border: 2px solid #9c27b0;
        }

        .reading-text h4 {
            color: #7b1fa2;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .option {
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            font-size: 16px;
            text-align: center;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
            animation: correctPulse 0.6s ease-out;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            animation: incorrectShake 0.6s ease-out;
        }

        /* Estilos para ejercicios interactivos */
        .interactive-exercise {
            margin: 20px 0;
        }

        .drag-drop-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .draggable {
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: move;
            user-select: none;
            transition: all 0.3s;
        }

        .draggable:hover {
            background: #5a6fdb;
            transform: scale(1.05);
        }

        .draggable.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            min-height: 50px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 10px;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .drop-zone.drag-over {
            border-color: #667eea;
            background: #e3f2fd;
        }

        .drop-zone.filled {
            background: #d4edda;
            border-color: #28a745;
        }

        .sequence-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .sequence-item {
            width: 60px;
            height: 60px;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sequence-item:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .sequence-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .feedback {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            display: none;
            font-size: 16px;
            line-height: 1.5;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .next-btn {
            background: #667eea;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            display: none;
            font-family: inherit;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
        }

        .reward-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1001;
            animation: popup 0.5s ease-out;
        }

        @keyframes popup {
            from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .achievement-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #ddd;
        }

        .achievement-card.unlocked {
            border-color: #ffd700;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
        }

        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
        }

        .connection-status.online {
            background: #d4edda;
            color: #155724;
        }

        .connection-status.offline {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .stats {
                width: 100%;
                justify-content: center;
            }

            .nav-tabs {
                justify-content: center;
            }

            .modal-content {
                padding: 20px;
                margin: 10px;
                width: 98%;
            }

            .question {
                font-size: 18px;
            }

            .options {
                grid-template-columns: 1fr;
            }

            .day-grid {
                grid-template-columns: 1fr;
            }

            .draggable {
                font-size: 14px;
                padding: 8px 12px;
            }

            .sequence-container {
                gap: 5px;
            }

            .sequence-item {
                width: 50px;
                height: 50px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Indicador de conexi√≥n -->
    <div id="connectionStatus" class="connection-status offline">üîÑ Conectando...</div>

    <!-- Pantalla de Login -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1>üéÆ Academia Pokemon</h1>
            <p style="margin-bottom: 20px; color: #666;">¬°Convi√©rtete en el mejor entrenador de conocimientos!</p>
            <input type="text" id="usernameInput" placeholder="Escribe tu nombre de entrenador" maxlength="20">
            <button onclick="login()">¬°Comenzar Aventura! üöÄ</button>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="user-info">
                    <div class="avatar">üèÜ</div>
                    <div>
                        <h2 id="userName">Entrenador</h2>
                        <p>Nivel <span id="userLevel">1</span></p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPoints">0</div>
                        <div>Puntos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="streak">0</div>
                        <div>Racha</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="accuracy">0%</div>
                        <div>Precisi√≥n</div>
                    </div>
                </div>
                <button onclick="logout()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Salir</button>
            </div>

            <!-- Navegaci√≥n -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('training')">üéØ Entrenamiento</button>
                <button class="nav-tab" onclick="showTab('achievements')">üèÜ Logros</button>
                <button class="nav-tab" onclick="showTab('stats')">üìä Estad√≠sticas</button>
                <button class="nav-tab" onclick="showTab('admin')">‚öôÔ∏è Administrar</button>
            </div>

            <!-- √Årea de contenido -->
            <div class="content-area">
                <!-- Pesta√±a de Entrenamiento -->
                <div id="trainingTab" class="tab-content">
                    <h2>üóìÔ∏è Plan de Entrenamiento Semanal</h2>
                    <div class="week-grid" id="weekGrid"></div>
                    <div id="dayView" style="display: none;">
                        <button onclick="backToWeeks()" style="margin-bottom: 20px; padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer;">‚Üê Volver a Semanas</button>
                        <h3 id="dayTitle"></h3>
                        <div class="day-grid" id="dayGrid"></div>
                    </div>
                </div>

                <!-- Pesta√±a de Logros -->
                <div id="achievementsTab" class="tab-content" style="display: none;">
                    <h2>üèÜ Tus Logros de Entrenador</h2>
                    <div class="achievement-grid" id="achievementGrid"></div>
                </div>

                <!-- Pesta√±a de Estad√≠sticas -->
                <div id="statsTab" class="tab-content" style="display: none;">
                    <h2>üìä Estad√≠sticas Detalladas</h2>
                    <div id="statsContent"></div>
                </div>

                <!-- Pesta√±a de Administraci√≥n -->
                <div id="adminTab" class="tab-content" style="display: none;">
                    <h2>‚öôÔ∏è Panel de Administraci√≥n</h2>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4>üìä Estado de Guardado</h4>
                        <p>Los datos se guardan autom√°ticamente en JSONBin.io</p>
                        <p><strong>Usuario actual:</strong> <span id="currentUserAdmin"></span></p>
                        <p><strong>√öltima sincronizaci√≥n:</strong> <span id="lastSync">-</span></p>
                    </div>
                    <button onclick="testConnection()" style="padding: 15px 30px; background: #17a2b8; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">üîÑ Probar Conexi√≥n</button>
                    <button onclick="resetProgress()" style="padding: 15px 30px; background: #dc3545; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">üîÑ Reiniciar Progreso</button>
                    <button onclick="exportData()" style="padding: 15px 30px; background: #28a745; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; margin: 10px;">üì• Exportar Datos</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ejercicio -->
    <div id="exerciseModal" class="exercise-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeExercise()">√ó</button>
            <div class="exercise-content">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <h3 id="exerciseTitle"></h3>
                <div id="learningHint" class="learning-hint" style="display: none;"></div>
                <div id="readingText" class="reading-text" style="display: none;"></div>
                <div id="exerciseQuestion" class="question"></div>
                <div id="interactiveArea" class="interactive-exercise" style="display: none;"></div>
                <div id="exerciseOptions" class="options"></div>
                <div id="exerciseFeedback" class="feedback"></div>
                <button id="nextExerciseBtn" class="next-btn" onclick="nextExercise()">Siguiente</button>
            </div>
        </div>
    </div>

    <!-- Popup de Recompensa -->
    <div id="rewardPopup" class="reward-popup">
        <h2 id="rewardTitle"></h2>
        <div id="rewardIcon" style="font-size: 60px; margin: 20px 0;"></div>
        <p id="rewardMessage"></p>
        <button onclick="closeReward()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">¬°Genial!</button>
    </div>

    <script>
        // Configuraci√≥n de JSONBin
        const JSONBIN_CONFIG = {
            binId: '68ee144343b1c97be96704f9',
            masterKey: '$2a$10$byEkgCiPtr6uA9j.sw5Uiuld00jGPRMT1Rn9TlhHYbPe3CFfaEu6G',
            apiUrl: 'https://api.jsonbin.io/v3'
        };

        // Estado global de la aplicaci√≥n
        let appState = {
            currentUser: null,
            userData: {},
            currentExerciseSet: [],
            currentExerciseIndex: 0,
            currentSessionStats: { correct: 0, total: 0 },
            connectionStatus: 'offline'
        };

        // Base de datos de ejercicios AMPLIADA
        const exerciseDatabase = {
            week1: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>üí° Suma con llevadas:</strong> Cuando la suma de unidades es mayor que 9, "llevamos" a las decenas. Ejemplo: 47 + 28 = ?',
                        question: 'üî• Charizard ten√≠a 47 puntos de ataque. Despu√©s de entrenar intensamente con Ash, gan√≥ 28 puntos m√°s. ¬øCu√°ntos puntos de ataque tiene ahora?',
                        options: ['75 puntos', '65 puntos', '71 puntos', '79 puntos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 47 + 28 = 75. Recuerda: 7 + 8 = 15, escribimos 5 y llevamos 1. Luego 4 + 2 + 1 = 7.'
                    },
                    {
                        type: 'reading',
                        theme: 'pokemon',
                        learningHint: '<strong>üìö Comprensi√≥n lectora:</strong> Lee despacio y busca detalles espec√≠ficos. Subraya mentalmente las palabras importantes.',
                        readingText: '<h4>üîµ El Entrenamiento de Pikachu</h4>Pikachu es un Pok√©mon el√©ctrico muy especial que vive en los densos bosques verdes cerca de Pueblo Paleta. Cada ma√±ana temprano, a las 7:00, entrena sus habilidades el√©ctricas junto a Ash. Le encanta comer exactamente 12 bayas dulces rojas para desayunar, que encuentra en los √°rboles m√°s altos del bosque. Su ataque favorito es el "Rayo" porque puede generar hasta 100.000 voltios de electricidad con sus mejillas amarillas brillantes. Pikachu es extremadamente leal y siempre protege a sus amigos del peligro.',
                        question: '¬øCu√°ntas bayas rojas come Pikachu para desayunar cada ma√±ana?',
                        options: ['10 bayas', '12 bayas', '15 bayas', '8 bayas'],
                        correct: 1,
                        explanation: '¬°Excelente! El texto dice claramente que "come exactamente 12 bayas dulces rojas para desayunar". ¬°Has le√≠do con mucha atenci√≥n a los detalles!'
                    },
                    {
                        type: 'english',
                        theme: 'pokemon',
                        learningHint: '<strong>üá¨üáß Colores en ingl√©s:</strong> Los colores son palabras muy importantes. "Yellow" suena como "jelo" en espa√±ol.',
                        question: 'üü° Las mejillas de Pikachu son amarillas y brillantes. ¬øC√≥mo se dice "amarillo" en ingl√©s?',
                        options: ['Red', 'Blue', 'Yellow', 'Green'],
                        correct: 2,
                        explanation: '¬°Genial! "Yellow" significa amarillo en ingl√©s. Pikachu has yellow cheeks! (¬°Pikachu tiene mejillas amarillas!)'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n visual:</strong> 6 √ó 4 significa 6 grupos de 4 objetos. Imagina 6 filas de 4 Pok√©mon cada una.',
                        question: 'üéØ Ash tiene 6 Pok√©mon en su equipo. Cada Pok√©mon puede aprender exactamente 4 movimientos diferentes. ¬øCu√°ntos movimientos conoce todo su equipo?',
                        options: ['24 movimientos', '20 movimientos', '26 movimientos', '22 movimientos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 6 √ó 4 = 24 movimientos. Puedes pensarlo como sumar: 4 + 4 + 4 + 4 + 4 + 4 = 24.'
                    },
                    {
                        type: 'interactive',
                        theme: 'pokemon',
                        subtype: 'sequence',
                        learningHint: '<strong>üî¢ Secuencias num√©ricas:</strong> Observa el patr√≥n. Los n√∫meros pueden aumentar de 2 en 2, de 5 en 5, etc.',
                        question: 'üß© Ayuda a Ash a ordenar estos n√∫meros de Pok√©dex de menor a mayor:',
                        data: [25, 1, 150, 9, 144],
                        correctOrder: [1, 9, 25, 144, 150],
                        explanation: '¬°Excelente! Has ordenado correctamente: 1 (Bulbasaur), 9 (Blastoise), 25 (Pikachu), 144 (Articuno), 150 (Mewtwo).'
                    },
                    {
                        type: 'science',
                        theme: 'pokemon',
                        learningHint: '<strong>üî¨ Estados de la materia:</strong> S√≥lido (hielo), l√≠quido (agua), gas (vapor). El calor cambia el estado.',
                        question: 'üßä Cuando unPok√©mon de tipo hielo usa su ataque, convierte el agua l√≠quida en hielo s√≥lido. ¬øQu√© tipo de cambio de estado es este?',
                        options: ['Evaporaci√≥n', 'Solidificaci√≥n', 'Fusi√≥n', 'Condensaci√≥n'],
                        correct: 1,
                        explanation: '¬°Correcto! La solidificaci√≥n es cuando un l√≠quido (agua) se convierte en s√≥lido (hielo). ¬°Como los ataques de hielo de los Pok√©mon!'
                    },
                    {
                        type: 'geography',
                        theme: 'pokemon',
                        learningHint: '<strong>üó∫Ô∏è Puntos cardinales:</strong> Norte arriba, Sur abajo, Este derecha, Oeste izquierda. Como una br√∫jula.',
                        question: 'üß≠ Ash viaja desde Pueblo Paleta hacia Ciudad Plateada. Si va hacia donde sale el sol, ¬øen qu√© direcci√≥n se mueve?',
                        options: ['Norte', 'Sur', 'Este', 'Oeste'],
                        correct: 2,
                        explanation: '¬°Perfecto! El sol sale por el Este. Si Ash va hacia donde sale el sol, se dirige al Este.'
                    }
                ],
                day2: [
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>‚ûï Sumas con tres n√∫meros:</strong> Suma de dos en dos: primero 15 + 23 = 38, luego 38 + 17.',
                        question: '‚öîÔ∏è Eren cont√≥ titanes durante tres d√≠as consecutivos. El lunes vio 15 titanes, el martes 23 titanes, y el mi√©rcoles 17 titanes. ¬øCu√°ntos titanes observ√≥ en total?',
                        options: ['55 titanes', '53 titanes', '57 titanes', '52 titanes'],
                        correct: 0,
                        explanation: '¬°Correcto! 15 + 23 + 17 = 55 titanes. Paso a paso: 15 + 23 = 38, luego 38 + 17 = 55.'
                    },
                    {
                        type: 'reading',
                        theme: 'titans',
                        learningHint: '<strong>üß± Organizaci√≥n espacial:</strong> Imagina las murallas como c√≠rculos conc√©ntricos, una dentro de otra.',
                        readingText: '<h4>üè∞ El Sistema de Murallas Defensivas</h4>Las tres enormes murallas protegen a la humanidad de los gigantes titanes. La muralla exterior se llama Mar√≠a, tiene 50 metros de altura y es la primera l√≠nea de defensa contra los titanes. Dentro de Mar√≠a se encuentra la muralla Rose, de 45 metros de altura, que protege las ciudades intermedias. En el centro de todo est√° la muralla Sina, la m√°s peque√±a con 40 metros de altura, pero la m√°s segura, donde vive la familia real. Entre cada muralla hay aproximadamente 100 kil√≥metros de distancia.',
                        question: '¬øCu√°l es la altura de la muralla Rose?',
                        options: ['50 metros', '40 metros', '45 metros', '35 metros'],
                        correct: 2,
                        explanation: '¬°Muy bien! El texto dice claramente que "la muralla Rose, de 45 metros de altura". ¬°Has encontrado la informaci√≥n espec√≠fica!'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>üó£Ô∏è Palabras cognadas:</strong> "Giant" y "gigante" suenan parecido porque vienen de la misma ra√≠z latina.',
                        question: 'üóø Los titanes son criaturas gigantes y terror√≠ficas. ¬øC√≥mo se dice "gigante" en ingl√©s?',
                        options: ['Small', 'Giant', 'Tiny', 'Little'],
                        correct: 1,
                        explanation: '¬°Excelente! "Giant" significa gigante. ¬øNotaste que suena similar a "gigante" en espa√±ol?'
                    },
                    {
                        type: 'math',
                        theme: 'titans',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n pr√°ctica:</strong> 8 √ó 6 = 48. Piensa en 8 grupos de 6 soldados formados.',
                        question: 'üõ°Ô∏è El escuadr√≥n se organiza en 8 filas de soldados. En cada fila hay 6 soldados. ¬øCu√°ntos soldados hay en total en la formaci√≥n?',
                        options: ['48 soldados', '42 soldados', '54 soldados', '46 soldados'],
                        correct: 0,
                        explanation: '¬°Perfecto! 8 √ó 6 = 48 soldados. Es como sumar 6 ocho veces: 6+6+6+6+6+6+6+6 = 48.'
                    },
                    {
                        type: 'interactive',
                        theme: 'titans',
                        subtype: 'drag_drop',
                        learningHint: '<strong>üìè Unidades de medida:</strong> Metro para altura, kil√≥metro para distancias largas, gramo para peso.',
                        question: 'üìê Arrastra cada medida a la unidad correcta:',
                        data: {
                            items: ['Altura de muralla', 'Distancia entre ciudades', 'Peso de una espada'],
                            zones: ['Metros', 'Kil√≥metros', 'Gramos'],
                            correct: [0, 1, 2]
                        },
                        explanation: '¬°Genial! Altura se mide en metros, distancias largas en kil√≥metros, y peso en gramos.'
                    },
                    {
                        type: 'history',
                        theme: 'titans',
                        learningHint: '<strong>üèõÔ∏è √âpocas hist√≥ricas:</strong> Prehistoria (sin escritura), Edad Antigua (pir√°mides), Edad Media (castillos).',
                        question: 'üè∞ Las murallas de la serie recuerdan a las fortificaciones medievales. ¬øEn qu√© √©poca hist√≥rica se constru√≠an castillos y murallas defensivas?',
                        options: ['Prehistoria', 'Edad Antigua', 'Edad Media', 'Edad Moderna'],
                        correct: 2,
                        explanation: '¬°Correcto! En la Edad Media se constru√≠an castillos y murallas para defenderse. ¬°Como las murallas contra los titanes!'
                    },
                    {
                        type: 'body',
                        theme: 'titans',
                        learningHint: '<strong>üí™ Sistema muscular:</strong> Los m√∫sculos nos permiten moverse. Los soldados necesitan m√∫sculos fuertes.',
                        question: 'üí™ Los soldados de las murallas necesitan m√∫sculos fuertes para manejar sus equipos. ¬øQu√© parte del cuerpo humano permite el movimiento?',
                        options: ['Los huesos', 'Los m√∫sculos', 'La piel', 'Los nervios'],
                        correct: 1,
                        explanation: '¬°Perfecto! Los m√∫sculos son los que nos permiten movernos y hacer fuerza, como los soldados entrenados.'
                    }
                ],
                day3: [
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>‚ûï‚ûñ Operaciones combinadas:</strong> Primero suma todos los goles de cada equipo, luego resta para comparar.',
                        question: '‚öΩ En el partido de ayer, el Real Madrid meti√≥ 2 goles en el primer tiempo y 3 en el segundo. El Barcelona meti√≥ 1 gol en el primer tiempo y 3 en el segundo. ¬øCu√°l fue la diferencia de goles?',
                        options: ['1 gol', '2 goles', '0 goles', '3 goles'],
                        correct: 0,
                        explanation: '¬°Muy bien! Real Madrid: 2 + 3 = 5 goles. Barcelona: 1 + 3 = 4 goles. Diferencia: 5 - 4 = 1 gol a favor del Real Madrid.'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>üèÉ‚Äç‚ôÇÔ∏è Datos biogr√°ficos:</strong> Busca informaci√≥n espec√≠fica sobre la persona: origen, profesi√≥n, logros.',
                        readingText: '<h4>‚≠ê Lionel Messi: Una Leyenda del F√∫tbol</h4>Lionel Andr√©s Messi naci√≥ el 24 de junio de 1987 en Rosario, Argentina, una ciudad de Sudam√©rica. Comenz√≥ a jugar f√∫tbol profesional a los 17 a√±os en el FC Barcelona de Espa√±a. Messi es famoso mundialmente por ser un delantero extraordinariamente h√°bil con la pelota y por haber ganado 7 premios Bal√≥n de Oro, m√°s que cualquier otro jugador en la historia. Mide 1,70 metros de altura y es conocido por su incre√≠ble velocidad y t√©cnica de dribleo. En 2022 logr√≥ su mayor sue√±o: ganar la Copa del Mundo con Argentina.',
                        question: '¬øEn qu√© a√±o naci√≥ Lionel Messi seg√∫n el texto?',
                        options: ['1986', '1987', '1988', '1985'],
                        correct: 1,
                        explanation: '¬°Perfecto! El texto dice claramente que "naci√≥ el 24 de junio de 1987". ¬°Has le√≠do con mucha precisi√≥n!'
                    },
                    {
                        type: 'english',
                        theme: 'football',
                        learningHint: '<strong>‚öΩ Deportes en ingl√©s:</strong> "Ball" viene de la palabra germ√°nica para pelota. Se usa en muchos deportes.',
                        question: '‚öΩ En el f√∫tbol, los jugadores patean la pelota con los pies. ¬øC√≥mo se dice "pelota" en ingl√©s?',
                        options: ['Ball', 'Goal', 'Field', 'Player'],
                        correct: 0,
                        explanation: '¬°Genial! "Ball" significa pelota. Football = foot (pie) + ball (pelota) = f√∫tbol.'
                    },
                    {
                        type: 'math',
                        theme: 'football',
                        learningHint: '<strong>‚úñÔ∏è Problemas de multiplicaci√≥n:</strong> 11 jugadores √ó 2 equipos. Cada equipo tiene el mismo n√∫mero de jugadores.',
                        question: 'üë• En un partido oficial de f√∫tbol juegan 2 equipos completos. Cada equipo tiene 11 jugadores en el campo. ¬øCu√°ntos jugadores est√°n jugando en total?',
                        options: ['22 jugadores', '20 jugadores', '24 jugadores', '18 jugadores'],
                        correct: 0,
                        explanation: '¬°Excelente! 11 √ó 2 = 22 jugadores en total. Tambi√©n puedes sumar: 11 + 11 = 22.'
                    },
                    {
                        type: 'interactive',
                        theme: 'football',
                        subtype: 'sequence',
                        learningHint: '<strong>‚è∞ Tiempo en el deporte:</strong> Un partido dura 90 minutos: 45 + 45. Se divide en dos tiempos.',
                        question: '‚è±Ô∏è Ordena las fases de un partido de f√∫tbol:',
                        data: ['Segundo tiempo', 'Calentamiento', 'Primer tiempo', 'Descanso', 'Final del partido'],
                        correctOrder: ['Calentamiento', 'Primer tiempo', 'Descanso', 'Segundo tiempo', 'Final del partido'],
                        explanation: '¬°Perfecto! Has ordenado correctamente las fases de un partido de f√∫tbol.'
                    },
                    {
                        type: 'geography',
                        theme: 'football',
                        learningHint: '<strong>üåç Pa√≠ses y continentes:</strong> Argentina est√° en Sudam√©rica, Espa√±a en Europa.',
                        question: 'üåé Messi naci√≥ en Argentina. ¬øEn qu√© continente est√° Argentina?',
                        options: ['Europa', 'Sudam√©rica', '√Åfrica', 'Asia'],
                        correct: 1,
                        explanation: '¬°Correcto! Argentina est√° en Sudam√©rica, junto con pa√≠ses como Brasil, Chile y Per√∫.'
                    },
                    {
                        type: 'body',
                        theme: 'football',
                        learningHint: '<strong>ü¶µ Partes del cuerpo:</strong> Los futbolistas usan principalmente las piernas y los pies para jugar.',
                        question: 'ü¶∂ Los futbolistas necesitan tener piernas muy fuertes. ¬øCu√°l es el hueso m√°s largo del cuerpo humano?',
                        options: ['El h√∫mero (brazo)', 'El f√©mur (muslo)', 'La tibia (espinilla)', 'El radio (antebrazo)'],
                        correct: 1,
                        explanation: '¬°Perfecto! El f√©mur, que est√° en el muslo, es el hueso m√°s largo y fuerte del cuerpo humano.'
                    }
                ],
                day4: [
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>‚ûñ Resta con llevadas:</strong> Si necesitas quitar m√°s de lo que tienes en una posici√≥n, "pides prestado" a la siguiente.',
                        question: 'üî´ Un Tenno empieza su misi√≥n con 124 puntos de energ√≠a. Usa 67 puntos para sus habilidades especiales. ¬øCu√°nta energ√≠a le queda?',
                        options: ['57 puntos', '63 puntos', '51 puntos', '59 puntos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 124 - 67 = 57 puntos. En la resta: 4 - 7 no se puede, pido prestado: 14 - 7 = 7, luego 1 - 6 no se puede, pido prestado: 11 - 6 = 5.'
                    },
                    {
                        type: 'reading',
                        theme: 'warframe',
                        learningHint: '<strong>üöÄ Ciencia ficci√≥n:</strong> Busca informaci√≥n sobre tecnolog√≠a futurista y caracter√≠sticas especiales.',
                        readingText: '<h4>ü§ñ Los Guerreros Tenno del Futuro</h4>Los Tenno son antiguos guerreros espaciales que despertaron despu√©s de siglos durmiendo en criosue√±o. Utilizan armaduras bio-mec√°nicas llamadas Warframes que les otorgan poderes sobrenaturales √∫nicos. Existen m√°s de 50 tipos diferentes de Warframes: algunos se especializan en velocidad extrema como Volt, otros en fuerza bruta como Rhino, y algunos en sigilo como Ash. Cada Warframe puede usar hasta 4 habilidades especiales diferentes. Los Tenno protegen el Sistema Solar viajando entre planetas como Marte, Venus, J√∫piter y Saturno usando naves espaciales llamadas Orbiter.',
                        question: '¬øCu√°ntos tipos diferentes de Warframes existen seg√∫n el texto?',
                        options: ['M√°s de 40', 'Exactamente 50', 'M√°s de 50', 'Menos de 50'],
                        correct: 2,
                        explanation: '¬°Excelente! El texto dice "m√°s de 50 tipos diferentes de Warframes". ¬°Has le√≠do con mucha atenci√≥n!'
                    },
                    {
                        type: 'english',
                        theme: 'warframe',
                        learningHint: '<strong>üåå Vocabulario espacial:</strong> "Space" se relaciona con astronauta, spaceship (nave espacial).',
                        question: 'üåå Los Tenno son guerreros que luchan en el espacio exterior. ¬øC√≥mo se dice "espacio" en ingl√©s?',
                        options: ['Space', 'Time', 'World', 'Sky'],
                        correct: 0,
                        explanation: '¬°Perfecto! "Space" significa espacio. Outer space = espacio exterior, donde luchan los Tenno.'
                    },
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>‚úñÔ∏è Multiplicaci√≥n de dos cifras:</strong> 15 √ó 4 = (10 √ó 4) + (5 √ó 4) = 40 + 20 = 60.',
                        question: 'ü™ê Un Tenno debe completar misiones en 15 planetas diferentes. En cada planeta hay 4 misiones obligatorias. ¬øCu√°ntas misiones debe completar en total?',
                        options: ['60 misiones', '55 misiones', '65 misiones', '50 misiones'],
                        correct: 0,
                        explanation: '¬°Genial! 15 √ó 4 = 60 misiones. Puedes calcularlo como (10 √ó 4) + (5 √ó 4) = 40 + 20 = 60.'
                    },
                    {
                        type: 'interactive',
                        theme: 'warframe',
                        subtype: 'drag_drop',
                        learningHint: '<strong>üåå Sistema Solar:</strong> Los planetas tienen orden desde el Sol: Mercurio, Venus, Tierra, Marte...',
                        question: 'üåç Arrastra cada planeta a su posici√≥n correcta desde el Sol:',
                        data: {
                            items: ['Marte', 'Venus', 'Tierra'],
                            zones: ['2¬∫ planeta', '3¬∫ planeta', '4¬∫ planeta'],
                            correct: [1, 2, 0]
                        },
                        explanation: '¬°Perfecto! Venus (2¬∫), Tierra (3¬∫), Marte (4¬∫). Los Tenno luchan en todos estos mundos.'
                    },
                    {
                        type: 'science',
                        theme: 'warframe',
                        learningHint: '<strong>üåç El Sistema Solar:</strong> Hay 8 planetas que giran alrededor del Sol. Los m√°s cercanos son rocosos.',
                        question: 'üåç Los Tenno protegen el Sistema Solar. ¬øCu√°ntos planetas principales hay en nuestro Sistema Solar?',
                        options: ['7 planetas', '8 planetas', '9 planetas', '10 planetas'],
                        correct: 1,
                        explanation: '¬°Correcto! Hay 8 planetas: Mercurio, Venus, Tierra, Marte, J√∫piter, Saturno, Urano y Neptuno.'
                    },
                    {
                        type: 'technology',
                        theme: 'warframe',
                        learningHint: '<strong>üíª Tecnolog√≠a:</strong> Los robots y la inteligencia artificial son parte de la ciencia moderna.',
                        question: 'ü§ñ Los Warframes son como robots avanzados. ¬øC√≥mo se llama la ciencia que estudia los robots?',
                        options: ['Biolog√≠a', 'Rob√≥tica', 'Geolog√≠a', 'Astronom√≠a'],
                        correct: 1,
                        explanation: '¬°Perfecto! La rob√≥tica es la ciencia que estudia y desarrolla robots, como los Warframes futuristas.'
                    }
                ],
                day5: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚ûó Divisi√≥n exacta:</strong> Dividir es repartir en partes iguales. 24 √∑ 6 = 4 significa que cada grupo tiene 4.',
                        question: 'üî¥ Ash tiene 24 Pok√©balls nuevas y quiere repartirlas igualmente entre sus 6 amigos entrenadores. ¬øCu√°ntas Pok√©balls recibir√° cada amigo?',
                        options: ['4 Pok√©balls', '5 Pok√©balls', '3 Pok√©balls', '6 Pok√©balls'],
                        correct: 0,
                        explanation: '¬°Perfecto! 24 √∑ 6 = 4 Pok√©balls cada uno. Puedes comprobarlo: 4 √ó 6 = 24. ¬°Ash es muy generoso!'
                    },
                    {
                        type: 'reading',
                        theme: 'football',
                        learningHint: '<strong>ü•Ö Reglas deportivas:</strong> Presta atenci√≥n a las reglas especiales y las excepciones.',
                        readingText: '<h4>‚öΩ Las Reglas B√°sicas del F√∫tbol</h4>En un partido oficial de f√∫tbol, cada equipo tiene exactamente 11 jugadores en el campo simult√°neamente. De estos 11 jugadores, hay 10 jugadores de campo que pueden correr libremente por todo el terreno, pero tienen una regla muy importante: solo pueden tocar la pelota con los pies, la cabeza, el pecho y los hombros. Sin embargo, existe un jugador muy especial llamado portero o guardameta. El portero es el √∫nico jugador de todo el equipo que puede usar las manos para tocar la pelota, pero esta regla especial solo funciona cuando est√° dentro de su √°rea de penalti, que es un rect√°ngulo de 16,5 metros marcado frente a su porter√≠a.',
                        question: '¬øCu√°ntos jugadores de campo (sin contar el portero) hay en cada equipo?',
                        options: ['9 jugadores', '10 jugadores', '11 jugadores', '12 jugadores'],
                        correct: 1,
                        explanation: '¬°Correcto! Son 11 jugadores en total: 10 jugadores de campo + 1 portero = 11 jugadores por equipo.'
                    },
                    {
                        type: 'english',
                        theme: 'titans',
                        learningHint: '<strong>üß± Construcciones:</strong> "Wall" tambi√©n se usa en "Great Wall of China" (Gran Muralla China).',
                        question: 'üè∞ Las murallas protegen a la humanidad de los titanes. ¬øC√≥mo se dice "muralla" o "muro" en ingl√©s?',
                        options: ['Wall', 'Door', 'Window', 'Roof'],
                        correct: 0,
                        explanation: '¬°Excelente! "Wall" significa muro o muralla. The Great Wall = La Gran Muralla (de China).'
                    },
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>üî¢ Fracciones b√°sicas:</strong> 1/2 es la mitad, 1/3 es un tercio, 1/4 es un cuarto.',
                        question: 'üçé Pikachu tiene 8 bayas para comer. Si se come la mitad en el desayuno, ¬øcu√°ntas bayas se comi√≥?',
                        options: ['4 bayas', '3 bayas', '5 bayas', '2 bayas'],
                        correct: 0,
                        explanation: '¬°Perfecto! La mitad de 8 es 4. La mitad (1/2) significa dividir entre 2: 8 √∑ 2 = 4 bayas.'
                    },
                    {
                        type: 'interactive',
                        theme: 'mixed',
                        subtype: 'sequence',
                        learningHint: '<strong>üìÖ D√≠as de la semana:</strong> Lunes es el primer d√≠a laborable, domingo el √∫ltimo d√≠a del fin de semana.',
                        question: 'üìÖ Ordena los d√≠as de la semana correctamente:',
                        data: ['Mi√©rcoles', 'Lunes', 'Viernes', 'Martes', 'Jueves'],
                        correctOrder: ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'],
                        explanation: '¬°Genial! Has ordenado perfectamente los d√≠as laborables de la semana.'
                    },
                    {
                        type: 'grammar',
                        theme: 'pokemon',
                        learningHint: '<strong>üìù Nombres propios:</strong> Los nombres de personas, lugares y Pok√©mon se escriben con may√∫scula inicial.',
                        question: '‚úèÔ∏è ¬øCu√°l de estas palabras debe escribirse con may√∫scula inicial?',
                        options: ['pelota', 'pikachu', 'amarillo', 'r√°pido'],
                        correct: 1,
                        explanation: '¬°Correcto! "Pikachu" es un nombre propio (de un Pok√©mon espec√≠fico) y se debe escribir con may√∫scula: Pikachu.'
                    },
                    {
                        type: 'values',
                        theme: 'mixed',
                        learningHint: '<strong>‚ù§Ô∏è Valores sociales:</strong> El respeto, la ayuda mutua y la honestidad son valores importantes.',
                        question: 'ü§ù Ash siempre ayuda a sus amigos cuando tienen problemas. ¬øQu√© valor positivo demuestra Ash?',
                        options: ['Ego√≠smo', 'Solidaridad', 'Envidia', 'Pereza'],
                        correct: 1,
                        explanation: '¬°Perfecto! Ash demuestra solidaridad al ayudar a sus amigos. La solidaridad es ayudar a otros sin esperar nada a cambio.'
                    }
                ]
            },
            week2: {
                day1: [
                    {
                        type: 'math',
                        theme: 'pokemon',
                        learningHint: '<strong>‚úñÔ∏è Tablas de multiplicar:</strong> La tabla del 7 es: 7√ó1=7, 7√ó2=14, 7√ó3=21, 7√ó4=28, 7√ó5=35.',
                        question: 'üî• Charizard entrena 7 horas cada d√≠a durante 5 d√≠as seguidos. ¬øCu√°ntas horas entren√≥ en total?',
                        options: ['35 horas', '32 horas', '40 horas', '28 horas'],
                        correct: 0,
                        explanation: '¬°Correcto! 7 √ó 5 = 35 horas. La tabla del 7: 7√ó5 = 35. ¬°Charizard entrena much√≠simo!'
                    },
                    {
                        type: 'reading',
                        theme: 'titans',
                        learningHint: '<strong>üìä Datos num√©ricos:</strong> Cuando leas textos con n√∫meros, an√≥talos mentalmente o subr√°yalos.',
                        readingText: '<h4>‚öîÔ∏è La Gran Expedici√≥n Exploratoria</h4>El comandante Erwin organiz√≥ la expedici√≥n m√°s grande de la historia para explorar m√°s all√° de la muralla Mar√≠a. La expedici√≥n estaba compuesta por 150 soldados de √©lite montados a caballo, divididos en 3 escuadrones de 50 soldados cada uno. Llevaban provisiones para 12 d√≠as de viaje y partieron al amanecer del d√≠a 15 de marzo. Durante las primeras 6 horas de viaje, avanzaron 42 kil√≥metros sin encontrar ning√∫n tit√°n. Sin embargo, al mediod√≠a descubrieron las huellas de un tit√°n gigante de 15 metros de altura que hab√≠a pasado por all√≠ recientemente.',
                        question: '¬øCu√°ntos kil√≥metros avanzaron durante las primeras 6 horas?',
                        options: ['40 kil√≥metros', '45 kil√≥metros', '42 kil√≥metros', '38 kil√≥metros'],
                        correct: 2,
                        explanation: '¬°Excelente! El texto dice "avanzaron 42 kil√≥metros sin encontrar ning√∫n tit√°n". ¬°Has prestado atenci√≥n a los detalles num√©ricos!'
                    },
                    {
                        type: 'english',
                        theme: 'football',
                        learningHint: '<strong>üèÉ‚Äç‚ôÇÔ∏è Verbos de movimiento:</strong> "Run" (correr), "walk" (caminar), "jump" (saltar).',
                        question: 'üèÉ‚Äç‚ôÇÔ∏è Los futbolistas corren muy r√°pido por el campo durante 90 minutos. ¬øC√≥mo se dice "correr" en ingl√©s?',
                        options: ['Walk', 'Run', 'Stop', 'Sit'],
                        correct: 1,
                        explanation: '¬°Genial! "Run" significa correr. Football players run fast! (¬°Los futbolistas corren r√°pido!)'
                    },
                    {
                        type: 'math',
                        theme: 'warframe',
                        learningHint: '<strong>üî¢ N√∫meros grandes:</strong> 1.000 = mil, 10.000 = diez mil, 100.000 = cien mil.',
                        question: 'üî´ Un Tenno ha completado misiones y ganado 1.250 puntos de experiencia en la primera semana y 2.375 puntos en la segunda semana. ¬øCu√°ntos puntos tiene en total?',
                        options: ['3.625 puntos', '3.525 puntos', '3.725 puntos', '3.500 puntos'],
                        correct: 0,
                        explanation: '¬°Perfecto! 1.250 + 2.375 = 3.625 puntos. Suma las unidades, luego decenas, centenas y miles.'
                    },
                    {
                        type: 'interactive',
                        theme: 'science',
                        subtype: 'drag_drop',
                        learningHint: '<strong>üî¨ Estados de la materia:</strong> S√≥lido (forma fija), l√≠quido (toma forma del recipiente), gas (llena todo el espacio).',
                        question: 'üß™ Clasifica estos elementos seg√∫n su estado:',
                        data: {
                            items: ['Hielo', 'Vapor de agua', 'Agua del grifo'],
                            zones: ['S√≥lido', 'L√≠quido', 'Gas'],
                            correct: [0, 2, 1]
                        },
                        explanation: '¬°Excelente! Hielo = s√≥lido, agua = l√≠quido, vapor = gas. ¬°Son el mismo elemento en diferentes estados!'
                    },
                    {
                        type: 'geography',
                        theme: 'football',
                        learningHint: '<strong>üó∫Ô∏è Capitales de Espa√±a:</strong> Madrid es la capital, Barcelona es en Catalu√±a, Sevilla en Andaluc√≠a.',
                        question: 'üèõÔ∏è El Real Madrid juega en la capital de Espa√±a. ¬øCu√°l es la capital de Espa√±a?',
                        options: ['Barcelona', 'Madrid', 'Sevilla', 'Valencia'],
                        correct: 1,
                        explanation: '¬°Correcto! Madrid es la capital de Espa√±a, donde juega el Real Madrid en el estadio Santiago Bernab√©u.'
                    },
                    {
                        type: 'nature',
                        theme: 'pokemon',
                        learningHint: '<strong>üå± Partes de las plantas:</strong> Ra√≠z (bajo tierra), tallo (soporte), hojas (respiran), flores (reproducci√≥n).',
                        question: 'üå≥ Pikachu busca bayas en los √°rboles del bosque. ¬øQu√© parte de la planta produce las frutas y bayas?',
                        options: ['Las ra√≠ces', 'El tallo', 'Las hojas', 'Las flores'],
                        correct: 3,
                        explanation: '¬°Perfecto! Las flores se transforman en frutos y bayas despu√©s de la polinizaci√≥n. ¬°Por eso Pikachu encuentra bayas donde antes hab√≠a flores!'
                    },
                    {
                        type: 'money',
                        theme: 'pokemon',
                        learningHint: '<strong>üí∞ Euros y c√©ntimos:</strong> 1 euro = 100 c√©ntimos. Para sumar dinero, suma euros con euros y c√©ntimos con c√©ntimos.',
                        question: 'üí∞ Ash compra 3 Pok√©balls que cuestan 1,50 euros cada una. ¬øCu√°nto paga en total?',
                        options: ['4,50 euros', '4,00 euros', '5,00 euros', '3,50 euros'],
                        correct: 0,
                        explanation: '¬°Genial! 3 √ó 1,50 = 4,50 euros. Tambi√©n puedes pensarlo como 1,50 + 1,50 + 1,50 = 4,50 euros.'
                    }
                ]
            }
        };

        // Logros disponibles AMPLIADOS
        const achievements = [
            { id: 'first_exercise', name: 'Primer Paso', description: 'Completa tu primer ejercicio', icon: 'üéØ', requirement: 1 },
            { id: 'math_master', name: 'Maestro Matem√°tico', description: 'Completa 20 ejercicios de matem√°ticas', icon: 'üßÆ', requirement: 20 },
            { id: 'reading_hero', name: 'H√©roe de la Lectura', description: 'Completa 20 ejercicios de comprensi√≥n lectora', icon: 'üìö', requirement: 20 },
            { id: 'english_expert', name: 'Experto en Ingl√©s', description: 'Completa 15 ejercicios de ingl√©s', icon: 'üá¨üáß', requirement: 15 },
            { id: 'perfect_day', name: 'D√≠a Perfecto', description: 'Completa todos los ejercicios de un d√≠a sin errores', icon: '‚≠ê', requirement: 1 },
            { id: 'streak_week', name: 'Racha Semanal', description: 'Mant√©n una racha de 7 d√≠as', icon: 'üî•', requirement: 7 },
            { id: 'multiplication_master', name: 'Maestro de la Multiplicaci√≥n', description: 'Completa 15 ejercicios de multiplicaci√≥n correctos', icon: '‚úñÔ∏è', requirement: 15 },
            { id: 'reading_champion', name: 'Campe√≥n de Lectura', description: 'Lee 25 textos completos', icon: 'üëë', requirement: 25 },
            { id: 'interactive_genius', name: 'Genio Interactivo', description: 'Completa 10 ejercicios interactivos', icon: 'üß©', requirement: 10 },
            { id: 'science_explorer', name: 'Explorador Cient√≠fico', description: 'Completa 10 ejercicios de ciencias', icon: 'üî¨', requirement: 10 },
            { id: 'speed_demon', name: 'Demonio de Velocidad', description: 'Completa un d√≠a en menos de 20 minutos', icon: '‚ö°', requirement: 1 },
            { id: 'hundred_club', name: 'Club de los 100', description: 'Alcanza 100 ejercicios completados', icon: 'üíØ', requirement: 100 }
        ];

        // Funciones de autenticaci√≥n
        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('¬°Por favor escribe tu nombre!');
                return;
            }
            
            appState.currentUser = username;
            await loadUserData();
            showMainApp();
        }

        function logout() {
            if (confirm('¬øEst√°s seguro de que quieres salir?')) {
                appState.currentUser = null;
                appState.userData = {};
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        }

        // Gesti√≥n de datos con JSONBin
        async function loadUserData() {
            updateConnectionStatus('connecting');
            try {
                console.log('Cargando datos del usuario:', appState.currentUser);
                
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Respuesta del servidor:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Datos recibidos:', data);
                    
                    const users = data.record?.users || {};
                    appState.userData = users[appState.currentUser] || createNewUser();
                    
                    console.log('Datos del usuario cargados:', appState.userData);
                    updateConnectionStatus('online');
                } else {
                    console.log('Error en respuesta, creando usuario nuevo');
                    appState.userData = createNewUser();
                    updateConnectionStatus('offline');
                }
            } catch (error) {
                console.error('Error cargando datos:', error);
                appState.userData = createNewUser();
                updateConnectionStatus('offline');
            }
            
            updateLastSyncTime();
        }

        async function saveUserData() {
            try {
                console.log('Guardando datos del usuario:', appState.currentUser);
                updateConnectionStatus('saving');
                
                let allData = { users: {} };
                
                try {
                    const getCurrentResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': JSONBIN_CONFIG.masterKey,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (getCurrentResponse.ok) {
                        const currentData = await getCurrentResponse.json();
                        allData = currentData.record || { users: {} };
                    }
                } catch (error) {
                    console.log('No se pudieron obtener datos existentes, creando estructura nueva');
                }
                
                if (!allData.users) {
                    allData.users = {};
                }
                allData.users[appState.currentUser] = {
                    ...appState.userData,
                    lastSaved: new Date().toISOString()
                };
                
                console.log('Datos a guardar:', allData);
                
                const saveResponse = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    },
                    body: JSON.stringify(allData)
                });
                
                if (saveResponse.ok) {
                    console.log('‚úÖ Datos guardados exitosamente en JSONBin');
                    updateConnectionStatus('online');
                    updateLastSyncTime();
                } else {
                    console.error('‚ùå Error al guardar:', saveResponse.status);
                    updateConnectionStatus('error');
                }
                
            } catch (error) {
                console.error('‚ùå Error guardando datos:', error);
                updateConnectionStatus('error');
            }
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            appState.connectionStatus = status;
            
            switch (status) {
                case 'online':
                    statusElement.textContent = '‚úÖ Conectado';
                    statusElement.className = 'connection-status online';
                    break;
                case 'offline':
                    statusElement.textContent = '‚ùå Sin conexi√≥n';
                    statusElement.className = 'connection-status offline';
                    break;
                case 'connecting':
                    statusElement.textContent = 'üîÑ Conectando...';
                    statusElement.className = 'connection-status offline';
                    break;
                case 'saving':
                    statusElement.textContent = 'üíæ Guardando...';
                    statusElement.className = 'connection-status online';
                    break;
                case 'error':
                    statusElement.textContent = '‚ö†Ô∏è Error de conexi√≥n';
                    statusElement.className = 'connection-status offline';
                    break;
            }
        }

        function updateLastSyncTime() {
            const now = new Date().toLocaleString('es-ES');
            const adminElement = document.getElementById('lastSync');
            if (adminElement) {
                adminElement.textContent = now;
            }
        }

        async function testConnection() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                    alert('‚úÖ Conexi√≥n exitosa con JSONBin.io');
                } else {
                    updateConnectionStatus('error');
                    alert('‚ùå Error de conexi√≥n: ' + response.status);
                }
            } catch (error) {
                updateConnectionStatus('error');
                alert('‚ùå Error de red: ' + error.message);
            }
        }

        function createNewUser() {
            return {
                level: 1,
                totalPoints: 0,
                streak: 0,
                totalExercises: 0,
                correctAnswers: 0,
                exercisesByType: { 
                    math: 0, reading: 0, english: 0, interactive: 0, 
                    science: 0, geography: 0, history: 0, body: 0, 
                    technology: 0, grammar: 0, values: 0, nature: 0, money: 0 
                },
                exercisesByTheme: { pokemon: 0, titans: 0, football: 0, warframe: 0, mixed: 0 },
                multiplicationExercises: 0,
                textsRead: 0,
                interactiveExercises: 0,
                perfectDays: 0,
                fastestDay: null,
                completedExercises: {},
                achievements: [],
                sessionStartTime: null,
                created: new Date().toISOString(),
                lastActivity: new Date().toISOString()
            };
        }

        // Interfaz principal
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUserInterface();
            generateWeeks();
            
            const adminUser = document.getElementById('currentUserAdmin');
            if (adminUser) {
                adminUser.textContent = appState.currentUser;
            }
        }

        function updateUserInterface() {
            document.getElementById('userName').textContent = appState.currentUser;
            document.getElementById('userLevel').textContent = appState.userData.level;
            document.getElementById('totalPoints').textContent = appState.userData.totalPoints;
            document.getElementById('streak').textContent = appState.userData.streak;
            
            const accuracy = appState.userData.totalExercises > 0 
                ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100)
                : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // Gesti√≥n de pesta√±as
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'achievements') {
                loadAchievements();
            } else if (tabName === 'stats') {
                loadStats();
            }
        }

        // Generaci√≥n de semanas
        function generateWeeks() {
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';
            
            const availableWeeks = Object.keys(exerciseDatabase).length;
            
            for (let week = 1; week <= availableWeeks; week++) {
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card';
                weekCard.onclick = () => showWeek(week);
                
                const completedDays = getCompletedDaysInWeek(week);
                const totalDays = 5;
                
                weekCard.innerHTML = `
                    <h3>üóìÔ∏è Semana ${week}</h3>
                    <p>Progreso: ${completedDays}/${totalDays} d√≠as completados</p>
                    <div style="margin-top: 15px;">
                        <div style="background: rgba(255,255,255,0.3); height: 8px; border-radius: 4px;">
                            <div style="background: white; height: 100%; width: ${(completedDays/totalDays)*100}%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; font-size: 14px;">üéØ ${getTotalExercisesInWeek(week)} ejercicios por d√≠a</p>
                `;
                
                weekGrid.appendChild(weekCard);
            }
        }

        function getTotalExercisesInWeek(week) {
            const weekKey = `week${week}`;
            if (exerciseDatabase[weekKey] && exerciseDatabase[weekKey].day1) {
                return exerciseDatabase[weekKey].day1.length;
            }
            return 4;
        }

        function getCompletedDaysInWeek(week) {
            let completed = 0;
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${week}_day${day}`;
                if (appState.userData.completedExercises[dayKey]) {
                    completed++;
                }
            }
            return completed;
        }

        function showWeek(weekNumber) {
            document.getElementById('weekGrid').style.display = 'none';
            document.getElementById('dayView').style.display = 'block';
            
            const dayGrid = document.getElementById('dayGrid');
            dayGrid.innerHTML = '';
            
            const days = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'];
            
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${weekNumber}_day${day}`;
                const isCompleted = appState.userData.completedExercises[dayKey];
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                if (isCompleted) {
                    dayCard.style.background = 'linear-gradient(135deg, #d4edda, #c3e6cb)';
                    dayCard.style.borderLeft = '5px solid #28a745';
                }
                
                dayCard.onclick = () => startDay(weekNumber, day);
                
                const exercises = getDayExercises(weekNumber, day);
                const exerciseList = exercises.map(ex => `
                    <div class="exercise-item">
                        <span>${getExerciseIcon(ex.type)} ${getExerciseTitle(ex.type, ex.theme)}</span>
                        <span>${isCompleted ? '‚úÖ' : '‚è≥'}</span>
                    </div>
                `).join('');
                
                const timeEstimate = Math.ceil(exercises.length * 4); // 4 minutos por ejercicio aproximadamente
                
                dayCard.innerHTML = `
                    <h4>${days[day-1]} - D√≠a ${day}</h4>
                    <p style="color: #666; margin-bottom: 15px;">üïê ~${timeEstimate} minutos | ${exercises.length} ejercicios</p>
                    <div class="exercise-list">
                        ${exerciseList}
                    </div>
                    ${isCompleted ? '<div style="margin-top: 15px; color: #28a745; font-weight: bold;">üéâ ¬°D√≠a completado!</div>' : ''}
                `;
                
                dayGrid.appendChild(dayCard);
            }
        }

        function backToWeeks() {
            document.getElementById('weekGrid').style.display = 'grid';
            document.getElementById('dayView').style.display = 'none';
        }

        function getDayExercises(week, day) {
            const weekKey = `week${week}`;
            const dayKey = `day${day}`;
            
            if (exerciseDatabase[weekKey] && exerciseDatabase[weekKey][dayKey]) {
                return exerciseDatabase[weekKey][dayKey];
            }
            
            // Si no hay ejercicios, usar ejercicios base
            return exerciseDatabase.week1.day1.slice(0, 4);
        }

        function getExerciseIcon(type) {
            const icons = {
                math: 'üßÆ',
                reading: 'üìñ',
                english: 'üá¨üáß',
                interactive: 'üß©',
                science: 'üî¨',
                geography: 'üåç',
                history: 'üèõÔ∏è',
                body: 'ü´Ä',
                technology: 'üíª',
                grammar: '‚úèÔ∏è',
                values: '‚ù§Ô∏è',
                nature: 'üå±',
                money: 'üí∞'
            };
            return icons[type] || 'üìù';
        }

        function getExerciseTitle(type, theme) {
            const titles = {
                math: 'Matem√°ticas',
                reading: 'Comprensi√≥n Lectora',
                english: 'Ingl√©s',
                interactive: 'Ejercicio Interactivo',
                science: 'Ciencias Naturales',
                geography: 'Geograf√≠a',
                history: 'Historia',
                body: 'Cuerpo Humano',
                technology: 'Tecnolog√≠a',
                grammar: 'Gram√°tica',
                values: 'Valores',
                nature: 'Naturaleza',
                money: 'Dinero'
            };
            
            const themes = {
                pokemon: 'Pok√©mon',
                titans: 'Titanes',
                football: 'F√∫tbol',
                warframe: 'Warframe',
                mixed: 'Variado'
            };
            
            return `${titles[type]} - ${themes[theme] || 'General'}`;
        }

        // Sistema de ejercicios MEJORADO
        function startDay(week, day) {
            const exercises = getDayExercises(week, day);
            appState.currentExerciseSet = exercises;
            appState.currentExerciseIndex = 0;
            appState.currentSessionStats = { 
                correct: 0, 
                total: 0, 
                week, 
                day,
                startTime: new Date().getTime()
            };
            
            showExercise();
        }

        function showExercise() {
            const modal = document.getElementById('exerciseModal');
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            
            document.getElementById('exerciseTitle').textContent = getExerciseTitle(exercise.type, exercise.theme);
            
            // Mostrar pista de aprendizaje
            const hintElement = document.getElementById('learningHint');
            if (exercise.learningHint) {
                hintElement.innerHTML = exercise.learningHint;
                hintElement.style.display = 'block';
            } else {
                hintElement.style.display = 'none';
            }
            
            // Mostrar texto de lectura si existe
            const readingElement = document.getElementById('readingText');
            if (exercise.readingText) {
                readingElement.innerHTML = exercise.readingText;
                readingElement.style.display = 'block';
                appState.userData.textsRead++;
            } else {
                readingElement.style.display = 'none';
            }
            
            document.getElementById('exerciseQuestion').innerHTML = exercise.question;
            
            // Ocultar elementos por defecto
            document.getElementById('exerciseOptions').style.display = 'none';
            document.getElementById('interactiveArea').style.display = 'none';
            document.getElementById('exerciseFeedback').style.display = 'none';
            document.getElementById('nextExerciseBtn').style.display = 'none';
            
            // Mostrar contenido seg√∫n el tipo de ejercicio
            if (exercise.type === 'interactive') {
                showInteractiveExercise(exercise);
            } else {
                showNormalExercise(exercise);
            }
            
            // Actualizar barra de progreso
            const progress = ((appState.currentExerciseIndex + 1) / appState.currentExerciseSet.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            modal.style.display = 'flex';
        }

        function showNormalExercise(exercise) {
            const optionsContainer = document.getElementById('exerciseOptions');
            optionsContainer.style.display = 'grid';
            optionsContainer.innerHTML = '';
            
            exercise.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
        }

        function showInteractiveExercise(exercise) {
            const interactiveArea = document.getElementById('interactiveArea');
            interactiveArea.style.display = 'block';
            
            if (exercise.subtype === 'sequence') {
                createSequenceExercise(exercise);
            } else if (exercise.subtype === 'drag_drop') {
                createDragDropExercise(exercise);
            }
        }

        function createSequenceExercise(exercise) {
            const interactiveArea = document.getElementById('interactiveArea');
            let selectedOrder = [];
            
            interactiveArea.innerHTML = `
                <div class="sequence-container" id="sequenceItems"></div>
                <div style="margin: 20px 0;">
                    <p><strong>Orden seleccionado:</strong></p>
                    <div id="selectedOrder" style="min-height: 40px; border: 2px dashed #ccc; padding: 10px; border-radius: 8px; margin: 10px 0;"></div>
                </div>
                <button onclick="checkSequence()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">Comprobar Orden</button>
                <button onclick="resetSequence()" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-left: 10px;">Reiniciar</button>
            `;
            
            const container = document.getElementById('sequenceItems');
            const shuffledData = [...exercise.data].sort(() => Math.random() - 0.5);
            
            shuffledData.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sequence-item';
                itemDiv.textContent = item;
                itemDiv.onclick = () => selectSequenceItem(item, itemDiv);
                container.appendChild(itemDiv);
            });
            
            window.currentExercise = exercise;
            window.selectedOrder = selectedOrder;
        }

        function selectSequenceItem(item, element) {
            if (element.classList.contains('selected')) return;
            
            element.classList.add('selected');
            window.selectedOrder.push(item);
            
            const orderDisplay = document.getElementById('selectedOrder');
            orderDisplay.innerHTML = window.selectedOrder.map((item, index) => 
                `<span style="background: #667eea; color: white; padding: 5px 10px; border-radius: 5px; margin: 2px; display: inline-block;">${index + 1}. ${item}</span>`
            ).join('');
        }

        function checkSequence() {
            const exercise = window.currentExercise;
            const isCorrect = JSON.stringify(window.selectedOrder) === JSON.stringify(exercise.correctOrder);
            
            handleInteractiveResult(isCorrect, exercise.explanation);
        }

        function resetSequence() {
            window.selectedOrder = [];
            document.getElementById('selectedOrder').innerHTML = '';
            document.querySelectorAll('.sequence-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        function createDragDropExercise(exercise) {
            const interactiveArea = document.getElementById('interactiveArea');
            
            interactiveArea.innerHTML = `
                <div class="drag-drop-area">
                    <div style="margin-bottom: 20px;">
                        <h4>Arrastra los elementos:</h4>
                        <div id="draggableItems" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 15px 0;"></div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4>A las zonas correctas:</h4>
                        <div id="dropZones" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0;"></div>
                    </div>
                </div>
                <button onclick="checkDragDrop()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-top: 15px;">Comprobar</button>
            `;
            
            const itemsContainer = document.getElementById('draggableItems');
            const zonesContainer = document.getElementById('dropZones');
            
            // Crear elementos arrastrables
            exercise.data.items.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'draggable';
                itemDiv.textContent = item;
                itemDiv.draggable = true;
                itemDiv.dataset.index = index;
                
                itemDiv.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', index);
                    itemDiv.classList.add('dragging');
                });
                
                itemDiv.addEventListener('dragend', () => {
                    itemDiv.classList.remove('dragging');
                });
                
                itemsContainer.appendChild(itemDiv);
            });
            
            // Crear zonas de soltar
            exercise.data.zones.forEach((zone, index) => {
                const zoneDiv = document.createElement('div');
                zoneDiv.className = 'drop-zone';
                zoneDiv.innerHTML = `<strong>${zone}</strong>`;
                zoneDiv.dataset.zoneIndex = index;
                
                zoneDiv.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zoneDiv.classList.add('drag-over');
                });
                
                zoneDiv.addEventListener('dragleave', () => {
                    zoneDiv.classList.remove('drag-over');
                });
                
                zoneDiv.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const itemIndex = e.dataTransfer.getData('text/plain');
                    const itemElement = document.querySelector(`[data-index="${itemIndex}"]`);
                    
                    // Limpiar zona anterior si el elemento ya estaba colocado
                    const currentZone = itemElement.parentElement;
                    if (currentZone.classList.contains('drop-zone')) {
                        currentZone.classList.remove('filled');
                    }
                    
                    // Colocar en nueva zona
                    zoneDiv.appendChild(itemElement);
                    zoneDiv.classList.remove('drag-over');
                    zoneDiv.classList.add('filled');
                });
                
                zonesContainer.appendChild(zoneDiv);
            });
            
            window.currentExercise = exercise;
        }

        function checkDragDrop() {
            const exercise = window.currentExercise;
            const dropZones = document.querySelectorAll('.drop-zone');
            let userAnswers = [];
            let allPlaced = true;
            
            dropZones.forEach((zone, zoneIndex) => {
                const item = zone.querySelector('.draggable');
                if (item) {
                    userAnswers[zoneIndex] = parseInt(item.dataset.index);
                } else {
                    allPlaced = false;
                }
            });
            
            if (!allPlaced) {
                alert('¬°Coloca todos los elementos en las zonas antes de comprobar!');
                return;
            }
            
            const isCorrect = JSON.stringify(userAnswers) === JSON.stringify(exercise.data.correct);
            handleInteractiveResult(isCorrect, exercise.explanation);
        }

        function handleInteractiveResult(isCorrect, explanation) {
            const feedback = document.getElementById('exerciseFeedback');
            
            appState.currentSessionStats.total++;
            appState.userData.interactiveExercises++;
            
            if (isCorrect) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = 'üéâ ' + explanation;
                appState.currentSessionStats.correct++;
                appState.userData.correctAnswers++;
                appState.userData.totalPoints += 15; // M√°s puntos por ejercicios interactivos
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '‚ùå ' + explanation;
            }
            
            feedback.style.display = 'block';
            document.getElementById('nextExerciseBtn').style.display = 'inline-block';
            
            // Actualizar estad√≠sticas
            appState.userData.totalExercises++;
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            appState.userData.exercisesByType[exercise.type]++;
            appState.userData.exercisesByTheme[exercise.theme]++;
            appState.userData.lastActivity = new Date().toISOString();
            
            saveUserData();
        }

        function selectOption(selectedIndex) {
            const exercise = appState.currentExerciseSet[appState.currentExerciseIndex];
            const options = document.querySelectorAll('.option');
            const feedback = document.getElementById('exerciseFeedback');
            
            options.forEach(option => option.onclick = null);
            
            appState.currentSessionStats.total++;
            
            if (selectedIndex === exercise.correct) {
                options[selectedIndex].classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = 'üéâ ' + exercise.explanation;
                appState.currentSessionStats.correct++;
                
                appState.userData.correctAnswers++;
                appState.userData.totalPoints += 10;
                
                // Puntos extra por multiplicaci√≥n
                if (exercise.question.includes('√ó') || exercise.question.includes('multiplicar')) {
                    appState.userData.multiplicationExercises++;
                    appState.userData.totalPoints += 5;
                }
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[exercise.correct].classList.add('correct');
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '‚ùå ' + exercise.explanation;
            }
            
            appState.userData.totalExercises++;
            appState.userData.exercisesByType[exercise.type]++;
            appState.userData.exercisesByTheme[exercise.theme]++;
            appState.userData.lastActivity = new Date().toISOString();
            
            feedback.style.display = 'block';
            document.getElementById('nextExerciseBtn').style.display = 'inline-block';
            
            saveUserData();
        }

        function nextExercise() {
            appState.currentExerciseIndex++;
            
            if (appState.currentExerciseIndex < appState.currentExerciseSet.length) {
                showExercise();
            } else {
                completeDay();
            }
        }

        function completeDay() {
            const { week, day, correct, total, startTime } = appState.currentSessionStats;
            const dayKey = `week${week}_day${day}`;
            const endTime = new Date().getTime();
            const duration = Math.round((endTime - startTime) / 1000 / 60); // minutos
            
            appState.userData.completedExercises[dayKey] = {
                completed: true,
                score: correct,
                total: total,
                duration: duration,
                date: new Date().toISOString()
            };
            
            // Actualizar racha
            if (correct === total) {
                appState.userData.streak++;
                appState.userData.perfectDays++;
            } else {
                appState.userData.streak = 0;
            }
            
            // Verificar d√≠a m√°s r√°pido
            if (correct === total && (!appState.userData.fastestDay || duration < appState.userData.fastestDay)) {
                appState.userData.fastestDay = duration;
            }
            
            checkAchievements();
            
            const newLevel = Math.floor(appState.userData.totalPoints / 150) + 1;
            if (newLevel > appState.userData.level) {
                appState.userData.level = newLevel;
                showReward('¬°Nivel Superior!', 'üÜô', `¬°Has alcanzado el nivel ${newLevel}!`);
            }
            
            closeExercise();
            saveUserData();
            updateUserInterface();
            generateWeeks();
            
            showDayComplete(correct, total, duration);
        }

        function showDayComplete(correct, total, duration) {
            const percentage = Math.round((correct / total) * 100);
            let message = '';
            let icon = '';
            
            if (percentage === 100) {
                message = '¬°Perfecto! ¬°Eres un verdadero maestro entrenador!';
                icon = 'üèÜ';
                if (duration <= 20) {
                    message += ' ¬°Y muy r√°pido!';
                }
            } else if (percentage >= 80) {
                message = '¬°Excelente trabajo! Casi perfecto.';
                icon = '‚≠ê';
            } else if (percentage >= 60) {
                message = '¬°Buen trabajo! Sigue practicando.';
                icon = 'üëç';
            } else {
                message = '¬°Sigue intentando! La pr√°ctica hace al maestro.';
                icon = 'üí™';
            }
            
            showReward('¬°D√≠a Completado!', icon, `${message}\nPuntuaci√≥n: ${correct}/${total} (${percentage}%)\nTiempo: ${duration} minutos`);
        }

        function closeExercise() {
            document.getElementById('exerciseModal').style.display = 'none';
        }

        // Sistema de logros AMPLIADO
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!appState.userData.achievements.includes(achievement.id)) {
                    let earned = false;
                    
                    switch (achievement.id) {
                        case 'first_exercise':
                            earned = appState.userData.totalExercises >= 1;
                            break;
                        case 'math_master':
                            earned = appState.userData.exercisesByType.math >= 20;
                            break;
                        case 'reading_hero':
                            earned = appState.userData.exercisesByType.reading >= 20;
                            break;
                        case 'english_expert':
                            earned = appState.userData.exercisesByType.english >= 15;
                            break;
                        case 'perfect_day':
                            earned = appState.currentSessionStats.correct === appState.currentSessionStats.total && appState.currentSessionStats.total > 0;
                            break;
                        case 'streak_week':
                            earned = appState.userData.streak >= 7;
                            break;
                        case 'multiplication_master':
                            earned = appState.userData.multiplicationExercises >= 15;
                            break;
                        case 'reading_champion':
                            earned = appState.userData.textsRead >= 25;
                            break;
                        case 'interactive_genius':
                            earned = appState.userData.interactiveExercises >= 10;
                            break;
                        case 'science_explorer':
                            earned = (appState.userData.exercisesByType.science || 0) >= 10;
                            break;
                        case 'speed_demon':
                            earned = appState.userData.fastestDay && appState.userData.fastestDay <= 20;
                            break;
                        case 'hundred_club':
                            earned = appState.userData.totalExercises >= 100;
                            break;
                    }
                    
                    if (earned) {
                        appState.userData.achievements.push(achievement.id);
                        showReward('¬°Nuevo Logro!', achievement.icon, `${achievement.name}\n${achievement.description}`);
                    }
                }
            });
        }

        function loadAchievements() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const isUnlocked = appState.userData.achievements.includes(achievement.id);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : ''}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <h4>${achievement.name}</h4>
                    <p>${achievement.description}</p>
                    <div style="margin-top: 10px; font-size: 12px; color: #666;">
                        ${isUnlocked ? '‚úÖ Desbloqueado' : 'üîí Bloqueado'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Estad√≠sticas detalladas AMPLIADAS
        function loadStats() {
            const content = document.getElementById('statsContent');
            const userData = appState.userData;
            
            const accuracy = userData.totalExercises > 0 
                ? Math.round((userData.correctAnswers / userData.totalExercises) * 100)
                : 0;
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="stat-card" style="padding: 20px;">
                        <h3>üìä Estad√≠sticas Generales</h3>
                        <p><strong>Ejercicios totales:</strong> ${userData.totalExercises}</p>
                        <p><strong>Respuestas correctas:</strong> ${userData.correctAnswers}</p>
                        <p><strong>Precisi√≥n:</strong> ${accuracy}%</p>
                        <p><strong>Puntos totales:</strong> ${userData.totalPoints}</p>
                        <p><strong>Racha actual:</strong> ${userData.streak} d√≠as</p>
                        <p><strong>Nivel:</strong> ${userData.level}</p>
                        <p><strong>D√≠as perfectos:</strong> ${userData.perfectDays || 0}</p>
                        <p><strong>D√≠a m√°s r√°pido:</strong> ${userData.fastestDay ? userData.fastestDay + ' minutos' : 'No disponible'}</p>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>üìö Por Materia</h3>
                        <p><strong>üßÆ Matem√°ticas:</strong> ${userData.exercisesByType.math || 0}</p>
                        <p><strong>üìñ Comprensi√≥n Lectora:</strong> ${userData.exercisesByType.reading || 0}</p>
                        <p><strong>üá¨üáß Ingl√©s:</strong> ${userData.exercisesByType.english || 0}</p>
                        <p><strong>üß© Interactivos:</strong> ${userData.exercisesByType.interactive || 0}</p>
                        <p><strong>üî¨ Ciencias:</strong> ${userData.exercisesByType.science || 0}</p>
                        <p><strong>üåç Geograf√≠a:</strong> ${userData.exercisesByType.geography || 0}</p>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                            <p><strong>‚úñÔ∏è Multiplicaciones:</strong> ${userData.multiplicationExercises || 0}</p>
                            <p><strong>üìñ Textos le√≠dos:</strong> ${userData.textsRead || 0}</p>
                        </div>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>üéÆ Por Tema Favorito</h3>
                        <p><strong>üî¥ Pok√©mon:</strong> ${userData.exercisesByTheme.pokemon || 0}</p>
                        <p><strong>‚öîÔ∏è Titanes:</strong> ${userData.exercisesByTheme.titans || 0}</p>
                        <p><strong>‚öΩ F√∫tbol:</strong> ${userData.exercisesByTheme.football || 0}</p>
                        <p><strong>üî´ Warframe:</strong> ${userData.exercisesByTheme.warframe || 0}</p>
                        <p><strong>üéØ Variado:</strong> ${userData.exercisesByTheme.mixed || 0}</p>
                    </div>
                    
                    <div class="stat-card" style="padding: 20px;">
                        <h3>üèÜ Progreso de Logros</h3>
                        <p><strong>Desbloqueados:</strong> ${userData.achievements.length}/${achievements.length}</p>
                        <div style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 5px;">
                            ${userData.achievements.map(id => {
                                const achievement = achievements.find(a => a.id === id);
                                return achievement ? `<span style="padding: 4px 8px; background: #ffd700; border-radius: 4px; font-size: 12px; color: #333;">${achievement.icon} ${achievement.name}</span>` : '';
                            }).join('')}
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3>üìà Progreso Semanal Detallado</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                        ${Object.keys(exerciseDatabase).map(weekKey => {
                            const weekNum = weekKey.replace('week', '');
                            const completed = getCompletedDaysInWeek(weekNum);
                            const weekData = getWeekStats(weekNum);
                            return `
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; border: 1px solid #ddd;">
                                    <h4>Semana ${weekNum}</h4>
                                    <div style="font-size: 24px; color: #667eea; margin: 10px 0;">${completed}/5</div>
                                    <div style="font-size: 12px; color: #666;">d√≠as completados</div>
                                    ${weekData.totalScore > 0 ? `
                                        <div style="margin-top: 10px; font-size: 14px;">
                                            <div>üìä ${weekData.totalScore}/${weekData.totalExercises} ejercicios</div>
                                            <div>üéØ ${Math.round((weekData.totalScore/weekData.totalExercises)*100)}% precisi√≥n</div>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px; border-left: 4px solid #2196f3;">
                    <h4>üìù Informaci√≥n de Cuenta</h4>
                    <p><strong>Usuario:</strong> ${appState.currentUser}</p>
                    <p><strong>Cuenta creada:</strong> ${userData.created ? new Date(userData.created).toLocaleDateString('es-ES') : 'Fecha no disponible'}</p>
                    <p><strong>√öltima actividad:</strong> ${userData.lastActivity ? new Date(userData.lastActivity).toLocaleString('es-ES') : 'No disponible'}</p>
                    <p><strong>Estado de guardado:</strong> ${appState.connectionStatus === 'online' ? '‚úÖ Sincronizado' : '‚ùå Sin sincronizar'}</p>
                </div>
            `;
        }

        function getWeekStats(weekNum) {
            let totalScore = 0;
            let totalExercises = 0;
            
            for (let day = 1; day <= 5; day++) {
                const dayKey = `week${weekNum}_day${day}`;
                const dayData = appState.userData.completedExercises[dayKey];
                if (dayData) {
                    totalScore += dayData.score;
                    totalExercises += dayData.total;
                }
            }
            
            return { totalScore, totalExercises };
        }

        // Sistema de recompensas
        function showReward(title, icon, message) {
            document.getElementById('rewardTitle').textContent = title;
            document.getElementById('rewardIcon').textContent = icon;
            document.getElementById('rewardMessage').textContent = message;
            document.getElementById('rewardPopup').style.display = 'block';
        }

        function closeReward() {
            document.getElementById('rewardPopup').style.display = 'none';
        }

        // Funciones de administraci√≥n
        function resetProgress() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar todo el progreso? Esta acci√≥n no se puede deshacer.')) {
                appState.userData = createNewUser();
                saveUserData();
                updateUserInterface();
                generateWeeks();
                alert('Progreso reiniciado correctamente.');
            }
        }

        function exportData() {
            const dataToExport = {
                user: appState.currentUser,
                data: appState.userData,
                exportDate: new Date().toISOString(),
                summary: {
                    totalExercises: appState.userData.totalExercises,
                    accuracy: appState.userData.totalExercises > 0 ? Math.round((appState.userData.correctAnswers / appState.userData.totalExercises) * 100) : 0,
                    level: appState.userData.level,
                    achievements: appState.userData.achievements.length,
                    connectionStatus: appState.connectionStatus,
                    perfectDays: appState.userData.perfectDays || 0,
                    fastestDay: appState.userData.fastestDay || null
                }
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `academia_pokemon_${appState.currentUser}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ Academia Pokemon iniciada - Versi√≥n ampliada');
            console.log('üì° Configuraci√≥n JSONBin:', {
                binId: JSONBIN_CONFIG.binId,
                apiUrl: JSONBIN_CONFIG.apiUrl
            });
            
            updateConnectionStatus('offline');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            // Event listener para Enter en el input de login
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
</body>
</html>
