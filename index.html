<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 Academia Pokemon - ¡Aprende Jugando!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 25%, #45b7d1 50%, #96ceb4 75%, #ffeaa7 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            min-height: 100vh;
            color: #2d3436;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 500px;
            width: 100%;
            position: relative;
            z-index: 2;
            border: 5px solid transparent;
            background-clip: padding-box;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            border-radius: 35px;
            z-index: -1;
        }

        .login-card h1 {
            font-family: 'Fredoka One', cursive;
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 3em;
            text-shadow: 3px 3px 0px #fff;
        }

        .login-card p {
            font-size: 18px;
            color: #636e72;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .login-card input {
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: 3px solid #ddd;
            border-radius: 20px;
            font-size: 18px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .login-card input:focus {
            outline: none;
            border-color: #ff6b6b;
            transform: scale(1.02);
            background: white;
        }

        .login-card button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #fd79a8);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
            font-family: 'Nunito', sans-serif;
        }

        .login-card button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
        }

        .main-app {
            display: none;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 3px solid #fdcb6e;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            color: white;
            font-weight: 800;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border: 4px solid white;
        }

        .user-info h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: #2d3436;
            margin: 0;
        }

        .user-info p {
            font-size: 16px;
            color: #636e72;
            margin: 5px 0 0 0;
            font-weight: 600;
        }

        .stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
            min-width: 100px;
            transition: transform 0.3s;
            border: 3px solid white;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #55efc4, #00b894);
            box-shadow: 0 8px 25px rgba(85, 239, 196, 0.3);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            box-shadow: 0 8px 25px rgba(253, 203, 110, 0.3);
        }

        .stat-card h3 {
            font-size: 28px;
            font-weight: 800;
            margin: 5px 0;
            font-family: 'Fredoka One', cursive;
        }

        .stat-card p {
            font-size: 14px;
            opacity: 0.95;
            font-weight: 700;
        }

        .tab-navigation {
            background: white;
            padding: 15px;
            border-radius: 25px;
            margin-bottom: 25px;
            display: flex;
            gap: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 3px solid #4ecdc4;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 15px 30px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 3px solid #dfe6e9;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 800;
            font-size: 16px;
            color: #2d3436;
            font-family: 'Nunito', sans-serif;
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #ff6b6b, #fd79a8);
            color: white;
            border-color: #d63031;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .calendar-wrapper {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            border: 4px solid #74b9ff;
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .calendar-header h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .day-header {
            font-family: 'Fredoka One', cursive;
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border-radius: 15px;
            font-size: 16px;
            border: 3px solid white;
        }

        .day-cell {
            aspect-ratio: 1;
            border: 4px solid #dfe6e9;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .day-cell:hover:not(.disabled):not(.empty) {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .day-cell.empty {
            opacity: 0.3;
            cursor: default;
            background: #f8f9fa;
        }

        .day-cell.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f9fa;
        }

        .day-cell.recoverable {
            background: linear-gradient(135deg, #fab1a0, #ff7675);
            border-color: #d63031;
            cursor: pointer;
            animation: pulseRecoverable 2s infinite;
        }

        @keyframes pulseRecoverable {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 118, 117, 0.4); }
            50% { box-shadow: 0 0 25px rgba(255, 118, 117, 0.7); }
        }

        .day-cell.recoverable:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(255, 118, 117, 0.8);
        }

        .day-cell.completed {
            background: linear-gradient(135deg, #55efc4, #00b894);
            border-color: #00b894;
            animation: pulseGlow 2s infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 184, 148, 0.5); }
            50% { box-shadow: 0 0 40px rgba(0, 184, 148, 0.8); }
        }

        .day-cell.current {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            border-color: #d63031;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .day-number {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            font-weight: 800;
            color: #2d3436;
        }

        .day-cell.completed .day-number,
        .day-cell.current .day-number,
        .day-cell.recoverable .day-number {
            color: white;
        }

        .day-status {
            font-size: 30px;
            margin-top: 5px;
        }

        .exercise-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .exercise-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 5px solid #4ecdc4;
            position: relative;
            margin: 20px auto;
            max-height: 90vh;
            overflow-y: auto;
        }

        .exercise-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .exercise-header h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #2d3436;
            margin-bottom: 15px;
        }

        .subject-badge {
            display: inline-block;
            padding: 12px 25px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 18px;
            margin: 5px;
            border: 3px solid white;
        }

        .subject-badge.math {
            background: linear-gradient(135deg, #ff6b6b, #fd79a8);
            color: white;
        }

        .subject-badge.reading {
            background: linear-gradient(135deg, #4ecdc4, #45b7d1);
            color: white;
        }

        .subject-badge.science {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .subject-badge.social {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
        }

        .instruction-box {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid #636e72;
        }

        .instruction-box h4 {
            font-family: 'Fredoka One', cursive;
            font-size: 22px;
            color: #2d3436;
            margin-bottom: 15px;
        }

        .instruction-box p {
            font-size: 18px;
            font-weight: 700;
            color: #2d3436;
            line-height: 1.6;
        }

        .reading-passage {
            background: linear-gradient(135deg, #fff9e6, #ffeaa7);
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid #fdcb6e;
            font-size: 18px;
            line-height: 2;
            font-weight: 600;
            color: #2d3436;
            max-height: 400px;
            overflow-y: auto;
        }

        .reading-passage h4 {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            margin-bottom: 20px;
            color: #e17055;
            text-align: center;
        }

        .reading-passage p {
            margin-bottom: 15px;
        }

        .question-container {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 30px;
            border-radius: 25px;
            margin: 25px 0;
            border: 4px solid #dfe6e9;
        }

        .question-text {
            font-size: 22px;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .options-container {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .option-btn {
            padding: 20px;
            background: white;
            border: 4px solid #dfe6e9;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
            font-weight: 700;
            text-align: left;
            color: #2d3436;
            font-family: 'Nunito', sans-serif;
        }

        .option-btn:hover {
            transform: translateX(10px);
            border-color: #74b9ff;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border-color: #0984e3;
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            border-color: #00b894;
        }

        .option-btn.incorrect {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border-color: #d63031;
        }

        .hint-box {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 20px;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid #e17055;
            display: none;
        }

        .hint-box.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hint-text {
            font-size: 18px;
            font-weight: 700;
            color: #2d3436;
        }

        .feedback-box {
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            font-size: 18px;
            font-weight: 700;
            border: 4px solid;
            display: none;
            line-height: 1.6;
        }

        .feedback-box.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .feedback-box.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            border-color: #00b894;
        }

        .feedback-box.incorrect {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border-color: #d63031;
        }

        .explanation-box {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid #2196f3;
            display: none;
            font-size: 17px;
            line-height: 1.7;
            font-weight: 600;
            color: #1565c0;
        }

        .explanation-box.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .explanation-box h4 {
            font-family: 'Fredoka One', cursive;
            font-size: 22px;
            margin-bottom: 15px;
            color: #0d47a1;
        }

        .exercise-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .exercise-btn {
            flex: 1;
            min-width: 150px;
            padding: 18px;
            border: none;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
        }

        .exercise-btn.primary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.4);
        }

        .exercise-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(116, 185, 255, 0.6);
        }

        .exercise-btn.secondary {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            color: #2d3436;
        }

        .exercise-btn.secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .exercise-btn.success {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            box-shadow: 0 8px 25px rgba(0, 184, 148, 0.4);
        }

        .exercise-btn.success:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 184, 148, 0.6);
        }

        .exercise-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .progress-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #dfe6e9;
            border: 3px solid #b2bec3;
            transition: all 0.3s;
        }

        .progress-dot.completed {
            background: linear-gradient(135deg, #55efc4, #00b894);
            border-color: #00b894;
        }

        .progress-dot.current {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            border-color: #e17055;
            transform: scale(1.3);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 800;
            box-shadow: 0 8px 20px rgba(214, 48, 49, 0.4);
        }

        .close-modal:hover {
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 12px 30px rgba(214, 48, 49, 0.6);
        }

        .achievement-unlock {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 50px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 2000;
            text-align: center;
            border: 5px solid #fdcb6e;
            display: none;
            animation: achievementPop 0.5s ease;
        }

        @keyframes achievementPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .achievement-unlock.visible {
            display: block;
        }

        .achievement-icon-big {
            font-size: 100px;
            margin-bottom: 20px;
        }

        .achievement-unlock h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #2d3436;
            margin-bottom: 15px;
        }

        .achievement-unlock p {
            font-size: 20px;
            font-weight: 700;
            color: #636e72;
        }

        .stats-kids {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .stat-card-big {
            background: linear-gradient(135deg, #f8f9fa, white);
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 4px solid #74b9ff;
            transition: all 0.3s;
        }

        .stat-card-big:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }

        .stat-icon-big {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .stat-number-big {
            font-family: 'Fredoka One', cursive;
            font-size: 48px;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .stat-label-big {
            font-size: 18px;
            font-weight: 700;
            color: #636e72;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .achievement-card {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 4px solid #636e72;
            transition: all 0.3s;
            opacity: 0.5;
        }

        .achievement-card.unlocked {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-color: #e17055;
            opacity: 1;
            animation: achievementGlow 2s infinite;
        }

        @keyframes achievementGlow {
            0%, 100% { box-shadow: 0 10px 30px rgba(253, 203, 110, 0.4); }
            50% { box-shadow: 0 10px 40px rgba(253, 203, 110, 0.8); }
        }

        .achievement-card:hover {
            transform: scale(1.05);
        }

        .achievement-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .ranking-container {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            border: 4px solid #fdcb6e;
        }

        .ranking-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .ranking-header h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #2d3436;
        }

        .ranking-filters {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            border: 3px solid #636e72;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 800;
            font-size: 16px;
            color: #2d3436;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
        }

        .filter-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            border-color: #e17055;
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin: 40px 0;
            min-height: 300px;
        }

        .podium-place {
            text-align: center;
            padding: 30px 20px;
            border-radius: 20px;
            border: 4px solid;
            min-width: 200px;
            transition: all 0.3s;
        }

        .podium-place:hover {
            transform: translateY(-10px);
        }

        .podium-place.first {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            border-color: #d63031;
            order: 2;
            height: 300px;
        }

        .podium-place.second {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            border-color: #636e72;
            order: 1;
            height: 240px;
        }

        .podium-place.third {
            background: linear-gradient(135deg, #fab1a0, #e17055);
            border-color: #d63031;
            order: 3;
            height: 200px;
        }

        .podium-rank {
            font-family: 'Fredoka One', cursive;
            font-size: 48px;
            color: white;
            margin-bottom: 10px;
        }

        .podium-name {
            font-size: 20px;
            font-weight: 800;
            color: white;
            margin-bottom: 10px;
        }

        .podium-score {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: white;
        }

        .ranking-table {
            margin-top: 30px;
        }

        .ranking-row {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, white);
            border-radius: 20px;
            margin-bottom: 15px;
            border: 3px solid #dfe6e9;
            transition: all 0.3s;
        }

        .ranking-row:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .ranking-row.current-user {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-color: #0984e3;
        }

        .ranking-row.current-user * {
            color: white !important;
        }

        .ranking-position {
            font-family: 'Fredoka One', cursive;
            font-size: 28px;
            color: #2d3436;
            min-width: 60px;
            text-align: center;
        }

        .ranking-user {
            flex: 1;
            font-size: 20px;
            font-weight: 800;
            color: #2d3436;
            margin-left: 20px;
        }

        .ranking-stats {
            display: flex;
            gap: 30px;
            font-weight: 700;
            color: #636e72;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1500;
            font-weight: 800;
            border: 3px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .connection-status.online {
            border-color: #00b894;
            color: #00b894;
        }

        .connection-status.offline {
            border-color: #636e72;
            color: #636e72;
        }

        .connection-status.connecting {
            border-color: #fdcb6e;
            color: #e17055;
        }

        .connection-status.error {
            border-color: #d63031;
            color: #d63031;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .settings-container {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            border: 4px solid #74b9ff;
        }

        .settings-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 3px solid #dfe6e9;
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: #2d3436;
            margin-bottom: 20px;
        }

        .settings-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            border: 3px solid #636e72;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 800;
            font-size: 16px;
            color: #2d3436;
            margin: 10px 0;
            transition: all 0.3s;
            font-family: 'Nunito', sans-serif;
        }

        .settings-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .settings-btn.danger {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border-color: #d63031;
        }

        .settings-btn.success {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            border-color: #00b894;
        }

        .timer-display {
            font-family: 'Fredoka One', cursive;
            font-size: 28px;
            color: #2d3436;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 20px;
            border: 4px solid #e17055;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
            }

            .user-info {
                flex-direction: column;
                text-align: center;
                width: 100%;
            }

            .avatar {
                width: 60px;
                height: 60px;
                font-size: 28px;
            }

            .stats {
                width: 100%;
                justify-content: space-around;
            }

            .stat-card {
                min-width: 80px;
                padding: 12px;
            }

            .stat-card h3 {
                font-size: 20px;
            }

            .stat-card p {
                font-size: 12px;
            }

            .tab-navigation {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .tab-navigation::-webkit-scrollbar {
                display: none;
            }

            .nav-tab {
                min-width: 120px;
                padding: 12px 15px;
                font-size: 14px;
                white-space: nowrap;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 6px;
            }

            .day-cell {
                min-height: 60px;
                padding: 5px;
            }

            .day-number {
                font-size: 14px;
            }

            .day-status {
                font-size: 18px;
            }

            .exercise-content {
                padding: 15px;
            }

            .exercise-modal {
                padding: 15px;
            }

            .option-btn {
                padding: 12px;
                font-size: 15px;
            }

            .podium {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .podium-place {
                width: 100%;
                max-width: 300px;
                height: auto !important;
            }

            .podium-place.first {
                order: 1;
            }

            .podium-place.second {
                order: 2;
            }

            .podium-place.third {
                order: 3;
            }

            .ranking-table {
                font-size: 14px;
            }

            .ranking-row td {
                padding: 10px 5px;
                font-size: 13px;
            }

            .achievement-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .calendar-header h2 {
                font-size: 24px;
            }

            .login-card {
                padding: 30px 20px;
                margin: 10px;
            }

            .login-card h1 {
                font-size: 2em;
            }
        }

        /* Media query específica para pantallas grandes (S24 Ultra y similares) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .calendar-grid {
                gap: 10px;
            }

            .day-cell {
                min-height: 80px;
            }

            .nav-tab {
                padding: 15px 20px;
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        <div class="status-dot"></div>
        <span id="statusText">Desconectado</span>
    </div>

    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h1>🎮 Academia Pokemon</h1>
            <p>¡Bienvenido, Súper Entrenador! 🚀</p>
            <input type="text" id="usernameInput" placeholder="Escribe tu nombre de entrenador">
            <button onclick="login()">¡Comenzar Aventura! 🌟</button>
        </div>
    </div>

    <div class="main-app" id="mainApp">
        <div class="container">
            <div class="header">
                <div class="user-info">
                    <div class="avatar" id="userAvatar">🎮</div>
                    <div>
                        <h2 id="userName">Súper Entrenador</h2>
                        <p id="userLevel">Nivel 1 - Novato Genial</p>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-card">
                        <h3 id="totalPoints">0</h3>
                        <p>⭐ Puntos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="streak">0</h3>
                        <p>🔥 Racha</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="achievements">0</h3>
                        <p>🏆 Logros</p>
                    </div>
                </div>
            </div>

            <div class="tab-navigation">
                <div class="nav-tab active" data-tab="calendar" onclick="showTab('calendar')">📅 Calendario</div>
                <div class="nav-tab" data-tab="stats" onclick="showTab('stats')">📊 Estadísticas</div>
                <div class="nav-tab" data-tab="achievements" onclick="showTab('achievements')">🏆 Logros</div>
                <div class="nav-tab" data-tab="ranking" onclick="showTab('ranking')">🥇 Ranking</div>
                <div class="nav-tab" data-tab="settings" onclick="showTab('settings')">⚙️ Ajustes</div>
            </div>

            <div id="calendarTab" class="tab-content active">
                <div class="calendar-wrapper">
                    <div class="calendar-header">
                        <h2>🗓️ Tu Calendario de Aventuras</h2>
                        <p style="font-size: 18px; font-weight: 600; color: #636e72;">¡30 minutos geniales cada día! 🌟</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 20px; border-radius: 20px; margin-bottom: 25px; border: 3px solid #2196f3;">
                        <h4 style="font-family: 'Fredoka One', cursive; font-size: 18px; color: #0d47a1; margin-bottom: 15px; text-align: center;">📋 Leyenda del Calendario</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-weight: 700; font-size: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">🎯</span>
                                <span style="color: #1565c0;">Hoy - ¡A jugar!</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">📝</span>
                                <span style="color: #1565c0;">Recuperar día perdido</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">✅</span>
                                <span style="color: #1565c0;">¡Completado!</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">🔒</span>
                                <span style="color: #1565c0;">Bloqueado (futuro)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="weeksContainer"></div>
                </div>
            </div>

            <div id="statsTab" class="tab-content">
                <div class="settings-container">
                    <div class="calendar-header">
                        <h2>📊 Mis Estadísticas Súper Geniales</h2>
                    </div>
                    <div id="statsContent"></div>
                </div>
            </div>

            <div id="achievementsTab" class="tab-content">
                <div class="settings-container">
                    <div class="calendar-header">
                        <h2>🏆 Mis Logros Increíbles</h2>
                    </div>
                    <div id="achievementGrid" class="achievement-grid"></div>
                </div>
            </div>

            <div id="rankingTab" class="tab-content">
                <div class="ranking-container">
                    <div class="ranking-header">
                        <h2>🥇 Ranking de Súper Campeones</h2>
                    </div>
                    <div class="ranking-filters">
                        <button class="filter-btn active" onclick="setRankingFilter('all')">🌟 Todos</button>
                        <button class="filter-btn" onclick="setRankingFilter('week')">📅 Esta Semana</button>
                        <button class="filter-btn" onclick="setRankingFilter('month')">📆 Este Mes</button>
                    </div>
                    <div id="podiumContainer" class="podium"></div>
                    <div id="rankingTableContainer" class="ranking-table"></div>
                </div>
            </div>

            <div id="settingsTab" class="tab-content">
                <div class="settings-container">
                    <div class="calendar-header">
                        <h2>⚙️ Configuración</h2>
                    </div>
                    
                    <div class="settings-section">
                        <h3>🔌 Conexión</h3>
                        <button class="settings-btn success" onclick="testConnection()">🔄 Probar Conexión</button>
                    </div>
                    
                    <div class="settings-section">
                        <h3>💾 Datos</h3>
                        <button class="settings-btn" onclick="exportData()">📥 Exportar Mis Datos</button>
                        <button class="settings-btn danger" onclick="resetProgress()">🔄 Reiniciar Progreso</button>
                    </div>
                    
                    <div class="settings-section">
                        <h3>⚠️ Zona Peligrosa</h3>
                        <button class="settings-btn danger" onclick="deleteUser()">🗑️ Eliminar Usuario Completo</button>
                        <p style="font-size: 14px; color: #d63031; font-weight: 600; margin-top: 10px;">⚠️ Esta acción borrará PERMANENTEMENTE tu usuario y todos tus datos del servidor.</p>
                    </div>
                    
                    <div class="settings-section">
                        <h3>ℹ️ Información</h3>
                        <p style="font-weight: 600; color: #636e72; margin: 10px 0;">Versión: 4.0 Final - ¡Con Textos Largos! 🚀</p>
                        <p style="font-weight: 600; color: #636e72; margin: 10px 0;">Usuario actual: <span id="currentUserDisplay"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="exercise-modal" id="exerciseModal">
        <div class="exercise-content">
            <button class="close-modal" onclick="closeExerciseModal()">✕</button>
            <div class="exercise-header">
                <h3 id="exerciseTitle">Ejercicios Súper Geniales</h3>
                <div id="subjectBadges"></div>
                <div class="timer-display" id="timerDisplay">⏱️ Tiempo: 30:00</div>
            </div>
            
            <div class="progress-indicator" id="progressIndicator"></div>
            
            <div id="exerciseContainer"></div>
            
            <div class="hint-box" id="hintBox">
                <div style="font-size: 24px; margin-bottom: 10px;">💡 Pista Genial</div>
                <div class="hint-text" id="hintText"></div>
            </div>
            
            <div class="feedback-box" id="feedbackBox">
                <div id="feedbackText"></div>
            </div>

            <div class="explanation-box" id="explanationBox">
                <h4>📚 ¿Por qué es así?</h4>
                <div id="explanationText"></div>
            </div>
            
            <div class="exercise-buttons">
                <button class="exercise-btn secondary" id="hintBtn" onclick="showHint()">💡 Pista</button>
                <button class="exercise-btn primary" id="checkBtn" onclick="checkAnswer()">✓ Comprobar</button>
                <button class="exercise-btn success" id="nextBtn" onclick="nextExercise()" style="display: none;">➜ Siguiente</button>
            </div>
        </div>
    </div>

    <div class="achievement-unlock" id="achievementUnlock">
        <div class="achievement-icon-big" id="unlockedIcon">🏆</div>
        <h3 id="unlockedName">¡Súper Logro!</h3>
        <p id="unlockedDescription">¡Has desbloqueado algo genial!</p>
        <button class="exercise-btn success" onclick="closeAchievementUnlock()" style="margin-top: 30px; width: 100%;">¡Genial! 🎉</button>
    </div>

    <script>
        const JSONBIN_CONFIG = {
            binId: '68ee144343b1c97be96704f9',
            masterKey: '$2a$10$byEkgCiPtr6uA9j.sw5Uiuld00jGPRMT1Rn9TlhHYbPe3CFfaEu6G',
            apiUrl: 'https://api.jsonbin.io/v3'
        };

        let appState = {
            currentUser: null,
            userData: null,
            allUsersData: {},
            currentDay: null,
            currentExerciseIndex: 0,
            currentExercises: [],
            selectedAnswer: null,
            currentRankingFilter: 'all',
            sessionStartTime: null,
            timerInterval: null,
            timeRemaining: 1800
        };

        // BANCO DE EJERCICIOS CON TEXTOS LARGOS DE COMPRENSIÓN LECTORA
        const exerciseBank = {
                    "math": [
                                {
                                            "instruction": "🎮 Pikachu necesita tu ayuda con las matemáticas. Lee con atención y calcula:",
                                            "question": "Pikachu ha derrotado a 234 Pokemon en batallas. Charizard ha derrotado el doble que Pikachu. ¿Cuántos Pokemon ha derrotado Charizard?",
                                            "options": [
                                                        "468 Pokemon",
                                                        "334 Pokemon",
                                                        "464 Pokemon",
                                                        "234 Pokemon"
                                            ],
                                            "correct": 0,
                                            "hint": "El doble significa multiplicar por 2. Puedes sumar 234 + 234 para encontrar la respuesta.",
                                            "explanation": "Cuando decimos 'el doble', significa multiplicar por 2. Entonces: 234 × 2 = 468. ¡Charizard es súper fuerte! 🔥"
                                },
                                {
                                            "instruction": "⚽ ¡Problema de fútbol! Vamos a resolver este ejercicio sobre el Real Madrid:",
                                            "question": "En el Bernabéu caben 81.044 personas. Si ya hay 56.789 espectadores viendo el partido, ¿cuántas personas más pueden entrar?",
                                            "options": [
                                                        "24.255 personas",
                                                        "25.255 personas",
                                                        "24.155 personas",
                                                        "23.255 personas"
                                            ],
                                            "correct": 0,
                                            "hint": "Tienes que restar: lo que cabe menos lo que ya hay.",
                                            "explanation": "Para saber cuántas personas más pueden entrar, restamos: 81.044 - 56.789 = 24.255. ⚽✨"
                                },
                                {
                                            "instruction": "🎮 Eren necesita calcular recursos para proteger la muralla. ¡Ayúdalo!",
                                            "question": "Los Titanes atacan en grupos de 8. Si Eren cuenta 96 Titanes acercándose, ¿cuántos grupos son?",
                                            "options": [
                                                        "12 grupos",
                                                        "11 grupos",
                                                        "13 grupos",
                                                        "10 grupos"
                                            ],
                                            "correct": 0,
                                            "hint": "Divide el total de Titanes entre el tamaño de cada grupo. Puedes usar la tabla del 8.",
                                            "explanation": "Para saber cuántos grupos hay, dividimos: 96 ÷ 8 = 12 grupos. ⚔️"
                                },
                                {
                                            "instruction": "⚽ ¡Problema con las medallas del Barcelona!",
                                            "question": "El Barça tiene 3 cajas de medallas. Cada caja contiene 25 medallas. ¿Cuántas medallas tienen en total?",
                                            "options": [
                                                        "75 medallas",
                                                        "70 medallas",
                                                        "80 medallas",
                                                        "65 medallas"
                                            ],
                                            "correct": 0,
                                            "hint": "Multiplica el número de cajas por las medallas en cada caja. 25 × 3 = ?",
                                            "explanation": "Multiplicamos: 3 cajas × 25 medallas = 75 medallas. 🏆"
                                },
                                {
                                            "instruction": "🎮 ¡Ash está contando sus Pokeballs! Vamos a ayudarlo:",
                                            "question": "Ash tiene 1/4 de sus Pokeballs llenas con Pokemon de tipo Agua. Si tiene 20 Pokeballs, ¿cuántas tienen Pokemon de Agua?",
                                            "options": [
                                                        "5 Pokeballs",
                                                        "10 Pokeballs",
                                                        "4 Pokeballs",
                                                        "8 Pokeballs"
                                            ],
                                            "correct": 0,
                                            "hint": "1/4 significa dividir en 4 partes iguales y tomar 1. Divide 20 ÷ 4.",
                                            "explanation": "Una fracción 1/4 significa dividir algo en 4 partes iguales. 20 ÷ 4 = 5. 💧"
                                },
                                {
                                            "instruction": "⚽ Cristiano Ronaldo está entrenando. ¡Necesita tu ayuda para contar!",
                                            "question": "Cristiano ha marcado 567 goles en su carrera. Luego marca 345 goles más. ¿Cuántos goles lleva en total?",
                                            "options": [
                                                        "912 goles",
                                                        "902 goles",
                                                        "812 goles",
                                                        "922 goles"
                                            ],
                                            "correct": 0,
                                            "hint": "Suma los goles: 567 + 345.",
                                            "explanation": "Sumamos: 567 + 345 = 912 goles. ⚽👑"
                                },
                                {
                                            "instruction": "🎮 ¡Naruto necesita comprar ramen! Ayúdalo con esta cuenta:",
                                            "question": "Un tazón de ramen cuesta 8 euros. Si Naruto compra 7 tazones para todo su equipo, ¿cuánto dinero necesita?",
                                            "options": [
                                                        "56 euros",
                                                        "48 euros",
                                                        "64 euros",
                                                        "52 euros"
                                            ],
                                            "correct": 0,
                                            "hint": "Multiplica el precio de un tazón por la cantidad: 8 × 7 = ?",
                                            "explanation": "Multiplicamos: 8 × 7 = 56 euros. 🍜"
                                },
                                {
                                            "instruction": "⚽ ¡Problema de la Liga! Vamos a calcular puntos:",
                                            "question": "El Atlético ganó 18 partidos (3 puntos cada uno) y empató 6 partidos (1 punto cada uno). ¿Cuántos puntos tiene en total?",
                                            "options": [
                                                        "60 puntos",
                                                        "54 puntos",
                                                        "66 puntos",
                                                        "72 puntos"
                                            ],
                                            "correct": 0,
                                            "hint": "Calcula primero los puntos por victorias (18 × 3) y luego súmale los empates (6 × 1).",
                                            "explanation": "Victorias: 18 × 3 = 54 puntos. Empates: 6 × 1 = 6 puntos. Total: 60 puntos. ⚽📊"
                                },
                                {
                                            "instruction": "🎮 Los Pokemon están organizando un torneo. ¡Ayuda con los cálculos!",
                                            "question": "Si hay 144 Pokemon y deben formar equipos de 12, ¿cuántos equipos se pueden formar?",
                                            "options": [
                                                        "12 equipos",
                                                        "10 equipos",
                                                        "14 equipos",
                                                        "16 equipos"
                                            ],
                                            "correct": 0,
                                            "hint": "Divide el total entre el tamaño de cada equipo: 144 ÷ 12 = ?",
                                            "explanation": "Dividimos: 144 ÷ 12 = 12 equipos. 🏆"
                                },
                                {
                                            "instruction": "⚡ ¡Problema de velocidad con Sonic!",
                                            "question": "Sonic recorre 450 kilómetros en 3 horas. ¿Cuántos kilómetros recorre por hora?",
                                            "options": [
                                                        "150 km/h",
                                                        "140 km/h",
                                                        "160 km/h",
                                                        "135 km/h"
                                            ],
                                            "correct": 0,
                                            "hint": "Divide la distancia total entre las horas: 450 ÷ 3 = ?",
                                            "explanation": "Para calcular el promedio por hora: 450 ÷ 3 = 150 km/h. 💨"
                                },
                                {
                                            "instruction": "🎮 ¡Luffy necesita contar sus tesoros!",
                                            "question": "Luffy tiene 3 cofres con 125 monedas cada uno y 2 cofres con 150 monedas cada uno. ¿Cuántas monedas tiene en total?",
                                            "options": [
                                                        "675 monedas",
                                                        "625 monedas",
                                                        "725 monedas",
                                                        "575 monedas"
                                            ],
                                            "correct": 0,
                                            "hint": "Calcula (3 × 125) + (2 × 150).",
                                            "explanation": "Primero: 3 × 125 = 375. Luego: 2 × 150 = 300. Total: 675 monedas. 💰"
                                },
                                {
                                            "instruction": "⚽ ¡Cálculo de asistencias! Vamos con Messi:",
                                            "question": "Messi ha dado 89 asistencias. Neymar ha dado 2/3 de lo que dio Messi. ¿Cuántas asistencias dio Neymar?",
                                            "options": [
                                                        "59 asistencias",
                                                        "60 asistencias",
                                                        "45 asistencias",
                                                        "66 asistencias"
                                            ],
                                            "correct": 0,
                                            "hint": "Multiplica 89 × 2, luego divide entre 3.",
                                            "explanation": "Calculamos 2/3 de 89: (89 × 2) ÷ 3 = 59.33, redondeamos a 59. ⚽✨"
                                },
                                {
                                            "instruction": "🎮 ¡Problema de evolución Pokemon!",
                                            "question": "Bulbasaur pesa 6.9 kg. Cuando evoluciona a Ivysaur, su peso aumenta 13.1 kg. ¿Cuánto pesa Ivysaur?",
                                            "options": [
                                                        "20 kg",
                                                        "19 kg",
                                                        "21 kg",
                                                        "18 kg"
                                            ],
                                            "correct": 0,
                                            "hint": "Suma el peso original más el aumento: 6.9 + 13.1 = ?",
                                            "explanation": "Sumamos: 6.9 + 13.1 = 20 kg. 🌿"
                                },
                                {
                                            "instruction": "⚽ ¡Problema del Camp Nou!",
                                            "question": "El Camp Nou tiene 99.354 asientos. Si 87.642 ya están ocupados, ¿cuántos asientos quedan libres?",
                                            "options": [
                                                        "11.712 asientos",
                                                        "12.712 asientos",
                                                        "11.612 asientos",
                                                        "10.712 asientos"
                                            ],
                                            "correct": 0,
                                            "hint": "Resta: 99.354 - 87.642.",
                                            "explanation": "Restamos: 99.354 - 87.642 = 11.712 asientos libres. 🏟️"
                                },
                                {
                                            "instruction": "🎮 ¡Mario está recolectando monedas!",
                                            "question": "Mario recoge 45 monedas por nivel. Si completa 8 niveles, ¿cuántas monedas recolectó?",
                                            "options": [
                                                        "360 monedas",
                                                        "350 monedas",
                                                        "405 monedas",
                                                        "320 monedas"
                                            ],
                                            "correct": 0,
                                            "hint": "Multiplica: 45 × 8.",
                                            "explanation": "Multiplicamos: 45 × 8 = 360. 🍄"
                                },
                                {
                                            "instruction": "⚽ ¡Mbappé está calculando su velocidad!",
                                            "question": "Mbappé corrió 720 metros en 60 segundos. ¿Cuántos metros recorre por segundo?",
                                            "options": [
                                                        "12 m/s",
                                                        "10 m/s",
                                                        "14 m/s",
                                                        "11 m/s"
                                            ],
                                            "correct": 0,
                                            "hint": "Divide la distancia entre el tiempo: 720 ÷ 60 = ?",
                                            "explanation": "Dividimos: 720 ÷ 60 = 12 metros por segundo. ⚡"
                                },
                                {
                                            "instruction": "🎮 ¡Goku está entrenando con pesas!",
                                            "question": "Goku levanta 250 kg en cada brazo. ¿Cuántos kilogramos levanta con ambos brazos?",
                                            "options": [
                                                        "500 kg",
                                                        "450 kg",
                                                        "550 kg",
                                                        "400 kg"
                                            ],
                                            "correct": 0,
                                            "hint": "Suma lo que levanta con cada brazo: 250 + 250 = ?",
                                            "explanation": "Sumamos: 250 + 250 = 500 kg en total. 💪"
                                },
                                {
                                            "instruction": "⚽ ¡Problema de la Copa del Mundo!",
                                            "question": "En un mundial se juegan 64 partidos. Si cada partido dura 90 minutos, ¿cuántos minutos de fútbol hay en total?",
                                            "options": [
                                                        "5.760 minutos",
                                                        "5.660 minutos",
                                                        "5.860 minutos",
                                                        "6.000 minutos"
                                            ],
                                            "correct": 0,
                                            "hint": "Multiplica: 64 × 90.",
                                            "explanation": "Multiplicamos: 64 × 90 = 5.760 minutos. ⚽🌍"
                                }
                    ],
                    "reading": [
                                {
                                            "instruction": "📖 Lee este texto sobre la aventura de Pikachu:",
                                            "passageTitle": "La Gran Aventura de Pikachu en el Bosque Misterioso",
                                            "passage": "Era un día soleado en Ciudad Paleta cuando Pikachu decidió explorar el Bosque Verde. Ash le advirtió: 'Ten cuidado, Pikachu.'\n\nPikachu caminó durante una hora hasta que escuchó un ruido. Sus mejillas eléctricas brillaron. Apareció un pequeño Caterpie asustado.\n\nEl Caterpie explicó que se había perdido buscando hojas de mora. Pikachu decidió ayudarlo. Juntos caminaron dos horas hasta encontrar un árbol enorme lleno de hojas verdes.\n\nMientras Caterpie comía feliz, Pikachu escuchó un grito lejano. ¡Era Ash! Pikachu se despidió de su nuevo amigo y corrió hacia la voz de Ash.\n\nCuando llegó, Ash lo abrazó fuerte. 'Me preocupé mucho, Pikachu.'",
                                            "question": "¿Cuánto tiempo caminó Pikachu en total? (inicio + ayuda a Caterpie)",
                                            "options": [
                                                        "3 horas",
                                                        "1 hora",
                                                        "2 horas",
                                                        "4 horas"
                                            ],
                                            "correct": 0,
                                            "hint": "1 hora al principio + 2 horas ayudando = ?",
                                            "explanation": "Pikachu caminó 1 hora al principio y luego 2 horas más. Total: 1 + 2 = 3 horas. ⚡"
                                },
                                {
                                            "instruction": "📖 Lee este texto sobre el Real Madrid:",
                                            "passageTitle": "El Real Madrid: Historia de un Gigante",
                                            "passage": "El Real Madrid fue fundado en 1902. En 1920 el Rey Alfonso XIII le dio el título de 'Real', que significa 'del Rey'.\n\nEl estadio se llama Santiago Bernabéu, construido en 1947. Tiene capacidad para más de 81.000 espectadores.\n\nEl equipo ha ganado 14 Champions League. Algunos jugadores famosos: Alfredo Di Stéfano marcó 308 goles; Cristiano Ronaldo marcó increíbles 450 goles entre 2009 y 2018.\n\nEl Real Madrid tiene una rivalidad con el FC Barcelona. Su partido se llama 'El Clásico' y lo ven más de 500 millones de personas.",
                                            "question": "¿Cuántos goles marcó Cristiano Ronaldo en el Real Madrid?",
                                            "options": [
                                                        "450 goles",
                                                        "308 goles",
                                                        "500 goles",
                                                        "81 goles"
                                            ],
                                            "correct": 0,
                                            "hint": "Busca en el tercer párrafo donde habla de Cristiano.",
                                            "explanation": "El texto dice: 'Cristiano Ronaldo marcó increíbles 450 goles entre 2009 y 2018'. ⚽👑"
                                },
                                {
                                            "instruction": "📖 Lee esta historia sobre Ataque a los Titanes:",
                                            "passageTitle": "La Caída del Muro María",
                                            "passage": "Eren Yeager tenía 10 años cuando vivía en Shiganshina, protegido por tres murallas: María, Rose y Sina. Estas murallas de 50 metros habían protegido a la humanidad durante 100 años.\n\nEren vivía con su padre Grisha (médico), su madre Carla, y su hermana adoptiva Mikasa. Su amigo Armin le mostraba libros sobre el océano.\n\nUn día terrible apareció el Titán Colosal de 60 metros. Destruyó la puerta del Muro María. Eren vio cómo un titán atacaba a su madre.\n\nEsa tragedia cambió a Eren. Juró vengarse y unirse al Cuerpo de Exploración. Mikasa y Armin lo acompañaron.\n\nDespués de tres años de entrenamiento, se graduaron. Eren quedó en el puesto 5, Mikasa fue la número 1, y Armin era el más inteligente.",
                                            "question": "¿En qué puesto quedó Eren en su graduación?",
                                            "options": [
                                                        "Puesto 5",
                                                        "Puesto 1",
                                                        "Puesto 10",
                                                        "Puesto 3"
                                            ],
                                            "correct": 0,
                                            "hint": "Busca en el último párrafo sobre la graduación.",
                                            "explanation": "El texto dice: 'Eren quedó en el puesto número 5'. ⚔️"
                                },
                                {
                                            "instruction": "📝 Gramática Pokemon:",
                                            "question": "En 'Los Pokemon luchan valientemente' - ¿Cuál es el VERBO?",
                                            "options": [
                                                        "luchan",
                                                        "Pokemon",
                                                        "gimnasio",
                                                        "valientemente"
                                            ],
                                            "correct": 0,
                                            "hint": "El verbo indica la ACCIÓN. ¿Qué están haciendo?",
                                            "explanation": "El verbo es 'luchan' porque indica la acción. 💪"
                                },
                                {
                                            "instruction": "📝 ¡Ortografía futbolera!",
                                            "question": "¿Cómo se escribe correctamente?",
                                            "options": [
                                                        "Messi jugó un partido increíble",
                                                        "Mesi jugo un partido increible",
                                                        "Messi jugo un partido increíble",
                                                        "Mesi jugó un partido increible"
                                            ],
                                            "correct": 0,
                                            "hint": "'Messi' lleva dos 's', 'jugó' lleva tilde, 'increíble' también.",
                                            "explanation": "'Messi' con doble 's', 'jugó' con tilde, 'increíble' con tilde. ⚽📝"
                                },
                                {
                                            "instruction": "📖 Lee sobre Naruto:",
                                            "passageTitle": "El Ninja que Nunca se Rinde",
                                            "passage": "Naruto Uzumaki quiere convertirse en Hokage. Cuando era pequeño, todos lo rechazaban porque dentro de él estaba sellado el Zorro de Nueve Colas.\n\nSu primer maestro fue Iruka-sensei. Luego, fue asignado al Equipo 7 con Sasuke, Sakura, y su maestro Kakashi.\n\nEl jutsu favorito de Naruto es el Rasengan, que le enseñó Jiraiya, uno de los Tres Sannin legendarios.\n\nLa frase que repite es: '¡Nunca me rindo! Ese es mi camino ninja'.",
                                            "question": "¿Quién le enseñó a Naruto el Rasengan?",
                                            "options": [
                                                        "Jiraiya",
                                                        "Kakashi",
                                                        "Iruka",
                                                        "Sasuke"
                                            ],
                                            "correct": 0,
                                            "hint": "Busca en el tercer párrafo. Es uno de los Tres Sannin.",
                                            "explanation": "El texto dice que le enseñó 'el legendario Jiraiya'. 🍜"
                                },
                                {
                                            "instruction": "📝 Identificar el SUJETO:",
                                            "question": "En 'El Real Madrid ganó la Champions' - ¿Cuál es el SUJETO?",
                                            "options": [
                                                        "El Real Madrid",
                                                        "ganó",
                                                        "la Champions League",
                                                        "Madrid"
                                            ],
                                            "correct": 0,
                                            "hint": "El sujeto es QUIÉN realiza la acción. ¿Quién ganó?",
                                            "explanation": "El sujeto es 'El Real Madrid' porque es quien realiza la acción. ⚽🏆"
                                },
                                {
                                            "instruction": "📖 Lee sobre Zelda:",
                                            "passageTitle": "La Leyenda de Zelda",
                                            "passage": "Link debe rescatar a la Princesa Zelda de Ganondorf. Para hacerlo, debe recolectar: la Master Sword, el Escudo de Hyrule, y la Ocarina del Tiempo.\n\nEn su aventura, Link viaja por mazmorras. Su compañera fiel es Navi, un hada pequeña de luz azul que le da consejos y dice '¡Hey! ¡Escucha!'.\n\nLink tiene un caballo llamado Epona que corre muy rápido.",
                                            "question": "¿De qué color es la luz de Navi?",
                                            "options": [
                                                        "Azul",
                                                        "Verde",
                                                        "Amarilla",
                                                        "Roja"
                                            ],
                                            "correct": 0,
                                            "hint": "Revisa el segundo párrafo donde describe a Navi.",
                                            "explanation": "El texto dice: 'un hada pequeña de luz azul'. 🧚‍♀️"
                                },
                                {
                                            "instruction": "📝 Reconocer tipos de palabras:",
                                            "question": "En 'Pikachu rápidamente atacó', la palabra 'rápidamente' es:",
                                            "options": [
                                                        "Un adverbio (dice CÓMO atacó)",
                                                        "Un verbo (acción)",
                                                        "Un sustantivo (nombre)",
                                                        "Un adjetivo"
                                            ],
                                            "correct": 0,
                                            "hint": "Termina en '-mente' y dice CÓMO hizo la acción.",
                                            "explanation": "'Rápidamente' es un adverbio que nos dice CÓMO atacó. ⚡"
                                },
                                {
                                            "instruction": "📖 Lee sobre Mario Bros:",
                                            "passageTitle": "Los Hermanos Fontaneros",
                                            "passage": "Mario y Luigi son hermanos fontaneros del Reino Champiñón. Mario viste de rojo y azul, Luigi de verde y azul. Luigi es más alto que Mario.\n\nSu misión es rescatar a la Princesa Peach de Bowser, un dragón tortuga gigante. Deben atravesar 8 mundos diferentes.\n\nYoshi, un dinosaurio verde, ayuda a Mario. Yoshi puede comer enemigos y poner huevos.",
                                            "question": "¿Cuántos mundos deben atravesar Mario y Luigi?",
                                            "options": [
                                                        "8 mundos",
                                                        "7 mundos",
                                                        "10 mundos",
                                                        "6 mundos"
                                            ],
                                            "correct": 0,
                                            "hint": "Busca en el segundo párrafo el número exacto.",
                                            "explanation": "El texto dice: 'deben atravesar 8 mundos diferentes'. 🍄"
                                },
                                {
                                            "instruction": "📝 Conjugación de verbos:",
                                            "question": "¿Cuál es el PASADO del verbo 'jugar' (YO)?",
                                            "options": [
                                                        "Yo jugué",
                                                        "Yo jugo",
                                                        "Yo jugaré",
                                                        "Yo juego"
                                            ],
                                            "correct": 0,
                                            "hint": "El pasado indica algo que YA sucedió. Busca '-é'.",
                                            "explanation": "'Jugué' es el pasado de 'jugar' en primera persona. ⚽"
                                },
                                {
                                            "instruction": "📖 Lee sobre Dragon Ball:",
                                            "passageTitle": "Goku y las Esferas del Dragón",
                                            "passage": "Goku es un Saiyan que llegó a la Tierra cuando era bebé. Fue criado por el maestro Gohan. Su comida favorita es el arroz con pollo.\n\nLas Esferas del Dragón son 7 bolas mágicas. Cuando se juntan todas, invocan al dragón Shenlong. Este dragón puede conceder dos deseos. Las esferas tienen desde una hasta siete estrellas.\n\nLos mejores amigos de Goku son Krillin (su compañero de entrenamiento) y Bulma (una genio científica).",
                                            "question": "¿Cuántos deseos concede Shenlong?",
                                            "options": [
                                                        "Dos deseos",
                                                        "Un deseo",
                                                        "Tres deseos",
                                                        "Siete deseos"
                                            ],
                                            "correct": 0,
                                            "hint": "Busca en el segundo párrafo sobre el dragón.",
                                            "explanation": "El texto dice: 'puede conceder dos deseos'. 🐉"
                                },
                                {
                                            "instruction": "📝 Signos de puntuación:",
                                            "question": "¿Qué signo va al inicio de una pregunta en español?",
                                            "options": [
                                                        "¿ (interrogación inicial)",
                                                        "! (exclamación)",
                                                        "? (interrogación final)",
                                                        ", (coma)"
                                            ],
                                            "correct": 0,
                                            "hint": "En español, las preguntas tienen un signo especial al INICIO y otro al final.",
                                            "explanation": "En español, las preguntas comienzan con '¿' y terminan con '?'. 📝❓"
                                },
                                {
                                            "instruction": "📖 Lee sobre Sonic:",
                                            "passageTitle": "El Erizo Más Rápido",
                                            "passage": "Sonic es un erizo azul que corre a la velocidad del sonido. Su velocidad máxima es de 1.200 km/h. Cuando corre, se enrolla en bola y destruye robots.\n\nSu archienemigo es el Dr. Eggman (Dr. Robotnik), un científico malvado con bigote grande y gafas oscuras.\n\nTails (Miles Prower) es el mejor amigo de Sonic. Es un zorro con dos colas que puede volar girándolas como helicóptero.",
                                            "question": "¿Cuántas colas tiene Tails?",
                                            "options": [
                                                        "Dos colas",
                                                        "Una cola",
                                                        "Tres colas",
                                                        "Cuatro colas"
                                            ],
                                            "correct": 0,
                                            "hint": "Su nombre 'Tails' significa 'colas'. Lee el último párrafo.",
                                            "explanation": "El texto dice: 'un zorro con dos colas'. 💨"
                                },
                                {
                                            "instruction": "📝 Sinónimos:",
                                            "question": "¿Cuál es un SINÓNIMO de 'valiente'?",
                                            "options": [
                                                        "Corajudo",
                                                        "Miedoso",
                                                        "Débil",
                                                        "Triste"
                                            ],
                                            "correct": 0,
                                            "hint": "Un sinónimo tiene significado parecido. Valiente = sin miedo.",
                                            "explanation": "'Corajudo' es sinónimo de 'valiente'. Ambos significan tener coraje. 🦁"
                                },
                                {
                                            "instruction": "📖 Lee sobre Minecraft:",
                                            "passageTitle": "Construye Tu Mundo",
                                            "passage": "Minecraft es un juego de bloques. Hay tres modos: Supervivencia (conseguir recursos), Creativo (recursos infinitos), y Aventura (mapas especiales).\n\nEn Supervivencia, por la noche aparecen: Creepers que explotan, Zombies, Esqueletos con flechas, y Arañas trepadoras. Debes construir refugio antes de que oscurezca.\n\nEl Diamante es el recurso más valioso. Solo se encuentra entre los niveles 5 y 12 en las cuevas. Con diamantes haces las herramientas más fuertes.",
                                            "question": "¿Entre qué niveles se encuentran los diamantes?",
                                            "options": [
                                                        "Entre niveles 5 y 12",
                                                        "Entre niveles 1 y 10",
                                                        "Entre niveles 10 y 20",
                                                        "Entre niveles 5 y 15"
                                            ],
                                            "correct": 0,
                                            "hint": "Busca en el último párrafo sobre los diamantes.",
                                            "explanation": "El texto dice: 'entre los niveles 5 y 12'. ⛏️💎"
                                },
                                {
                                            "instruction": "📝 Antónimos:",
                                            "question": "¿Cuál es un ANTÓNIMO de 'rápido'?",
                                            "options": [
                                                        "Lento",
                                                        "Veloz",
                                                        "Ágil",
                                                        "Ligero"
                                            ],
                                            "correct": 0,
                                            "hint": "Un antónimo es lo contrario. Opuesto de rápido es...",
                                            "explanation": "'Lento' es antónimo de 'rápido'. Son opuestos. 🐢⚡"
                                },
                                {
                                            "instruction": "📖 Lee sobre Fortnite:",
                                            "passageTitle": "La Victoria Real",
                                            "passage": "Fortnite es un juego donde 100 jugadores compiten en una isla. El objetivo es ser el último en pie para ganar la Victoria Real. La partida empieza saltando del autobús volador.\n\nPuedes construir con tres materiales: madera (débil pero rápida), ladrillo (equilibrado), y metal (la más fuerte pero lenta de construir).\n\nDurante la partida, una tormenta morada reduce el área de juego. Si te quedas fuera, pierdes vida constantemente.",
                                            "question": "¿Cuál es el material MÁS FUERTE para construir?",
                                            "options": [
                                                        "Metal",
                                                        "Madera",
                                                        "Ladrillo",
                                                        "Piedra"
                                            ],
                                            "correct": 0,
                                            "hint": "Busca en el segundo párrafo donde compara los tres materiales.",
                                            "explanation": "El texto dice: 'metal (la más fuerte pero lenta de construir)'. 🔨"
                                }
                    ],
                    "science": [
                                {
                                            "instruction": "🔬 Estados de la materia:",
                                            "question": "El agua en forma de hielo está en estado:",
                                            "options": [
                                                        "Sólido",
                                                        "Líquido",
                                                        "Gaseoso",
                                                        "Plasma"
                                            ],
                                            "correct": 0,
                                            "hint": "Cuando el agua se congela, se vuelve dura como piedra.",
                                            "explanation": "El hielo es agua en estado SÓLIDO. A 0°C o menos, se vuelve duro. ❄️"
                                },
                                {
                                            "instruction": "🌱 ¡Ciencias Naturales! Las plantas:",
                                            "question": "¿Qué necesitan las plantas para hacer fotosíntesis?",
                                            "options": [
                                                        "Luz solar, agua y dióxido de carbono",
                                                        "Solo agua",
                                                        "Solo tierra",
                                                        "Solo aire"
                                            ],
                                            "correct": 0,
                                            "hint": "Las plantas usan: energía del sol, agua del suelo, y un gas del aire.",
                                            "explanation": "Usan: luz solar (energía), agua (del suelo), y CO₂ (del aire). Producen su alimento y oxígeno. 🌳☀️"
                                },
                                {
                                            "instruction": "⚡ ¡Electricidad con Pikachu!",
                                            "question": "¿Qué tipo de energía produce Pikachu con sus ataques eléctricos?",
                                            "options": [
                                                        "Energía eléctrica",
                                                        "Energía térmica",
                                                        "Energía nuclear",
                                                        "Energía química"
                                            ],
                                            "correct": 0,
                                            "hint": "Pikachu lanza rayos y truenos. Eso es electricidad.",
                                            "explanation": "Pikachu produce ENERGÍA ELÉCTRICA (movimiento de electrones). ⚡"
                                },
                                {
                                            "instruction": "🌍 ¡Geografía del planeta Tierra!",
                                            "question": "¿Cuál es el planeta más cercano al Sol?",
                                            "options": [
                                                        "Mercurio",
                                                        "Venus",
                                                        "Tierra",
                                                        "Marte"
                                            ],
                                            "correct": 0,
                                            "hint": "Es el más pequeño y el primero desde el Sol.",
                                            "explanation": "MERCURIO está a 58 millones de km del Sol. Su temperatura puede llegar a 430°C. ☀️🪐"
                                },
                                {
                                            "instruction": "🦴 ¡Sistema óseo humano!",
                                            "question": "¿Cuántos huesos tiene aproximadamente un adulto humano?",
                                            "options": [
                                                        "206 huesos",
                                                        "150 huesos",
                                                        "300 huesos",
                                                        "100 huesos"
                                            ],
                                            "correct": 0,
                                            "hint": "Es un número entre 200 y 210. Los bebés tienen más pero se fusionan.",
                                            "explanation": "Un adulto tiene aproximadamente 206 HUESOS. Los bebés nacen con unos 300. 🦴"
                                },
                                {
                                            "instruction": "💧 ¡El ciclo del agua!",
                                            "question": "¿Cómo se llama cuando el agua líquida se convierte en vapor?",
                                            "options": [
                                                        "Evaporación",
                                                        "Condensación",
                                                        "Precipitación",
                                                        "Solidificación"
                                            ],
                                            "correct": 0,
                                            "hint": "Es cuando el Sol calienta el agua y sube al cielo como vapor.",
                                            "explanation": "La EVAPORACIÓN es cuando el agua líquida se transforma en vapor por el calor. ☁️💧"
                                },
                                {
                                            "instruction": "🔋 ¡Energías renovables!",
                                            "question": "¿Cuál de estas es una energía renovable?",
                                            "options": [
                                                        "Energía solar",
                                                        "Petróleo",
                                                        "Carbón",
                                                        "Gas natural"
                                            ],
                                            "correct": 0,
                                            "hint": "Renovable = no se agota. Piensa en algo del Sol.",
                                            "explanation": "La ENERGÍA SOLAR es renovable porque el Sol brilla todos los días. ☀️🌱"
                                },
                                {
                                            "instruction": "🐛 ¡Metamorfosis de los insectos!",
                                            "question": "¿En qué orden ocurre la metamorfosis de una mariposa?",
                                            "options": [
                                                        "Huevo → Oruga → Crisálida → Mariposa",
                                                        "Huevo → Crisálida → Oruga → Mariposa",
                                                        "Oruga → Huevo → Mariposa → Crisálida",
                                                        "Mariposa → Huevo → Oruga → Crisálida"
                                            ],
                                            "correct": 0,
                                            "hint": "Primero nace como gusano, luego se envuelve, y sale volando.",
                                            "explanation": "La metamorfosis: HUEVO → ORUGA (come mucho) → CRISÁLIDA (se transforma) → MARIPOSA. 🦋"
                                },
                                {
                                            "instruction": "🌡️ ¡Temperatura y calor!",
                                            "question": "¿A qué temperatura se congela el agua pura?",
                                            "options": [
                                                        "0 grados Celsius",
                                                        "10 grados Celsius",
                                                        "100 grados Celsius",
                                                        "-10 grados Celsius"
                                            ],
                                            "correct": 0,
                                            "hint": "Es el punto donde el agua se vuelve hielo. Número redondo fácil.",
                                            "explanation": "El agua se congela a 0°C. A 100°C hierve y se evapora. ❄️🌡️"
                                },
                                {
                                            "instruction": "🫀 ¡Sistema circulatorio!",
                                            "question": "¿Qué órgano bombea la sangre por todo el cuerpo?",
                                            "options": [
                                                        "El corazón",
                                                        "El cerebro",
                                                        "Los pulmones",
                                                        "El estómago"
                                            ],
                                            "correct": 0,
                                            "hint": "Está en el pecho y late constantemente. Cuando corres, late más rápido.",
                                            "explanation": "El CORAZÓN bombea sangre. Late aprox. 100.000 veces al día. ❤️"
                                },
                                {
                                            "instruction": "🌙 ¡Las fases de la Luna!",
                                            "question": "¿Cuánto tiempo tarda la Luna en dar una vuelta completa alrededor de la Tierra?",
                                            "options": [
                                                        "Aproximadamente 28 días",
                                                        "7 días",
                                                        "365 días",
                                                        "24 horas"
                                            ],
                                            "correct": 0,
                                            "hint": "Es casi un mes. Por eso cada semana la Luna se ve diferente.",
                                            "explanation": "La Luna tarda aproximadamente 28 DÍAS (casi un mes) en orbitar la Tierra. 🌙"
                                },
                                {
                                            "instruction": "⚛️ ¡Los átomos y las moléculas!",
                                            "question": "¿Qué es lo más pequeño: un átomo o una molécula?",
                                            "options": [
                                                        "Un átomo",
                                                        "Una molécula",
                                                        "Son del mismo tamaño",
                                                        "Una célula"
                                            ],
                                            "correct": 0,
                                            "hint": "Las moléculas están hechas de varios átomos unidos.",
                                            "explanation": "Un ÁTOMO es más pequeño. Las moléculas son grupos de átomos unidos. ⚛️"
                                },
                                {
                                            "instruction": "🦷 ¡Los dientes humanos!",
                                            "question": "¿Cuántos dientes permanentes tiene un adulto humano?",
                                            "options": [
                                                        "32 dientes",
                                                        "20 dientes",
                                                        "28 dientes",
                                                        "40 dientes"
                                            ],
                                            "correct": 0,
                                            "hint": "Incluye las muelas del juicio. Si cuentas arriba y abajo, son bastantes.",
                                            "explanation": "Un adulto tiene 32 DIENTES (incluyendo 4 muelas del juicio). 🦷✨"
                                },
                                {
                                            "instruction": "🌈 ¡La luz y los colores!",
                                            "question": "¿Cuántos colores tiene el arcoíris?",
                                            "options": [
                                                        "7 colores",
                                                        "5 colores",
                                                        "10 colores",
                                                        "3 colores"
                                            ],
                                            "correct": 0,
                                            "hint": "Rojo, naranja, amarillo, verde, azul, añil y violeta. Cuenta.",
                                            "explanation": "El arcoíris tiene 7 COLORES: Rojo, Naranja, Amarillo, Verde, Azul, Añil, Violeta. 🌈"
                                },
                                {
                                            "instruction": "🐟 ¡Animales vertebrados e invertebrados!",
                                            "question": "¿Cuál de estos animales es INVERTEBRADO (no tiene columna)?",
                                            "options": [
                                                        "Pulpo",
                                                        "Perro",
                                                        "Gato",
                                                        "Pájaro"
                                            ],
                                            "correct": 0,
                                            "hint": "Los invertebrados no tienen huesos en la espalda. Animales blandos.",
                                            "explanation": "El PULPO es invertebrado porque no tiene columna ni huesos. 🐙"
                                },
                                {
                                            "instruction": "🌋 ¡Volcanes y la Tierra!",
                                            "question": "¿Cómo se llama la roca fundida que sale de un volcán?",
                                            "options": [
                                                        "Lava",
                                                        "Magma",
                                                        "Ceniza",
                                                        "Roca ígnea"
                                            ],
                                            "correct": 0,
                                            "hint": "Cuando está dentro se llama magma, pero cuando sale se llama...",
                                            "explanation": "La roca fundida que SALE del volcán es LAVA. Dentro se llama magma. 🌋"
                                },
                                {
                                            "instruction": "👂 ¡Los sentidos!",
                                            "question": "¿Cuál es el sentido que nos permite mantener el equilibrio?",
                                            "options": [
                                                        "El equilibrio (oído interno)",
                                                        "La vista",
                                                        "El tacto",
                                                        "El olfato"
                                            ],
                                            "correct": 0,
                                            "hint": "Aunque no es uno de los 5 sentidos tradicionales, está en el oído.",
                                            "explanation": "El EQUILIBRIO lo controla el oído interno (aparato vestibular). 👂⚖️"
                                },
                                {
                                            "instruction": "🧲 ¡Magnetismo y fuerzas!",
                                            "question": "¿Cuáles son los dos polos de un imán?",
                                            "options": [
                                                        "Norte y Sur",
                                                        "Positivo y Negativo",
                                                        "Este y Oeste",
                                                        "Arriba y Abajo"
                                            ],
                                            "correct": 0,
                                            "hint": "Son como los puntos cardinales de una brújula.",
                                            "explanation": "Los imanes tienen polo NORTE y polo SUR. Opuestos se atraen, iguales se repelen. 🧲"
                                }
                    ],
                    "social": [
                                {
                                            "instruction": "🗺️ ¡Geografía de España!",
                                            "question": "¿Cuál es la capital de España?",
                                            "options": [
                                                        "Madrid",
                                                        "Barcelona",
                                                        "Sevilla",
                                                        "Valencia"
                                            ],
                                            "correct": 0,
                                            "hint": "Es la ciudad más grande y está en el centro del país.",
                                            "explanation": "MADRID es la capital desde 1561. Tiene más de 3 millones de habitantes. 🇪🇸"
                                },
                                {
                                            "instruction": "⚔️ ¡Historia de la Edad Media!",
                                            "question": "¿Cómo se llamaban los soldados que iban a caballo con armadura?",
                                            "options": [
                                                        "Caballeros",
                                                        "Arqueros",
                                                        "Magos",
                                                        "Piratas"
                                            ],
                                            "correct": 0,
                                            "hint": "Usaban armadura de metal y protegían castillos. Montaban a...",
                                            "explanation": "Los CABALLEROS eran guerreros nobles que luchaban a caballo. ⚔️🛡️"
                                },
                                {
                                            "instruction": "🌍 ¡Los continentes!",
                                            "question": "¿Cuántos continentes hay en el mundo?",
                                            "options": [
                                                        "7 continentes",
                                                        "5 continentes",
                                                        "6 continentes",
                                                        "8 continentes"
                                            ],
                                            "correct": 0,
                                            "hint": "Asia, África, Europa, América del Norte, América del Sur, Oceanía y...",
                                            "explanation": "Hay 7 CONTINENTES: Asia, África, América del Norte, del Sur, Antártida, Europa y Oceanía. 🌏"
                                },
                                {
                                            "instruction": "🏛️ ¡Civilizaciones antiguas!",
                                            "question": "¿En qué país están las pirámides de Giza?",
                                            "options": [
                                                        "Egipto",
                                                        "México",
                                                        "China",
                                                        "Grecia"
                                            ],
                                            "correct": 0,
                                            "hint": "Es un país de África que está junto al río Nilo.",
                                            "explanation": "Las pirámides están en EGIPTO, junto al Nilo. Construidas hace más de 4.500 años. 🏜️"
                                },
                                {
                                            "instruction": "💰 ¡Economía básica!",
                                            "question": "¿Cuál es la moneda que se usa en la mayoría de países de Europa?",
                                            "options": [
                                                        "Euro",
                                                        "Dólar",
                                                        "Libra",
                                                        "Peso"
                                            ],
                                            "correct": 0,
                                            "hint": "Símbolo: €. Se usa en España, Francia, Italia, Alemania...",
                                            "explanation": "El EURO (€) es la moneda de 20 países de la Unión Europea. 💶"
                                },
                                {
                                            "instruction": "🗽 ¡Monumentos famosos!",
                                            "question": "¿En qué ciudad está la Estatua de la Libertad?",
                                            "options": [
                                                        "Nueva York",
                                                        "París",
                                                        "Londres",
                                                        "Roma"
                                            ],
                                            "correct": 0,
                                            "hint": "Es una ciudad de Estados Unidos, la más grande del país.",
                                            "explanation": "La Estatua de la Libertad está en NUEVA YORK. Fue un regalo de Francia en 1886. 🗽"
                                },
                                {
                                            "instruction": "🌊 ¡Océanos del mundo!",
                                            "question": "¿Cuál es el océano más grande del planeta?",
                                            "options": [
                                                        "Océano Pacífico",
                                                        "Océano Atlántico",
                                                        "Océano Índico",
                                                        "Océano Ártico"
                                            ],
                                            "correct": 0,
                                            "hint": "Su nombre significa 'tranquilo'. Está entre América y Asia.",
                                            "explanation": "El OCÉANO PACÍFICO es el más grande, cubre más de 165 millones de km². 🌊"
                                },
                                {
                                            "instruction": "👥 ¡Derechos humanos!",
                                            "question": "¿Cuál de estos es un derecho fundamental de todos los niños?",
                                            "options": [
                                                        "Derecho a la educación",
                                                        "Derecho a trabajar",
                                                        "Derecho a conducir",
                                                        "Derecho a votar"
                                            ],
                                            "correct": 0,
                                            "hint": "Todos los niños deben poder ir a...",
                                            "explanation": "El DERECHO A LA EDUCACIÓN es fundamental. Todos los niños tienen derecho a aprender. 📚"
                                },
                                {
                                            "instruction": "🗺️ ¡Comunidades Autónomas!",
                                            "question": "¿Cuántas Comunidades Autónomas tiene España?",
                                            "options": [
                                                        "17 Comunidades",
                                                        "15 Comunidades",
                                                        "20 Comunidades",
                                                        "12 Comunidades"
                                            ],
                                            "correct": 0,
                                            "hint": "Incluye Cataluña, Andalucía, Madrid, Aragón... cuenta bien todas.",
                                            "explanation": "España tiene 17 COMUNIDADES AUTÓNOMAS más 2 ciudades autónomas. 🇪🇸"
                                },
                                {
                                            "instruction": "⏰ ¡La medida del tiempo!",
                                            "question": "¿Cuántos años forman un siglo?",
                                            "options": [
                                                        "100 años",
                                                        "50 años",
                                                        "10 años",
                                                        "1.000 años"
                                            ],
                                            "correct": 0,
                                            "hint": "Un siglo es mucho tiempo. Es un número redondo muy grande.",
                                            "explanation": "Un SIGLO son 100 AÑOS. Estamos en el siglo XXI (21), que comenzó en 2001. ⏰"
                                },
                                {
                                            "instruction": "🏔️ ¡Geografía física de España!",
                                            "question": "¿Cuál es el río más largo de España?",
                                            "options": [
                                                        "Río Tajo",
                                                        "Río Ebro",
                                                        "Río Duero",
                                                        "Río Guadalquivir"
                                            ],
                                            "correct": 0,
                                            "hint": "Pasa por Toledo y desemboca en Lisboa, Portugal.",
                                            "explanation": "El RÍO TAJO es el más largo con 1.008 km. Desemboca en Lisboa. 🏞️"
                                },
                                {
                                            "instruction": "🌐 ¡Las banderas del mundo!",
                                            "question": "¿De qué colores es la bandera de España?",
                                            "options": [
                                                        "Rojo y amarillo",
                                                        "Azul y blanco",
                                                        "Verde y rojo",
                                                        "Rojo y blanco"
                                            ],
                                            "correct": 0,
                                            "hint": "Son dos colores. Uno es el color del sol.",
                                            "explanation": "La bandera de España tiene franjas ROJA-AMARILLA-ROJA. 🇪🇸"
                                },
                                {
                                            "instruction": "🏛️ ¡Democracia y gobierno!",
                                            "question": "¿Cómo se llama la persona que dirige el gobierno de un país?",
                                            "options": [
                                                        "Presidente o Primer Ministro",
                                                        "Rey o Reina",
                                                        "Alcalde",
                                                        "Gobernador"
                                            ],
                                            "correct": 0,
                                            "hint": "En España se llama Presidente del Gobierno. Toma las decisiones políticas.",
                                            "explanation": "Puede ser PRESIDENTE o PRIMER MINISTRO. Es elegido por votación. 🏛️"
                                },
                                {
                                            "instruction": "🗓️ ¡Historia de España!",
                                            "question": "¿En qué año descubrió Cristóbal Colón América?",
                                            "options": [
                                                        "1492",
                                                        "1500",
                                                        "1400",
                                                        "1600"
                                            ],
                                            "correct": 0,
                                            "hint": "Es un año muy famoso. Siglo XV.",
                                            "explanation": "Cristóbal Colón llegó a América el 12 de octubre de 1492. 🚢"
                                },
                                {
                                            "instruction": "🌍 ¡Países y capitales de Europa!",
                                            "question": "¿Cuál es la capital de Francia?",
                                            "options": [
                                                        "París",
                                                        "Londres",
                                                        "Berlín",
                                                        "Roma"
                                            ],
                                            "correct": 0,
                                            "hint": "Es la ciudad de la Torre Eiffel y el río Sena.",
                                            "explanation": "PARÍS es la capital de Francia. Famosa por la Torre Eiffel. 🗼"
                                },
                                {
                                            "instruction": "🏰 ¡Edad Media en España!",
                                            "question": "¿Cómo se llamaban los palacios fortificados donde vivían los reyes?",
                                            "options": [
                                                        "Castillos",
                                                        "Iglesias",
                                                        "Mezquitas",
                                                        "Catedrales"
                                            ],
                                            "correct": 0,
                                            "hint": "Tenían murallas, torres y un foso con agua. Protegían de los ataques.",
                                            "explanation": "Los CASTILLOS eran fortalezas donde vivían reyes y nobles. 🏰⚔️"
                                },
                                {
                                            "instruction": "🌏 ¡La población mundial!",
                                            "question": "¿Cuál es el país con más habitantes del mundo?",
                                            "options": [
                                                        "India",
                                                        "China",
                                                        "Estados Unidos",
                                                        "Indonesia"
                                            ],
                                            "correct": 0,
                                            "hint": "Hasta 2023 era China, pero ahora otro país asiático lo superó.",
                                            "explanation": "INDIA es actualmente el país más poblado con más de 1.400 millones. 👥"
                                },
                                {
                                            "instruction": "📅 ¡El calendario!",
                                            "question": "¿Cuántos meses tiene un año?",
                                            "options": [
                                                        "12 meses",
                                                        "10 meses",
                                                        "11 meses",
                                                        "13 meses"
                                            ],
                                            "correct": 0,
                                            "hint": "Enero, Febrero, Marzo... cuenta hasta Diciembre.",
                                            "explanation": "Un año tiene 12 MESES. Algunos tienen 31 días, otros 30, y febrero 28/29. 📅"
                                }
                    ]
        };

        const achievements = [
            { id: 'first_day', name: '¡Primer Día Genial!', description: 'Completa tu primer día de ejercicios', icon: '🌟' },
            { id: 'week_warrior', name: 'Guerrero de la Semana', description: 'Completa una semana completa', icon: '⚔️' },
            { id: 'perfect_score', name: 'Perfección Total', description: 'Consigue 100% en todos los ejercicios de un día', icon: '💯' },
            { id: 'streak_5', name: 'Racha de Fuego', description: 'Mantén una racha de 5 días', icon: '🔥' },
            { id: 'streak_10', name: 'Imparable', description: 'Mantén una racha de 10 días', icon: '⚡' },
            { id: 'math_master', name: 'Maestro de Mates', description: 'Completa 20 ejercicios de matemáticas', icon: '🧮' },
            { id: 'reading_pro', name: 'Súper Lector', description: 'Completa 20 ejercicios de lectura', icon: '📚' },
            { id: 'science_genius', name: 'Genio Científico', description: 'Completa 20 ejercicios de ciencias', icon: '🔬' },
            { id: 'social_expert', name: 'Experto Social', description: 'Completa 20 ejercicios de sociales', icon: '🌍' },
            { id: 'century_club', name: 'Club del Centenar', description: 'Completa 100 ejercicios en total', icon: '💪' },
            { id: 'speed_demon', name: 'Rayo Veloz', description: 'Completa un día en menos de 20 minutos', icon: '⚡' }
        ];

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            statusElement.className = 'connection-status ' + status;
            
            const statusMessages = {
                'online': '✅ Conectado',
                'offline': '⚠️ Desconectado',
                'connecting': '🔄 Conectando...',
                'error': '❌ Error'
            };
            
            statusText.textContent = statusMessages[status] || 'Desconocido';
        }

        function createNewUser() {
            return {
                totalPoints: 0,
                streak: 0,
                lastActiveDate: null,
                achievements: [],
                completedDays: [],
                totalExercises: 0,
                correctAnswers: 0,
                totalAttempts: 0, // NUEVO: Total de intentos (incluye fallos)
                wrongAnswers: 0,   // NUEVO: Respuestas incorrectas
                exercisesByType: {
                    math: 0,
                    reading: 0,
                    science: 0,
                    social: 0
                },
                dailyProgress: {}
            };
        }

        function ensureUserDataStructure(userData) {
            if (!userData) return createNewUser();
            
            // Asegurar que existan todas las propiedades
            if (!userData.exercisesByType) {
                userData.exercisesByType = {
                    math: 0,
                    reading: 0,
                    science: 0,
                    social: 0
                };
            }
            if (!userData.achievements) userData.achievements = [];
            if (!userData.completedDays) userData.completedDays = [];
            if (typeof userData.totalPoints !== 'number') userData.totalPoints = 0;
            if (typeof userData.streak !== 'number') userData.streak = 0;
            if (typeof userData.totalExercises !== 'number') userData.totalExercises = 0;
            if (typeof userData.correctAnswers !== 'number') userData.correctAnswers = 0;
            if (typeof userData.totalAttempts !== 'number') userData.totalAttempts = 0;
            if (typeof userData.wrongAnswers !== 'number') userData.wrongAnswers = 0;
            
            return userData;
        }

        // ==================== FUNCIONES DE NORMALIZACIÓN ====================
        
        /**
         * Normaliza la estructura de datos de un usuario al formato estándar
         * Maneja tanto el formato antiguo como el nuevo
         */
        function normalizeUserData(userData, username) {
            console.log(`🔧 Normalizando datos para usuario: ${username}`);
            
            // Si ya tiene la estructura correcta, solo asegurar campos
            const normalized = ensureUserDataStructure(userData);
            
            // Convertir completedDays (string array) a array si es necesario
            if (normalized.completedDays && typeof normalized.completedDays === 'object' && !Array.isArray(normalized.completedDays)) {
                // Si completedDays es un objeto en lugar de array, convertirlo
                normalized.completedDays = Object.values(normalized.completedDays).filter(v => typeof v === 'string');
            }
            
            // Asegurar que completedDays sea un array
            if (!Array.isArray(normalized.completedDays)) {
                normalized.completedDays = [];
            }
            
            console.log('✅ Datos normalizados para', username);
            return normalized;
        }

        /**
         * Limpia y normaliza toda la estructura de datos
         * MANTIENE usuarios en la raíz como en el archivo original
         * Mueve usuarios que estén dentro de un objeto 'users' a la raíz
         */
        function cleanAndNormalizeAllData(data) {
            console.log('🧹 Iniciando limpieza y normalización de datos...');
            
            const cleaned = {};
            
            // Campos del sistema que no son usuarios
            const systemFields = ['currentWeek', 'currentDay', 'currentExercise', 'stars', 
                                 'correctAnswers', 'daysCompleted', 'completedDays', 'startTime',
                                 'currentColor', 'totalFailures', 'currentExerciseFailures',
                                 'failuresByExercise', 'exerciseAttempts', 'users'];
            
            // Primero, si hay un objeto 'users', mover sus usuarios a la raíz
            if (data.users && typeof data.users === 'object') {
                console.log('⚠️ Detectado objeto "users" - moviendo usuarios a la raíz');
                Object.keys(data.users).forEach(username => {
                    console.log(`🔄 Moviendo usuario de users.${username} a raíz`);
                    cleaned[username] = normalizeUserData(data.users[username], username);
                });
            }
            
            // Procesar todos los campos en la raíz
            Object.keys(data).forEach(key => {
                const value = data[key];
                
                // Si es un campo del sistema, ignorarlo (no lo necesitamos en la nueva estructura)
                if (systemFields.includes(key)) {
                    return;
                }
                
                // Si parece datos de usuario (tiene campos como totalPoints, streak, etc.)
                if (value && typeof value === 'object' && 
                    (value.totalPoints !== undefined || value.streak !== undefined || 
                     value.achievements !== undefined || value.totalExercises !== undefined ||
                     value.completedDays !== undefined)) {
                    
                    console.log(`👤 Usuario encontrado en raíz: ${key}`);
                    // Si ya lo procesamos desde 'users', no sobrescribir
                    if (!cleaned[key]) {
                        cleaned[key] = normalizeUserData(value, key);
                    }
                }
            });
            
            console.log('✅ Limpieza completada. Usuarios encontrados:', Object.keys(cleaned));
            return cleaned;
        }
        
        // ==================== FIN FUNCIONES DE NORMALIZACIÓN ====================

        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            
            if (!username) {
                alert('¡Por favor escribe tu nombre de entrenador súper genial! 😊');
                return;
            }
            
            try {
                appState.currentUser = username;
                const displayElement = document.getElementById('currentUserDisplay');
                if (displayElement) {
                    displayElement.textContent = username;
                }
                
                updateConnectionStatus('connecting');
                await loadUserData();
                
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                updateUserInterface();
                generateWeeks();
                
                // Cargar las pestañas iniciales
                loadStats();
                loadAchievements();
                loadRanking();
                
                console.log('✅ Login completado exitosamente');
            } catch (error) {
                console.error('❌ Error en login:', error);
                updateConnectionStatus('error');
                alert('❌ Error al iniciar sesión. Por favor, intenta de nuevo.');
            }
        }

        async function loadUserData() {
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('📦 Datos recibidos del servidor:', data.record);
                    
                    // ====== APLICAR LIMPIEZA Y NORMALIZACIÓN ======
                    appState.allUsersData = cleanAndNormalizeAllData(data.record || {});
                    console.log('✨ Datos normalizados:', appState.allUsersData);
                    
                    if (!appState.allUsersData[appState.currentUser]) {
                        appState.allUsersData[appState.currentUser] = createNewUser();
                    }
                    
                    appState.userData = normalizeUserData(appState.allUsersData[appState.currentUser], appState.currentUser);
                    
                    // Guardar la versión limpia de vuelta al servidor
                    await saveUserData();
                    
                    updateConnectionStatus('online');
                    checkStreak();
                } else {
                    throw new Error('Error al cargar datos');
                }
            } catch (error) {
                console.error('Error:', error);
                updateConnectionStatus('error');
                
                appState.allUsersData[appState.currentUser] = createNewUser();
                appState.userData = ensureUserDataStructure(appState.allUsersData[appState.currentUser]);
            }
        }

        async function saveUserData() {
            try {
                appState.allUsersData[appState.currentUser] = appState.userData;
                
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    },
                    body: JSON.stringify(appState.allUsersData)
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                } else {
                    throw new Error('Error al guardar');
                }
            } catch (error) {
                console.error('Error al guardar:', error);
                updateConnectionStatus('error');
            }
        }

        function checkStreak() {
            const today = new Date().toDateString();
            const lastActive = appState.userData.lastActiveDate;
            
            if (!lastActive) {
                appState.userData.streak = 0;
                return;
            }
            
            const lastDate = new Date(lastActive);
            const diffTime = new Date(today) - lastDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 1) {
                appState.userData.streak = 0;
            }
        }

        function updateUserInterface() {
            const userData = appState.userData || createNewUser();
            
            document.getElementById('userName').textContent = appState.currentUser || 'Entrenador';
            document.getElementById('userAvatar').textContent = appState.currentUser ? appState.currentUser[0].toUpperCase() : '🎮';
            document.getElementById('totalPoints').textContent = userData.totalPoints || 0;
            document.getElementById('streak').textContent = userData.streak || 0;
            document.getElementById('achievements').textContent = (userData.achievements && userData.achievements.length) || 0;
            
            const level = Math.floor(userData.totalPoints / 100) + 1;
            const levelNames = {
                1: 'Novato Genial',
                2: 'Aprendiz Súper',
                3: 'Estudiante Pro',
                4: 'Experto Total',
                5: 'Maestro Pokemon',
                10: '¡CAMPEÓN LEGENDARIO!'
            };
            const levelName = levelNames[Math.min(level, 10)] || `Nivel ${level}`;
            document.getElementById('userLevel').textContent = `Nivel ${level} - ${levelName}`;
        }

        function generateWeeks() {
            const container = document.getElementById('weeksContainer');
            container.innerHTML = '';
            
            const today = new Date();
            const weeks = 1;
            
            for (let week = 0; week < weeks; week++) {
                const weekDiv = document.createElement('div');
                weekDiv.style.marginBottom = '40px';
                
                const weekHeader = document.createElement('h3');
                weekHeader.style.fontFamily = "'Fredoka One', cursive";
                weekHeader.style.fontSize = '24px';
                weekHeader.style.marginBottom = '20px';
                weekHeader.style.color = '#2d3436';
                weekHeader.textContent = `🌟 Semana ${week + 1}`;
                weekDiv.appendChild(weekHeader);
                
                const grid = document.createElement('div');
                grid.className = 'calendar-grid';
                
                const dayNames = ['L', 'M', 'X', 'J', 'V', 'S', 'D'];
                dayNames.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'day-header';
                    header.textContent = day;
                    grid.appendChild(header);
                });
                
                const startDate = new Date(today);
                startDate.setDate(today.getDate() - today.getDay() + 1 + (week * 7));
                
                const firstDayOfWeek = startDate.getDay() === 0 ? 6 : startDate.getDay() - 1;
                
                for (let i = 0; i < firstDayOfWeek; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'day-cell empty';
                    grid.appendChild(emptyCell);
                }
                
                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + day);
                    
                    const dayCell = document.createElement('div');
                    dayCell.className = 'day-cell';
                    
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'day-number';
                    dayNumber.textContent = currentDate.getDate();
                    dayCell.appendChild(dayNumber);
                    
                    const dateKey = currentDate.toDateString();
                    const isCompleted = appState.userData.completedDays.includes(dateKey);
                    const isToday = dateKey === today.toDateString();
                    const isPast = currentDate < today && !isToday;
                    const isFuture = currentDate > today;
                    
                    const statusIcon = document.createElement('div');
                    statusIcon.className = 'day-status';
                    
                    if (isCompleted) {
                        dayCell.classList.add('completed');
                        statusIcon.textContent = '✅';
                    } else if (isToday) {
                        dayCell.classList.add('current');
                        statusIcon.textContent = '🎯';
                    } else if (isFuture) {
                        dayCell.classList.add('disabled');
                        statusIcon.textContent = '🔒';
                    } else if (isPast) {
                        // Los días pasados NO completados están disponibles para recuperar
                        dayCell.classList.add('recoverable');
                        statusIcon.textContent = '📝';
                    }
                    
                    dayCell.appendChild(statusIcon);
                    
                    // Permitir click en día actual O días pasados no completados
                    if ((isToday || isPast) && !isCompleted) {
                        dayCell.onclick = () => startDayExercises(dateKey);
                        dayCell.style.cursor = 'pointer';
                    }
                    
                    grid.appendChild(dayCell);
                }
                
                weekDiv.appendChild(grid);
                container.appendChild(weekDiv);
            }
        }

        /**
         * Genera ejercicios únicos para cada día de la semana
         * Cada semana tiene 7 días (L-D) con 10 ejercicios cada uno (70 ejercicios/semana)
         * Los ejercicios NO se repiten dentro de la misma semana
         */
        function generateDailyExercises() {
            const dateKey = appState.currentDay || new Date().toDateString();
            const date = new Date(dateKey);
            
            // Calcular número de semana y día de la semana (0=Domingo, 1=Lunes, ..., 6=Sábado)
            const weekNumber = getWeekNumber(date);
            const dayOfWeek = date.getDay(); // 0=Domingo, 1=Lunes, 2=Martes, etc.
            
            console.log(`📅 Generando ejercicios para: ${dateKey}, Semana ${weekNumber}, Día ${dayOfWeek}`);
            
            // Crear un pool de todos los ejercicios disponibles
            const allExercises = [];
            const subjects = ['math', 'reading', 'science', 'social'];
            
            subjects.forEach(subject => {
                exerciseBank[subject].forEach((exercise, index) => {
                    allExercises.push({
                        ...exercise,
                        subject: subject,
                        id: `${subject}_${index}` // ID único para cada ejercicio
                    });
                });
            });
            
            console.log(`📚 Total ejercicios en el banco: ${allExercises.length}`);
            
            // Usar semana como seed para shufflear
            const weekSeed = hashString(`week_${weekNumber}`);
            
            // Shufflear todos los ejercicios de forma determinística para esta semana
            const weekExercises = [...allExercises].sort((a, b) => {
                const hashA = hashString(a.id + weekSeed);
                const hashB = hashString(b.id + weekSeed);
                return hashA - hashB;
            });
            
            // Dividir los ejercicios en 7 días (10 ejercicios por día)
            const exercisesPerDay = 10;
            const startIndex = dayOfWeek * exercisesPerDay;
            const endIndex = startIndex + exercisesPerDay;
            
            // Obtener los ejercicios para este día específico
            const todayExercises = weekExercises.slice(startIndex, endIndex);
            
            // Si no hay suficientes ejercicios (banco pequeño), repetir desde el principio
            if (todayExercises.length < exercisesPerDay) {
                const needed = exercisesPerDay - todayExercises.length;
                const additional = weekExercises.slice(0, needed);
                todayExercises.push(...additional);
            }
            
            console.log(`✅ Ejercicios del día ${dayOfWeek}: ${todayExercises.length} ejercicios`);
            console.log(`📝 IDs: ${todayExercises.map(e => e.id).join(', ')}`);
            
            return todayExercises;
        }

        /**
         * Calcula el número de semana del año
         */
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // Función para crear un hash simple y determinístico de una cadena
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convertir a entero de 32 bits
            }
            return Math.abs(hash);
        }

        function startDayExercises(dateKey) {
            appState.currentDay = dateKey;
            appState.currentExerciseIndex = 0;
            appState.currentExercises = generateDailyExercises();
            appState.sessionStartTime = Date.now();
            appState.timeRemaining = 1800;
            
            document.getElementById('exerciseModal').style.display = 'flex';
            updateProgressIndicator();
            startTimer();
            loadExercise();
        }

        function startTimer() {
            if (appState.timerInterval) {
                clearInterval(appState.timerInterval);
            }
            
            appState.timerInterval = setInterval(() => {
                appState.timeRemaining--;
                
                const minutes = Math.floor(appState.timeRemaining / 60);
                const seconds = appState.timeRemaining % 60;
                document.getElementById('timerDisplay').textContent = 
                    `⏱️ Tiempo: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (appState.timeRemaining <= 0) {
                    clearInterval(appState.timerInterval);
                    alert('⏰ ¡Se acabó el tiempo! Pero no te preocupes, ¡puedes seguir mañana! 💪');
                    closeExerciseModal();
                }
            }, 1000);
        }

        function updateProgressIndicator() {
            const container = document.getElementById('progressIndicator');
            container.innerHTML = '';
            
            appState.currentExercises.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (index < appState.currentExerciseIndex) {
                    dot.classList.add('completed');
                } else if (index === appState.currentExerciseIndex) {
                    dot.classList.add('current');
                }
                container.appendChild(dot);
            });
        }

        function loadExercise() {
            const exercise = appState.currentExercises[appState.currentExerciseIndex];
            const container = document.getElementById('exerciseContainer');
            
            document.getElementById('exerciseTitle').textContent = 
                `Ejercicio ${appState.currentExerciseIndex + 1} de ${appState.currentExercises.length}`;
            
            const badges = document.getElementById('subjectBadges');
            badges.innerHTML = `<span class="subject-badge ${exercise.subject}">${getSubjectName(exercise.subject)}</span>`;
            
            document.getElementById('hintBox').classList.remove('visible');
            document.getElementById('feedbackBox').classList.remove('visible');
            document.getElementById('explanationBox').classList.remove('visible');
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('hintBtn').style.display = 'inline-block';
            appState.selectedAnswer = null;
            
            container.innerHTML = '';
            
            // Instrucción
            if (exercise.instruction) {
                const instructionDiv = document.createElement('div');
                instructionDiv.className = 'instruction-box';
                instructionDiv.innerHTML = `
                    <h4>📋 Instrucciones</h4>
                    <p>${exercise.instruction}</p>
                `;
                container.appendChild(instructionDiv);
            }
            
            // Texto de lectura LARGO si existe
            if (exercise.passage) {
                const passageDiv = document.createElement('div');
                passageDiv.className = 'reading-passage';
                
                if (exercise.passageTitle) {
                    passageDiv.innerHTML = `<h4>${exercise.passageTitle}</h4>`;
                }
                
                const paragraphs = exercise.passage.split('\n\n');
                paragraphs.forEach(para => {
                    const p = document.createElement('p');
                    p.textContent = para;
                    passageDiv.appendChild(p);
                });
                
                container.appendChild(passageDiv);
            }
            
            // Pregunta
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-container';
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = exercise.question;
            questionDiv.appendChild(questionText);
            
            // Opciones
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';
            
            exercise.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => selectOption(index);
                optionsContainer.appendChild(btn);
            });
            
            questionDiv.appendChild(optionsContainer);
            container.appendChild(questionDiv);
        }

        function getSubjectName(subject) {
            const names = {
                'math': '🧮 Matemáticas',
                'reading': '📖 Lengua',
                'science': '🔬 Ciencias Naturales',
                'social': '🌍 Ciencias Sociales'
            };
            return names[subject] || subject;
        }

        function selectOption(index) {
            document.querySelectorAll('.option-btn').forEach((btn, i) => {
                btn.classList.remove('selected');
                if (i === index) {
                    btn.classList.add('selected');
                }
            });
            appState.selectedAnswer = index;
        }

        function showHint() {
            const exercise = appState.currentExercises[appState.currentExerciseIndex];
            document.getElementById('hintText').textContent = exercise.hint;
            document.getElementById('hintBox').classList.add('visible');
        }

        function checkAnswer() {
            const exercise = appState.currentExercises[appState.currentExerciseIndex];
            
            if (appState.selectedAnswer === null) {
                alert('¡Por favor selecciona una respuesta primero! 😊');
                return;
            }
            
            const isCorrect = appState.selectedAnswer === exercise.correct;
            
            // REGISTRAR INTENTO
            appState.userData.totalAttempts++;
            
            document.querySelectorAll('.option-btn').forEach((btn, index) => {
                btn.style.pointerEvents = 'none';
                if (index === exercise.correct) {
                    btn.classList.add('correct');
                } else if (index === appState.selectedAnswer && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });
            
            appState.userData.totalExercises++;
            appState.userData.exercisesByType[exercise.subject]++;
            
            if (isCorrect) {
                appState.userData.correctAnswers++;
                appState.userData.totalPoints += 10;
                showFeedback(true, exercise);
            } else {
                // REGISTRAR FALLO Y PENALIZAR
                appState.userData.wrongAnswers++;
                // Penalización: -3 puntos por error (pero nunca bajar de 0)
                appState.userData.totalPoints = Math.max(0, appState.userData.totalPoints - 3);
                showFeedback(false, exercise);
            }
            
            showExplanation(exercise);
            
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
            document.getElementById('hintBtn').style.display = 'none';
            
            updateUserInterface();
        }

        function showFeedback(isCorrect, exercise) {
            const feedbackBox = document.getElementById('feedbackBox');
            const feedbackText = document.getElementById('feedbackText');
            
            feedbackBox.className = 'feedback-box visible';
            
            if (isCorrect) {
                feedbackBox.classList.add('correct');
                const messages = [
                    '🎉 ¡Súper correcto! ¡Eres genial!',
                    '⭐ ¡Perfecto! ¡Lo has clavado!',
                    '🌟 ¡Increíble! ¡Sigue así!',
                    '💪 ¡Excelente trabajo, campeón!',
                    '🏆 ¡Bravo! ¡Eres un crack!'
                ];
                feedbackText.textContent = messages[Math.floor(Math.random() * messages.length)];
            } else {
                feedbackBox.classList.add('incorrect');
                const correctAnswerText = exercise.options[exercise.correct];
                
                feedbackText.innerHTML = `
                    ❌ ¡Ups! No es correcto esta vez.<br>
                    <span style="font-size: 16px; margin-top: 10px; display: block;">
                        La respuesta correcta es: <strong>${correctAnswerText}</strong><br>
                        ¡No te preocupes, sigue intentándolo! 💪
                    </span>
                `;
            }
        }

        function showExplanation(exercise) {
            const explanationBox = document.getElementById('explanationBox');
            const explanationText = document.getElementById('explanationText');
            
            if (exercise.explanation) {
                explanationText.textContent = exercise.explanation;
                explanationBox.classList.add('visible');
            }
        }

        function nextExercise() {
            appState.currentExerciseIndex++;
            
            if (appState.currentExerciseIndex >= appState.currentExercises.length) {
                completeDayExercises();
            } else {
                updateProgressIndicator();
                loadExercise();
            }
        }

        function completeDayExercises() {
            clearInterval(appState.timerInterval);
            
            const dateKey = appState.currentDay;
            if (!appState.userData.completedDays.includes(dateKey)) {
                appState.userData.completedDays.push(dateKey);
            }
            
            const today = new Date().toDateString();
            if (!appState.userData.lastActiveDate || new Date(appState.userData.lastActiveDate).toDateString() !== today) {
                appState.userData.streak++;
                appState.userData.lastActiveDate = today;
            }
            
            const timeTaken = (Date.now() - appState.sessionStartTime) / 1000;
            
            checkAchievements(timeTaken);
            saveUserData();
            
            alert(`🎉 ¡Súper bien hecho! ¡Has completado el día!\n\n⭐ Puntos ganados: ${appState.userData.totalPoints}\n🔥 Racha actual: ${appState.userData.streak} días`);
            
            closeExerciseModal();
            generateWeeks();
            updateUserInterface();
        }

        function checkAchievements(timeTaken) {
            const toCheck = [];
            
            if (appState.userData.completedDays.length === 1) {
                toCheck.push('first_day');
            }
            if (appState.userData.completedDays.length === 7) {
                toCheck.push('week_warrior');
            }
            if (appState.userData.streak === 5) {
                toCheck.push('streak_5');
            }
            if (appState.userData.streak === 10) {
                toCheck.push('streak_10');
            }
            if (appState.userData.exercisesByType.math >= 20) {
                toCheck.push('math_master');
            }
            if (appState.userData.exercisesByType.reading >= 20) {
                toCheck.push('reading_pro');
            }
            if (appState.userData.exercisesByType.science >= 20) {
                toCheck.push('science_genius');
            }
            if (appState.userData.exercisesByType.social >= 20) {
                toCheck.push('social_expert');
            }
            if (appState.userData.totalExercises >= 100) {
                toCheck.push('century_club');
            }
            if (timeTaken < 1200) {
                toCheck.push('speed_demon');
            }
            
            const accuracy = (appState.userData.correctAnswers / appState.userData.totalExercises) * 100;
            if (accuracy === 100 && appState.userData.totalExercises >= 10) {
                toCheck.push('perfect_score');
            }
            
            toCheck.forEach(achievementId => {
                if (!appState.userData.achievements.includes(achievementId)) {
                    unlockAchievement(achievementId);
                }
            });
        }

        function unlockAchievement(achievementId) {
            appState.userData.achievements.push(achievementId);
            const achievement = achievements.find(a => a.id === achievementId);
            
            if (achievement) {
                document.getElementById('unlockedIcon').textContent = achievement.icon;
                document.getElementById('unlockedName').textContent = achievement.name;
                document.getElementById('unlockedDescription').textContent = achievement.description;
                document.getElementById('achievementUnlock').classList.add('visible');
                
                setTimeout(() => {
                    document.getElementById('achievementUnlock').classList.remove('visible');
                }, 5000);
            }
        }

        function closeAchievementUnlock() {
            document.getElementById('achievementUnlock').classList.remove('visible');
        }

        function closeExerciseModal() {
            clearInterval(appState.timerInterval);
            document.getElementById('exerciseModal').style.display = 'none';
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'achievements') {
                loadAchievements();
            } else if (tabName === 'ranking') {
                loadRanking();
            }
        }

        function loadRanking() {
            const allUsers = Object.entries(appState.allUsersData);
            
            console.log('📊 Ranking - Total usuarios:', allUsers.length);
            console.log('📊 Usuarios:', allUsers);
            
            if (allUsers.length === 0) {
                showNoRankingData();
                return;
            }
            
            let filteredUsers = allUsers;
            let showingFiltered = false;
            
            if (appState.currentRankingFilter === 'week') {
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                const weekFiltered = allUsers.filter(([_, data]) => {
                    return data.completedDays && data.completedDays.some(day => new Date(day) >= weekAgo);
                });
                // Si hay resultados con el filtro, usarlos; si no, mostrar todos
                if (weekFiltered.length > 0) {
                    filteredUsers = weekFiltered;
                    showingFiltered = true;
                }
            } else if (appState.currentRankingFilter === 'month') {
                const monthAgo = new Date();
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                const monthFiltered = allUsers.filter(([_, data]) => {
                    return data.completedDays && data.completedDays.some(day => new Date(day) >= monthAgo);
                });
                // Si hay resultados con el filtro, usarlos; si no, mostrar todos
                if (monthFiltered.length > 0) {
                    filteredUsers = monthFiltered;
                    showingFiltered = true;
                }
            }
            
            console.log('📊 Usuarios filtrados:', filteredUsers.length);
            
            // Ordenar usuarios por: 1) Logros, 2) Precisión, 3) Puntos totales
            const sortedUsers = filteredUsers.sort((a, b) => {
                const aAchievements = a[1].achievements ? a[1].achievements.length : 0;
                const bAchievements = b[1].achievements ? b[1].achievements.length : 0;
                
                // Primero por logros
                if (bAchievements !== aAchievements) {
                    return bAchievements - aAchievements;
                }
                
                // Luego por precisión (accuracy)
                const aAttempts = a[1].totalAttempts || 0;
                const bAttempts = b[1].totalAttempts || 0;
                const aAccuracy = aAttempts > 0 ? (a[1].correctAnswers || 0) / aAttempts : 0;
                const bAccuracy = bAttempts > 0 ? (b[1].correctAnswers || 0) / bAttempts : 0;
                
                if (Math.abs(bAccuracy - aAccuracy) > 0.01) { // Si hay diferencia significativa
                    return bAccuracy - aAccuracy;
                }
                
                // Finalmente por puntos totales
                return (b[1].totalPoints || 0) - (a[1].totalPoints || 0);
            });
            
            const podiumContainer = document.getElementById('podiumContainer');
            const tableContainer = document.getElementById('rankingTableContainer');
            podiumContainer.innerHTML = '';
            tableContainer.innerHTML = '';
            
            // Mostrar mensaje si estamos filtrando sin resultados del filtro
            if (!showingFiltered && appState.currentRankingFilter !== 'all') {
                const notice = document.createElement('div');
                notice.style.cssText = 'text-align: center; padding: 15px; background: #ffeaa7; border-radius: 15px; margin-bottom: 20px; border: 3px solid #fdcb6e;';
                notice.innerHTML = '<p style="font-weight: 700; color: #2d3436; margin: 0;">ℹ️ No hay actividad en este periodo. Mostrando todos los usuarios.</p>';
                podiumContainer.parentElement.insertBefore(notice, podiumContainer);
            }
            
            // PODIO - Mostrar top 3 (o menos si hay menos usuarios)
            const top3 = sortedUsers.slice(0, 3);
            if (top3.length > 0) {
                const podium = document.createElement('div');
                podium.className = 'podium';
                
                // Si solo hay 1 usuario
                if (top3.length === 1) {
                    const [username, data] = top3[0];
                    const accuracy = (data.totalAttempts || 0) > 0 
                        ? Math.round(((data.correctAnswers || 0) / data.totalAttempts) * 100)
                        : 0;
                    const place = document.createElement('div');
                    place.className = 'podium-place first';
                    place.innerHTML = `
                        <div class="podium-rank">🥇</div>
                        <div class="podium-name">${username}</div>
                        <div class="podium-score">⭐ ${data.totalPoints || 0}</div>
                        <div class="podium-score">🎯 ${accuracy}%</div>
                        <div class="podium-score">🏆 ${data.achievements ? data.achievements.length : 0}</div>
                    `;
                    podium.appendChild(place);
                } 
                // Si hay 2 usuarios
                else if (top3.length === 2) {
                    const correctMedals = ['🥇', '🥈']; // Medallas correctas para 2 usuarios
                    [0, 1].forEach((index) => {
                        const [username, data] = top3[index];
                        const accuracy = (data.totalAttempts || 0) > 0 
                            ? Math.round(((data.correctAnswers || 0) / data.totalAttempts) * 100)
                            : 0;
                        const place = document.createElement('div');
                        place.className = `podium-place ${index === 0 ? 'first' : 'second'}`;
                        place.innerHTML = `
                            <div class="podium-rank">${correctMedals[index]}</div>
                            <div class="podium-name">${username}</div>
                            <div class="podium-score">⭐ ${data.totalPoints || 0}</div>
                            <div class="podium-score">🎯 ${accuracy}%</div>
                            <div class="podium-score">🏆 ${data.achievements ? data.achievements.length : 0}</div>
                        `;
                        podium.appendChild(place);
                    });
                } 
                // Si hay 3 o más usuarios - orden visual: 2do, 1ro, 3ro
                else {
                    const displayOrder = [
                        { arrayIndex: 1, position: 'second', medal: '🥈' },  // 2do lugar (izquierda)
                        { arrayIndex: 0, position: 'first', medal: '🥇' },   // 1er lugar (centro)
                        { arrayIndex: 2, position: 'third', medal: '🥉' }    // 3er lugar (derecha)
                    ];
                    
                    displayOrder.forEach(({ arrayIndex, position, medal }) => {
                        if (top3[arrayIndex]) {
                            const [username, data] = top3[arrayIndex];
                            const accuracy = (data.totalAttempts || 0) > 0 
                                ? Math.round(((data.correctAnswers || 0) / data.totalAttempts) * 100)
                                : 0;
                            const place = document.createElement('div');
                            place.className = `podium-place ${position}`;
                            place.innerHTML = `
                                <div class="podium-rank">${medal}</div>
                                <div class="podium-name">${username}</div>
                                <div class="podium-score">⭐ ${data.totalPoints || 0}</div>
                                <div class="podium-score">🎯 ${accuracy}%</div>
                                <div class="podium-score">🏆 ${data.achievements ? data.achievements.length : 0}</div>
                            `;
                            podium.appendChild(place);
                        }
                    });
                }
                
                podiumContainer.appendChild(podium);
            }
            
            // TABLA - Mostrar el resto (posición 4 en adelante)
            const remainingUsers = sortedUsers.slice(3);
            if (remainingUsers.length > 0) {
                remainingUsers.forEach(([username, data], index) => {
                    const accuracy = (data.totalAttempts || 0) > 0 
                        ? Math.round(((data.correctAnswers || 0) / data.totalAttempts) * 100)
                        : 0;
                    const row = document.createElement('div');
                    row.className = 'ranking-row';
                    if (username === appState.currentUser) {
                        row.classList.add('current-user');
                    }
                    
                    row.innerHTML = `
                        <div class="ranking-position">#${index + 4}</div>
                        <div class="ranking-user">${username}</div>
                        <div class="ranking-stats">
                            <span>⭐ ${data.totalPoints || 0}</span>
                            <span>🎯 ${accuracy}%</span>
                            <span>🏆 ${data.achievements ? data.achievements.length : 0}</span>
                            <span>🔥 ${data.streak || 0}</span>
                        </div>
                    `;
                    
                    tableContainer.appendChild(row);
                });
            } else if (sortedUsers.length <= 3) {
                // Si hay 3 o menos usuarios, mostrar un mensaje amigable
                tableContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 20px; border: 3px solid #74b9ff; margin-top: 20px;">
                        <div style="font-size: 60px; margin-bottom: 15px;">🎯</div>
                        <h4 style="font-family: 'Fredoka One', cursive; font-size: 20px; color: #2d3436; margin-bottom: 10px;">¡Top ${sortedUsers.length} de entrenadores!</h4>
                        <p style="font-size: 16px; color: #636e72; font-weight: 600;">¡Invita a más amigos para competir! 🚀</p>
                    </div>
                `;
            }
            
            console.log('📊 Ranking cargado - Podio:', top3.length, 'Tabla:', remainingUsers.length);
        }

        function setRankingFilter(filter) {
            appState.currentRankingFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadRanking();
        }

        function showNoRankingData() {
            const podiumContainer = document.getElementById('podiumContainer');
            const tableContainer = document.getElementById('rankingTableContainer');
            
            podiumContainer.innerHTML = '';
            tableContainer.innerHTML = `
                <div style="text-align: center; padding: 50px; background: white; border-radius: 20px; border: 3px solid #74b9ff;">
                    <div style="font-size: 80px; margin-bottom: 20px;">🌟</div>
                    <h3 style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #2d3436; margin-bottom: 15px;">¡Sé el primer súper entrenador!</h3>
                    <p style="font-size: 16px; color: #636e72; font-weight: 600;">Completa algunos ejercicios geniales para aparecer en el ranking de campeones.</p>
                </div>
            `;
        }

        function loadStats() {
            try {
                const content = document.getElementById('statsContent');
                const userData = appState.userData || createNewUser();
                
                console.log('📊 LoadStats - userData:', userData);
                console.log('📊 LoadStats - content element:', content);
                
                if (!content) {
                    console.error('❌ No se encontró el elemento statsContent');
                    return;
                }
                
                // Asegurar que existan los campos necesarios con valores por defecto
                const totalAttempts = userData.totalAttempts || 0;
                const correctAnswers = userData.correctAnswers || 0;
                const wrongAnswers = userData.wrongAnswers || 0;
                const totalExercises = userData.totalExercises || 0;
                
                // Calcular precisión (accuracy)
                const accuracy = totalAttempts > 0 
                    ? Math.round((correctAnswers / totalAttempts) * 100)
                    : 0;
                
                // Determinar nivel de precisión y emoji
                let accuracyEmoji = '🎯';
                let accuracyClass = '';
                if (accuracy >= 90) {
                    accuracyEmoji = '🏆';
                    accuracyClass = 'excellent';
                } else if (accuracy >= 75) {
                    accuracyEmoji = '⭐';
                    accuracyClass = 'good';
                } else if (accuracy >= 50) {
                    accuracyEmoji = '📈';
                    accuracyClass = 'ok';
                } else {
                    accuracyEmoji = '💪';
                    accuracyClass = 'needs-work';
                }
                
                const allUsers = Object.entries(appState.allUsersData || {});
                const sortedByAchievements = allUsers.sort((a, b) => {
                    const aAchievements = a[1].achievements ? a[1].achievements.length : 0;
                    const bAchievements = b[1].achievements ? b[1].achievements.length : 0;
                    if (bAchievements !== aAchievements) {
                        return bAchievements - aAchievements;
                    }
                    return (b[1].totalPoints || 0) - (a[1].totalPoints || 0);
                });
                
                const userRankPosition = sortedByAchievements.findIndex(([username]) => username === appState.currentUser) + 1;
                
                content.innerHTML = `
                    <div class="stats-kids">
                        <div class="stat-card-big">
                            <div class="stat-icon-big">🎯</div>
                            <div class="stat-number-big">${totalExercises}</div>
                            <div class="stat-label-big">Ejercicios Súper Completados</div>
                        </div>
                        
                        <div class="stat-card-big">
                            <div class="stat-icon-big">${accuracyEmoji}</div>
                            <div class="stat-number-big">${accuracy}%</div>
                            <div class="stat-label-big">Precisión (Aciertos a la Primera)</div>
                        </div>
                        
                        <div class="stat-card-big">
                            <div class="stat-icon-big">🏆</div>
                            <div class="stat-number-big">${userRankPosition > 0 ? `#${userRankPosition}` : '🌟'}</div>
                            <div class="stat-label-big">Mi Posición en el Ranking</div>
                        </div>
                        
                        <div class="stat-card-big">
                            <div class="stat-icon-big">🎖️</div>
                            <div class="stat-number-big">${userData.achievements ? userData.achievements.length : 0}</div>
                            <div class="stat-label-big">Logros Súper Geniales</div>
                        </div>
                        
                        <div class="stat-card-big">
                            <div class="stat-icon-big">🔥</div>
                            <div class="stat-number-big">${userData.streak || 0}</div>
                            <div class="stat-label-big">Días Seguidos Geniales</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #fff3cd, #ffe69c); border-radius: 20px; border: 3px solid #ffc107;">
                        <h4 style="font-family: 'Fredoka One', cursive; font-size: 20px; text-align: center; margin-bottom: 15px; color: #856404;">💡 Sistema de Puntos</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; font-weight: 700; font-size: 15px; color: #856404;">
                            <div>✅ Respuesta correcta: <span style="color: #28a745;">+10 puntos</span></div>
                            <div>❌ Respuesta incorrecta: <span style="color: #dc3545;">-3 puntos</span></div>
                            <div>🎯 Tu precisión: <strong style="font-size: 18px;">${accuracy}%</strong></div>
                        </div>
                        <p style="margin-top: 15px; text-align: center; font-weight: 600; color: #856404; font-size: 14px;">
                            💭 ¡Piensa bien antes de responder! Cada error resta puntos.
                        </p>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 25px; background: white; border-radius: 20px; border: 3px solid #17a2b8;">
                        <h4 style="font-family: 'Fredoka One', cursive; font-size: 20px; text-align: center; margin-bottom: 20px; color: #2d3436;">📈 Mis Números Detallados</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: center;">
                            <div style="padding: 15px; background: #d4edda; border-radius: 15px; border: 3px solid #28a745;">
                                <div style="font-size: 32px; margin-bottom: 5px;">✅</div>
                                <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #155724;">${correctAnswers}</div>
                                <div style="font-weight: 700; color: #155724; font-size: 14px;">Aciertos</div>
                            </div>
                            <div style="padding: 15px; background: #f8d7da; border-radius: 15px; border: 3px solid #dc3545;">
                                <div style="font-size: 32px; margin-bottom: 5px;">❌</div>
                                <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #721c24;">${wrongAnswers}</div>
                                <div style="font-weight: 700; color: #721c24; font-size: 14px;">Errores</div>
                            </div>
                            <div style="padding: 15px; background: #d1ecf1; border-radius: 15px; border: 3px solid #17a2b8;">
                                <div style="font-size: 32px; margin-bottom: 5px;">📝</div>
                                <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #0c5460;">${totalAttempts}</div>
                                <div style="font-weight: 700; color: #0c5460; font-size: 14px;">Intentos Totales</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 25px; border: 3px solid #74b9ff;">
                        <h3 style="font-family: 'Fredoka One', cursive; font-size: 28px; text-align: center; margin-bottom: 30px; color: #2d3436;">📊 ¡Mis Números por Materia!</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #ff6b6b;">
                                <div style="font-size: 40px; margin-bottom: 10px;">🧮</div>
                                <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #ff6b6b;">${(userData.exercisesByType && userData.exercisesByType.math) || 0}</div>
                                <div style="font-weight: 700; color: #636e72;">Mates Geniales</div>
                            </div>
                            
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #4ecdc4;">
                                <div style="font-size: 40px; margin-bottom: 10px;">📖</div>
                                <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #4ecdc4;">${(userData.exercisesByType && userData.exercisesByType.reading) || 0}</div>
                                <div style="font-weight: 700; color: #636e72;">Súper Lectura</div>
                            </div>
                            
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #74b9ff;">
                                <div style="font-size: 40px; margin-bottom: 10px;">🔬</div>
                                <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #74b9ff;">${(userData.exercisesByType && userData.exercisesByType.science) || 0}</div>
                                <div style="font-weight: 700; color: #636e72;">Ciencias Naturales</div>
                            </div>
                            
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; border: 3px solid #a29bfe;">
                                <div style="font-size: 40px; margin-bottom: 10px;">🌍</div>
                                <div style="font-family: 'Fredoka One', cursive; font-size: 24px; color: #a29bfe;">${(userData.exercisesByType && userData.exercisesByType.social) || 0}</div>
                                <div style="font-weight: 700; color: #636e72;">Ciencias Sociales</div>
                            </div>
                        </div>
                    </div>
                `;
                
                console.log('✅ LoadStats completado exitosamente');
            } catch (error) {
                console.error('❌ Error en loadStats:', error);
                const content = document.getElementById('statsContent');
                if (content) {
                    content.innerHTML = '<p style="text-align: center; color: red; padding: 20px;">Error al cargar estadísticas. Por favor, recarga la página.</p>';
                }
            }
        }

        function loadAchievements() {
            const grid = document.getElementById('achievementGrid');
            grid.innerHTML = '';
            
            const userData = appState.userData || createNewUser();
            
            achievements.forEach(achievement => {
                const isUnlocked = userData.achievements && userData.achievements.includes(achievement.id);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : ''}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <h4 style="font-family: 'Fredoka One', cursive; margin-bottom: 10px;">${achievement.name}</h4>
                    <p style="font-weight: 600; font-size: 14px;">${achievement.description}</p>
                    <div style="margin-top: 15px; font-size: 14px; font-weight: 700;">
                        ${isUnlocked ? '🎉 ¡DESBLOQUEADO!' : '🔐 Bloqueado'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        async function testConnection() {
            updateConnectionStatus('connecting');
            try {
                const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.masterKey
                    }
                });
                
                if (response.ok) {
                    updateConnectionStatus('online');
                    alert('✅ ¡Conexión súper exitosa con JSONBin.io! 🎉');
                    await loadUserData();
                } else {
                    updateConnectionStatus('error');
                    alert('❌ Error de conexión: ' + response.status);
                }
            } catch (error) {
                updateConnectionStatus('error');
                alert('❌ Error de red: ' + error.message);
            }
        }

        function resetProgress() {
            if (confirm('¿Estás súper seguro de que quieres empezar de nuevo? ¡Perderás todos tus logros geniales! 😱')) {
                appState.userData = createNewUser();
                saveUserData();
                updateUserInterface();
                generateWeeks();
                alert('🎉 ¡Progreso reiniciado! ¡Nueva aventura comenzando! 🚀');
            }
        }

        function exportData() {
            const dataToExport = {
                user: appState.currentUser,
                data: appState.userData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `academia_pokemon_${appState.currentUser}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('📥 ¡Datos súper descargados! 🎉');
        }

        async function deleteUser() {
            const confirmMessage = `⚠️ ATENCIÓN ⚠️\n\n¿Estás COMPLETAMENTE seguro de que quieres ELIMINAR tu usuario "${appState.currentUser}"?\n\nEsta acción:\n- Borrará PERMANENTEMENTE todos tus datos del servidor\n- NO se puede deshacer\n- Perderás TODOS tus puntos, logros y progreso\n\nEscribe "${appState.currentUser}" para confirmar:`;
            
            const confirmation = prompt(confirmMessage);
            
            if (confirmation === appState.currentUser) {
                try {
                    updateConnectionStatus('connecting');
                    
                    // Eliminar el usuario de allUsersData
                    delete appState.allUsersData[appState.currentUser];
                    
                    // Guardar en el servidor
                    const response = await fetch(`${JSONBIN_CONFIG.apiUrl}/b/${JSONBIN_CONFIG.binId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': JSONBIN_CONFIG.masterKey
                        },
                        body: JSON.stringify(appState.allUsersData)
                    });
                    
                    if (response.ok) {
                        updateConnectionStatus('online');
                        alert('✅ Usuario eliminado correctamente del servidor.\n\n¡Hasta pronto! 👋');
                        
                        // Limpiar estado y volver al login
                        appState.currentUser = null;
                        appState.userData = null;
                        
                        document.getElementById('mainApp').style.display = 'none';
                        document.getElementById('loginScreen').style.display = 'flex';
                        document.getElementById('usernameInput').value = '';
                    } else {
                        throw new Error('Error al eliminar del servidor');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    updateConnectionStatus('error');
                    alert('❌ Error al eliminar el usuario del servidor.\n\nPor favor, inténtalo de nuevo.');
                }
            } else if (confirmation !== null) {
                alert('❌ Confirmación incorrecta. No se ha eliminado el usuario.');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎮 Academia Pokemon iniciada - Versión 4.0 FINAL');
            
            updateConnectionStatus('offline');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
        });
    </script>
</body>
</html>
