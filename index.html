<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventuras de Aprendizaje - Completo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 16px;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #4ade80 0%, #3b82f6 50%, #8b5cf6 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 10001;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .login-box {
            background: white;
            border-radius: 30px;
            padding: 50px 40px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 30px 90px rgba(0,0,0,0.4);
            text-align: center;
        }
        
        .login-box h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        
        .login-box p {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .login-box input {
            width: 100%;
            padding: 18px 20px;
            font-size: 1.2em;
            border: 3px solid #e5e7eb;
            border-radius: 15px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .login-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        /* Buttons */
        .btn {
            padding: 18px 35px;
            font-size: 1.2em;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            border: none;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            width: 100%;
            opacity: 0.6;
        }
        
        /* App Container */
        .app-container {
            background: white;
            border-radius: 40px;
            box-shadow: 0 30px 90px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
            display: none;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.2em;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            margin-bottom: 5px;
        }
        
        .user-badge {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            color: #667eea;
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 700;
            transition: all 0.3s;
            border: 2px solid rgba(102, 126, 234, 0.5);
            z-index: 2;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .user-badge:hover {
            background: white;
            border-color: #667eea;
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .config-btn {
            position: absolute;
            top: 20px;
            right: 25px;
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid rgba(255,255,255,0.3);
            z-index: 2;
        }
        
        .config-btn:hover {
            background: rgba(255,255,255,0.35);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 8px;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            min-width: 80px;
        }
        
        .stat-number {
            font-size: 2.2em;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            display: block;
        }
        
        .stat-item div:last-child {
            font-size: 0.85em;
            opacity: 0.95;
            font-weight: 500;
        }
        
        .content {
            padding: 35px 30px;
            min-height: 500px;
            background: linear-gradient(180deg, #fafbff 0%, #f5f7ff 100%);
        }
        
        .day-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 30px;
            margin-top: 40px;
            padding: 20px;
        }
        
        .day-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }
        
        .day-card:hover {
            transform: scale(1.05) translateY(-10px);
        }
        
        .day-card .icon {
            font-size: 3em;
            margin-bottom: 8px;
            display: block;
            filter: drop-shadow(0 6px 12px rgba(0,0,0,0.3));
        }
        
        .day-card .title {
            font-size: 1.4em;
            font-weight: 900;
            margin-bottom: 4px;
            text-shadow: 0 3px 8px rgba(0,0,0,0.4);
        }
        
        .day-card.completed {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.6);
        }
        
        .day-card.completed::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            color: #10b981;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.3em;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <body>
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h2>üëã ¬°Hola!</h2>
            <p>Escribe tu nombre para comenzar</p>
            
            <input 
                type="text" 
                id="usernameInput" 
                placeholder="Tu nombre"
                autocomplete="off"
            >
            
            <button class="btn btn-primary" id="loginBtn">
                ‚ú® Comenzar Aventura
            </button>
            
            <button class="btn btn-secondary" id="superAdminBtn">
                üîê SuperAdmin
            </button>
        </div>
    </div>

    <div class="app-container" id="appContainer">
        <div class="header">
            <div class="config-btn" id="configBtn">‚öôÔ∏è Config</div>
            <div class="user-badge" id="userBadge" style="display: none;">
                üë§ <span id="currentUserName"></span>
            </div>
            <h1>üéÆ Aventuras de Aprendizaje üéÆ</h1>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="starsCount">0</div>
                    <div>‚≠ê Estrellas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="daysCompleted">0</div>
                    <div>üìÖ D√≠as</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="correctAnswers">0</div>
                    <div>‚úÖ Correctas</div>
                </div>
            </div>
        </div>
        
        <div class="content">
            <h2 style="text-align: center; color: #667eea; margin-bottom: 20px;" id="weekTitle">
                Cargando aventuras...
            </h2>
            <div id="mainContent"></div>
        </div>
    </div>
   <script>
        // =====================================================
        // CONFIGURACI√ìN
        // =====================================================
        const JSONBIN_BIN_ID = '68ee144343b1c97be96704f9';
        const JSONBIN_MASTER_KEY = '$2a$10$byEkgCiPtr6uA9j.sw5Uiuld00jGPRMT1Rn9TlhHYbPe3CFfaEu6G';
        const JSONBIN_API_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;
        const SUPERADMIN_PASSWORD = 'superadmin2024';

        // =====================================================
        // ESTADO GLOBAL
        // =====================================================
        let currentUser = null;
        let allUsersData = {};
        let weeksData = null;
        let isSaving = false;

        let state = {
            currentWeek: 1,
            currentDay: 0,
            currentExercise: 0,
            stars: 0,
            correctAnswers: 0,
            daysCompleted: 0,
            completedDays: {},
            startTime: null,
            currentColor: '#000000',
            totalFailures: 0,
            currentExerciseFailures: 0,
            failuresByExercise: {},
            exerciseAttempts: {}
        };

        // =====================================================
        // INICIALIZACI√ìN
        // =====================================================
        async function init() {
            setupEventListeners();
            await loadWeeksData();
            await checkExistingSession();
        }

        function setupEventListeners() {
            // Login
            document.getElementById('usernameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') loginUser();
            });
            
            document.getElementById('loginBtn').addEventListener('click', loginUser);
            
            // SuperAdmin
            document.getElementById('superAdminBtn').addEventListener('click', () => {
                const password = prompt('üîê Contrase√±a SuperAdmin:');
                if (password === SUPERADMIN_PASSWORD) {
                    showSuperAdmin();
                } else if (password) {
                    alert('‚ùå Contrase√±a incorrecta');
                }
            });
            
            // Config
            document.getElementById('configBtn').addEventListener('click', showConfig);
            
            // User Badge (logout)
            document.getElementById('userBadge').addEventListener('click', () => {
                if (confirm('¬øDeseas cerrar sesi√≥n?')) {
                    logout();
                }
            });
        }

        // =====================================================
        // CARGA DE DATOS
        // =====================================================
        async function loadWeeksData() {
            console.log('üìö Intentando cargar semanas.json...');
            
            try {
                const response = await fetch('semanas.json');
                if (!response.ok) {
                    throw new Error('No se pudo cargar semanas.json');
                }
                weeksData = await response.json();
                console.log('‚úÖ Semanas cargadas:', Object.keys(weeksData).length, 'semanas');
                return;
            } catch (error) {
                console.warn('‚ö†Ô∏è No se encontr√≥ semanas.json, usando datos de ejemplo');
            }
            
            // DATOS DE EJEMPLO SI NO EXISTE semanas.json
            weeksData = {
                "1": {
                    "name": "Semana 1",
                    "description": "Comenzando la aventura",
                    "days": [
                        {
                            "icon": "üìö",
                            "title": "Matem√°ticas",
                            "badge": "Maestro de N√∫meros",
                            "exercises": []
                        },
                        {
                            "icon": "üî§",
                            "title": "Lectura",
                            "badge": "Gran Lector",
                            "exercises": []
                        },
                        {
                            "icon": "üåç",
                            "title": "Ciencias",
                            "badge": "Cient√≠fico",
                            "exercises": []
                        },
                        {
                            "icon": "üé®",
                            "title": "Arte",
                            "badge": "Artista Creativo",
                            "exercises": []
                        },
                        {
                            "icon": "üåê",
                            "title": "Ingl√©s",
                            "badge": "Pol√≠glota",
                            "exercises": []
                        }
                    ]
                },
                "2": {
                    "name": "Semana 2",
                    "description": "Avanzando en el aprendizaje",
                    "days": [
                        {
                            "icon": "üî¢",
                            "title": "Matem√°ticas Avanzadas",
                            "badge": "Genio Matem√°tico",
                            "exercises": []
                        },
                        {
                            "icon": "üìñ",
                            "title": "Comprensi√≥n Lectora",
                            "badge": "Lector Experto",
                            "exercises": []
                        },
                        {
                            "icon": "üß™",
                            "title": "Experimentos",
                            "badge": "Cient√≠fico Loco",
                            "exercises": []
                        },
                        {
                            "icon": "üé≠",
                            "title": "Teatro",
                            "badge": "Actor Estrella",
                            "exercises": []
                        },
                        {
                            "icon": "üó£Ô∏è",
                            "title": "Conversaci√≥n",
                            "badge": "Hablante Nativo",
                            "exercises": []
                        }
                    ]
                }
            };
            
            console.log('‚úÖ Datos de ejemplo cargados');
        }

        async function checkExistingSession() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                await loadAllUsersData();
                if (allUsersData[currentUser]) {
                    await loadState();
                    hideLoginScreen();
                    return;
                }
            }
            showLoginScreen();
        }

        // =====================================================
        // UI - PANTALLAS
        // =====================================================
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('usernameInput').value = '';
            setTimeout(() => {
                document.getElementById('usernameInput').focus();
            }, 100);
        }

        function hideLoginScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('userBadge').style.display = 'block';
            document.getElementById('currentUserName').textContent = currentUser;
            updateStats();
            loadWeekContent();
        }

        function loadWeekContent() {
            if (!weeksData) {
                document.getElementById('weekTitle').textContent = '‚ö†Ô∏è Error al cargar semanas';
                document.getElementById('mainContent').innerHTML = '<p style="text-align:center;color:#ef4444;">No se pudieron cargar las semanas. Recarga la p√°gina.</p>';
                return;
            }
            
            const week = weeksData[state.currentWeek];
            if (!week) {
                document.getElementById('weekTitle').textContent = '‚ö†Ô∏è Semana no encontrada';
                document.getElementById('mainContent').innerHTML = '<p style="text-align:center;color:#ef4444;">La semana seleccionada no existe.</p>';
                return;
            }
            
            document.getElementById('weekTitle').textContent = `${week.name} - ${week.description}`;
            
            let html = '<div class="day-selector">';
            
            week.days.forEach((day, index) => {
                const dayKey = `${state.currentWeek}_${index + 1}`;
                const isCompleted = state.completedDays && state.completedDays[dayKey];
                
                html += `
                    <div class="day-card ${isCompleted ? 'completed' : ''}" 
                         onclick="startDay(${index + 1})" 
                         style="position: relative;">
                        <div class="icon">${day.icon}</div>
                        <div class="title">D√≠a ${index + 1}</div>
                        <div>${day.title}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            document.getElementById('mainContent').innerHTML = html;
        }

        function startDay(dayNum) {
            const week = weeksData[state.currentWeek];
            const day = week.days[dayNum - 1];
            
            alert(`üéÆ Comenzando D√≠a ${dayNum}: ${day.title}\n\n‚ú® Por ahora es una demostraci√≥n.\n\nAqu√≠ se cargar√≠an los ejercicios reales del archivo semanas.json\n\nüí° Presiona OK para marcar el d√≠a como completado (DEMO)`);
            
            // Marcar como completado (demo)
            const dayKey = `${state.currentWeek}_${dayNum}`;
            if (!state.completedDays) state.completedDays = {};
            
            if (!state.completedDays[dayKey]) {
                state.completedDays[dayKey] = true;
                state.daysCompleted = (state.daysCompleted || 0) + 1;
                state.stars = (state.stars || 0) + 10;
                state.correctAnswers = (state.correctAnswers || 0) + 5;
                
                updateStats();
                saveState();
                loadWeekContent();
                
                alert(`üéâ ¬°D√≠a completado!\n\n‚≠ê +10 estrellas\n‚úÖ +5 respuestas correctas\n\nüèÜ Badge ganado: ${day.badge}`);
            } else {
                alert(`‚ÑπÔ∏è Ya completaste este d√≠a\n\nBadge: ${day.badge}`);
            }
        }
        // =====================================================
        // AUTENTICACI√ìN Y LOGIN
        // =====================================================
        async function loginUser() {
            const username = document.getElementById('usernameInput').value.trim();
            
            if (!username) {
                alert('‚ö†Ô∏è Por favor, escribe tu nombre');
                return;
            }
            
            if (username.length < 2) {
                alert('‚ö†Ô∏è El nombre debe tener al menos 2 caracteres');
                return;
            }
            
            currentUser = username;
            localStorage.setItem('currentUser', username);
            
            await loadAllUsersData();
            
            // Si el usuario no existe, crear uno nuevo
            if (!allUsersData[username]) {
                console.log('‚úÖ Creando nuevo usuario:', username);
                allUsersData[username] = {
                    currentWeek: 1,
                    currentDay: 0,
                    currentExercise: 0,
                    stars: 0,
                    correctAnswers: 0,
                    daysCompleted: 0,
                    completedDays: {},
                    startTime: null,
                    currentColor: '#000000',
                    totalFailures: 0,
                    currentExerciseFailures: 0,
                    failuresByExercise: {},
                    exerciseAttempts: {}
                };
                await saveAllUsersData();
            }
            
            await loadState();
            hideLoginScreen();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            state = {
                currentWeek: 1,
                currentDay: 0,
                currentExercise: 0,
                stars: 0,
                correctAnswers: 0,
                daysCompleted: 0,
                completedDays: {},
                startTime: null,
                currentColor: '#000000',
                totalFailures: 0,
                currentExerciseFailures: 0,
                failuresByExercise: {},
                exerciseAttempts: {}
            };
            showLoginScreen();
        }

        // =====================================================
        // JSONBIN - GESTI√ìN DE DATOS EN LA NUBE
        // =====================================================
        async function loadAllUsersData() {
            try {
                console.log('üì° Cargando datos desde JSONBin...');
                
                const response = await fetch(JSONBIN_API_URL + '/latest', {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_MASTER_KEY
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.record && typeof data.record === 'object') {
                        allUsersData = data.record;
                        console.log('‚úÖ Datos cargados desde JSONBin:', Object.keys(allUsersData).length, 'usuarios');
                    } else {
                        allUsersData = {};
                        console.log('‚ö†Ô∏è JSONBin vac√≠o, inicializando...');
                    }
                } else {
                    console.log('‚ö†Ô∏è Error al cargar desde JSONBin, usando datos locales');
                    allUsersData = {};
                }
            } catch (error) {
                console.error('‚ùå Error al cargar datos de usuarios:', error);
                
                // Intentar recuperar desde localStorage como backup
                const localBackup = localStorage.getItem('allUsersData');
                if (localBackup) {
                    try {
                        allUsersData = JSON.parse(localBackup);
                        console.log('‚úÖ Datos recuperados desde backup local:', Object.keys(allUsersData).length, 'usuarios');
                    } catch (e) {
                        allUsersData = {};
                    }
                } else {
                    allUsersData = {};
                }
            }
        }

        async function saveAllUsersData() {
            if (isSaving) {
                console.log('‚è≥ Ya hay un guardado en progreso...');
                return;
            }
            
            isSaving = true;
            
            try {
                // Guardar en localStorage como backup
                localStorage.setItem('allUsersData', JSON.stringify(allUsersData));
                
                console.log('üíæ Guardando en JSONBin...', Object.keys(allUsersData).length, 'usuarios');
                
                const response = await fetch(JSONBIN_API_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_MASTER_KEY
                    },
                    body: JSON.stringify(allUsersData)
                });

                if (response.ok) {
                    console.log('‚úÖ Datos guardados exitosamente en JSONBin');
                } else {
                    console.error('‚ö†Ô∏è Error al guardar en JSONBin. Status:', response.status);
                }
            } catch (error) {
                console.error('‚ùå Error al guardar datos:', error);
            } finally {
                isSaving = false;
            }
        }

        async function loadState() {
            if (!currentUser) return;
            
            await loadAllUsersData();
            
            if (allUsersData[currentUser]) {
                state = { ...state, ...allUsersData[currentUser] };
                console.log(`‚úÖ Estado cargado para usuario: ${currentUser}`);
                console.log('üìä Estrellas:', state.stars, '| D√≠as:', state.daysCompleted);
            } else {
                console.log(`‚ö†Ô∏è Usuario nuevo: ${currentUser}`);
                allUsersData[currentUser] = { ...state };
                await saveAllUsersData();
            }
        }

        async function saveState() {
            if (!currentUser || isSaving) return;
            
            allUsersData[currentUser] = { ...state };
            await saveAllUsersData();
        }

        function updateStats() {
            document.getElementById('starsCount').textContent = state.stars || 0;
            document.getElementById('daysCompleted').textContent = state.daysCompleted || 0;
            document.getElementById('correctAnswers').textContent = state.correctAnswers || 0;
        }

        // =====================================================
        // SUPERADMIN - GESTI√ìN DE USUARIOS
        // =====================================================
        async function showSuperAdmin() {
            await loadAllUsersData();
            
            let mensaje = 'üëë PANEL SUPERADMIN\n\n';
            mensaje += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            mensaje += 'üìä USUARIOS REGISTRADOS:\n\n';
            
            const usernames = Object.keys(allUsersData);
            
            if (usernames.length === 0) {
                mensaje += '   ‚ö†Ô∏è No hay usuarios registrados\n\n';
            } else {
                usernames.forEach((username, index) => {
                    const userData = allUsersData[username] || {};
                    const stars = userData.stars || 0;
                    const days = userData.daysCompleted || 0;
                    const correct = userData.correctAnswers || 0;
                    
                    mensaje += `${index + 1}. üë§ ${username}\n`;
                    mensaje += `   ‚≠ê ${stars} estrellas\n`;
                    mensaje += `   üìÖ ${days} d√≠as completados\n`;
                    mensaje += `   ‚úÖ ${correct} respuestas correctas\n\n`;
                });
            }
            
            mensaje += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            mensaje += 'üîß ACCIONES DISPONIBLES:\n\n';
            mensaje += '1Ô∏è‚É£ Eliminar usuario espec√≠fico\n';
            mensaje += '   ‚Üí Escribe el nombre exacto del usuario\n\n';
            mensaje += '2Ô∏è‚É£ Reiniciar TODOS los datos\n';
            mensaje += '   ‚Üí Escribe: RESET\n\n';
            mensaje += '3Ô∏è‚É£ Cancelar\n';
            mensaje += '   ‚Üí Escribe: CANCELAR\n\n';
            mensaje += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            
            const accion = prompt(mensaje);
            
            if (!accion || accion.toUpperCase() === 'CANCELAR') {
                return;
            }
            
            if (accion.toUpperCase() === 'RESET') {
                const confirmReset = confirm(
                    '‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è ADVERTENCIA CR√çTICA ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è\n\n' +
                    'Est√°s a punto de ELIMINAR:\n\n' +
                    '‚ùå TODOS los usuarios\n' +
                    '‚ùå TODO el progreso\n' +
                    '‚ùå TODAS las estad√≠sticas\n\n' +
                    'üî¥ Esta acci√≥n NO se puede deshacer\n\n' +
                    '¬øEst√°s ABSOLUTAMENTE seguro?'
                );
                
                if (confirmReset) {
                    const doubleConfirm = confirm(
                        'üî¥ √öLTIMA CONFIRMACI√ìN\n\n' +
                        'Escribe OK en el siguiente cuadro para confirmar'
                    );
                    
                    if (doubleConfirm) {
                        allUsersData = {};
                        await saveAllUsersData();
                        alert('‚úÖ Sistema reiniciado completamente\n\nTodos los datos han sido eliminados.');
                        logout();
                    }
                }
            } else {
                // Eliminar usuario espec√≠fico
                if (allUsersData[accion]) {
                    if (confirm(
                        `¬øEliminar usuario "${accion}"?\n\n` +
                        `‚≠ê ${allUsersData[accion].stars || 0} estrellas\n` +
                        `üìÖ ${allUsersData[accion].daysCompleted || 0} d√≠as\n\n` +
                        `‚ö†Ô∏è Esta acci√≥n no se puede deshacer`
                    )) {
                        delete allUsersData[accion];
                        await saveAllUsersData();
                        alert(`‚úÖ Usuario "${accion}" eliminado correctamente`);
                    }
                } else {
                    alert(`‚ùå Usuario "${accion}" no encontrado\n\nVerifica que el nombre est√© escrito correctamente.`);
                }
            }
        }
        // =====================================================
        // PANEL DE CONFIGURACI√ìN PERSONAL
        // =====================================================
        function showConfig() {
            if (!currentUser) {
                alert('‚ö†Ô∏è Debes iniciar sesi√≥n primero');
                return;
            }
            
            const stars = state.stars || 0;
            const days = state.daysCompleted || 0;
            const correct = state.correctAnswers || 0;
            const failures = state.totalFailures || 0;
            const totalAttempts = correct + failures;
            const accuracy = totalAttempts > 0 ? Math.round((correct / totalAttempts) * 100) : 0;
            
            let mensaje = '‚öôÔ∏è PANEL DE CONFIGURACI√ìN\n\n';
            mensaje += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            mensaje += `üë§ Usuario: ${currentUser}\n\n`;
            mensaje += 'üìä TUS ESTAD√çSTICAS:\n\n';
            mensaje += `‚≠ê Estrellas: ${stars}\n`;
            mensaje += `üìÖ D√≠as completados: ${days}\n`;
            mensaje += `‚úÖ Respuestas correctas: ${correct}\n`;
            mensaje += `‚ùå Fallos totales: ${failures}\n`;
            mensaje += `üéØ Precisi√≥n: ${accuracy}%\n\n`;
            
            // Mostrar detalles de d√≠as completados por semana
            if (state.completedDays && Object.keys(state.completedDays).length > 0) {
                mensaje += 'üìö PROGRESO POR SEMANAS:\n\n';
                const weekProgress = {};
                
                Object.keys(state.completedDays).forEach(dayKey => {
                    const [week, day] = dayKey.split('_');
                    if (!weekProgress[week]) {
                        weekProgress[week] = [];
                    }
                    weekProgress[week].push(day);
                });
                
                Object.keys(weekProgress).sort().forEach(week => {
                    const days = weekProgress[week].sort((a, b) => parseInt(a) - parseInt(b));
                    mensaje += `   Semana ${week}: D√≠as ${days.join(', ')} ‚úì\n`;
                });
                mensaje += '\n';
            }
            
            mensaje += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            mensaje += 'üîß ACCIONES DISPONIBLES:\n\n';
            mensaje += '1Ô∏è‚É£ Ver estad√≠sticas detalladas\n';
            mensaje += '   ‚Üí Escribe: STATS\n\n';
            mensaje += '2Ô∏è‚É£ Reiniciar MI progreso\n';
            mensaje += '   ‚Üí Escribe: REINICIAR\n\n';
            mensaje += '3Ô∏è‚É£ Eliminar semana espec√≠fica\n';
            mensaje += '   ‚Üí Escribe el n√∫mero de semana (ej: 1)\n\n';
            mensaje += '4Ô∏è‚É£ Cerrar\n';
            mensaje += '   ‚Üí Escribe: CANCELAR\n\n';
            mensaje += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            
            const accion = prompt(mensaje);
            
            if (!accion || accion.toUpperCase() === 'CANCELAR') {
                return;
            }
            
            if (accion.toUpperCase() === 'STATS') {
                showDetailedStats();
            } else if (accion.toUpperCase() === 'REINICIAR') {
                resetMyProgress();
            } else if (!isNaN(accion)) {
                // Eliminar semana espec√≠fica
                const weekNum = parseInt(accion);
                deleteWeekProgress(weekNum);
            } else {
                alert('‚ùå Opci√≥n no v√°lida');
            }
        }
        
        function showDetailedStats() {
            let mensaje = 'üìä ESTAD√çSTICAS DETALLADAS\n\n';
            mensaje += `üë§ Usuario: ${currentUser}\n\n`;
            mensaje += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            // Estad√≠sticas por ejercicio
            if (state.failuresByExercise && Object.keys(state.failuresByExercise).length > 0) {
                mensaje += '‚ùå FALLOS POR EJERCICIO:\n\n';
                
                Object.entries(state.failuresByExercise).forEach(([exerciseId, failures]) => {
                    if (failures > 0) {
                        const [week, day, exercise] = exerciseId.split('_');
                        const attempts = state.exerciseAttempts[exerciseId] || 0;
                        mensaje += `Semana ${week}, D√≠a ${day}, Ejercicio ${parseInt(exercise) + 1}:\n`;
                        mensaje += `   ‚ùå ${failures} fallos en ${attempts} intentos\n\n`;
                    }
                });
            } else {
                mensaje += '‚úÖ ¬°Sin fallos registrados! ¬°Excelente trabajo!\n\n';
            }
            
            mensaje += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            
            alert(mensaje);
        }
        
        function resetMyProgress() {
            const confirmReset = confirm(
                '‚ö†Ô∏è ADVERTENCIA ‚ö†Ô∏è\n\n' +
                'Vas a REINICIAR tu progreso:\n\n' +
                `‚ùå ${state.stars || 0} estrellas\n` +
                `‚ùå ${state.daysCompleted || 0} d√≠as completados\n` +
                `‚ùå ${state.correctAnswers || 0} respuestas correctas\n` +
                `‚ùå Todas tus estad√≠sticas\n\n` +
                'üî¥ Esta acci√≥n NO se puede deshacer\n\n' +
                '¬øEst√°s seguro?'
            );
            
            if (!confirmReset) return;
            
            const doubleConfirm = confirm(
                'üî¥ √öLTIMA CONFIRMACI√ìN\n\n' +
                '¬øRealmente quieres borrar TODO tu progreso?\n\n' +
                'Presiona OK para confirmar'
            );
            
            if (doubleConfirm) {
                state = {
                    currentWeek: 1,
                    currentDay: 0,
                    currentExercise: 0,
                    stars: 0,
                    correctAnswers: 0,
                    daysCompleted: 0,
                    completedDays: {},
                    startTime: null,
                    currentColor: '#000000',
                    totalFailures: 0,
                    currentExerciseFailures: 0,
                    failuresByExercise: {},
                    exerciseAttempts: {}
                };
                
                saveState();
                updateStats();
                loadWeekContent();
                
                alert('‚úÖ Tu progreso ha sido reiniciado\n\n¬°Comienza tu aventura de nuevo!');
            }
        }
        
        function deleteWeekProgress(weekNum) {
            if (!weeksData[weekNum]) {
                alert(`‚ùå La semana ${weekNum} no existe`);
                return;
            }
            
            // Contar d√≠as completados de esa semana
            let daysInWeek = 0;
            Object.keys(state.completedDays || {}).forEach(key => {
                if (key.startsWith(`${weekNum}_`)) {
                    daysInWeek++;
                }
            });
            
            if (daysInWeek === 0) {
                alert(`‚ÑπÔ∏è No tienes progreso en la Semana ${weekNum}`);
                return;
            }
            
            const confirmDelete = confirm(
                `¬øEliminar progreso de la Semana ${weekNum}?\n\n` +
                `üìÖ ${daysInWeek} d√≠as completados se perder√°n\n\n` +
                `‚ö†Ô∏è Esta acci√≥n no se puede deshacer`
            );
            
            if (confirmDelete) {
                // Eliminar d√≠as de esa semana
                Object.keys(state.completedDays).forEach(key => {
                    if (key.startsWith(`${weekNum}_`)) {
                        delete state.completedDays[key];
                    }
                });
                
                state.daysCompleted -= daysInWeek;
                if (state.daysCompleted < 0) state.daysCompleted = 0;
                
                saveState();
                updateStats();
                loadWeekContent();
                
                alert(`‚úÖ Progreso de Semana ${weekNum} eliminado\n\n${daysInWeek} d√≠as borrados`);
            }
        }

        // =====================================================
        // EVENTOS GLOBALES
        // =====================================================
        document.addEventListener('keydown', function(e) {
            // ESC para cerrar paneles (si implementas modales)
            if (e.key === 'Escape') {
                // Aqu√≠ puedes agregar l√≥gica para cerrar modales
            }
        });

        // Guardar progreso antes de cerrar la ventana
        window.addEventListener('beforeunload', function(e) {
            if (currentUser && Object.keys(state.completedDays || {}).length > 0) {
                saveState();
            }
        });

        // =====================================================
        // INICIO DE LA APLICACI√ìN
        // =====================================================
        window.addEventListener('load', function() {
            console.log('üéÆ Aventuras de Aprendizaje - Inicializando...');
            init();
        });

        // Funci√≥n auxiliar para debug en consola
        window.debugState = function() {
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('üîç DEBUG STATE');
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('Usuario actual:', currentUser);
            console.log('Estado:', state);
            console.log('Todos los usuarios:', allUsersData);
            console.log('Semanas cargadas:', weeksData ? Object.keys(weeksData).length : 0);
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        };
        
        console.log('‚úÖ C√≥digo JavaScript cargado correctamente');
        console.log('üí° Usa debugState() en consola para ver el estado actual');
    </script>
</body>
</html>
